## 1. 文件处理简要概述

文件处理是计算机编程中一个重要的主题，它涉及到读取和写入文件，以及对文件进行各种操作。文件处理允许程序与外部存储交互，实现数据的持久性保存。以下是文件处理的基本概念和用途：

文件是一组相关数据的集合，可以是文本文件（包含字符）或二进制文件（包含任意数据）。

C++ 操作一个文件的流程主要包括打开文件、读写文件、定位文件位置、关闭文件等步骤

打开、操作、关闭 >三步走

C++提供了丰富的文件处理功能，主要通过标准库中的文件流（**fstream**）类来实现。
![](assets/文件操作.jpg)
## 2. 文件的打开和关闭

在C++中，`fstream` 类是用于文件操作的重要类。它继承自 `ifstream` 和 `ofstream` 类，因此可以同时用于文件的读取和写入操作。以下是文件的打开和关闭流程：

  

**如何打开文件：**

使用 `fstream` 类的构造函数可以打开一个文件。构造函数的参数包括文件名和打开模式。

```C++
#include <fstream>

int main() {
    // 打开文件（默认为输出模式）
    std::fstream file("laojia.txt", std::ios::out);

    // 进行文件操作...

    // 关闭文件
    file.close();

    return 0;
}
```

  

**打开模式说明：**下面是使用表格展示文件打开模式说明的示例：

| **模式**               | **含义**                          |
| -------------------- | ------------------------------- |
| **std::ios::in**     | 以输入模式打开文件，用于读取数据。               |
| **std::ios::out**    | 以输出模式打开文件，用于写入数据。               |
| **std::ios::app**    | 以追加模式打开文件，新写入的内容会添加到文件末尾。append |
| **std::ios::ate**    | 打开文件并定位到文件末尾。 atend             |
| **std::ios::binary** | 以二进制模式打开文件，用于处理二进制数据。           |

多个模式之间用`“|”`运算符，联合。

```C++
// 以二进制模式打开文件 读写文件
fstream binaryFile("binary.bin", ios::binary | ios::out | ios::in);
```

关于in和out的困惑，画一幅画。
![](assets/in_out.jpg)
如果文件不使用 **close()** 关闭会有什么问题？

!!! note
	1. **资源泄漏：** 每次打开文件都会分配一些系统资源，如果不及时关闭文件，可能会导致资源泄漏，最终影响程序性能。
	2. **文件锁定：** 在某些操作系统中，文件可能会被锁定，防止其他程序或进程访问。如果文件没有关闭，其他程序可能无法正常访问该文件。
	3. **数据不稳定：** 未关闭的文件可能会导致数据不稳定，因为可能尚未将所有的写入操作完全刷新到磁盘上。

就像你同时为两个领导服务，你是什么感受？

## 3. 写文件

在C++中，使用 `ofstream` 类可以方便地进行文件写入操作。以下是一些写文件的常见操作：

### 3.1. 使用 `ofstream` 类写入文本文件

```C++
#include <iostream>
#include <fstream>
using namespace std;

int main() {
    // 打开文件进行写入
    ofstream outputFile("output.txt");

    // 检查文件是否成功打开
    if (!outputFile.is_open()) {
        cerr << "Unable to open file for writing." << endl;
        return 1;  // 退出程序，返回错误状态码
    }

    // 写入内容
    outputFile << "Hello, this is a line of text." << endl;

    // 关闭文件
    outputFile.close();

    return 0;
}
```

  

在这个例子中，我们使用 `ofstream` 打开名为 "output.txt" 的文件进行写入，然后将一行文本写入文件。最后，我们使用 `close()` 函数关闭文件。

### 3.2. 写入整行

```C++
#include <iostream>
#include <fstream>
using namespace std;

int main() {
    // 打开文件进行写入
    ofstream outputFile("output.txt");

    // 检查文件是否成功打开
    if (!outputFile.is_open()) {
        cerr << "Unable to open file for writing." << endl;
        return 1;  // 退出程序，返回错误状态码
    }

    // 写入整行
    outputFile << "This is a line of text." << endl;

    // 关闭文件
    outputFile.close();

    return 0;
}
```

### 3.3. 写入字符

```C++
#include <iostream>
#include <fstream>
using namespace std;

int main() {
    // 打开文件进行写入
    ofstream outputFile("output.txt");

    // 检查文件是否成功打开
    if (!outputFile.is_open()) {
        cerr << "Unable to open file for writing." << endl;
        return 1;  // 退出程序，返回错误状态码
    }

    // 写入字符
    outputFile.put('A');

    // 关闭文件
    outputFile.close();

    return 0;
}
```

  

### 3.4. 使用`write` 函数

下面是一个简单的C++写文件的示例，使用 `ofstream` 类和 `write` 函数：

  

```C++
#include <iostream>
#include <fstream>

int main() {
    // 打开文件以写入数据
    std::ofstream outFile("example.txt", std::ios::binary);

    if (!outFile) {
        std::cerr << "无法打开文件！" << std::endl;
        return 1;
    }

    // 数据准备
    char data[] = "Hello, World!";
    size_t size = sizeof(data);

    // 将数据写入文件
    outFile.write(data, size);

    // 关闭文件
    outFile.close();

    std::cout << "数据成功写入文件 'example.txt'" << std::endl;

    return 0;
}
```

  

在这个示例中，我们首先创建一个 `ofstream` 对象 `outFile`，并打开一个名为 "example.txt" 的文件，以二进制模式写入数据。接着，我们准备了一个包含字符串 "Hello, World!" 的字符数组 `data`，并使用 `write` 函数将数据写入文件。最后，我们关闭文件并输出成功的消息。

### 3.5. 文件不存在时的处理

在打开文件进行写入操作时，如果文件不存在，`ofstream` 会尝试创建文件。如果创建文件失败，可以使用 `is_open()` 函数检查文件是否成功打开，以便进行错误处理。在上述例子中，都包含了对文件是否成功打开的检查。

### 3.6. 写文件常用函数

在C++中写文件时，常用的一些成员函数包括 `ofstream` 类的成员函数。下面是一些主要的写文件成员函数以及它们的作用：

1. **open**：

	- 作用：打开文件，关联文件名和输出流。
	- 示例：`ofstreamObject.open("filename.txt");`

2. **is_open**：

	- 作用：检查文件是否成功打开。
	- 示例：`if (ofstreamObject.is_open()) { /* 文件成功打开 */ }`

3. **close**：

	- 作用：关闭文件。
	- 示例：`ofstreamObject.close();`

4. **seekp**：

	- 作用：设置文件写入位置。
	- 示例：`ofstreamObject.seekp(0, ios::beg);`

5. **tellp**：

	- 作用：获取当前的文件写入位置。
	- 示例：`streampos position = ofstreamObject.tellp();`

6. **write**：

	- 作用：将数据写入文件。
	- 示例：`ofstreamObject.write(data, size);`

7. **put**：

	- 作用：将一个字符写入文件。
	- 示例：`ofstreamObject.put('A');`

8. **operator<<**：

	- 作用：用于插入数据到文件，类似于输出流的 `<<` 操作符。
	- 示例：`ofstreamObject << "Hello, World!" << endl;`

9. **good**：

	- 作用：检查流的状态是否正常，返回 `true` 表示正常。
	- 示例：`if (ofstreamObject.good()) { /* 流状态正常 */ }`

10. **bad**：

	- 作用：检查流是否处于错误状态，返回 `true` 表示有错误。
	- 示例：`if (ofstreamObject.bad()) { /* 流处于错误状态 */ }`

11. **fail**：

	- 作用：检查流是否处于失败状态，返回 `true` 表示有失败。
	- 示例：`if (ofstreamObject.fail()) { /* 流处于失败状态 */ }`

12. **eof**：

	- 作用：检查是否已到达文件末尾。
	- 示例：`if (ofstreamObject.eof()) { /* 已到达文件末尾 */ }`

  

这些成员函数允许你在写文件时进行各种不同类型的操作，包括设置写入位置、写入数据、插入数据等，同时也可以通过状态函数检查文件流的状态。

## 4. 读文件

  

使用 ifstream 类读取文本文件

在C++中，可以使用 **ifstream** 类来方便地读取文本文件

### 4.1. 读取方式

![](assets/读文件.jpg)



