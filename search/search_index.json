{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\ud83d\udc4b Hello World! // \u6b22\u8fce\u6765\u5230\u8fd9\u4e2a\u4e0d\u592a\u6b63\u7ecf\u7684\u4ee3\u7801\u89d2\u843d // \u5982\u679c\u4f60\u5728\u5bfb\u627e\u4e00\u4e2a\u517c\u5177\u5e72\u8d27\u4e0e\u8da3\u5473\u7684\u6280\u672f\u535a\u5ba2 // \u90a3\u4e48\u606d\u559c\u4f60,\u4f60\u6765\u5bf9\u5730\u65b9\u4e86! \u6211\u662f\u4e00\u540d\u6280\u672f\u7231\u597d\u8005\u3002\u5728\u8fd9\u4e2a\u6570\u5b57\u4e16\u754c\u91cc\u65e5\u591c\u7801\u5b57\u7684\u540c\u65f6,\u4e5f\u60f3\u901a\u8fc7\u8fd9\u4e2a\u5c0f\u5929\u5730\u5206\u4eab\u4e00\u4e9b\u6280\u672f\u5fc3\u5f97\u548c\u7ecf\u9a8c\u603b\u7ed3\u3002 \ud83e\udd14 \u4e3a\u4ec0\u4e48\u8981\u5199\u8fd9\u4e2a\u535a\u5ba2? \u8bf4\u5b9e\u8bdd,\u6700\u521d\u53ea\u662f\u60f3\u627e\u4e2a\u5730\u65b9\u8bb0\u5f55\u4e00\u4e0b\u81ea\u5df1\u8e29\u8fc7\u7684\u5751(\u662f\u7684,\u975e\u5e38\u591a\u7684\u5751)\u3002\u540e\u6765\u53d1\u73b0,\u539f\u6765\u81ea\u5df1\u7684\u7ecf\u9a8c\u771f\u7684\u53ef\u4ee5\u5e2e\u52a9\u5230\u5176\u4ed6\u4eba,\u4e8e\u662f\u5c31\u575a\u6301\u4e86\u4e0b\u6765\u3002 \ud83d\udcda \u8fd9\u91cc\u6709\u4ec0\u4e48? \ud83d\udcdd \u6280\u672f\u6587\u7ae0 - \u4ece\u5165\u95e8\u5230\u653e\u5f03\u7684\u5168\u8fc7\u7a0b\u8bb0\u5f55 \ud83d\udd27 \u5b9e\u7528\u5de5\u5177 - \u63d0\u9ad8\u6548\u7387\u7684\u5404\u79cd\u5c0f\u6280\u5de7 \ud83d\udca1 \u7ecf\u9a8c\u5206\u4eab - \u8e29\u5751\u65e5\u8bb0\u548c\u89e3\u51b3\u65b9\u6848 \ud83c\udfae \u968f\u7b14\u611f\u609f - \u7801\u519c\u7684\u65e5\u5e38\u5410\u69fd \ud83c\udfaf \u535a\u5ba2\u7279\u8272 // \u8fd9\u4e2a\u535a\u5ba2\u7684\u7279\u70b9: // 1. \u4e0d\u88c5\u903c - \u7528\u6700\u901a\u4fd7\u7684\u8bed\u8a00\u8bb2\u6280\u672f // 2. \u6709\u6001\u5ea6 - \u5b9e\u4e8b\u6c42\u662f,\u62d2\u7edd\u7a7a\u8c08 // 3. \u91cd\u5b9e\u8df5 - \u7406\u8bba\u7ed3\u5408\u5b9e\u9645,\u6ce8\u91cd\u5e94\u7528 // 4. \u7231\u5206\u4eab - \u5f00\u6e90\u7cbe\u795e,\u77e5\u8bc6\u5171\u4eab \ud83e\udd1d \u4ea4\u4e2a\u670b\u53cb? \u5982\u679c\u4f60\u4e5f\u662f: - \u70ed\u7231\u6280\u672f\u7684\u6781\u5ba2 - \u559c\u6b22\u94bb\u7814\u7684\u5de5\u7a0b\u5e08 - \u6216\u8005\u5c31\u662f\u4e2a\u5bf9\u7f16\u7a0b\u611f\u5174\u8da3\u7684\u666e\u901a\u4eba \u90a3\u5c31\u7559\u4e0b\u6765\u770b\u770b\u5427! \u8bf4\u4e0d\u5b9a\u6211\u4eec\u80fd\u6210\u4e3a\u5fd7\u540c\u9053\u5408\u7684\u670b\u53cb\u5462~ \ud83d\udce2 \u53cb\u60c5\u63d0\u793a // WARNING: // \u672c\u535a\u5ba2\u542b\u6709\u5927\u91cf\u6280\u672f\u5e72\u8d27 // \u53ef\u80fd\u4f1a\u5bfc\u81f4\u6280\u672f\u6c34\u5e73\u4e0d\u81ea\u89c9\u63d0\u5347 // \u8bf7\u8c28\u614e\u9605\u8bfb \"\u4ee3\u7801\u5199\u5230\u53cc\u624b\u53d1\u8f6f, \u5374\u4f9d\u7136\u6539\u4e0d\u5b8cBug\u7684\u65f6\u5019, \u522b\u5fd8\u4e86\u6765\u8fd9\u91cc\u627e\u627e\u89e3\u51b3\u65b9\u6848!\" PS: \u5982\u679c\u4f60\u53d1\u73b0\u6587\u7ae0\u4e2d\u6709\u9519\u8bef,\u8bf7\u4e0d\u8981\u5ba2\u6c14,\u76f4\u63a5\u6307\u51fa\u6765\u3002\u6bd5\u7adf\u5728\u7a0b\u5e8f\u5458\u7684\u4e16\u754c\u91cc,\"debug\"\u5c31\u662f\u6211\u4eec\u7684\u65e5\u5e38\u5de5\u4f5c\u561b! \ud83d\ude09","title":"\u9996\u9875"},{"location":"#hello-world","text":"// \u6b22\u8fce\u6765\u5230\u8fd9\u4e2a\u4e0d\u592a\u6b63\u7ecf\u7684\u4ee3\u7801\u89d2\u843d // \u5982\u679c\u4f60\u5728\u5bfb\u627e\u4e00\u4e2a\u517c\u5177\u5e72\u8d27\u4e0e\u8da3\u5473\u7684\u6280\u672f\u535a\u5ba2 // \u90a3\u4e48\u606d\u559c\u4f60,\u4f60\u6765\u5bf9\u5730\u65b9\u4e86! \u6211\u662f\u4e00\u540d\u6280\u672f\u7231\u597d\u8005\u3002\u5728\u8fd9\u4e2a\u6570\u5b57\u4e16\u754c\u91cc\u65e5\u591c\u7801\u5b57\u7684\u540c\u65f6,\u4e5f\u60f3\u901a\u8fc7\u8fd9\u4e2a\u5c0f\u5929\u5730\u5206\u4eab\u4e00\u4e9b\u6280\u672f\u5fc3\u5f97\u548c\u7ecf\u9a8c\u603b\u7ed3\u3002","title":"\ud83d\udc4b Hello World!"},{"location":"#_1","text":"\u8bf4\u5b9e\u8bdd,\u6700\u521d\u53ea\u662f\u60f3\u627e\u4e2a\u5730\u65b9\u8bb0\u5f55\u4e00\u4e0b\u81ea\u5df1\u8e29\u8fc7\u7684\u5751(\u662f\u7684,\u975e\u5e38\u591a\u7684\u5751)\u3002\u540e\u6765\u53d1\u73b0,\u539f\u6765\u81ea\u5df1\u7684\u7ecf\u9a8c\u771f\u7684\u53ef\u4ee5\u5e2e\u52a9\u5230\u5176\u4ed6\u4eba,\u4e8e\u662f\u5c31\u575a\u6301\u4e86\u4e0b\u6765\u3002","title":"\ud83e\udd14 \u4e3a\u4ec0\u4e48\u8981\u5199\u8fd9\u4e2a\u535a\u5ba2?"},{"location":"#_2","text":"\ud83d\udcdd \u6280\u672f\u6587\u7ae0 - \u4ece\u5165\u95e8\u5230\u653e\u5f03\u7684\u5168\u8fc7\u7a0b\u8bb0\u5f55 \ud83d\udd27 \u5b9e\u7528\u5de5\u5177 - \u63d0\u9ad8\u6548\u7387\u7684\u5404\u79cd\u5c0f\u6280\u5de7 \ud83d\udca1 \u7ecf\u9a8c\u5206\u4eab - \u8e29\u5751\u65e5\u8bb0\u548c\u89e3\u51b3\u65b9\u6848 \ud83c\udfae \u968f\u7b14\u611f\u609f - \u7801\u519c\u7684\u65e5\u5e38\u5410\u69fd","title":"\ud83d\udcda \u8fd9\u91cc\u6709\u4ec0\u4e48?"},{"location":"#_3","text":"// \u8fd9\u4e2a\u535a\u5ba2\u7684\u7279\u70b9: // 1. \u4e0d\u88c5\u903c - \u7528\u6700\u901a\u4fd7\u7684\u8bed\u8a00\u8bb2\u6280\u672f // 2. \u6709\u6001\u5ea6 - \u5b9e\u4e8b\u6c42\u662f,\u62d2\u7edd\u7a7a\u8c08 // 3. \u91cd\u5b9e\u8df5 - \u7406\u8bba\u7ed3\u5408\u5b9e\u9645,\u6ce8\u91cd\u5e94\u7528 // 4. \u7231\u5206\u4eab - \u5f00\u6e90\u7cbe\u795e,\u77e5\u8bc6\u5171\u4eab","title":"\ud83c\udfaf \u535a\u5ba2\u7279\u8272"},{"location":"#_4","text":"\u5982\u679c\u4f60\u4e5f\u662f: - \u70ed\u7231\u6280\u672f\u7684\u6781\u5ba2 - \u559c\u6b22\u94bb\u7814\u7684\u5de5\u7a0b\u5e08 - \u6216\u8005\u5c31\u662f\u4e2a\u5bf9\u7f16\u7a0b\u611f\u5174\u8da3\u7684\u666e\u901a\u4eba \u90a3\u5c31\u7559\u4e0b\u6765\u770b\u770b\u5427! \u8bf4\u4e0d\u5b9a\u6211\u4eec\u80fd\u6210\u4e3a\u5fd7\u540c\u9053\u5408\u7684\u670b\u53cb\u5462~","title":"\ud83e\udd1d \u4ea4\u4e2a\u670b\u53cb?"},{"location":"#_5","text":"// WARNING: // \u672c\u535a\u5ba2\u542b\u6709\u5927\u91cf\u6280\u672f\u5e72\u8d27 // \u53ef\u80fd\u4f1a\u5bfc\u81f4\u6280\u672f\u6c34\u5e73\u4e0d\u81ea\u89c9\u63d0\u5347 // \u8bf7\u8c28\u614e\u9605\u8bfb \"\u4ee3\u7801\u5199\u5230\u53cc\u624b\u53d1\u8f6f, \u5374\u4f9d\u7136\u6539\u4e0d\u5b8cBug\u7684\u65f6\u5019, \u522b\u5fd8\u4e86\u6765\u8fd9\u91cc\u627e\u627e\u89e3\u51b3\u65b9\u6848!\" PS: \u5982\u679c\u4f60\u53d1\u73b0\u6587\u7ae0\u4e2d\u6709\u9519\u8bef,\u8bf7\u4e0d\u8981\u5ba2\u6c14,\u76f4\u63a5\u6307\u51fa\u6765\u3002\u6bd5\u7adf\u5728\u7a0b\u5e8f\u5458\u7684\u4e16\u754c\u91cc,\"debug\"\u5c31\u662f\u6211\u4eec\u7684\u65e5\u5e38\u5de5\u4f5c\u561b! \ud83d\ude09","title":"\ud83d\udce2 \u53cb\u60c5\u63d0\u793a"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/01/","text":"\u301001\u3011\u5b89\u88c5\u4e0e\u57fa\u672c\u4ecb\u7ecd \u6559\u5b66\u89c6\u9891 ::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili \u5728\u5b89\u88c5\u67d0\u4e9b\u5f00\u6e90\u5e93\u7684\u65f6\u5019\uff0c\u5982\u679c\u6d89\u53ca\u5230\u6e90\u7801\u7f16\u8bd1\uff0c\u7ecf\u5e38\u4f1a\u4f7f\u7528 CMake \u5b8c\u6210\u6784\u5efa\u3001\u5b89\u88c5\uff0c\u521d\u6b21\u63a5\u89e6 CMake \u65f6\uff0c\u6211\u4eec\u5148\u56de\u7b54 CMake \u662f\u4ec0\u4e48 \u4e3a\u4ec0\u4e48\u7528 CMake \u600e\u4e48\u7528 CMake \u8fd9\u4e09\u4e2a\u95ee\u9898\u3002\u5728\u5bf9 CMake \u6709\u4e2a\u5927\u6982\u5370\u8c61\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7ee7\u7eed\u63a2\u7d22\u66f4\u9ad8\u7ea7\u3001\u66f4\u73b0\u4ee3\u7684\u7528\u6cd5\u3002 1. CMake \u662f\u4ec0\u4e48 \u4e0b\u6587\u662f\u4e00\u53e5\u6765\u81ea\u767e\u5ea6\u767e\u79d1\u7684\u5b9a\u4e49\uff0c\u6211\u4eec\u7b80\u5355\u505a\u4e2a\u5206\u6bb5\uff0c\u5e76\u6682\u65f6\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u5185\u5bb9\u3002 CMake \u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u5b89\u88c5\uff08\u7f16\u8bd1\uff09\u5de5\u5177\uff0c\u53ef\u4ee5\u7528\u7b80\u5355\u7684\u8bed\u53e5\u6765\u63cf\u8ff0\u6240\u6709\u5e73\u53f0\u7684\u5b89\u88c5(\u7f16\u8bd1\u8fc7\u7a0b) \u4ed6\u80fd\u591f\u8f93\u51fa\u5404\u79cd\u5404\u6837\u7684 makefile \u6216\u8005 project \u6587\u4ef6 CMake \u5e76\u4e0d\u76f4\u63a5\u5efa\u6784\u51fa\u6700\u7ec8\u7684\u8f6f\u4ef6\uff0c\u800c\u662f\u4ea7\u751f\u6807\u51c6\u7684\u5efa\u6784\u6863\uff08\u5982 Unix \u7684 Makefile \u6216 Windows Visual C++ \u7684 projects/workspaces\uff09\uff0c\u7136\u540e\u518d\u4f9d\u4e00\u822c\u7684\u5efa\u6784\u65b9\u5f0f\u4f7f\u7528 \u9996\u5148\u6211\u4eec\u53ef\u4ee5\u660e\u786e\uff0cCMake \u662f\u4e00\u4e2a==\u8de8\u5e73\u53f0\u5de5\u5177==\u3002\u7b80\u5355\u7684\u3001\u72ed\u9698\u7684\u8bf4\uff0c\u8de8\u5e73\u53f0\u5c31\u662f\u53ef\u4ee5\u5728 Windows\u3001Linux \u53d1\u884c\u7248\u4e43\u81f3 MacOS \u7b49\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u4f7f\u7528\u3002 \u5176\u6b21\uff0cCMake \u4f7f\u7528\u4e0e Python \u6027\u8d28\u7b49\u540c\u7684\u811a\u672c\u8bed\u8a00\u3002Python \u4e00\u822c\u5728\u6267\u884c\u67d0\u4e2a py \u6587\u4ef6\u7684\u65f6\u5019\uff0c\u4f1a\u4f7f\u7528 python3 main.py \u8fd9\u79cd\u8bed\u53e5\uff0c\u5b8c\u6210\u5bf9 main.py \u7684\u9010\u884c\u89e3\u6790\uff0cCMake \u540c\u6837\uff0c\u5728\u8fd0\u884c cmake .. # .. \u5c31\u8868\u793a\u4e0a\u4e00\u7ea7\u6587\u4ef6\u5939 \u540e\uff0c\u53ef\u4ee5\u89e3\u6790\u6765\u81ea\u4e0a\u4e00\u7ea7\u6587\u4ef6\u5939\u4e2d CMakeLists.txt \u91cc\u7684\u5185\u5bb9\uff0c\u5e76\u5c06\u4ea7\u7269\u8f93\u51fa\u5230\u5f53\u524d\u6587\u4ef6\u5939\u3002\u56e0\u6b64\uff0cCMake \u89e3\u6790\u7684\u6587\u4ef6\u4e00\u822c\u90fd\u662f\u540d\u4e3a CMakeLists.txt \u7684\u6587\u4ef6\uff0c\u5f53\u7136\u8fd8\u6709\u5176\u4ed6\u7c7b\u578b\u7684\u6587\u4ef6\uff0c\u5728\u540e\u6587\u4f1a\u8be6\u7ec6\u4ecb\u7ecd\u3002 \u6700\u540e\uff0c\u9700\u8981\u5f3a\u8c03\u4e00\u70b9\uff0c CMake \u5e76\u4e0d\u662f\u4e00\u4e2a\u7f16\u8bd1\u5668\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u7f16\u8bd1\u5de5\u5177 \uff0c\u6b63\u5982\u767e\u5ea6\u767e\u79d1\u6240\u8bf4\uff0cCMake \u4e0d\u76f4\u63a5\u5efa\u6784\u51fa\u6700\u7ec8\u7684\u8f6f\u4ef6\uff0cCMake \u4e3b\u8981\u4f5c\u7528\u5c31\u662f\u80fd\u591f \u4f7f\u7528\u7edf\u4e00\u7684\u8bed\u6cd5\uff0c\u5728\u7279\u5b9a\u5e73\u53f0\u4e0b\uff0c\u751f\u6210\u80fd\u591f\u6307\u5bfc\u7f16\u8bd1\u5668\u5b8c\u6210\u7f16\u8bd1\u5de5\u4f5c\u7684\u6587\u4ef6 \uff0c\u8fd9\u4e00\u6587\u4ef6\u6211\u4eec\u79f0\u4e4b\u4e3a==\u5efa\u6784\u6863==\uff0c\u7528\u4e8e\u751f\u6210\u5efa\u6784\u6863\u7684\u7edf\u4e00\u8bed\u6cd5\u7684\u6587\u4ef6\uff0c\u5373 CMakeLists.txt \u6587\u4ef6\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a==\u7ec4\u6001\u6863==\u3002 2. \u4e3a\u4ec0\u4e48\u7528 CMake 2.1 \u8bed\u6cd5\u7edf\u4e00 \u4e0d\u540c\u7684\u5e73\u53f0\u7f16\u8bd1\u5668\u3001\u7cfb\u7edf\u73af\u5883\u3001\u53ef\u6267\u884c\u6587\u4ef6\u683c\u5f0f\u90fd\u4e0d\u76f8\u540c\uff0c\u751f\u6210\u53ef\u6267\u884c\u7a0b\u5e8f\u7684\u65b9\u5f0f\u4e5f\u4e0d\u5c3d\u76f8\u540c\uff0c\u4f8b\u5982\uff0c\u5bf9\u4e8e\u540c\u6837\u7684\u4e00\u4e2a main.cpp \u5728 Ubuntu \u4e0a\uff0c\u4e00\u822c\u4f1a\u4f7f\u7528 gcc/g++ \u7f16\u8bd1\u5668\u5b8c\u6210 C/C++ \u6587\u4ef6\u7684\u7f16\u8bd1\uff0c\u6267\u884c bash g++ main.cpp -o demo \u6700\u7ec8\u751f\u6210\u4e00\u4e2a\u4e8c\u8fdb\u5236\u7684\u53ef\u6267\u884c\u7a0b\u5e8f demo \u5728 Windows \u4e0a\uff0c\u5f97\u76ca\u4e8e Visual Studio \u5f3a\u5927\u7684 IDE\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5728\u8be5 IDE \u4e0a\u96c6\u6210\u597d\u7f16\u8bd1\u5668\uff08MSVC\uff09\u5b8c\u6210\u6e90\u6587\u4ef6\u7684\u7f16\u8bd1\uff0c\u4e00\u822c\u70b9\u51fb Visual Studio \u7684 \u751f\u6210\u89e3\u51b3\u65b9\u6848 \uff0c\u53ef\u4ee5\u5728\u9879\u76ee\u7684\u6587\u4ef6\u5939\u4e0b\u751f\u6210\u4e00\u4e2a .exe \u6587\u4ef6\uff0c\u8fd9\u5c31\u662f\u5728 Windows \u4e0a\u6700\u7ec8\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u7a0b\u5e8f \u4f46\u4f7f\u7528 CMake \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u7edf\u4e00\u7684\u8bed\u53e5\u751f\u6210 \u5efa\u6784\u6863 \u3002 \u5728 Ubuntu \u4e0a\uff0c\u751f\u6210\u80fd\u591f\u88ab Unix makefile \u89e3\u6790\u7684 Makefile \u6587\u4ef6\uff0c\u8fd9\u4e00\u6587\u4ef6\u53ef\u4ee5\u6307\u5bfc gcc/g++ \u7f16\u8bd1\u5668\u5b8c\u6210\u6784\u5efa\uff08\u7f16\u8bd1\uff09\u5de5\u4f5c\uff0c Makefile \u6587\u4ef6\u5c31\u662f\u5efa\u6784\u6863\u3002 \u5728 Windows \u4e0a\uff0c\u751f\u6210\u80fd\u591f\u88ab Visual Studio MSBuild \u89e3\u6790\u7684 *.sln \u89e3\u51b3\u65b9\u6848\u6587\u4ef6\uff0c\u8fd9\u4e00\u6587\u4ef6\u53ef\u4ee5\u6307\u5bfc MSVC \u7f16\u8bd1\u5668\u5b8c\u6210\u6784\u5efa\uff08\u7f16\u8bd1\uff09\u5de5\u4f5c\uff0c *.sln \u6587\u4ef6\u5c31\u662f\u5efa\u6784\u6863\u3002 2.2 \u529f\u80fd\u5f3a\u5927 \u8fc4\u4eca\u4e3a\u6b62\uff0cCMake 3.x \u7cfb\u5217\u5df2\u7ecf\u53d1\u5e03\u4e86\u8d85\u8fc7 30 \u4e2a\u7248\u672c\uff0c\u622a\u81f3 2024/11/29 \u7684\u6700\u65b0\u7248\u672c\u662f 3.31.1 \uff0c\u540e\u7eed\u7684\u4ecb\u7ecd\u5747\u4ee5 3.16 \u4e3a\u6700\u5c0f\u7248\u672c\u3002\u901a\u8fc7 CMake \u53ef\u4ee5\u5728\u751f\u6210 \u5efa\u6784\u6863 \u4e4b\u524d\u5b9e\u73b0 \u7b2c\u4e09\u65b9\u4f9d\u8d56\u5e93\u7684\u4e0b\u8f7d\u3001\u5305\u542b \u6587\u4ef6\u89e3\u6790\u3001\u751f\u6210 C/C++ \u5b8f\u7684\u751f\u6210 3. \u600e\u4e48\u7528 CMake 3.1 \u5b89\u88c5 \u9996\u5148\u5b89\u88c5 CMake\uff0c\u8fd9\u91cc\u7ed9\u51fa\u4e24\u79cd\u5b89\u88c5\u65b9\u5f0f 3.1.1 \u8f6f\u4ef6\u6e90\u5b89\u88c5 \u8fd9\u79cd\u5b89\u88c5\u65b9\u5f0f\u6700\u5feb\uff0c\u4f46\u7248\u672c\u6bd4\u8f83\u53d7\u9650\uff0c\u5728\u8f83\u65b0\u7684 Linux \u53d1\u884c\u7248\u4e0a\u7248\u672c\u4f1a\u65b0\u4e00\u70b9\u3002\u8fd9\u91cc\u4ee5 Debian \u7cfb\u53d1\u884c\u7248\u4e3a\u4f8b\uff0c\u53ef\u4f7f\u7528 APT \u5305\u7ba1\u7406\u5de5\u5177\u8fdb\u884c\u5b89\u88c5 sudo apt install cmake cmake-qt-gui cmake-curses-gui \u6765\u5b89\u88c5 CMake \u5de5\u5177\uff0c\u4f8b\u5982\uff0c\u5728 Ubuntu 18.04 \u4e0b\uff0c\u5bf9\u5e94\u7684\u7248\u672c\u4e3a 3.10 20.04 \u4e0b\uff0c\u5bf9\u5e94\u7684\u7248\u672c\u4e3a 3.16 22.04 \u4e0b\uff0c\u5bf9\u5e94\u7684\u7248\u672c\u4e3a 3.22 3.1.2 \u4e0b\u8f7d\u4e8c\u8fdb\u5236\u5305 \u53ef\u76f4\u63a5\u5728 Github \u4e2d\u6253\u5f00 CMake Release \uff0c\u627e\u5230\u4f60\u60f3\u4e0b\u8f7d\u7684\u7248\u672c\uff0c\u70b9\u51fb\u5bf9\u5e94\u7684\u538b\u7f29\u5305\uff0c\u4f8b\u5982\u5728 x64 \u73af\u5883\u4e0b\u7684 Linux \u53ef\u9009\u62e9 cmake-x.xx.x-linux-x86_64.tar.gz \uff0c\u4e0b\u8f7d\u540e\u8fdb\u884c\u89e3\u538b\uff0c\u5c31\u5f97\u5230\u4e86\u6240\u6709 CMake \u5de5\u5177\u3002\u6b64\u5916\uff0c\u53ef\u81ea\u884c\u5b89\u88c5\u5230\u7cfb\u7edf\u8def\u5f84\u4e0b\uff0c\u4ee5 cmake-3.29.0-linux-x86_64.tar.gz \u4e3a\u4f8b\uff0c\u53ef\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4 tar xf cmake-3.29.0-linux-x86_64.tar.gz # \u89e3\u538b cd cmake-3.29.0-linux-x86_64 sudo cp -r * /usr/local # \u5b89\u88c5\u81f3 /usr/local ::: tip Windows \u7528\u6237\u53ef\u5728 CMake \u5b98\u7f51 \u4e0b\u8f7d\u5bf9\u5e94\u7684 *.msi \u5b89\u88c5\u5305\uff0c\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u5c31\u53ef\u4ee5\u5728\u547d\u4ee4\u884c\u4e2d\u4f7f\u7528 cmake \u547d\u4ee4\u4e86\u3002 ::: 3.2 CMake \u751f\u6210\u5efa\u6784\u6863\u7684\u6b65\u9aa4 \u7136\u540e\u6211\u4eec\u518d\u5bf9\u4e0a\u6587\u901a\u8fc7 main.cpp \u751f\u6210\u5efa\u6784\u6863\u7684\u8fc7\u7a0b\u505a\u4e2a\u4ecb\u7ecd\uff0c\u4e86\u89e3 CMake \u751f\u6210\u5efa\u6784\u6863\u7684\u57fa\u672c\u6b65\u9aa4\u3002 \u9996\u5148\u5728 main.cpp \u540c\u7ea7\u76ee\u5f55\u4e0b\u521b\u5efa CMakeLists.txt \u6587\u4ef6\uff0c\u8fd9\u5c31\u662f CMake \u751f\u6210\u5efa\u6784\u6863\u6240\u53c2\u8003\uff08\u89e3\u6790\uff09\u7684\u6587\u4ef6\uff0c\u5e76\u5728\u5176\u4e2d\u5199\u5165 # \u6307\u5b9a CMake \u7684\u6700\u5c0f\u7248\u672c\u53f7\uff0c\u4f4e\u4e8e\u6b64\u7248\u672c\u7684 CMake \u5c06\u7ec8\u6b62\u5efa\u6784\u6863\u7684\u751f\u6210\u8fc7\u7a0b cmake_minimum_required(VERSION 3.16) # \u521b\u5efa\u9879\u76ee project( Demo # \u8bbe\u7f6e\u9879\u76ee\u540d LANGUAGES CXX # \u6307\u5b9a\u8bed\u8a00\uff0c\u672a\u6307\u5b9a\u7684\u8bed\u8a00\u5c06\u4e0d\u53c2\u4e0e\u6784\u5efa\uff0c\u4f8b\u5982 test.c \u6587\u4ef6 ) # \u521b\u5efa\u53ef\u6267\u884c\u6587\u4ef6 add_executable( demo # \u76ee\u6807\u540d main.cpp # \u7528\u5230\u7684\u6e90\u6587\u4ef6 ) \u521b\u5efa\u597d\u540e\uff0c\u5728\u9879\u76ee\u4e0b\u521b\u5efa build \u6587\u4ef6\u5939\uff0c\u5728\u8be5\u6587\u4ef6\u5939\u4e0b\u6253\u5f00\u7ec8\u7aef\uff08Windows \u4e0b\u53ef\u4ee5\u662f PowerShell\uff09\uff0c\u8f93\u5165 cmake .. \u5373\u53ef\u5728\u5f53\u524d\u6587\u4ef6\u5939\u4e0b\u751f\u6210\u5bf9\u5e94\u7684\u5efa\u6784\u6863\u3002 \u4ee5\u4e0a\u5c31\u662f\u5229\u7528 CMake \u751f\u6210\u5efa\u6784\u6863\u7684\u57fa\u672c\u6d41\u7a0b\uff0c\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u5728 add_executable \u4e2d\u6211\u4eec\u6d89\u53ca\u5230\u4e86\u4e00\u4e2a\u65b0\u7684\u540d\u8bcd\uff1a\u76ee\u6807\uff08target\uff09\uff0c\u76ee\u6807\u662f CMake \u62bd\u8c61\u51fa\u6765\u7684\u4e00\u4e2a\u6982\u5ff5\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u7406\u89e3\u4e3a\u5177\u6709 \u540d\u79f0 \u5305\u542b\u7684\u6587\u4ef6\u5939 \u5176\u4f59\u7f16\u8bd1\u5c5e\u6027 \u4f9d\u8d56\u7684\u5176\u4ed6\u76ee\u6807 \u7684\u4e00\u4e2a\u7c7b\uff0c\u53ef\u4ee5\u4f7f\u7528C++\u7684\u7c7b\u6765\u63cf\u8ff0\u76ee\u6807\u8fd9\u4e00\u6982\u5ff5 // CMake \u76ee\u6807 struct Target { string name; // \u540d\u79f0 vector<string> include_directories; // \u5305\u542b\u7684\u6587\u4ef6\u5939 vector<string> properties; // \u5176\u4f59\u7f16\u8bd1\u5c5e\u6027 vector<Target *> targets; // \u4f9d\u8d56\u7684\u5176\u4ed6\u76ee\u6807 }; \u901a\u8fc7\u4e0a\u6587\u53ef\u4ee5\u5f97\u77e5\uff0c\u76ee\u6807\u5177\u6709\u4f9d\u8d56\u5173\u7cfb\uff0c\u56e0\u6b64\u76ee\u6807\u4e0d\u4ec5\u53ea\u6709\u53ef\u6267\u884c\u6587\u4ef6\u8fd9\u4e00\u5f62\u5f0f\uff0c\u8fd8\u5177\u6709\u522b\u7684\u5f62\u5f0f\uff0c\u5728 \u301005\u3011\u76ee\u6807\u6784\u5efa \u4f1a\u8be6\u7ec6\u7ed9\u51fa\u76ee\u6807\u5305\u542b\u7684\u5185\u5bb9\u3002 ::: tip \u603b\u7ed3 CMake \u751f\u6210\u5efa\u6784\u6863\u7684\u8fc7\u7a0b\u53ef\u4ee5\u7b80\u5355\u6982\u62ec\u6210 \u521b\u5efa\u9879\u76ee \u76ee\u6807\u6784\u5efa \u5bfc\u51fa\u914d\u7f6e\uff08\u5982\u679c\u6709\u5b89\u88c5\u7684\u9700\u6c42\uff0c\u5219\u9700\u8981\u505a\uff09 ::: \u8be6\u7ec6\u7684\u5185\u5bb9\u4f1a\u5728\u540e\u6587\u4ecb\u7ecd\u3002 \u00b7\u00b7\u00b7","title":"\u301001\u3011\u5b89\u88c5\u4e0e\u57fa\u672c\u4ecb\u7ecd"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/01/#01","text":"","title":"\u301001\u3011\u5b89\u88c5\u4e0e\u57fa\u672c\u4ecb\u7ecd"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/01/#_1","text":"::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili \u5728\u5b89\u88c5\u67d0\u4e9b\u5f00\u6e90\u5e93\u7684\u65f6\u5019\uff0c\u5982\u679c\u6d89\u53ca\u5230\u6e90\u7801\u7f16\u8bd1\uff0c\u7ecf\u5e38\u4f1a\u4f7f\u7528 CMake \u5b8c\u6210\u6784\u5efa\u3001\u5b89\u88c5\uff0c\u521d\u6b21\u63a5\u89e6 CMake \u65f6\uff0c\u6211\u4eec\u5148\u56de\u7b54 CMake \u662f\u4ec0\u4e48 \u4e3a\u4ec0\u4e48\u7528 CMake \u600e\u4e48\u7528 CMake \u8fd9\u4e09\u4e2a\u95ee\u9898\u3002\u5728\u5bf9 CMake \u6709\u4e2a\u5927\u6982\u5370\u8c61\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7ee7\u7eed\u63a2\u7d22\u66f4\u9ad8\u7ea7\u3001\u66f4\u73b0\u4ee3\u7684\u7528\u6cd5\u3002","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/01/#1-cmake","text":"\u4e0b\u6587\u662f\u4e00\u53e5\u6765\u81ea\u767e\u5ea6\u767e\u79d1\u7684\u5b9a\u4e49\uff0c\u6211\u4eec\u7b80\u5355\u505a\u4e2a\u5206\u6bb5\uff0c\u5e76\u6682\u65f6\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u5185\u5bb9\u3002 CMake \u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u5b89\u88c5\uff08\u7f16\u8bd1\uff09\u5de5\u5177\uff0c\u53ef\u4ee5\u7528\u7b80\u5355\u7684\u8bed\u53e5\u6765\u63cf\u8ff0\u6240\u6709\u5e73\u53f0\u7684\u5b89\u88c5(\u7f16\u8bd1\u8fc7\u7a0b) \u4ed6\u80fd\u591f\u8f93\u51fa\u5404\u79cd\u5404\u6837\u7684 makefile \u6216\u8005 project \u6587\u4ef6 CMake \u5e76\u4e0d\u76f4\u63a5\u5efa\u6784\u51fa\u6700\u7ec8\u7684\u8f6f\u4ef6\uff0c\u800c\u662f\u4ea7\u751f\u6807\u51c6\u7684\u5efa\u6784\u6863\uff08\u5982 Unix \u7684 Makefile \u6216 Windows Visual C++ \u7684 projects/workspaces\uff09\uff0c\u7136\u540e\u518d\u4f9d\u4e00\u822c\u7684\u5efa\u6784\u65b9\u5f0f\u4f7f\u7528 \u9996\u5148\u6211\u4eec\u53ef\u4ee5\u660e\u786e\uff0cCMake \u662f\u4e00\u4e2a==\u8de8\u5e73\u53f0\u5de5\u5177==\u3002\u7b80\u5355\u7684\u3001\u72ed\u9698\u7684\u8bf4\uff0c\u8de8\u5e73\u53f0\u5c31\u662f\u53ef\u4ee5\u5728 Windows\u3001Linux \u53d1\u884c\u7248\u4e43\u81f3 MacOS \u7b49\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u4f7f\u7528\u3002 \u5176\u6b21\uff0cCMake \u4f7f\u7528\u4e0e Python \u6027\u8d28\u7b49\u540c\u7684\u811a\u672c\u8bed\u8a00\u3002Python \u4e00\u822c\u5728\u6267\u884c\u67d0\u4e2a py \u6587\u4ef6\u7684\u65f6\u5019\uff0c\u4f1a\u4f7f\u7528 python3 main.py \u8fd9\u79cd\u8bed\u53e5\uff0c\u5b8c\u6210\u5bf9 main.py \u7684\u9010\u884c\u89e3\u6790\uff0cCMake \u540c\u6837\uff0c\u5728\u8fd0\u884c cmake .. # .. \u5c31\u8868\u793a\u4e0a\u4e00\u7ea7\u6587\u4ef6\u5939 \u540e\uff0c\u53ef\u4ee5\u89e3\u6790\u6765\u81ea\u4e0a\u4e00\u7ea7\u6587\u4ef6\u5939\u4e2d CMakeLists.txt \u91cc\u7684\u5185\u5bb9\uff0c\u5e76\u5c06\u4ea7\u7269\u8f93\u51fa\u5230\u5f53\u524d\u6587\u4ef6\u5939\u3002\u56e0\u6b64\uff0cCMake \u89e3\u6790\u7684\u6587\u4ef6\u4e00\u822c\u90fd\u662f\u540d\u4e3a CMakeLists.txt \u7684\u6587\u4ef6\uff0c\u5f53\u7136\u8fd8\u6709\u5176\u4ed6\u7c7b\u578b\u7684\u6587\u4ef6\uff0c\u5728\u540e\u6587\u4f1a\u8be6\u7ec6\u4ecb\u7ecd\u3002 \u6700\u540e\uff0c\u9700\u8981\u5f3a\u8c03\u4e00\u70b9\uff0c CMake \u5e76\u4e0d\u662f\u4e00\u4e2a\u7f16\u8bd1\u5668\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u7f16\u8bd1\u5de5\u5177 \uff0c\u6b63\u5982\u767e\u5ea6\u767e\u79d1\u6240\u8bf4\uff0cCMake \u4e0d\u76f4\u63a5\u5efa\u6784\u51fa\u6700\u7ec8\u7684\u8f6f\u4ef6\uff0cCMake \u4e3b\u8981\u4f5c\u7528\u5c31\u662f\u80fd\u591f \u4f7f\u7528\u7edf\u4e00\u7684\u8bed\u6cd5\uff0c\u5728\u7279\u5b9a\u5e73\u53f0\u4e0b\uff0c\u751f\u6210\u80fd\u591f\u6307\u5bfc\u7f16\u8bd1\u5668\u5b8c\u6210\u7f16\u8bd1\u5de5\u4f5c\u7684\u6587\u4ef6 \uff0c\u8fd9\u4e00\u6587\u4ef6\u6211\u4eec\u79f0\u4e4b\u4e3a==\u5efa\u6784\u6863==\uff0c\u7528\u4e8e\u751f\u6210\u5efa\u6784\u6863\u7684\u7edf\u4e00\u8bed\u6cd5\u7684\u6587\u4ef6\uff0c\u5373 CMakeLists.txt \u6587\u4ef6\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a==\u7ec4\u6001\u6863==\u3002","title":"1. CMake \u662f\u4ec0\u4e48"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/01/#2-cmake","text":"","title":"2. \u4e3a\u4ec0\u4e48\u7528 CMake"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/01/#21","text":"\u4e0d\u540c\u7684\u5e73\u53f0\u7f16\u8bd1\u5668\u3001\u7cfb\u7edf\u73af\u5883\u3001\u53ef\u6267\u884c\u6587\u4ef6\u683c\u5f0f\u90fd\u4e0d\u76f8\u540c\uff0c\u751f\u6210\u53ef\u6267\u884c\u7a0b\u5e8f\u7684\u65b9\u5f0f\u4e5f\u4e0d\u5c3d\u76f8\u540c\uff0c\u4f8b\u5982\uff0c\u5bf9\u4e8e\u540c\u6837\u7684\u4e00\u4e2a main.cpp \u5728 Ubuntu \u4e0a\uff0c\u4e00\u822c\u4f1a\u4f7f\u7528 gcc/g++ \u7f16\u8bd1\u5668\u5b8c\u6210 C/C++ \u6587\u4ef6\u7684\u7f16\u8bd1\uff0c\u6267\u884c bash g++ main.cpp -o demo \u6700\u7ec8\u751f\u6210\u4e00\u4e2a\u4e8c\u8fdb\u5236\u7684\u53ef\u6267\u884c\u7a0b\u5e8f demo \u5728 Windows \u4e0a\uff0c\u5f97\u76ca\u4e8e Visual Studio \u5f3a\u5927\u7684 IDE\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5728\u8be5 IDE \u4e0a\u96c6\u6210\u597d\u7f16\u8bd1\u5668\uff08MSVC\uff09\u5b8c\u6210\u6e90\u6587\u4ef6\u7684\u7f16\u8bd1\uff0c\u4e00\u822c\u70b9\u51fb Visual Studio \u7684 \u751f\u6210\u89e3\u51b3\u65b9\u6848 \uff0c\u53ef\u4ee5\u5728\u9879\u76ee\u7684\u6587\u4ef6\u5939\u4e0b\u751f\u6210\u4e00\u4e2a .exe \u6587\u4ef6\uff0c\u8fd9\u5c31\u662f\u5728 Windows \u4e0a\u6700\u7ec8\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u7a0b\u5e8f \u4f46\u4f7f\u7528 CMake \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u7edf\u4e00\u7684\u8bed\u53e5\u751f\u6210 \u5efa\u6784\u6863 \u3002 \u5728 Ubuntu \u4e0a\uff0c\u751f\u6210\u80fd\u591f\u88ab Unix makefile \u89e3\u6790\u7684 Makefile \u6587\u4ef6\uff0c\u8fd9\u4e00\u6587\u4ef6\u53ef\u4ee5\u6307\u5bfc gcc/g++ \u7f16\u8bd1\u5668\u5b8c\u6210\u6784\u5efa\uff08\u7f16\u8bd1\uff09\u5de5\u4f5c\uff0c Makefile \u6587\u4ef6\u5c31\u662f\u5efa\u6784\u6863\u3002 \u5728 Windows \u4e0a\uff0c\u751f\u6210\u80fd\u591f\u88ab Visual Studio MSBuild \u89e3\u6790\u7684 *.sln \u89e3\u51b3\u65b9\u6848\u6587\u4ef6\uff0c\u8fd9\u4e00\u6587\u4ef6\u53ef\u4ee5\u6307\u5bfc MSVC \u7f16\u8bd1\u5668\u5b8c\u6210\u6784\u5efa\uff08\u7f16\u8bd1\uff09\u5de5\u4f5c\uff0c *.sln \u6587\u4ef6\u5c31\u662f\u5efa\u6784\u6863\u3002","title":"2.1 \u8bed\u6cd5\u7edf\u4e00"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/01/#22","text":"\u8fc4\u4eca\u4e3a\u6b62\uff0cCMake 3.x \u7cfb\u5217\u5df2\u7ecf\u53d1\u5e03\u4e86\u8d85\u8fc7 30 \u4e2a\u7248\u672c\uff0c\u622a\u81f3 2024/11/29 \u7684\u6700\u65b0\u7248\u672c\u662f 3.31.1 \uff0c\u540e\u7eed\u7684\u4ecb\u7ecd\u5747\u4ee5 3.16 \u4e3a\u6700\u5c0f\u7248\u672c\u3002\u901a\u8fc7 CMake \u53ef\u4ee5\u5728\u751f\u6210 \u5efa\u6784\u6863 \u4e4b\u524d\u5b9e\u73b0 \u7b2c\u4e09\u65b9\u4f9d\u8d56\u5e93\u7684\u4e0b\u8f7d\u3001\u5305\u542b \u6587\u4ef6\u89e3\u6790\u3001\u751f\u6210 C/C++ \u5b8f\u7684\u751f\u6210","title":"2.2 \u529f\u80fd\u5f3a\u5927"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/01/#3-cmake","text":"","title":"3. \u600e\u4e48\u7528 CMake"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/01/#31","text":"\u9996\u5148\u5b89\u88c5 CMake\uff0c\u8fd9\u91cc\u7ed9\u51fa\u4e24\u79cd\u5b89\u88c5\u65b9\u5f0f","title":"3.1 \u5b89\u88c5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/01/#311","text":"\u8fd9\u79cd\u5b89\u88c5\u65b9\u5f0f\u6700\u5feb\uff0c\u4f46\u7248\u672c\u6bd4\u8f83\u53d7\u9650\uff0c\u5728\u8f83\u65b0\u7684 Linux \u53d1\u884c\u7248\u4e0a\u7248\u672c\u4f1a\u65b0\u4e00\u70b9\u3002\u8fd9\u91cc\u4ee5 Debian \u7cfb\u53d1\u884c\u7248\u4e3a\u4f8b\uff0c\u53ef\u4f7f\u7528 APT \u5305\u7ba1\u7406\u5de5\u5177\u8fdb\u884c\u5b89\u88c5 sudo apt install cmake cmake-qt-gui cmake-curses-gui \u6765\u5b89\u88c5 CMake \u5de5\u5177\uff0c\u4f8b\u5982\uff0c\u5728 Ubuntu 18.04 \u4e0b\uff0c\u5bf9\u5e94\u7684\u7248\u672c\u4e3a 3.10 20.04 \u4e0b\uff0c\u5bf9\u5e94\u7684\u7248\u672c\u4e3a 3.16 22.04 \u4e0b\uff0c\u5bf9\u5e94\u7684\u7248\u672c\u4e3a 3.22","title":"3.1.1 \u8f6f\u4ef6\u6e90\u5b89\u88c5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/01/#312","text":"\u53ef\u76f4\u63a5\u5728 Github \u4e2d\u6253\u5f00 CMake Release \uff0c\u627e\u5230\u4f60\u60f3\u4e0b\u8f7d\u7684\u7248\u672c\uff0c\u70b9\u51fb\u5bf9\u5e94\u7684\u538b\u7f29\u5305\uff0c\u4f8b\u5982\u5728 x64 \u73af\u5883\u4e0b\u7684 Linux \u53ef\u9009\u62e9 cmake-x.xx.x-linux-x86_64.tar.gz \uff0c\u4e0b\u8f7d\u540e\u8fdb\u884c\u89e3\u538b\uff0c\u5c31\u5f97\u5230\u4e86\u6240\u6709 CMake \u5de5\u5177\u3002\u6b64\u5916\uff0c\u53ef\u81ea\u884c\u5b89\u88c5\u5230\u7cfb\u7edf\u8def\u5f84\u4e0b\uff0c\u4ee5 cmake-3.29.0-linux-x86_64.tar.gz \u4e3a\u4f8b\uff0c\u53ef\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4 tar xf cmake-3.29.0-linux-x86_64.tar.gz # \u89e3\u538b cd cmake-3.29.0-linux-x86_64 sudo cp -r * /usr/local # \u5b89\u88c5\u81f3 /usr/local ::: tip Windows \u7528\u6237\u53ef\u5728 CMake \u5b98\u7f51 \u4e0b\u8f7d\u5bf9\u5e94\u7684 *.msi \u5b89\u88c5\u5305\uff0c\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u5c31\u53ef\u4ee5\u5728\u547d\u4ee4\u884c\u4e2d\u4f7f\u7528 cmake \u547d\u4ee4\u4e86\u3002 :::","title":"3.1.2 \u4e0b\u8f7d\u4e8c\u8fdb\u5236\u5305"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/01/#32-cmake","text":"\u7136\u540e\u6211\u4eec\u518d\u5bf9\u4e0a\u6587\u901a\u8fc7 main.cpp \u751f\u6210\u5efa\u6784\u6863\u7684\u8fc7\u7a0b\u505a\u4e2a\u4ecb\u7ecd\uff0c\u4e86\u89e3 CMake \u751f\u6210\u5efa\u6784\u6863\u7684\u57fa\u672c\u6b65\u9aa4\u3002 \u9996\u5148\u5728 main.cpp \u540c\u7ea7\u76ee\u5f55\u4e0b\u521b\u5efa CMakeLists.txt \u6587\u4ef6\uff0c\u8fd9\u5c31\u662f CMake \u751f\u6210\u5efa\u6784\u6863\u6240\u53c2\u8003\uff08\u89e3\u6790\uff09\u7684\u6587\u4ef6\uff0c\u5e76\u5728\u5176\u4e2d\u5199\u5165 # \u6307\u5b9a CMake \u7684\u6700\u5c0f\u7248\u672c\u53f7\uff0c\u4f4e\u4e8e\u6b64\u7248\u672c\u7684 CMake \u5c06\u7ec8\u6b62\u5efa\u6784\u6863\u7684\u751f\u6210\u8fc7\u7a0b cmake_minimum_required(VERSION 3.16) # \u521b\u5efa\u9879\u76ee project( Demo # \u8bbe\u7f6e\u9879\u76ee\u540d LANGUAGES CXX # \u6307\u5b9a\u8bed\u8a00\uff0c\u672a\u6307\u5b9a\u7684\u8bed\u8a00\u5c06\u4e0d\u53c2\u4e0e\u6784\u5efa\uff0c\u4f8b\u5982 test.c \u6587\u4ef6 ) # \u521b\u5efa\u53ef\u6267\u884c\u6587\u4ef6 add_executable( demo # \u76ee\u6807\u540d main.cpp # \u7528\u5230\u7684\u6e90\u6587\u4ef6 ) \u521b\u5efa\u597d\u540e\uff0c\u5728\u9879\u76ee\u4e0b\u521b\u5efa build \u6587\u4ef6\u5939\uff0c\u5728\u8be5\u6587\u4ef6\u5939\u4e0b\u6253\u5f00\u7ec8\u7aef\uff08Windows \u4e0b\u53ef\u4ee5\u662f PowerShell\uff09\uff0c\u8f93\u5165 cmake .. \u5373\u53ef\u5728\u5f53\u524d\u6587\u4ef6\u5939\u4e0b\u751f\u6210\u5bf9\u5e94\u7684\u5efa\u6784\u6863\u3002 \u4ee5\u4e0a\u5c31\u662f\u5229\u7528 CMake \u751f\u6210\u5efa\u6784\u6863\u7684\u57fa\u672c\u6d41\u7a0b\uff0c\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u5728 add_executable \u4e2d\u6211\u4eec\u6d89\u53ca\u5230\u4e86\u4e00\u4e2a\u65b0\u7684\u540d\u8bcd\uff1a\u76ee\u6807\uff08target\uff09\uff0c\u76ee\u6807\u662f CMake \u62bd\u8c61\u51fa\u6765\u7684\u4e00\u4e2a\u6982\u5ff5\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u7406\u89e3\u4e3a\u5177\u6709 \u540d\u79f0 \u5305\u542b\u7684\u6587\u4ef6\u5939 \u5176\u4f59\u7f16\u8bd1\u5c5e\u6027 \u4f9d\u8d56\u7684\u5176\u4ed6\u76ee\u6807 \u7684\u4e00\u4e2a\u7c7b\uff0c\u53ef\u4ee5\u4f7f\u7528C++\u7684\u7c7b\u6765\u63cf\u8ff0\u76ee\u6807\u8fd9\u4e00\u6982\u5ff5 // CMake \u76ee\u6807 struct Target { string name; // \u540d\u79f0 vector<string> include_directories; // \u5305\u542b\u7684\u6587\u4ef6\u5939 vector<string> properties; // \u5176\u4f59\u7f16\u8bd1\u5c5e\u6027 vector<Target *> targets; // \u4f9d\u8d56\u7684\u5176\u4ed6\u76ee\u6807 }; \u901a\u8fc7\u4e0a\u6587\u53ef\u4ee5\u5f97\u77e5\uff0c\u76ee\u6807\u5177\u6709\u4f9d\u8d56\u5173\u7cfb\uff0c\u56e0\u6b64\u76ee\u6807\u4e0d\u4ec5\u53ea\u6709\u53ef\u6267\u884c\u6587\u4ef6\u8fd9\u4e00\u5f62\u5f0f\uff0c\u8fd8\u5177\u6709\u522b\u7684\u5f62\u5f0f\uff0c\u5728 \u301005\u3011\u76ee\u6807\u6784\u5efa \u4f1a\u8be6\u7ec6\u7ed9\u51fa\u76ee\u6807\u5305\u542b\u7684\u5185\u5bb9\u3002 ::: tip \u603b\u7ed3 CMake \u751f\u6210\u5efa\u6784\u6863\u7684\u8fc7\u7a0b\u53ef\u4ee5\u7b80\u5355\u6982\u62ec\u6210 \u521b\u5efa\u9879\u76ee \u76ee\u6807\u6784\u5efa \u5bfc\u51fa\u914d\u7f6e\uff08\u5982\u679c\u6709\u5b89\u88c5\u7684\u9700\u6c42\uff0c\u5219\u9700\u8981\u505a\uff09 ::: \u8be6\u7ec6\u7684\u5185\u5bb9\u4f1a\u5728\u540e\u6587\u4ecb\u7ecd\u3002 \u00b7\u00b7\u00b7","title":"3.2 CMake \u751f\u6210\u5efa\u6784\u6863\u7684\u6b65\u9aa4"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/02/","text":"\u301002\u3011CMake \u7684\u6587\u4ef6\u5206\u5e03 \u6559\u5b66\u89c6\u9891 ::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili \u5728\u6b63\u5f0f\u5f00\u59cb\u5b66\u4e60 CMake \u4e4b\u524d\uff0c\u9700\u8981\u6e05\u695a CMake \u6587\u4ef6\u4e00\u822c\u5728\u9879\u76ee\u4e2d\u662f\u5982\u4f55\u5206\u5e03\u7684\uff0c\u53ea\u6709\u6e05\u695a\u5404\u4e2a\u6587\u4ef6\u662f\u5982\u4f55\u5206\u5e03\u7684\uff0c\u624d\u80fd\u6b63\u786e\u4e14\u5408\u7406\u7684\u4e66\u5199 CMakeLists.txt \u6587\u4ef6\u3002 1. \u6309\u6a21\u5757\u5206\u5c42\u7684 CMakeLists.txt \u4e00\u822c\u6765\u8bf4\uff0c\u81ea\u5df1\u5728\u4f7f\u7528 CMake \u7684\u65f6\u5019\uff0c\u5982\u679c\u9879\u76ee\u4e0d\u5927\uff0c\u5f80\u5f80\u90fd\u559c\u6b22\u4ec5\u4f7f\u7528\u4e00\u4e2a CMakeLists.txt \u6765\u7ba1\u7406\u6240\u6709\u7684\u5c5e\u6027\u914d\u7f6e\u3002\u4f46\u968f\u7740\u9879\u76ee\u8d8a\u505a\u8d8a\u5927\uff0c\u4e00\u4e2a CMakeLists.txt \u5728\u53ef\u8bfb\u6027\u3001\u53ef\u7ef4\u62a4\u6027\u4e0a\u90fd\u4f1a\u6709\u6240\u964d\u4f4e\u3002\u4e3a\u6b64\u9700\u8981\u5bf9\u6bcf\u4e2a\u7279\u5b9a\u7684\u6a21\u5757\u7f16\u5199 CMakeLists.txt \u3002\u53ef\u4ee5\u53c2\u8003 OpenCV \u7684 CMakeLists.txt \u5e03\u5c40\u3002 . \u251c\u2500\u2500 cmake \u2502 \u2514\u2500\u2500 ... \u251c\u2500\u2500 CMakeLists.txt \u251c\u2500\u2500 include \u2502 \u251c\u2500\u2500 CMakeLists.txt (\u7528\u4e8e\u5168\u5c40\u5305\u542b\u7684 opencv.hpp \u7684\u5bfc\u51fa) \u2502 \u2514\u2500\u2500 ... \u251c\u2500\u2500 modules \u2502 \u2514\u2500\u2500 core \u2502 \u251c\u2500\u2500 CMakeLists.txt \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u251c\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2514\u2500\u2500 test \u2502 \u2514\u2500\u2500 ... \u251c\u2500\u2500 README.md \u2514\u2500\u2500 samples \u5f88\u663e\u7136\uff0c\u6bcf\u7ea7\u6a21\u5757\uff08\u76ee\u5f55\uff09\u7684\u6587\u4ef6\u5939\u4e0b\u90fd\u4f1a\u5b58\u5728\u4e00\u4e2a CMakeLists.txt \u3002 \u6700\u5e95\u5c42\u7684 CMakeLists.txt \u662f\u4e3a\u4e86\u7ba1\u7406\u8be5\u6a21\u5757\u529f\u80fd\u7684\u7f16\u8bd1\u3001\u6d4b\u8bd5\u6587\u4ef6\u7f16\u8bd1\uff0c\u4ee5\u53ca\u63d0\u4f9b\u6307\u5b9a\u7684\u63a5\u53e3\uff08\u53ef\u4ee5\u662f\u5e93\uff0c\u4e5f\u53ef\u4ee5\u662f\u82e5\u5e72 CMake \u53d8\u91cf\uff09\u7ed9\u5916\u90e8\u3002OpenCV \u4e2d\u4f7f\u7528\u8bed\u53e5 ocv_add_module() \u6765\u6dfb\u52a0\u6a21\u5757\u3002\u4f8b\u5982\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/modules/core/CMakeLists.txt \u4e2d\u7684\u5185\u5bb9 ocv_add_module(core OPTIONAL opencv_cudev WRAP java objc python js) \u8fd9\u4e2a\u8bed\u53e5\u5e76\u4e0d\u662f CMake \u539f\u751f\u8bed\u6cd5\u4e2d\u81ea\u5e26\u7684\uff0c\u800c\u662f\u9879\u76ee\u81ea\u884c\u8bbe\u8ba1\u7684\u5b8f\u3002CMake \u4e2d\u7684\u5b8f\u4e0eC/C++\u4e2d\u4f7f\u7528 #define \u521b\u5efa\u7684\u5b8f\u539f\u7406\u7c7b\u4f3c\uff0c\u90fd\u662f\u8d77\u5230\u4e86\u6587\u672c\u66ff\u6362\u7684\u4f5c\u7528\u3002\u6839\u636e\u8fd9\u4e2a\u5b8f\u4ee5\u53ca\u6b64 CMakeLists.txt \u7684\u5176\u4f59\u529f\u80fd\uff0c\u53ef\u4ee5\u521b\u5efa\u8be5 core \u6a21\u5757\u7684\u76ee\u6807\uff1a opencv_core \uff0c\u5e76\u4e3a\u6b64\u6dfb\u52a0\u5408\u9002\u7684\u4f9d\u8d56\u9879\u3002 OpenCV 4.x \u7cfb\u5217\u7248\u672c\u8bbe\u7f6e\u4e24\u7ea7\u76ee\u5f55\u7684 CMakeList.txt \u3002\u6839\u76ee\u5f55\u4e0b\u5373\u6700\u9ad8\u7ea7\u76ee\u5f55\u7684 CMakeLists.txt \u4e00\u822c\u662f\u5bf9\u4e8e\u6574\u4e2a\u9879\u76ee\u6709\u5173\u7f16\u8bd1\u9009\u9879\u7684\u8bbe\u7f6e\uff0c\u4ee5\u53ca\u5bf9\u7cfb\u7edf\u3001\u5e73\u53f0\u3001\u7f16\u8bd1\u5668\u7b49\u7f16\u8bd1\u73af\u5883\u4fe1\u606f\u7684\u517c\u5bb9\u5904\u7406\u3002OpenCV \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMakeLists.txt \u524d\u4e00\u5927\u6bb5\u90fd\u662f\u5728\u5bf9\u5f53\u524d\u5e73\u53f0\u3001\u7f16\u8bd1\u914d\u7f6e\u7684\u4fe1\u606f\u505a\u5904\u7406\uff0c\u4f8b\u5982\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/CMakeLists.txt \u4e2d\u7684\u5185\u5bb9 if(CMAKE_SYSTEM_NAME MATCHES WindowsPhone OR CMAKE_SYSTEM_NAME MATCHES WindowsStore) cmake_minimum_required(VERSION 3.1 FATAL_ERROR) cmake_policy(VERSION 2.8) else() cmake_minimum_required(VERSION \"${MIN_VER_CMAKE}\" FATAL_ERROR) endif() 2. \u5176\u4f59 CMake \u6587\u4ef6 CMake \u4e2d\u9664\u4e86\u89e3\u6790 CMakeLists.txt \u6587\u4ef6\uff0c\u8fd8\u5141\u8bb8\u89e3\u6790\u6269\u5c55\u540d\u4e3a .cmake \u7684\u6587\u4ef6\u3002\u4e00\u822c\u6709\u4e24\u79cd\u64cd\u4f5c\u53ef\u4ee5\u5bf9\u8fd9\u7c7b\u6587\u4ef6\u8fdb\u884c\u8bbf\u95ee\uff0c\u5206\u522b\u662f find_package() \uff0c\u7528\u4e8e\u53d1\u73b0\u7b2c\u4e09\u65b9\u4f9d\u8d56\u5e93 include() \uff0c\u7528\u4e8e\u5305\u542b\u672c\u5730\u7684\u6216 CMake \u6807\u51c6\u4e2d\u63d0\u4f9b\u7684 *.cmake \u6587\u4ef6\uff0c\u4e00\u822c\u8fd9\u7c7b\u6587\u4ef6\u4f1a\u63d0\u4f9b\u4e00\u7cfb\u5217\u5b8f\u6216\u51fd\u6570\u6765\u8f85\u52a9\u6211\u4eec\u5b8c\u6210\u5efa\u6784\u6863\u7684\u751f\u6210\u3002 \u5176\u4e2d\u7b2c\u4e00\u79cd\u65b9\u6848\u4f1a\u5728 \u301008\u3011find_package \u8be6\u89e3 \u4e2d\u4ecb\u7ecd\u3002 2.1 *.cmake \u6587\u4ef6 OpenCV \u4e2d\uff0c\u81ea\u5b9a\u4e49\u7684 *.cmake \u6587\u4ef6\u5168\u90e8\u5b58\u653e\u5728 <opencv-path>/cmake \u6587\u4ef6\u5939\u4e0b\uff0c\u5e38\u89c1\u7684\u540d\u79f0\u6709 Findxxx.cmake OpenCVxxx.cmake \u7b2c\u4e00\u79cd\u662f\u672c\u5730\u9879\u76ee\u4e2d\u7528\u4e8e find_package() \u7684\uff0c\u4f8b\u5982 FindONNX.cmake \u7b49\u6587\u4ef6\u3002\u7b2c\u4e8c\u79cd\u5219\u662f\u6dfb\u52a0\u4e86\u5404\u79cd\u5404\u6837\u7684\u80fd\u591f\u51cf\u5c11\u91cd\u590d\u64cd\u4f5c\u7684\u5b8f\u4e0e\u51fd\u6570\uff0c ocv_add_module() \u5c31\u662f\u5176\u4e2d\u4e4b\u4e00\uff0c\u4ed6\u88ab\u5b9a\u4e49\u5728 OpenCVModule.cmake \u4e2d\uff0c\u8fd9\u79cd\u4e00\u822c\u9700\u8981\u6267\u884c include() \u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a # \u5b9a\u4e49\u4e8e <opencv-path>/CMakeLists.txt \u4e2d\u7684\u5185\u5bb9 # --- OpenCL --- if(WITH_OPENCL) include(cmake/OpenCVDetectOpenCL.cmake) endif() # --- Halide --- if(WITH_HALIDE) include(cmake/OpenCVDetectHalide.cmake) endif() # --- VkCom --- if(WITH_VULKAN) include(cmake/OpenCVDetectVulkan.cmake) endif() # --- WebNN --- if(WITH_WEBNN) include(cmake/OpenCVDetectWebNN.cmake) endif() 2.2 *.in \u6587\u4ef6 *.in \u6a21\u677f\u6587\u4ef6\u4e00\u822c\u662f\u7528\u4e8e\u5728 cmake \u6267\u884c\u9636\u6bb5\uff08\u51c6\u786e\u6765\u8bf4\uff0c\u5e94\u8be5\u662f\u914d\u7f6e\u9636\u6bb5\uff09\u5c06\u5176\u5d4c\u5165\u7684 CMake \u53d8\u91cf\u3001\u5217\u8868\u5c55\u5f00\uff0c\u5e76\u751f\u6210\u76ee\u6807\u6587\u4ef6\u7684\u8fc7\u7a0b\u4e2d\u7684\u3002\u8fd9\u4e00\u6b65\u901a\u5e38\u662f\u7531 configure_file() \u5b8c\u6210\uff0c\u4f1a\u5728 \u301006\u3011\u53d8\u91cf\u53c2\u4e0e C++ \u7684\u7f16\u8bd1 \u4e2d\u8fdb\u884c\u4ecb\u7ecd\u3002 *.in \u7684\u540e\u7f00\u662f\u7ea6\u5b9a\u4fd7\u6210\u7684\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u5f62\u5f0f\u7684\u540e\u7f00\u3002 OpenCV\u4e2d\u7684\u6b64\u7c7b\u6587\u4ef6\u4e00\u822c\u653e\u5728 <opencv-path>/cmake/template \u6587\u4ef6\u5939\u4e0b\uff0c\u4e3b\u8981\u662f\u7528\u4e8e\u5728\u6267\u884c cmake .. \u7684\u65f6\u5019\u5c06\u6a21\u677f\u6587\u4ef6\u8f6c\u6362\u4e3a\u5177\u4f53\u7684\u6587\u4ef6\u3002\u53e6\u5916\uff0c\u5728 cmake --install . \u7684\u65f6\u5019\u4f1a\u5c06\u751f\u6210\u7684 OpenCVConfig.cmake \u7b49\u4e00\u7cfb\u5217\u6587\u4ef6\u5b89\u88c5\u81f3\u76ee\u6807\u8def\u5f84\u4e0b\uff0c\u800c OpenCVConfig.cmake \u6587\u4ef6\u7684\u4ea7\u751f\uff0c\u5c31\u9700\u8981 <opencv-path>/cmake/template \u6587\u4ef6\u5939\u4e0b\u7684 OpenCVConfig.cmake.in \u6587\u4ef6\u3002 ::: important \u603b\u7ed3 1. \u9879\u76ee\u7684\u6839\u76ee\u5f55\u4ee5\u53ca\u5404\u6a21\u5757\u90fd\u4f1a\u7ba1\u7406\u4e00\u4e2a CMakeLists.txt \u6587\u4ef6 2. CMake \u8fd8\u4f1a\u89e3\u6790 *.cmake \u540e\u7f00\u7684\u6587\u4ef6 3. *.in \u6587\u4ef6\u4e00\u822c\u4f5c\u4e3a\u6a21\u677f\u6587\u4ef6\uff0c\u4e00\u822c\u5728 CMake \u89e3\u6790\u671f\u95f4\u8f6c\u6362\u4e3a\u5177\u4f53\u7684\u6587\u4ef6 :::","title":"\u301002\u3011CMake \u7684\u6587\u4ef6\u5206\u5e03"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/02/#02cmake","text":"","title":"\u301002\u3011CMake \u7684\u6587\u4ef6\u5206\u5e03"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/02/#_1","text":"::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili \u5728\u6b63\u5f0f\u5f00\u59cb\u5b66\u4e60 CMake \u4e4b\u524d\uff0c\u9700\u8981\u6e05\u695a CMake \u6587\u4ef6\u4e00\u822c\u5728\u9879\u76ee\u4e2d\u662f\u5982\u4f55\u5206\u5e03\u7684\uff0c\u53ea\u6709\u6e05\u695a\u5404\u4e2a\u6587\u4ef6\u662f\u5982\u4f55\u5206\u5e03\u7684\uff0c\u624d\u80fd\u6b63\u786e\u4e14\u5408\u7406\u7684\u4e66\u5199 CMakeLists.txt \u6587\u4ef6\u3002","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/02/#1-cmakeliststxt","text":"\u4e00\u822c\u6765\u8bf4\uff0c\u81ea\u5df1\u5728\u4f7f\u7528 CMake \u7684\u65f6\u5019\uff0c\u5982\u679c\u9879\u76ee\u4e0d\u5927\uff0c\u5f80\u5f80\u90fd\u559c\u6b22\u4ec5\u4f7f\u7528\u4e00\u4e2a CMakeLists.txt \u6765\u7ba1\u7406\u6240\u6709\u7684\u5c5e\u6027\u914d\u7f6e\u3002\u4f46\u968f\u7740\u9879\u76ee\u8d8a\u505a\u8d8a\u5927\uff0c\u4e00\u4e2a CMakeLists.txt \u5728\u53ef\u8bfb\u6027\u3001\u53ef\u7ef4\u62a4\u6027\u4e0a\u90fd\u4f1a\u6709\u6240\u964d\u4f4e\u3002\u4e3a\u6b64\u9700\u8981\u5bf9\u6bcf\u4e2a\u7279\u5b9a\u7684\u6a21\u5757\u7f16\u5199 CMakeLists.txt \u3002\u53ef\u4ee5\u53c2\u8003 OpenCV \u7684 CMakeLists.txt \u5e03\u5c40\u3002 . \u251c\u2500\u2500 cmake \u2502 \u2514\u2500\u2500 ... \u251c\u2500\u2500 CMakeLists.txt \u251c\u2500\u2500 include \u2502 \u251c\u2500\u2500 CMakeLists.txt (\u7528\u4e8e\u5168\u5c40\u5305\u542b\u7684 opencv.hpp \u7684\u5bfc\u51fa) \u2502 \u2514\u2500\u2500 ... \u251c\u2500\u2500 modules \u2502 \u2514\u2500\u2500 core \u2502 \u251c\u2500\u2500 CMakeLists.txt \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u251c\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2514\u2500\u2500 test \u2502 \u2514\u2500\u2500 ... \u251c\u2500\u2500 README.md \u2514\u2500\u2500 samples \u5f88\u663e\u7136\uff0c\u6bcf\u7ea7\u6a21\u5757\uff08\u76ee\u5f55\uff09\u7684\u6587\u4ef6\u5939\u4e0b\u90fd\u4f1a\u5b58\u5728\u4e00\u4e2a CMakeLists.txt \u3002 \u6700\u5e95\u5c42\u7684 CMakeLists.txt \u662f\u4e3a\u4e86\u7ba1\u7406\u8be5\u6a21\u5757\u529f\u80fd\u7684\u7f16\u8bd1\u3001\u6d4b\u8bd5\u6587\u4ef6\u7f16\u8bd1\uff0c\u4ee5\u53ca\u63d0\u4f9b\u6307\u5b9a\u7684\u63a5\u53e3\uff08\u53ef\u4ee5\u662f\u5e93\uff0c\u4e5f\u53ef\u4ee5\u662f\u82e5\u5e72 CMake \u53d8\u91cf\uff09\u7ed9\u5916\u90e8\u3002OpenCV \u4e2d\u4f7f\u7528\u8bed\u53e5 ocv_add_module() \u6765\u6dfb\u52a0\u6a21\u5757\u3002\u4f8b\u5982\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/modules/core/CMakeLists.txt \u4e2d\u7684\u5185\u5bb9 ocv_add_module(core OPTIONAL opencv_cudev WRAP java objc python js) \u8fd9\u4e2a\u8bed\u53e5\u5e76\u4e0d\u662f CMake \u539f\u751f\u8bed\u6cd5\u4e2d\u81ea\u5e26\u7684\uff0c\u800c\u662f\u9879\u76ee\u81ea\u884c\u8bbe\u8ba1\u7684\u5b8f\u3002CMake \u4e2d\u7684\u5b8f\u4e0eC/C++\u4e2d\u4f7f\u7528 #define \u521b\u5efa\u7684\u5b8f\u539f\u7406\u7c7b\u4f3c\uff0c\u90fd\u662f\u8d77\u5230\u4e86\u6587\u672c\u66ff\u6362\u7684\u4f5c\u7528\u3002\u6839\u636e\u8fd9\u4e2a\u5b8f\u4ee5\u53ca\u6b64 CMakeLists.txt \u7684\u5176\u4f59\u529f\u80fd\uff0c\u53ef\u4ee5\u521b\u5efa\u8be5 core \u6a21\u5757\u7684\u76ee\u6807\uff1a opencv_core \uff0c\u5e76\u4e3a\u6b64\u6dfb\u52a0\u5408\u9002\u7684\u4f9d\u8d56\u9879\u3002 OpenCV 4.x \u7cfb\u5217\u7248\u672c\u8bbe\u7f6e\u4e24\u7ea7\u76ee\u5f55\u7684 CMakeList.txt \u3002\u6839\u76ee\u5f55\u4e0b\u5373\u6700\u9ad8\u7ea7\u76ee\u5f55\u7684 CMakeLists.txt \u4e00\u822c\u662f\u5bf9\u4e8e\u6574\u4e2a\u9879\u76ee\u6709\u5173\u7f16\u8bd1\u9009\u9879\u7684\u8bbe\u7f6e\uff0c\u4ee5\u53ca\u5bf9\u7cfb\u7edf\u3001\u5e73\u53f0\u3001\u7f16\u8bd1\u5668\u7b49\u7f16\u8bd1\u73af\u5883\u4fe1\u606f\u7684\u517c\u5bb9\u5904\u7406\u3002OpenCV \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMakeLists.txt \u524d\u4e00\u5927\u6bb5\u90fd\u662f\u5728\u5bf9\u5f53\u524d\u5e73\u53f0\u3001\u7f16\u8bd1\u914d\u7f6e\u7684\u4fe1\u606f\u505a\u5904\u7406\uff0c\u4f8b\u5982\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/CMakeLists.txt \u4e2d\u7684\u5185\u5bb9 if(CMAKE_SYSTEM_NAME MATCHES WindowsPhone OR CMAKE_SYSTEM_NAME MATCHES WindowsStore) cmake_minimum_required(VERSION 3.1 FATAL_ERROR) cmake_policy(VERSION 2.8) else() cmake_minimum_required(VERSION \"${MIN_VER_CMAKE}\" FATAL_ERROR) endif()","title":"1. \u6309\u6a21\u5757\u5206\u5c42\u7684 CMakeLists.txt"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/02/#2-cmake","text":"CMake \u4e2d\u9664\u4e86\u89e3\u6790 CMakeLists.txt \u6587\u4ef6\uff0c\u8fd8\u5141\u8bb8\u89e3\u6790\u6269\u5c55\u540d\u4e3a .cmake \u7684\u6587\u4ef6\u3002\u4e00\u822c\u6709\u4e24\u79cd\u64cd\u4f5c\u53ef\u4ee5\u5bf9\u8fd9\u7c7b\u6587\u4ef6\u8fdb\u884c\u8bbf\u95ee\uff0c\u5206\u522b\u662f find_package() \uff0c\u7528\u4e8e\u53d1\u73b0\u7b2c\u4e09\u65b9\u4f9d\u8d56\u5e93 include() \uff0c\u7528\u4e8e\u5305\u542b\u672c\u5730\u7684\u6216 CMake \u6807\u51c6\u4e2d\u63d0\u4f9b\u7684 *.cmake \u6587\u4ef6\uff0c\u4e00\u822c\u8fd9\u7c7b\u6587\u4ef6\u4f1a\u63d0\u4f9b\u4e00\u7cfb\u5217\u5b8f\u6216\u51fd\u6570\u6765\u8f85\u52a9\u6211\u4eec\u5b8c\u6210\u5efa\u6784\u6863\u7684\u751f\u6210\u3002 \u5176\u4e2d\u7b2c\u4e00\u79cd\u65b9\u6848\u4f1a\u5728 \u301008\u3011find_package \u8be6\u89e3 \u4e2d\u4ecb\u7ecd\u3002","title":"2. \u5176\u4f59 CMake \u6587\u4ef6"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/02/#21-cmake","text":"OpenCV \u4e2d\uff0c\u81ea\u5b9a\u4e49\u7684 *.cmake \u6587\u4ef6\u5168\u90e8\u5b58\u653e\u5728 <opencv-path>/cmake \u6587\u4ef6\u5939\u4e0b\uff0c\u5e38\u89c1\u7684\u540d\u79f0\u6709 Findxxx.cmake OpenCVxxx.cmake \u7b2c\u4e00\u79cd\u662f\u672c\u5730\u9879\u76ee\u4e2d\u7528\u4e8e find_package() \u7684\uff0c\u4f8b\u5982 FindONNX.cmake \u7b49\u6587\u4ef6\u3002\u7b2c\u4e8c\u79cd\u5219\u662f\u6dfb\u52a0\u4e86\u5404\u79cd\u5404\u6837\u7684\u80fd\u591f\u51cf\u5c11\u91cd\u590d\u64cd\u4f5c\u7684\u5b8f\u4e0e\u51fd\u6570\uff0c ocv_add_module() \u5c31\u662f\u5176\u4e2d\u4e4b\u4e00\uff0c\u4ed6\u88ab\u5b9a\u4e49\u5728 OpenCVModule.cmake \u4e2d\uff0c\u8fd9\u79cd\u4e00\u822c\u9700\u8981\u6267\u884c include() \u64cd\u4f5c\uff0c\u4f8b\u5982\uff1a # \u5b9a\u4e49\u4e8e <opencv-path>/CMakeLists.txt \u4e2d\u7684\u5185\u5bb9 # --- OpenCL --- if(WITH_OPENCL) include(cmake/OpenCVDetectOpenCL.cmake) endif() # --- Halide --- if(WITH_HALIDE) include(cmake/OpenCVDetectHalide.cmake) endif() # --- VkCom --- if(WITH_VULKAN) include(cmake/OpenCVDetectVulkan.cmake) endif() # --- WebNN --- if(WITH_WEBNN) include(cmake/OpenCVDetectWebNN.cmake) endif()","title":"2.1 *.cmake \u6587\u4ef6"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/02/#22-in","text":"*.in \u6a21\u677f\u6587\u4ef6\u4e00\u822c\u662f\u7528\u4e8e\u5728 cmake \u6267\u884c\u9636\u6bb5\uff08\u51c6\u786e\u6765\u8bf4\uff0c\u5e94\u8be5\u662f\u914d\u7f6e\u9636\u6bb5\uff09\u5c06\u5176\u5d4c\u5165\u7684 CMake \u53d8\u91cf\u3001\u5217\u8868\u5c55\u5f00\uff0c\u5e76\u751f\u6210\u76ee\u6807\u6587\u4ef6\u7684\u8fc7\u7a0b\u4e2d\u7684\u3002\u8fd9\u4e00\u6b65\u901a\u5e38\u662f\u7531 configure_file() \u5b8c\u6210\uff0c\u4f1a\u5728 \u301006\u3011\u53d8\u91cf\u53c2\u4e0e C++ \u7684\u7f16\u8bd1 \u4e2d\u8fdb\u884c\u4ecb\u7ecd\u3002 *.in \u7684\u540e\u7f00\u662f\u7ea6\u5b9a\u4fd7\u6210\u7684\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u5f62\u5f0f\u7684\u540e\u7f00\u3002 OpenCV\u4e2d\u7684\u6b64\u7c7b\u6587\u4ef6\u4e00\u822c\u653e\u5728 <opencv-path>/cmake/template \u6587\u4ef6\u5939\u4e0b\uff0c\u4e3b\u8981\u662f\u7528\u4e8e\u5728\u6267\u884c cmake .. \u7684\u65f6\u5019\u5c06\u6a21\u677f\u6587\u4ef6\u8f6c\u6362\u4e3a\u5177\u4f53\u7684\u6587\u4ef6\u3002\u53e6\u5916\uff0c\u5728 cmake --install . \u7684\u65f6\u5019\u4f1a\u5c06\u751f\u6210\u7684 OpenCVConfig.cmake \u7b49\u4e00\u7cfb\u5217\u6587\u4ef6\u5b89\u88c5\u81f3\u76ee\u6807\u8def\u5f84\u4e0b\uff0c\u800c OpenCVConfig.cmake \u6587\u4ef6\u7684\u4ea7\u751f\uff0c\u5c31\u9700\u8981 <opencv-path>/cmake/template \u6587\u4ef6\u5939\u4e0b\u7684 OpenCVConfig.cmake.in \u6587\u4ef6\u3002 ::: important \u603b\u7ed3 1. \u9879\u76ee\u7684\u6839\u76ee\u5f55\u4ee5\u53ca\u5404\u6a21\u5757\u90fd\u4f1a\u7ba1\u7406\u4e00\u4e2a CMakeLists.txt \u6587\u4ef6 2. CMake \u8fd8\u4f1a\u89e3\u6790 *.cmake \u540e\u7f00\u7684\u6587\u4ef6 3. *.in \u6587\u4ef6\u4e00\u822c\u4f5c\u4e3a\u6a21\u677f\u6587\u4ef6\uff0c\u4e00\u822c\u5728 CMake \u89e3\u6790\u671f\u95f4\u8f6c\u6362\u4e3a\u5177\u4f53\u7684\u6587\u4ef6 :::","title":"2.2 *.in \u6587\u4ef6"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/","text":"\u301003\u3011\u53d8\u91cf\u7684\u8bbe\u7f6e\u4e0e\u5f15\u7528 \u6559\u5b66\u89c6\u9891 ::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili @ bilibili 1. \u524d\u8a00 \u4ece\u6e90\u7801\u7f16\u8bd1 OpenCV \u65f6\u90fd\u4f1a\u7528\u5230 CMake \u4e2d\u7684\u53d8\u91cf\uff0c\u5e76\u4e14\u8fd8\u7ecf\u5e38\u901a\u8fc7\u8fd9\u4e9b\u53d8\u91cf\u6765\u4e3a OpenCV \u9879\u76ee\u7684\u6784\u5efa\u3001\u5b89\u88c5\u8fc7\u7a0b\u8fdb\u884c\u914d\u7f6e\u3002\u914d\u7f6e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u4f55\u5411\u7528\u6237\u5c55\u793a\u5fc5\u8981\u7684\u53c2\u6570\u4ee5\u53ca\u5c4f\u853d\u4e00\u4e9b\u5c40\u90e8\u4f7f\u7528\u7684\u53c2\u6570\u663e\u5f97\u5341\u5206\u91cd\u8981\u3002 C++ \u4e2d\u7684\u53d8\u91cf\u5177\u5907\u81ea\u52a8\u5b58\u50a8\u671f\u3001\u9759\u6001\u5b58\u50a8\u671f\u3001\u7ebf\u7a0b\u5b58\u50a8\u671f\u4ee5\u53ca\u52a8\u6001\u5b58\u50a8\u671f\uff0cCMake \u4e5f\u5177\u6709\u7c7b\u4f3c\u7684\u6548\u679c\uff0c\u53d8\u91cf\u5728\u5212\u5206\u4e0a\u5177\u6709 \u666e\u901a\u53d8\u91cf \u7f13\u5b58\u53d8\u91cf \u73af\u5883\u53d8\u91cf 3 \u79cd\uff0c\u6b64\u5185\u5bb9\u7684\u8be6\u7ec6\u63cf\u8ff0\u53ef\u53c2\u8003 \u53d8\u91cf \u3002 2. \u666e\u901a\u53d8\u91cf \u6b64\u7c7b\u53d8\u91cf\u5177\u6709\u4e0eC/C++\u8bed\u8a00\u4e2d\u7684\u81ea\u52a8\u5b58\u50a8\u671f\u7c7b\u4f3c\u7684\u6548\u679c\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c \u5728\u51fd\u6570 function \u4e2d\u521b\u5efa\u7684\u53d8\u91cf\u4e0d\u4f1a\u5728\u51fd\u6570\u4ee5\u5916\u751f\u6548\u6216\u88ab\u8bbf\u95ee\uff0c\u53ef\u7c7b\u6bd4 C/C++ \u7684\u51fd\u6570\uff1b CMakeLists.txt \u53ef\u4ee5\u7ee7\u627f\u7236\u76ee\u5f55\u6587\u4ef6\u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u5728\u5904\u7406 CMakeLists.txt \u6587\u4ef6\u4e4b\u524d\uff0cCMake \u4f1a\u590d\u5236\u7236\u76ee\u5f55\u4e2d\u5b9a\u4e49\u7684\u6240\u6709\u53d8\u91cf\uff08\u5982\u679c\u6709\uff09\uff0c\u4ee5\u521d\u59cb\u5316\u5f53\u524d\u4f5c\u7528\u57df\u3002 2.1 \u5b9a\u4e49 \u4e00\u822c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5373\u53ef\u5b9a\u4e49\u4e00\u4e2a\u666e\u901a\u53d8\u91cf set(val1 \"aaa\") # val1 \u5185\u5bb9\u4e3a 1 \u4e2a\u503c\uff1aaaa set(val2 \"bb\" bbb) # val2 \u5185\u5bb9\u4e3a 2 \u4e2a\u503c\uff1abb;bbb set(val3 aa;bb) # val3 \u5185\u5bb9\u4e3a 2 \u4e2a\u503c\uff1aaa;bb set(val4 aa;bb cc) # val4 \u5185\u5bb9\u4e3a 3 \u4e2a\u503c\uff1aaa;bb;cc ::: warning 1. \u5373\u4f7f bbb \u4e0d\u52a0 \"\" \u53f7\uff0c\u4e5f\u8868\u793a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u56e0\u4e3a CMake \u7684\u53d8\u91cf\u59cb\u7ec8\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\u7684 \uff0c\u4f46\u4e0d\u59a8\u788d\u67d0\u4e9b\u547d\u4ee4\u53ef\u4ee5\u5c06\u5176\u89e3\u91ca\u4e3a\u5176\u4ed6\u7c7b\u578b\uff1b 2. \u5efa\u8bae\u53d8\u91cf\u7684\u5185\u5bb9\u8981\u4e48\u90fd\u4f7f\u7528\u5f15\u53f7 \"\" \uff0c\u8981\u4e48\u90fd\u4e0d\u4f7f\u7528\uff0c\u4f8b\u5982 val2 \u7684\u5199\u6cd5\u5c31\u4e0d\u597d 3. \u53d8\u91cf\u5185\u5bb9\u53ef\u4ee5\u901a\u8fc7\u7a7a\u683c \u6216\u8005\u5206\u53f7 ; \u8fdb\u884c\u5206\u9694\uff0c\u4e5f\u53ef\u4ee5\u6df7\u7528\uff0c\u4f8b\u5982 val4 ::: 2.2 \u5f15\u7528 \u53ef\u4ee5\u7406\u89e3\u4e3a\u53d6\u503c\u64cd\u4f5c\uff0c\u57fa\u672c\u7684\u5f62\u5f0f\u4e3a ${xxx} set(AA xy mn) set(BB ${AA} cc) # BB \u5185\u5bb9\u4e3a 3 \u4e2a\u503c\uff1axy;mn;cc set(CC \"${BB}\") # CC \u5185\u5bb9\u4e3a 3 \u4e2a\u503c\uff1axy;mn;cc 2.2 \u89e3\u9664 unset() \u8bed\u53e5\u5219\u662f\u89e3\u9664\u5b9a\u4e49\u7684\u529f\u80fd\uff0c\u4f8b\u5982\uff1a # \u5b9a\u4e49\u4e8e <opencv-path>/CMakeLists.txt \u4e2d\u7684\u5185\u5bb9 unset(_hal_includes) \u5b83\u53ef\u4ee5\u5c06\u53d8\u91cf\u7684\u5185\u5bb9\u6e05\u9664\uff0c\u4e0b\u6b21\u518d\u6b21\u4f7f\u7528\u540c\u540d\u7684\u53d8\u91cf\u9700\u8981\u91cd\u65b0 set 2.3 \u4f5c\u7528\u57df\u63d0\u5347 \u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5b50\u76ee\u5f55\u7684\u53d8\u91cf\u65e0\u6cd5\u5728\u7236\u76ee\u5f55 CMakeLists.txt \u4e2d\u751f\u6548\uff0c\u4f46\u662f\u7236\u76ee\u5f55\u7684 CMakeLists.txt \u4e2d\u5b9a\u4e49\u597d\u7684\u53d8\u91cf\u53ef\u4ee5\u88ab\u5b50\u76ee\u5f55\u7684 CMakeLists.txt \u6240\u7ee7\u627f\uff0c\u4f46\u5f00\u8f9f\u4e86\u65b0\u7684\u4f5c\u7528\u57df\u3002 \u5982\u679c\u6211\u4eec\u5e0c\u671b\u5728\u5b50\u76ee\u5f55\u7684 CMakeLists.txt \u4e2d\u8bbe\u7f6e\u53d8\u91cf\uff0c\u5e76\u4e14\u80fd\u591f\u5728\u7236\u76ee\u5f55 CMakeLists.txt \u4e2d\u751f\u6548\uff0c\u6211\u4eec\u9700\u8981\u63d0\u5347\u4f5c\u7528\u57df\uff0c\u8bed\u6cd5\u662f set(xxx PARENT_SCOPE) \u4f8b\u5982\uff0c\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u7684 CMakeLists.txt \u4e2d\u5199\u5165\u4e86\u4ee5\u4e0b\u5185\u5bb9 message(STATUS \"var1 = ${var1}\") message(STATUS \"var2 = ${var2}\") add_subdirectory(module) message(STATUS \"var1 = ${var1}\") message(STATUS \"var2 = ${var2}\") \u800c\u5728 module \u6a21\u5757\u7684\u6587\u4ef6\u5bf9\u5e94\u7684 CMakeLists.txt \u4e2d\u5199\u5165 set(var1 \"abc\") set(var2 \"def\" PARENT_SCOPE) \u5728\u6267\u884c CMake \u540e\uff0c\u8fd0\u884c\u7ed3\u679c\u4e3a -- var1 = -- var2 = -- var1 = -- var2 = def \u5728\u4f7f\u7528 PARENT_SCOPE \u540e\uff0c var2 \u53d8\u91cf\u5728\u7236\u76ee\u5f55 CMakeLists.txt \u4e2d\u4e5f\u80fd\u751f\u6548\u3002 3. CMake \u53d8\u91cf 3.1 \u79cd\u7c7b \u6b64\u4e3a CMake \u9ed8\u8ba4\u63d0\u4f9b\u7684\u53d8\u91cf\uff0c\u4e5f\u5c06\u8bb0\u8f7d\u5728 CMakeCache.txt \u4e2d\u3002\u5177\u4f53\u5305\u62ec \u63d0\u4f9b\u4fe1\u606f\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 CMAKE_BINARY_DIR \u3001 PROJECT_NAME \u6539\u53d8\u884c\u4e3a\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 CMAKE_BUILD_TYPE \u63cf\u8ff0\u7cfb\u7edf\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 CMAKE_SYSTEM_PROCESSOR \u63a7\u5236\u6784\u5efa\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 LIBRARY_OUTPUT_PATH \u3001 CMAKE_RUNTIME_OUTPUT_DIRECTORY \u8bed\u8a00\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 CMAKE_CXX_STANDARD CTest \u4e0e CPack \u7684\u53d8\u91cf 3.2 \u5b9a\u4e49 \u8fd9\u79cd\u53d8\u91cf\u5728\u5b9a\u4e49\u65f6\u4e0e\u666e\u901a\u53d8\u91cf\u7684\u5b9a\u4e49\u65b9\u5f0f\u4e00\u81f4\uff0c\u4f46\u6548\u679c\u4e0a\u662f\u7f13\u5b58\u53d8\u91cf\uff0c\u4f8b\u5982\uff1a set(CMAKE_BUILD_TYPE Debug) \u5728\u5e95\u5c42 CMakeLists.txt \u6587\u4ef6\u4e2d\u88ab\u8bbe\u7f6e\uff0c\u4f46\u80fd\u591f\u5728\u4e4b\u540e\u8bbf\u95ee\u5230\u7684\u5176\u4ed6 CMakeLists.txt \u4e2d \u7ee7\u7eed\u751f\u6548 \u3002 4. \u7f13\u5b58\u53d8\u91cf \u8fd9\u79cd\u53d8\u91cf\u5728\u5b9a\u4e49\u540e\u4fbf\u88ab\u6dfb\u52a0\u81f3\u4e86 CMakeCache.txt \u6587\u4ef6\u4e2d\uff0c\u4e4b\u540e\u8bbf\u95ee\u5b83\u7684\u65f6\u5019\uff0c\u5c06\u4ece CMakeCache.txt \u6587\u4ef6\u4e2d\u8c03\u51fa\uff0c\u56e0\u6b64\u5747\u80fd\u5f97\u5230\u6709\u6548\u8bbf\u95ee\u6570\u636e\u3002 ::: tip \u8fd9\u7c7b\u53d8\u91cf\u53ef\u4ee5\u7528 C/C++ \u5177\u6709\u52a8\u6001\u5b58\u50a8\u671f\u7684\u53d8\u91cf\u6765\u7c7b\u6bd4 ::: 4.1 \u5b9a\u4e49 \u4e0a\u6587\u63d0\u5230 CMake \u53d8\u91cf\u90fd\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\uff0c\u4f46\u4e0d\u59a8\u788d\u89e3\u91ca\u6210\u5176\u4ed6\u7c7b\u578b\uff0c\u5728\u7f13\u5b58\u53d8\u91cf\u4e2d\uff0c\u53ef\u4ee5\u89e3\u91ca\u6210\u5176\u4ed6\u7c7b\u578b\u53ef\u4f9b cmake-gui \u7b49\u5de5\u5177\u663e\u793a\u3002 4.1.1 option \u5176\u4e2d\uff0c\u4f7f\u7528 option \u547d\u4ee4\u662f\u521b\u5efa BOOL \u578b\u7f13\u5b58\u53d8\u91cf\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u4e00\u822c\u53ef\u4ee5\u4f5c\u4e3a\u7f16\u8bd1\u9009\u9879\uff0c\u5373\u4f7f\u5b98\u7f51\u4e2d\u6ca1\u6709\u5728\u7f13\u5b58\u53d8\u91cf\u4e2d\u4ecb\u7ecd\u8be5\u547d\u4ee4\u3002 option \u7684\u4f7f\u7528\u65b9\u5f0f\u5982\u4e0b\uff1a option(ORT_WITH_CUDA \"the library compile with CUDA\" OFF) \u5b83\u53ea\u6709\u4e24\u79cd\u72b6\u6001\uff0c TRUE \u3001 FALSE \u6216\u7528\u53e6\u4e00\u79cd\u8868\u793a\u65b9\u5f0f\uff1a ON \u3001 OFF \uff0c\u6700\u5e38\u89c1\u7684 option \u53d8\u91cf\u5c31\u662f\u5728\u4f7f\u7528 cmake-gui \u5de5\u5177\u7684\u65f6\u5019\uff0c\u53f3\u4fa7\u680f\u4e2d\u53ef\u4ee5\u6253\u52fe\u7684\u65b9\u6846\u3002 4.1.2 \u81ea\u5b9a\u4e49\u7f13\u5b58\u53d8\u91cf \u5373\u4f7f\u7528\u547d\u4ee4 set(xxx CACHE) \uff0c\u8fd9\u662f\u4e00\u822c\u7684\u8bbe\u7f6e\u7f13\u5b58\u53d8\u91cf\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u53c2\u8003 OpenCV \u4e2d\u7684\u4f8b\u5b50\uff1a # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 set(OPENCV_MODULES_BUILD \"\" CACHE INTERNAL \"List of OpenCV modules included into the build\") CACHE \u6307\u660e\u4e86\u8fd9\u662f\u4e00\u4e2a\u7f13\u5b58\u53d8\u91cf\uff0c INTERNAL \u7684\u6548\u679c\u4e0e STRING \u6548\u679c\u5927\u81f4\u76f8\u540c\uff0c\u4f46 INTERNAL \u65e0\u6cd5\u5728 CMake \u5de5\u5177\u4e2d\u663e\u793a\uff0c\u7528\u6237\u65e0\u6cd5\u901a\u8fc7 cmake-gui \u7b49\u5de5\u5177\u8fdb\u884c\u4fee\u6539\uff0c\u4f46 STRING \u53ef\u4ee5\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709\u4ee5\u4e0b\u51e0\u4e2a\u5e38\u7528\u7684\u7c7b\u578b\uff1a BOOL \u3001 PATH \u3001 FILEPATH \u3002\u5176\u4e2d BOOL \u578b\u7f13\u5b58\u53d8\u91cf\u4e0e\u4f7f\u7528 option \u521b\u5efa\u7684\u53d8\u91cf\u6548\u679c\u7b49\u540c\u3002 \u4e4b\u540e\u8ddf\u7684\u5b57\u7b26\u4e32\u5219\u662f\u8fd9\u4e2a\u53d8\u91cf\u7684\u6ce8\u91ca\uff0c\u5728 cmake-gui \u5de5\u5177\u4e2d\uff0c\u628a\u9f20\u6807\u653e\u7f6e\u5728\u5de6\u4fa7\u7684\u53d8\u91cf\u540d\u4e0a\uff0c\u5373\u53ef\u663e\u793a\u51fa\u8be5\u53d8\u91cf\u7684\u6ce8\u91ca\u3002 4.1.3 \u5b98\u7f51\u4ecb\u7ecd BOOL \uff1a ON/OFF \u503c\u3002 cmake-gui \u4f1a\u63d0\u4f9b\u4e00\u4e2a\u5f62\u5982 \u7684\u590d\u9009\u6846\uff1b FILEPATH \uff1a\u78c1\u76d8\u4e0a\u6587\u4ef6\u7684\u8def\u5f84\u3002 cmake-gui \u4f1a\u63d0\u4f9b\u4e00\u4e2a\u5f62\u5982 \u7684\u6587\u4ef6\u5bf9\u8bdd\u6846\uff1b PATH \uff1a\u78c1\u76d8\u4e0a\u76ee\u5f55\u7684\u8def\u5f84\u3002 cmake-gui \u4f1a\u63d0\u4f9b\u4e00\u4e2a\u6587\u4ef6\u5bf9\u8bdd\u6846\uff1b STRING \uff1a\u4e00\u884c\u6587\u5b57\u3002 cmake-gui \u4f1a\u63d0\u4f9b\u5f62\u5982 \u7684\u6587\u672c\u5b57\u6bb5\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86 STRINGS \u5c5e\u6027\u4e5f\u53ef\u4ee5\u63d0\u4f9b\u4e0b\u62c9\u9009\u9879\uff1b INTERNAL \uff1a\u4e00\u884c\u6587\u5b57\u3002 cmake-gui \u4f1a\u4e0d\u663e\u793a\u8be5\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u56e0\u6b64\u5728\u4f7f\u7528\u6b64\u7c7b\u578b\u65f6\u610f\u5473\u7740 FORCE 4.2 \u5f15\u7528 \u4e0e\u666e\u901a\u53d8\u91cf\u7684\u5f15\u7528\u65b9\u5f0f\u4e00\u81f4\uff0c\u5373 ${xxx} \uff0c\u4f46 ${xxx} \u4f1a \u5148\u641c\u7d22\u6709\u65e0\u666e\u901a\u53d8\u91cf\uff0c\u82e5\u627e\u4e0d\u5230\u624d\u4f1a\u7ee7\u7eed\u641c\u7d22\u7f13\u5b58\u53d8\u91cf \u3002\u82e5\u5f3a\u5236\u6307\u5b9a\u641c\u7d22\u7f13\u5b58\u53d8\u91cf\uff0c\u5219\u9700\u8981\u4f7f\u7528 $CACHE{xxx} \uff0c\u4f8b\u5982 set(val1 \"aaa\") set(val2 \"bbb\" CACHE STRING \"Test String\") message(STATUS ${val1}) # -- aaa message(STATUS ${val2}) # -- bbb message(STATUS $CACHE{val1}) # -- message(STATUS $CACHE{val2}) # -- bbb 4.3 \u89e3\u9664 \u540c\u6837\u4e5f\u662f\u4f7f\u7528 unset \u8bed\u53e5\u3002\u4f46\u7565\u6709\u4e0d\u540c\u7684\u662f\uff0c\u9700\u8981\u52a0\u4e0a CACHE \uff1a # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 unset(OPENCV_WORLD_MODULES CACHE) 5. \u73af\u5883\u53d8\u91cf \u4e0e\u7cfb\u7edf\u4e2d\u7684\u73af\u5883\u53d8\u91cf\u662f\u4e00\u4e2a\u6982\u5ff5\uff0c\u6bd4\u5982 LD_LIBRARY_PATH \uff0c\u8981\u5f15\u7528\u8fd9\u79cd\u53d8\u91cf\u6211\u4eec\u9700\u8981\u4f7f\u7528 $ENV{xxx} \uff0c\u4f8b\u5982 set(sdk_path \"$ENV{MVCAM_SDK_PATH}\") if(sdk_path STREQUAL \"\") return() endif() \u5176\u4e2d MVCAM_SDK_PATH \u662f\u7cfb\u7edf\u73af\u5883\u4e2d\u7684\u4e00\u4e2a\u53d8\u91cf\uff08\u5b9a\u4e49\u5728 .bashrc \u91cc\u9762\uff09 6. \u53d8\u91cf\u89c4\u8303 6.1 \u8bbe\u7f6e\u89c4\u8303 \u6765\u770b OpenCV \u4e2d\u5b8f ocv_add_module \u5185\u90e8\u7684\u4e00\u4e2a\u6761\u4ef6\u63a7\u5236\u8bed\u53e5\u7684\u5199\u6cd5\uff1a if(...) # ... set(__ocv_argn__ ${ADD_MODULE_ARGN}) # ... unset(__ocv_argn__) # ... endif() \u53ef\u4ee5\u770b\u5230\uff0c ${ADD_MODULE_ARGN} \u5728\u6574\u4e2a\u6761\u4ef6\u8fd0\u7b97\u4e2d\u5747\u672a\u5b9a\u4e49\uff0c\u56e0\u6b64\u4ed6\u5bf9\u4e8e\u8fd9\u4e2a\u8bed\u53e5\u6765\u8bf4\u662f\u4e2a\u5916\u90e8\u53d8\u91cf\u3002\u5bf9\u4e8e\u5916\u90e8\u53d8\u91cf\uff0cOpenCV\u7684\u505a\u6cd5\u901a\u5e38\u4e0e\u4e0a\u9762\u7684\u4ee3\u7801\u4e00\u81f4\uff0c\u5373 set() \u4e00\u4e2a\u65b0\u7684\u53d8\u91cf\u6765\u8bb0\u5f55\u8fd9\u4e2a\u53ef\u80fd\u4f1a\u505a\u4fee\u6539\u7684\u503c\uff0c\u5e76\u4e14\u5728\u8fd9\u4e2a\u53d8\u91cf\u7528\u5b8c\u540e unset() \u3002 6.2 \u547d\u540d\u89c4\u8303 \u666e\u901a\u53d8\u91cf\u53ef\u4ee5\u4f7f\u7528\u5c0f\u5199 + \u4e0b\u5212\u7ebf\u7684\u65b9\u5f0f\uff0c\u4f8b\u5982 cmake set(my_var \"ABC\") \u7f13\u5b58\u53d8\u91cf\u4f7f\u7528\u5927\u5199 + \u4e0b\u5212\u7ebf\u7684\u65b9\u5f0f\uff0c\u4f8b\u5982 cmake set(MY_VAR \"ABC\" CACHE STRING \"My variable\")","title":"\u301003\u3011\u53d8\u91cf\u7684\u8bbe\u7f6e\u4e0e\u5f15\u7528"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#03","text":"","title":"\u301003\u3011\u53d8\u91cf\u7684\u8bbe\u7f6e\u4e0e\u5f15\u7528"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#_1","text":"::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili @ bilibili","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#1","text":"\u4ece\u6e90\u7801\u7f16\u8bd1 OpenCV \u65f6\u90fd\u4f1a\u7528\u5230 CMake \u4e2d\u7684\u53d8\u91cf\uff0c\u5e76\u4e14\u8fd8\u7ecf\u5e38\u901a\u8fc7\u8fd9\u4e9b\u53d8\u91cf\u6765\u4e3a OpenCV \u9879\u76ee\u7684\u6784\u5efa\u3001\u5b89\u88c5\u8fc7\u7a0b\u8fdb\u884c\u914d\u7f6e\u3002\u914d\u7f6e\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u4f55\u5411\u7528\u6237\u5c55\u793a\u5fc5\u8981\u7684\u53c2\u6570\u4ee5\u53ca\u5c4f\u853d\u4e00\u4e9b\u5c40\u90e8\u4f7f\u7528\u7684\u53c2\u6570\u663e\u5f97\u5341\u5206\u91cd\u8981\u3002 C++ \u4e2d\u7684\u53d8\u91cf\u5177\u5907\u81ea\u52a8\u5b58\u50a8\u671f\u3001\u9759\u6001\u5b58\u50a8\u671f\u3001\u7ebf\u7a0b\u5b58\u50a8\u671f\u4ee5\u53ca\u52a8\u6001\u5b58\u50a8\u671f\uff0cCMake \u4e5f\u5177\u6709\u7c7b\u4f3c\u7684\u6548\u679c\uff0c\u53d8\u91cf\u5728\u5212\u5206\u4e0a\u5177\u6709 \u666e\u901a\u53d8\u91cf \u7f13\u5b58\u53d8\u91cf \u73af\u5883\u53d8\u91cf 3 \u79cd\uff0c\u6b64\u5185\u5bb9\u7684\u8be6\u7ec6\u63cf\u8ff0\u53ef\u53c2\u8003 \u53d8\u91cf \u3002","title":"1. \u524d\u8a00"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#2","text":"\u6b64\u7c7b\u53d8\u91cf\u5177\u6709\u4e0eC/C++\u8bed\u8a00\u4e2d\u7684\u81ea\u52a8\u5b58\u50a8\u671f\u7c7b\u4f3c\u7684\u6548\u679c\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c \u5728\u51fd\u6570 function \u4e2d\u521b\u5efa\u7684\u53d8\u91cf\u4e0d\u4f1a\u5728\u51fd\u6570\u4ee5\u5916\u751f\u6548\u6216\u88ab\u8bbf\u95ee\uff0c\u53ef\u7c7b\u6bd4 C/C++ \u7684\u51fd\u6570\uff1b CMakeLists.txt \u53ef\u4ee5\u7ee7\u627f\u7236\u76ee\u5f55\u6587\u4ef6\u4e2d\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u5728\u5904\u7406 CMakeLists.txt \u6587\u4ef6\u4e4b\u524d\uff0cCMake \u4f1a\u590d\u5236\u7236\u76ee\u5f55\u4e2d\u5b9a\u4e49\u7684\u6240\u6709\u53d8\u91cf\uff08\u5982\u679c\u6709\uff09\uff0c\u4ee5\u521d\u59cb\u5316\u5f53\u524d\u4f5c\u7528\u57df\u3002","title":"2. \u666e\u901a\u53d8\u91cf"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#21","text":"\u4e00\u822c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5373\u53ef\u5b9a\u4e49\u4e00\u4e2a\u666e\u901a\u53d8\u91cf set(val1 \"aaa\") # val1 \u5185\u5bb9\u4e3a 1 \u4e2a\u503c\uff1aaaa set(val2 \"bb\" bbb) # val2 \u5185\u5bb9\u4e3a 2 \u4e2a\u503c\uff1abb;bbb set(val3 aa;bb) # val3 \u5185\u5bb9\u4e3a 2 \u4e2a\u503c\uff1aaa;bb set(val4 aa;bb cc) # val4 \u5185\u5bb9\u4e3a 3 \u4e2a\u503c\uff1aaa;bb;cc ::: warning 1. \u5373\u4f7f bbb \u4e0d\u52a0 \"\" \u53f7\uff0c\u4e5f\u8868\u793a\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u56e0\u4e3a CMake \u7684\u53d8\u91cf\u59cb\u7ec8\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\u7684 \uff0c\u4f46\u4e0d\u59a8\u788d\u67d0\u4e9b\u547d\u4ee4\u53ef\u4ee5\u5c06\u5176\u89e3\u91ca\u4e3a\u5176\u4ed6\u7c7b\u578b\uff1b 2. \u5efa\u8bae\u53d8\u91cf\u7684\u5185\u5bb9\u8981\u4e48\u90fd\u4f7f\u7528\u5f15\u53f7 \"\" \uff0c\u8981\u4e48\u90fd\u4e0d\u4f7f\u7528\uff0c\u4f8b\u5982 val2 \u7684\u5199\u6cd5\u5c31\u4e0d\u597d 3. \u53d8\u91cf\u5185\u5bb9\u53ef\u4ee5\u901a\u8fc7\u7a7a\u683c \u6216\u8005\u5206\u53f7 ; \u8fdb\u884c\u5206\u9694\uff0c\u4e5f\u53ef\u4ee5\u6df7\u7528\uff0c\u4f8b\u5982 val4 :::","title":"2.1 \u5b9a\u4e49"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#22","text":"\u53ef\u4ee5\u7406\u89e3\u4e3a\u53d6\u503c\u64cd\u4f5c\uff0c\u57fa\u672c\u7684\u5f62\u5f0f\u4e3a ${xxx} set(AA xy mn) set(BB ${AA} cc) # BB \u5185\u5bb9\u4e3a 3 \u4e2a\u503c\uff1axy;mn;cc set(CC \"${BB}\") # CC \u5185\u5bb9\u4e3a 3 \u4e2a\u503c\uff1axy;mn;cc","title":"2.2 \u5f15\u7528"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#22_1","text":"unset() \u8bed\u53e5\u5219\u662f\u89e3\u9664\u5b9a\u4e49\u7684\u529f\u80fd\uff0c\u4f8b\u5982\uff1a # \u5b9a\u4e49\u4e8e <opencv-path>/CMakeLists.txt \u4e2d\u7684\u5185\u5bb9 unset(_hal_includes) \u5b83\u53ef\u4ee5\u5c06\u53d8\u91cf\u7684\u5185\u5bb9\u6e05\u9664\uff0c\u4e0b\u6b21\u518d\u6b21\u4f7f\u7528\u540c\u540d\u7684\u53d8\u91cf\u9700\u8981\u91cd\u65b0 set","title":"2.2 \u89e3\u9664"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#23","text":"\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5b50\u76ee\u5f55\u7684\u53d8\u91cf\u65e0\u6cd5\u5728\u7236\u76ee\u5f55 CMakeLists.txt \u4e2d\u751f\u6548\uff0c\u4f46\u662f\u7236\u76ee\u5f55\u7684 CMakeLists.txt \u4e2d\u5b9a\u4e49\u597d\u7684\u53d8\u91cf\u53ef\u4ee5\u88ab\u5b50\u76ee\u5f55\u7684 CMakeLists.txt \u6240\u7ee7\u627f\uff0c\u4f46\u5f00\u8f9f\u4e86\u65b0\u7684\u4f5c\u7528\u57df\u3002 \u5982\u679c\u6211\u4eec\u5e0c\u671b\u5728\u5b50\u76ee\u5f55\u7684 CMakeLists.txt \u4e2d\u8bbe\u7f6e\u53d8\u91cf\uff0c\u5e76\u4e14\u80fd\u591f\u5728\u7236\u76ee\u5f55 CMakeLists.txt \u4e2d\u751f\u6548\uff0c\u6211\u4eec\u9700\u8981\u63d0\u5347\u4f5c\u7528\u57df\uff0c\u8bed\u6cd5\u662f set(xxx PARENT_SCOPE) \u4f8b\u5982\uff0c\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u7684 CMakeLists.txt \u4e2d\u5199\u5165\u4e86\u4ee5\u4e0b\u5185\u5bb9 message(STATUS \"var1 = ${var1}\") message(STATUS \"var2 = ${var2}\") add_subdirectory(module) message(STATUS \"var1 = ${var1}\") message(STATUS \"var2 = ${var2}\") \u800c\u5728 module \u6a21\u5757\u7684\u6587\u4ef6\u5bf9\u5e94\u7684 CMakeLists.txt \u4e2d\u5199\u5165 set(var1 \"abc\") set(var2 \"def\" PARENT_SCOPE) \u5728\u6267\u884c CMake \u540e\uff0c\u8fd0\u884c\u7ed3\u679c\u4e3a -- var1 = -- var2 = -- var1 = -- var2 = def \u5728\u4f7f\u7528 PARENT_SCOPE \u540e\uff0c var2 \u53d8\u91cf\u5728\u7236\u76ee\u5f55 CMakeLists.txt \u4e2d\u4e5f\u80fd\u751f\u6548\u3002","title":"2.3 \u4f5c\u7528\u57df\u63d0\u5347"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#3-cmake","text":"","title":"3. CMake \u53d8\u91cf"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#31","text":"\u6b64\u4e3a CMake \u9ed8\u8ba4\u63d0\u4f9b\u7684\u53d8\u91cf\uff0c\u4e5f\u5c06\u8bb0\u8f7d\u5728 CMakeCache.txt \u4e2d\u3002\u5177\u4f53\u5305\u62ec \u63d0\u4f9b\u4fe1\u606f\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 CMAKE_BINARY_DIR \u3001 PROJECT_NAME \u6539\u53d8\u884c\u4e3a\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 CMAKE_BUILD_TYPE \u63cf\u8ff0\u7cfb\u7edf\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 CMAKE_SYSTEM_PROCESSOR \u63a7\u5236\u6784\u5efa\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 LIBRARY_OUTPUT_PATH \u3001 CMAKE_RUNTIME_OUTPUT_DIRECTORY \u8bed\u8a00\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 CMAKE_CXX_STANDARD CTest \u4e0e CPack \u7684\u53d8\u91cf","title":"3.1 \u79cd\u7c7b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#32","text":"\u8fd9\u79cd\u53d8\u91cf\u5728\u5b9a\u4e49\u65f6\u4e0e\u666e\u901a\u53d8\u91cf\u7684\u5b9a\u4e49\u65b9\u5f0f\u4e00\u81f4\uff0c\u4f46\u6548\u679c\u4e0a\u662f\u7f13\u5b58\u53d8\u91cf\uff0c\u4f8b\u5982\uff1a set(CMAKE_BUILD_TYPE Debug) \u5728\u5e95\u5c42 CMakeLists.txt \u6587\u4ef6\u4e2d\u88ab\u8bbe\u7f6e\uff0c\u4f46\u80fd\u591f\u5728\u4e4b\u540e\u8bbf\u95ee\u5230\u7684\u5176\u4ed6 CMakeLists.txt \u4e2d \u7ee7\u7eed\u751f\u6548 \u3002","title":"3.2 \u5b9a\u4e49"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#4","text":"\u8fd9\u79cd\u53d8\u91cf\u5728\u5b9a\u4e49\u540e\u4fbf\u88ab\u6dfb\u52a0\u81f3\u4e86 CMakeCache.txt \u6587\u4ef6\u4e2d\uff0c\u4e4b\u540e\u8bbf\u95ee\u5b83\u7684\u65f6\u5019\uff0c\u5c06\u4ece CMakeCache.txt \u6587\u4ef6\u4e2d\u8c03\u51fa\uff0c\u56e0\u6b64\u5747\u80fd\u5f97\u5230\u6709\u6548\u8bbf\u95ee\u6570\u636e\u3002 ::: tip \u8fd9\u7c7b\u53d8\u91cf\u53ef\u4ee5\u7528 C/C++ \u5177\u6709\u52a8\u6001\u5b58\u50a8\u671f\u7684\u53d8\u91cf\u6765\u7c7b\u6bd4 :::","title":"4. \u7f13\u5b58\u53d8\u91cf"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#41","text":"\u4e0a\u6587\u63d0\u5230 CMake \u53d8\u91cf\u90fd\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\uff0c\u4f46\u4e0d\u59a8\u788d\u89e3\u91ca\u6210\u5176\u4ed6\u7c7b\u578b\uff0c\u5728\u7f13\u5b58\u53d8\u91cf\u4e2d\uff0c\u53ef\u4ee5\u89e3\u91ca\u6210\u5176\u4ed6\u7c7b\u578b\u53ef\u4f9b cmake-gui \u7b49\u5de5\u5177\u663e\u793a\u3002","title":"4.1 \u5b9a\u4e49"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#411-option","text":"\u5176\u4e2d\uff0c\u4f7f\u7528 option \u547d\u4ee4\u662f\u521b\u5efa BOOL \u578b\u7f13\u5b58\u53d8\u91cf\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u4e00\u822c\u53ef\u4ee5\u4f5c\u4e3a\u7f16\u8bd1\u9009\u9879\uff0c\u5373\u4f7f\u5b98\u7f51\u4e2d\u6ca1\u6709\u5728\u7f13\u5b58\u53d8\u91cf\u4e2d\u4ecb\u7ecd\u8be5\u547d\u4ee4\u3002 option \u7684\u4f7f\u7528\u65b9\u5f0f\u5982\u4e0b\uff1a option(ORT_WITH_CUDA \"the library compile with CUDA\" OFF) \u5b83\u53ea\u6709\u4e24\u79cd\u72b6\u6001\uff0c TRUE \u3001 FALSE \u6216\u7528\u53e6\u4e00\u79cd\u8868\u793a\u65b9\u5f0f\uff1a ON \u3001 OFF \uff0c\u6700\u5e38\u89c1\u7684 option \u53d8\u91cf\u5c31\u662f\u5728\u4f7f\u7528 cmake-gui \u5de5\u5177\u7684\u65f6\u5019\uff0c\u53f3\u4fa7\u680f\u4e2d\u53ef\u4ee5\u6253\u52fe\u7684\u65b9\u6846\u3002","title":"4.1.1 option"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#412","text":"\u5373\u4f7f\u7528\u547d\u4ee4 set(xxx CACHE) \uff0c\u8fd9\u662f\u4e00\u822c\u7684\u8bbe\u7f6e\u7f13\u5b58\u53d8\u91cf\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u53c2\u8003 OpenCV \u4e2d\u7684\u4f8b\u5b50\uff1a # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 set(OPENCV_MODULES_BUILD \"\" CACHE INTERNAL \"List of OpenCV modules included into the build\") CACHE \u6307\u660e\u4e86\u8fd9\u662f\u4e00\u4e2a\u7f13\u5b58\u53d8\u91cf\uff0c INTERNAL \u7684\u6548\u679c\u4e0e STRING \u6548\u679c\u5927\u81f4\u76f8\u540c\uff0c\u4f46 INTERNAL \u65e0\u6cd5\u5728 CMake \u5de5\u5177\u4e2d\u663e\u793a\uff0c\u7528\u6237\u65e0\u6cd5\u901a\u8fc7 cmake-gui \u7b49\u5de5\u5177\u8fdb\u884c\u4fee\u6539\uff0c\u4f46 STRING \u53ef\u4ee5\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u6709\u4ee5\u4e0b\u51e0\u4e2a\u5e38\u7528\u7684\u7c7b\u578b\uff1a BOOL \u3001 PATH \u3001 FILEPATH \u3002\u5176\u4e2d BOOL \u578b\u7f13\u5b58\u53d8\u91cf\u4e0e\u4f7f\u7528 option \u521b\u5efa\u7684\u53d8\u91cf\u6548\u679c\u7b49\u540c\u3002 \u4e4b\u540e\u8ddf\u7684\u5b57\u7b26\u4e32\u5219\u662f\u8fd9\u4e2a\u53d8\u91cf\u7684\u6ce8\u91ca\uff0c\u5728 cmake-gui \u5de5\u5177\u4e2d\uff0c\u628a\u9f20\u6807\u653e\u7f6e\u5728\u5de6\u4fa7\u7684\u53d8\u91cf\u540d\u4e0a\uff0c\u5373\u53ef\u663e\u793a\u51fa\u8be5\u53d8\u91cf\u7684\u6ce8\u91ca\u3002","title":"4.1.2 \u81ea\u5b9a\u4e49\u7f13\u5b58\u53d8\u91cf"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#413","text":"BOOL \uff1a ON/OFF \u503c\u3002 cmake-gui \u4f1a\u63d0\u4f9b\u4e00\u4e2a\u5f62\u5982 \u7684\u590d\u9009\u6846\uff1b FILEPATH \uff1a\u78c1\u76d8\u4e0a\u6587\u4ef6\u7684\u8def\u5f84\u3002 cmake-gui \u4f1a\u63d0\u4f9b\u4e00\u4e2a\u5f62\u5982 \u7684\u6587\u4ef6\u5bf9\u8bdd\u6846\uff1b PATH \uff1a\u78c1\u76d8\u4e0a\u76ee\u5f55\u7684\u8def\u5f84\u3002 cmake-gui \u4f1a\u63d0\u4f9b\u4e00\u4e2a\u6587\u4ef6\u5bf9\u8bdd\u6846\uff1b STRING \uff1a\u4e00\u884c\u6587\u5b57\u3002 cmake-gui \u4f1a\u63d0\u4f9b\u5f62\u5982 \u7684\u6587\u672c\u5b57\u6bb5\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86 STRINGS \u5c5e\u6027\u4e5f\u53ef\u4ee5\u63d0\u4f9b\u4e0b\u62c9\u9009\u9879\uff1b INTERNAL \uff1a\u4e00\u884c\u6587\u5b57\u3002 cmake-gui \u4f1a\u4e0d\u663e\u793a\u8be5\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u56e0\u6b64\u5728\u4f7f\u7528\u6b64\u7c7b\u578b\u65f6\u610f\u5473\u7740 FORCE","title":"4.1.3 \u5b98\u7f51\u4ecb\u7ecd"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#42","text":"\u4e0e\u666e\u901a\u53d8\u91cf\u7684\u5f15\u7528\u65b9\u5f0f\u4e00\u81f4\uff0c\u5373 ${xxx} \uff0c\u4f46 ${xxx} \u4f1a \u5148\u641c\u7d22\u6709\u65e0\u666e\u901a\u53d8\u91cf\uff0c\u82e5\u627e\u4e0d\u5230\u624d\u4f1a\u7ee7\u7eed\u641c\u7d22\u7f13\u5b58\u53d8\u91cf \u3002\u82e5\u5f3a\u5236\u6307\u5b9a\u641c\u7d22\u7f13\u5b58\u53d8\u91cf\uff0c\u5219\u9700\u8981\u4f7f\u7528 $CACHE{xxx} \uff0c\u4f8b\u5982 set(val1 \"aaa\") set(val2 \"bbb\" CACHE STRING \"Test String\") message(STATUS ${val1}) # -- aaa message(STATUS ${val2}) # -- bbb message(STATUS $CACHE{val1}) # -- message(STATUS $CACHE{val2}) # -- bbb","title":"4.2 \u5f15\u7528"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#43","text":"\u540c\u6837\u4e5f\u662f\u4f7f\u7528 unset \u8bed\u53e5\u3002\u4f46\u7565\u6709\u4e0d\u540c\u7684\u662f\uff0c\u9700\u8981\u52a0\u4e0a CACHE \uff1a # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 unset(OPENCV_WORLD_MODULES CACHE)","title":"4.3 \u89e3\u9664"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#5","text":"\u4e0e\u7cfb\u7edf\u4e2d\u7684\u73af\u5883\u53d8\u91cf\u662f\u4e00\u4e2a\u6982\u5ff5\uff0c\u6bd4\u5982 LD_LIBRARY_PATH \uff0c\u8981\u5f15\u7528\u8fd9\u79cd\u53d8\u91cf\u6211\u4eec\u9700\u8981\u4f7f\u7528 $ENV{xxx} \uff0c\u4f8b\u5982 set(sdk_path \"$ENV{MVCAM_SDK_PATH}\") if(sdk_path STREQUAL \"\") return() endif() \u5176\u4e2d MVCAM_SDK_PATH \u662f\u7cfb\u7edf\u73af\u5883\u4e2d\u7684\u4e00\u4e2a\u53d8\u91cf\uff08\u5b9a\u4e49\u5728 .bashrc \u91cc\u9762\uff09","title":"5. \u73af\u5883\u53d8\u91cf"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#6","text":"","title":"6. \u53d8\u91cf\u89c4\u8303"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#61","text":"\u6765\u770b OpenCV \u4e2d\u5b8f ocv_add_module \u5185\u90e8\u7684\u4e00\u4e2a\u6761\u4ef6\u63a7\u5236\u8bed\u53e5\u7684\u5199\u6cd5\uff1a if(...) # ... set(__ocv_argn__ ${ADD_MODULE_ARGN}) # ... unset(__ocv_argn__) # ... endif() \u53ef\u4ee5\u770b\u5230\uff0c ${ADD_MODULE_ARGN} \u5728\u6574\u4e2a\u6761\u4ef6\u8fd0\u7b97\u4e2d\u5747\u672a\u5b9a\u4e49\uff0c\u56e0\u6b64\u4ed6\u5bf9\u4e8e\u8fd9\u4e2a\u8bed\u53e5\u6765\u8bf4\u662f\u4e2a\u5916\u90e8\u53d8\u91cf\u3002\u5bf9\u4e8e\u5916\u90e8\u53d8\u91cf\uff0cOpenCV\u7684\u505a\u6cd5\u901a\u5e38\u4e0e\u4e0a\u9762\u7684\u4ee3\u7801\u4e00\u81f4\uff0c\u5373 set() \u4e00\u4e2a\u65b0\u7684\u53d8\u91cf\u6765\u8bb0\u5f55\u8fd9\u4e2a\u53ef\u80fd\u4f1a\u505a\u4fee\u6539\u7684\u503c\uff0c\u5e76\u4e14\u5728\u8fd9\u4e2a\u53d8\u91cf\u7528\u5b8c\u540e unset() \u3002","title":"6.1 \u8bbe\u7f6e\u89c4\u8303"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/03/#62","text":"\u666e\u901a\u53d8\u91cf\u53ef\u4ee5\u4f7f\u7528\u5c0f\u5199 + \u4e0b\u5212\u7ebf\u7684\u65b9\u5f0f\uff0c\u4f8b\u5982 cmake set(my_var \"ABC\") \u7f13\u5b58\u53d8\u91cf\u4f7f\u7528\u5927\u5199 + \u4e0b\u5212\u7ebf\u7684\u65b9\u5f0f\uff0c\u4f8b\u5982 cmake set(MY_VAR \"ABC\" CACHE STRING \"My variable\")","title":"6.2 \u547d\u540d\u89c4\u8303"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/","text":"\u301004\u3011\u8fd0\u7b97\u7b26\u4e0e\u6761\u4ef6\u3001\u5faa\u73af\u8bed\u53e5 \u6559\u5b66\u89c6\u9891 ::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili 1. \u6761\u4ef6\u63a7\u5236\uff1aif \u6761\u4ef6\u63a7\u5236\u7684\u57fa\u672c\u5199\u6cd5\u4e3a\uff1a if(aaa) # ... elseif(bbb) # ... else() # ... endif() \u5e76\u4e14\u80fd\u591f\u652f\u6301\u5d4c\u5957\u6761\u4ef6\u63a7\u5236\uff0c\u5373 if(aaa) # ... if(ccc) # ... endif() # ... else() # ... endif() 2. \u8fd0\u7b97\u7b26 \u5148\u7ed9\u51fa\u4ee5\u4e0b\u4f8b\u5b50 # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 if(\" ${ARGV1}\" STREQUAL \" INTERNAL\" OR \" ${ARGV1}\" STREQUAL \" BINDINGS\") set(OPENCV_MODULE_${the_module}_CLASS \"${ARGV1}\" CACHE INTERNAL \"The category of the module\") set(__ocv_argn__ ${ADD_MODULE_ARGN}) list(REMOVE_AT __ocv_argn__ 0) ocv_add_dependencies(${the_module} ${__ocv_argn__}) unset(__ocv_argn__) else() set(OPENCV_MODULE_${the_module}_CLASS \"PUBLIC\" CACHE INTERNAL \"The category of the module\") ocv_add_dependencies(${the_module} ${ADD_MODULE_ARGN}) if(BUILD_${the_module}) set(OPENCV_MODULES_PUBLIC ${OPENCV_MODULES_PUBLIC} \"${the_module}\" CACHE INTERNAL \"List of OpenCV modules marked for export\") endif() endif() \u5728 if() \u7684\u5c0f\u62ec\u53f7\u4e2d\u51fa\u73b0\u4e86 STREQUAL \u4ee5\u53ca OR \u7684\u5185\u5bb9\uff0c\u8fd9\u4e9b\u5c5e\u4e8e\u8fd0\u7b97\u7b26\uff0c\u6211\u4eec\u6709\u5fc5\u8981\u4ecb\u7ecd\u4e00\u4e9b\u80fd\u591f\u4ea7\u751f BOOL \u7c7b\u578b\u53d8\u91cf\u7684\u8fd0\u7b97\u7b26\uff0c\u8fd9\u4e9b\u8fd0\u7b97\u7b26\u4e5f\u5e38\u7528\u4e8e\u6761\u4ef6\u63a7\u5236\u4e2d\u3002 2.1 \u4e00\u5143\u8fd0\u7b97\u7b26 EXISTS \uff1a\u5224\u65ad\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u662f\u5426\u5b58\u5728\uff0c\u5b58\u5728\u65f6\u4e3a\u771f\u3002\u9700\u8981\u63d0\u4f9b\u7edd\u5bf9\u8def\u5f84\uff1b\u5982\u679c\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u662f\u7b26\u53f7\u94fe\u63a5\uff08\u4f8b\u5982\u8f6f\u8fde\u63a5\uff09\uff0c\u5219\u53ea\u6709\u5f53\u94fe\u63a5\u7684\u76ee\u6807\u5b58\u5728\u65f6\u8fd4\u56de\u771f\u3002\u683c\u5f0f\u4e3a\uff1a EXISTS xxx \uff0c\u4f8b\u5982\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 if(EXISTS \"${CMAKE_CURRENT_BINARY_DIR}/test\") IS_DIRECTORY \uff1a\u5224\u65ad\u6307\u5b9a\u5185\u5bb9\u662f\u5426\u4e3a\u6587\u4ef6\u5939\uff0c\u662f\u5219\u4e3a\u771f\u3002\u9700\u8981\u63d0\u4f9b\u7edd\u5bf9\u8def\u5f84\u3002\u683c\u5f0f\u4e3a\uff1a IS_DIRECTOTY xxx \uff0c\u4f8b\u5982\uff1a cmake if(IS_DIRECTORY ${CMAKE_CURRENT_LIST_DIR}/${m}) COMMAND \uff1a\u5982\u679c\u7ed9\u5b9a\u7684\u540d\u79f0\u662f\u547d\u4ee4\u3001\u5b8f\u6216\u8005\u51fd\u6570\u8fd9\u7c7b\u53ef\u88ab\u8c03\u7528\u7684\u5bf9\u8c61\uff0c\u5219\u8fd4\u56de\u771f\u3002\u683c\u5f0f\u4e3a\uff1a COMMAND xxx \uff0c\u4f8b\u5982\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 if(COMMAND ocv_get_module_external_sources) DEFINED \uff1a\u5982\u679c\u7ed9\u5b9a\u7684\u53d8\u91cf\uff08\u666e\u901a\u53d8\u91cf\u3001\u7f13\u5b58\u53d8\u91cf\u6216\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\uff09\u5b58\u5728\uff0c\u5219\u8fd4\u56de\u771f\u3002\u683c\u5f0f\u4e3a\uff1a DEFINED xxx \uff0c\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u524d\u8981\u52a0 ENV \uff0c\u5373 DEFINED ENV xxx \u3002\u793a\u4f8b\u5982\u4e0b\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 if(DEFINED OPENCV_INITIAL_PASS) TARGET \uff1a\u5982\u679c\u7ed9\u5b9a\u7684\u540d\u79f0\u662f\u76ee\u6807\uff08\u5305\u62ec\u4e8c\u8fdb\u5236\u76ee\u6807\u3001\u4f2a\u76ee\u6807\uff0c\u53ef\u53c2\u8003 \u301005\u3011\u76ee\u6807\u6784\u5efa \uff09\uff0c\u5219\u8fd4\u56de\u771f\u3002\u683c\u5f0f\u4e3a\uff1a TARGET xxx \uff0c\u4f8b\u5982\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVGenABI.cmake \u4e2d\u7684\u5185\u5bb9 if(TARGET opencv_${mod}) # opencv_world 2.2 \u4e8c\u5143\u8fd0\u7b97\u7b26 EQUAL \uff1a\u5de6\u8fb9\u4e24\u4e2a\u5b57\u7b26\u4e32\u6216\u8005\u53d8\u91cf\u76f8\u7b49\u65f6\u4e3a\u771f\u3002 STREQUAL \uff1a\u5de6\u8fb9\u4e0e\u53f3\u8fb9\u7684\u5b57\u5178\u987a\u5e8f\u76f8\u7b49\u65f6\u4e3a\u771f\u3002 MATCHES \uff1a\u6309\u7167\u6b63\u5219\u8868\u8fbe\u5f0f\u53bb\u5339\u914d\uff0c\u5de6\u8fb9\u662f\u5f85\u5339\u914d\u7684\u503c\uff0c\u53f3\u8fb9\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u80fd\u5339\u914d\u4e3a\u65f6\u4e3a\u771f\u3002\u4f8b\u5982\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 # m \u4e3a\u67d0\u4e2a foreach \u4e2d\u7684\u5143\u7d20 if(NOT m MATCHES \"^opencv_\") 2.3 \u903b\u8f91\u8fd0\u7b97\u7b26 \u4e0e\u5176\u4ed6\u8bed\u8a00\u4e00\u81f4\uff0c\u5305\u542b\u4e0e\u3001\u6216\u3001\u975e\uff1a AND \u3001 OR \u3001 NOT if(BUILD_opencv_world AND m STREQUAL \"opencv_world\" OR NOT BUILD_opencv_world OR NOT OPENCV_MODULE_${m}_IS_PART_OF_WORLD) \u903b\u8f91\u64cd\u4f5c\u7b26\u7684\u7ed3\u5408\u4f18\u5148\u7ea7\uff1a NOT > AND > OR ::: tip \u8fd0\u7b97\u7b26\u7ed3\u5408\u987a\u5e8f\u4e3a\uff1a\u4e00\u5143\u8fd0\u7b97\u7b26 > \u4e8c\u5143\u8fd0\u7b97\u7b26 > \u903b\u8f91\u8fd0\u7b97\u7b26 ::: 3. \u5faa\u73af\u63a7\u5236\uff1aforeach \u8fd9\u91cc\u4ecb\u7ecd\u6700\u5e38\u7528\u7684 foreach \uff0c while \u8fd9\u91cc\u4e0d\u505a\u4ecb\u7ecd 3.1 \u7528\u6cd5 \u5148\u7ed9\u51fa\u4e24\u4e2a\u4f8b\u5b50\uff1a # \u4ee5\u4e0b\u5747\u4e3a\u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 # Example 1 foreach(subdir ${subdirs}) if(EXISTS \"${path}/${subdir}/CMakeLists.txt\") list(APPEND paths \"${path}/${subdir}\") list(APPEND names \"${subdir}\") endif() endforeach() # Example 2 foreach(mod ${OPENCV_MODULES_BUILD} ${OPENCV_MODULES_DISABLED_USER} ${OPENCV_MODULES_DISABLED_AUTO} ${OPENCV_MODULES_DISABLED_FORCE}) if(HAVE_${mod}) unset(HAVE_${mod} CACHE) endif() unset(OPENCV_MODULE_${mod}_DEPS CACHE) unset(OPENCV_MODULE_${mod}_DEPS_EXT CACHE) # \u7701\u7565\u4e00\u7cfb\u5217 unset endforeach() \u53ef\u4ee5\u5f97\u51fa\uff0c\u904d\u5386\u5faa\u73af\u63a7\u5236\u7684\u57fa\u672c\u5199\u6cd5\u4e3a\uff1a foreach(\u6bcf\u4e2a\u5143\u7d20 ${\u5217\u88681} ${\u5217\u88682} ...) \u5faa\u73af\u4f53 endforeach() \u5bf9\u4e8e\u4ee5\u4e0a\u4e24\u4e2a\u4f8b\u5b50 Example 1 \u548c Example 2\uff0c\u6709\u4ee5\u4e0b\u6ce8\u610f\u7684\u5730\u65b9\uff1a Example 1 ${subdirs} \u4e0d\u53ef\u5199\u6210 \"${subdirs}\" \uff0c\u6211\u4eec\u5047\u8bbe\u6b64\u5904 ${subdirs} \u5185\u5bb9\u6709\uff1a a \u3001 b \u3001 c \uff0c\u90a3\u4e48\u904d\u5386\u7684\u65f6\u5019 subdir \u5219\u5206\u522b\u6307\u4ee3 a \u3001 b \u3001 c \u3002\u800c\u5982\u679c\u5199\u6210 \"${subdirs}\" \uff0c\u5c55\u5f00\u5219\u8868\u793a \"a;b;c\" \uff0c\u90a3\u4e48 subdir \u5219\u6307\u4ee3 a;b;c \u8fd9\u4e2a\u53d8\u91cf\u3002 subdir \u662f\u4e2a\u666e\u901a\u53d8\u91cf\uff0c\u56e0\u6b64\u5728\u8bbf\u95ee\uff08\u53d6\u503c\uff09\u65f6\u4e5f\u9700\u8981\u7528 ${} \u7684\u5199\u6cd5\u3002 Example 2 \u5171\u6709 4 \u4e2a\u5f85\u904d\u5386\u7684\u5217\u8868\uff0c\u904d\u5386\u5219\u4f1a\u5c06\u8fd9 4 \u4e2a\u5217\u8868\u4e2d\u7684\u6240\u6709\u5185\u5bb9\u4f9d\u6b21\u8bbf\u95ee\u3002 mod \u4e3a\u4e00\u4e2a\u53d8\u91cf\uff0c\u4e0d\u4f8b\u5916\u7684\u4e5f\u9700\u8981\u7528 ${} \u6765\u8bbf\u95ee\u3002\u540c\u65f6\u6211\u4eec\u8fd8\u80fd\u770b\u5230\u8fd9\u79cd\u5199\u6cd5\uff1a cmake unset(OPENCV_MODULE_${mod}_DEPS CACHE) ${mod} \u7528\u5728\u4e86\u4e00\u4e2a\u53d8\u91cf\u7684\u4e2d\u95f4\uff0c\u5047\u8bbe\u6b64\u65f6 ${mod} \u6307\u7684\u662f aa \uff0c\u90a3\u4e48\u8fd9\u4e2a\u53d8\u91cf\u5219\u8868\u793a\u4e3a\uff1a OPENCV_MODULE_aa_DEPS ::: warning \u6761\u4ef6\u63a7\u5236\u7ed3\u675f\u6807\u5fd7 endif() \u548c\u5faa\u73af\u63a7\u5236\u7ed3\u675f\u6807\u5fd7 endforeach() \u62ec\u53f7\u4e2d\u7684\u5185\u5bb9\u53ef\u4ee5\u4e0d\u5199\uff0c\u4e00\u65e6\u5199\uff0c\u5c31\u5fc5\u987b\u8ddf if() \u548c foreach() \u62ec\u53f7\u4e2d\u7684\u5185\u5bb9\u4e00\u81f4 ::: 3.2 \u5176\u4ed6\u5199\u6cd5 foreach \u8fd8\u6709\u5176\u4ed6\u5199\u6cd5\uff0c\u4f8b\u5982\u5bf9\u4e8e foreach(m ${members}) # ... endforeach() \u6709\u66f4\u76f4\u89c2\u7684\u5199\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u6210 foreach(m IN LIST members) # ... endforeach() 4. \u793a\u4f8b \u5982\u679c\u6211\u4eec\u60f3\u904d\u5386\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u5939\u8981\u600e\u4e48\u529e\uff1f\u5728\u7ec8\u7aef\u4e2d\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ls \u6765\u5217\u51fa\u5f53\u524d\u8def\u5f84\u4e0b\u7684\u6240\u6709\u5185\u5bb9\uff0c\u5305\u62ec\u6587\u4ef6\u5939\uff0c\u5f53\u7136\u4e5f\u5305\u62ec\u4e86\u6587\u4ef6\uff0c\u5728 CMake \u4e2d\u6211\u4eec\u8981\u5982\u4f55\u8c03\u7528\u547d\u4ee4\u884c\u5462\uff1f 4.1 \u5217\u51fa\u6587\u4ef6\u4e0e\u6587\u4ef6\u5939 4.1.1 \u6267\u884c\u5b50\u8fdb\u7a0b\uff1aexecute_process \u5148\u5217\u51fa\u5b98\u7f51\u7ed9\u51fa\u7684\u547d\u4ee4\u539f\u578b\uff1a ```cmake :collapsed-lines=8 execute_process(COMMAND [ ] [COMMAND [ ]]... [WORKING_DIRECTORY ] [TIMEOUT ] [RESULT_VARIABLE ] [RESULTS_VARIABLE ] [OUTPUT_VARIABLE ] [ERROR_VARIABLE ] [INPUT_FILE ] [OUTPUT_FILE ] [ERROR_FILE ] [OUTPUT_QUIET] [ERROR_QUIET] [COMMAND_ECHO ] [OUTPUT_STRIP_TRAILING_WHITESPACE] [ERROR_STRIP_TRAILING_WHITESPACE] [ENCODING ] [ECHO_OUTPUT_VARIABLE] [ECHO_ERROR_VARIABLE] [COMMAND_ERROR_IS_FATAL ]) \u8fd9\u91cc\u5217\u51fa\u5e38\u7528\u7684\u51e0\u4e2a\u9009\u9879\uff1a&#x20; - `COMMAND` - \u7528\u4e8e\u6307\u5b9a\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u547d\u4ee4\u884c\u3002 - CMake \u76f4\u63a5\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf API \u6267\u884c\u5b50\u8fdb\u7a0b\u3002\u6240\u6709\u53c2\u6570\u90fd\u88ab\u9010\u5b57\u4f20\u9012\u7ed9\u5b50\u8fdb\u7a0b\u3002\u6ca1\u6709\u4f7f\u7528\u4e2d\u95f4 Shell\uff0c\u6240\u4ee5\u50cf `>` \u8fd9\u6837\u7684 Shell \u64cd\u4f5c\u7b26\u88ab\u89c6\u4e3a\u666e\u901a\u53c2\u6570\u3002 - \u5982\u679c\u9700\u8981\u8fde\u7eed\u6267\u884c\u591a\u4e2a\u547d\u4ee4\uff0c\u8bf7\u4f7f\u7528\u591a\u4e2a `execute_process()` \u8c03\u7528\uff0c\u5e76\u4f7f\u7528\u5355\u4e2a `COMMAND` \u53c2\u6570\u3002 - `OUTPUT_VARIABLE` - \u53d8\u91cf\u540d\u5c06\u5206\u522b\u7528\u6807\u51c6\u8f93\u51fa\u7ba1\u9053\u7684\u5185\u5bb9\u8bbe\u7f6e\u3002 - `ERROR_VARIABLE` - \u53d8\u91cf\u540d\u5c06\u5206\u522b\u7528\u6807\u51c6\u9519\u8bef\u7ba1\u9053\u7684\u5185\u5bb9\u8bbe\u7f6e\u3002 \u56e0\u6b64\uff0c\u5217\u51fa\u5f53\u524d\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\u5939\uff0c\u5c31\u53ef\u4ee5\u5199\u4e3a ```cmake execute_process(COMMAND ls ${CMAKE_CURRENT_LIST_DIR} OUTPUT_VARIABLE subs) \u5176\u4e2d\uff0c\u8f93\u51fa\u7684\u53d8\u91cf\u4e3a subs \uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4ec5\u80fd\u5728\u652f\u6301 ls \u547d\u4ee4\u7684\u7ec8\u7aef\u4e0a\u4f7f\u7528\uff0c\u4f8b\u5982 Shell \u3001 Windows PowerShell \u7b49\u3002 4.1.2 \u4f7f\u7528 file \u64cd\u4f5c \u4e3a\u5b9e\u73b0\u540c\u6837\u6548\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u66f4\u52a0\u901a\u7528\u7684 file \u547d\u4ee4 set(cur_path \"${CMAKE_CURRENT_LIST_DIR}\") file(GLOB subs RELATIVE \"${cur_path}\" \"${cur_path}/*\") \u5176\u4e2d\uff0c\u8f93\u51fa\u7684\u53d8\u91cf\u4e3a subs 4.2 \u7528\u6cd5\u793a\u4f8b \u4f8b\u5982\uff0c\u5217\u51fa\u5f53\u524d\u76ee\u5f55\u4e0b\u6240\u6709\u7684\u6587\u4ef6\u5939\uff0c\u5e76\u6dfb\u52a0\u81f3 dirs \u4e2d set(dirs) set(cur_path \"${CMAKE_CURRENT_LIST_DIR}\") file(GLOB subs RELATIVE \"${cur_path}\" \"${cur_path}/*\") foreach(_sub ${subs}) if(IS_DIRECTORY ${_sub}) list(APPEND dirs ${_sub}) endif() endforeach()","title":"\u301004\u3011\u8fd0\u7b97\u7b26\u4e0e\u6761\u4ef6\u3001\u5faa\u73af\u8bed\u53e5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#04","text":"","title":"\u301004\u3011\u8fd0\u7b97\u7b26\u4e0e\u6761\u4ef6\u3001\u5faa\u73af\u8bed\u53e5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#_1","text":"::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#1-if","text":"\u6761\u4ef6\u63a7\u5236\u7684\u57fa\u672c\u5199\u6cd5\u4e3a\uff1a if(aaa) # ... elseif(bbb) # ... else() # ... endif() \u5e76\u4e14\u80fd\u591f\u652f\u6301\u5d4c\u5957\u6761\u4ef6\u63a7\u5236\uff0c\u5373 if(aaa) # ... if(ccc) # ... endif() # ... else() # ... endif()","title":"1. \u6761\u4ef6\u63a7\u5236\uff1aif"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#2","text":"\u5148\u7ed9\u51fa\u4ee5\u4e0b\u4f8b\u5b50 # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 if(\" ${ARGV1}\" STREQUAL \" INTERNAL\" OR \" ${ARGV1}\" STREQUAL \" BINDINGS\") set(OPENCV_MODULE_${the_module}_CLASS \"${ARGV1}\" CACHE INTERNAL \"The category of the module\") set(__ocv_argn__ ${ADD_MODULE_ARGN}) list(REMOVE_AT __ocv_argn__ 0) ocv_add_dependencies(${the_module} ${__ocv_argn__}) unset(__ocv_argn__) else() set(OPENCV_MODULE_${the_module}_CLASS \"PUBLIC\" CACHE INTERNAL \"The category of the module\") ocv_add_dependencies(${the_module} ${ADD_MODULE_ARGN}) if(BUILD_${the_module}) set(OPENCV_MODULES_PUBLIC ${OPENCV_MODULES_PUBLIC} \"${the_module}\" CACHE INTERNAL \"List of OpenCV modules marked for export\") endif() endif() \u5728 if() \u7684\u5c0f\u62ec\u53f7\u4e2d\u51fa\u73b0\u4e86 STREQUAL \u4ee5\u53ca OR \u7684\u5185\u5bb9\uff0c\u8fd9\u4e9b\u5c5e\u4e8e\u8fd0\u7b97\u7b26\uff0c\u6211\u4eec\u6709\u5fc5\u8981\u4ecb\u7ecd\u4e00\u4e9b\u80fd\u591f\u4ea7\u751f BOOL \u7c7b\u578b\u53d8\u91cf\u7684\u8fd0\u7b97\u7b26\uff0c\u8fd9\u4e9b\u8fd0\u7b97\u7b26\u4e5f\u5e38\u7528\u4e8e\u6761\u4ef6\u63a7\u5236\u4e2d\u3002","title":"2. \u8fd0\u7b97\u7b26"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#21","text":"EXISTS \uff1a\u5224\u65ad\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u662f\u5426\u5b58\u5728\uff0c\u5b58\u5728\u65f6\u4e3a\u771f\u3002\u9700\u8981\u63d0\u4f9b\u7edd\u5bf9\u8def\u5f84\uff1b\u5982\u679c\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u662f\u7b26\u53f7\u94fe\u63a5\uff08\u4f8b\u5982\u8f6f\u8fde\u63a5\uff09\uff0c\u5219\u53ea\u6709\u5f53\u94fe\u63a5\u7684\u76ee\u6807\u5b58\u5728\u65f6\u8fd4\u56de\u771f\u3002\u683c\u5f0f\u4e3a\uff1a EXISTS xxx \uff0c\u4f8b\u5982\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 if(EXISTS \"${CMAKE_CURRENT_BINARY_DIR}/test\") IS_DIRECTORY \uff1a\u5224\u65ad\u6307\u5b9a\u5185\u5bb9\u662f\u5426\u4e3a\u6587\u4ef6\u5939\uff0c\u662f\u5219\u4e3a\u771f\u3002\u9700\u8981\u63d0\u4f9b\u7edd\u5bf9\u8def\u5f84\u3002\u683c\u5f0f\u4e3a\uff1a IS_DIRECTOTY xxx \uff0c\u4f8b\u5982\uff1a cmake if(IS_DIRECTORY ${CMAKE_CURRENT_LIST_DIR}/${m}) COMMAND \uff1a\u5982\u679c\u7ed9\u5b9a\u7684\u540d\u79f0\u662f\u547d\u4ee4\u3001\u5b8f\u6216\u8005\u51fd\u6570\u8fd9\u7c7b\u53ef\u88ab\u8c03\u7528\u7684\u5bf9\u8c61\uff0c\u5219\u8fd4\u56de\u771f\u3002\u683c\u5f0f\u4e3a\uff1a COMMAND xxx \uff0c\u4f8b\u5982\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 if(COMMAND ocv_get_module_external_sources) DEFINED \uff1a\u5982\u679c\u7ed9\u5b9a\u7684\u53d8\u91cf\uff08\u666e\u901a\u53d8\u91cf\u3001\u7f13\u5b58\u53d8\u91cf\u6216\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\uff09\u5b58\u5728\uff0c\u5219\u8fd4\u56de\u771f\u3002\u683c\u5f0f\u4e3a\uff1a DEFINED xxx \uff0c\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u524d\u8981\u52a0 ENV \uff0c\u5373 DEFINED ENV xxx \u3002\u793a\u4f8b\u5982\u4e0b\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 if(DEFINED OPENCV_INITIAL_PASS) TARGET \uff1a\u5982\u679c\u7ed9\u5b9a\u7684\u540d\u79f0\u662f\u76ee\u6807\uff08\u5305\u62ec\u4e8c\u8fdb\u5236\u76ee\u6807\u3001\u4f2a\u76ee\u6807\uff0c\u53ef\u53c2\u8003 \u301005\u3011\u76ee\u6807\u6784\u5efa \uff09\uff0c\u5219\u8fd4\u56de\u771f\u3002\u683c\u5f0f\u4e3a\uff1a TARGET xxx \uff0c\u4f8b\u5982\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVGenABI.cmake \u4e2d\u7684\u5185\u5bb9 if(TARGET opencv_${mod}) # opencv_world","title":"2.1 \u4e00\u5143\u8fd0\u7b97\u7b26"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#22","text":"EQUAL \uff1a\u5de6\u8fb9\u4e24\u4e2a\u5b57\u7b26\u4e32\u6216\u8005\u53d8\u91cf\u76f8\u7b49\u65f6\u4e3a\u771f\u3002 STREQUAL \uff1a\u5de6\u8fb9\u4e0e\u53f3\u8fb9\u7684\u5b57\u5178\u987a\u5e8f\u76f8\u7b49\u65f6\u4e3a\u771f\u3002 MATCHES \uff1a\u6309\u7167\u6b63\u5219\u8868\u8fbe\u5f0f\u53bb\u5339\u914d\uff0c\u5de6\u8fb9\u662f\u5f85\u5339\u914d\u7684\u503c\uff0c\u53f3\u8fb9\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u80fd\u5339\u914d\u4e3a\u65f6\u4e3a\u771f\u3002\u4f8b\u5982\uff1a cmake # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 # m \u4e3a\u67d0\u4e2a foreach \u4e2d\u7684\u5143\u7d20 if(NOT m MATCHES \"^opencv_\")","title":"2.2 \u4e8c\u5143\u8fd0\u7b97\u7b26"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#23","text":"\u4e0e\u5176\u4ed6\u8bed\u8a00\u4e00\u81f4\uff0c\u5305\u542b\u4e0e\u3001\u6216\u3001\u975e\uff1a AND \u3001 OR \u3001 NOT if(BUILD_opencv_world AND m STREQUAL \"opencv_world\" OR NOT BUILD_opencv_world OR NOT OPENCV_MODULE_${m}_IS_PART_OF_WORLD) \u903b\u8f91\u64cd\u4f5c\u7b26\u7684\u7ed3\u5408\u4f18\u5148\u7ea7\uff1a NOT > AND > OR ::: tip \u8fd0\u7b97\u7b26\u7ed3\u5408\u987a\u5e8f\u4e3a\uff1a\u4e00\u5143\u8fd0\u7b97\u7b26 > \u4e8c\u5143\u8fd0\u7b97\u7b26 > \u903b\u8f91\u8fd0\u7b97\u7b26 :::","title":"2.3 \u903b\u8f91\u8fd0\u7b97\u7b26"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#3-foreach","text":"\u8fd9\u91cc\u4ecb\u7ecd\u6700\u5e38\u7528\u7684 foreach \uff0c while \u8fd9\u91cc\u4e0d\u505a\u4ecb\u7ecd","title":"3. \u5faa\u73af\u63a7\u5236\uff1aforeach"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#31","text":"\u5148\u7ed9\u51fa\u4e24\u4e2a\u4f8b\u5b50\uff1a # \u4ee5\u4e0b\u5747\u4e3a\u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d\u7684\u5185\u5bb9 # Example 1 foreach(subdir ${subdirs}) if(EXISTS \"${path}/${subdir}/CMakeLists.txt\") list(APPEND paths \"${path}/${subdir}\") list(APPEND names \"${subdir}\") endif() endforeach() # Example 2 foreach(mod ${OPENCV_MODULES_BUILD} ${OPENCV_MODULES_DISABLED_USER} ${OPENCV_MODULES_DISABLED_AUTO} ${OPENCV_MODULES_DISABLED_FORCE}) if(HAVE_${mod}) unset(HAVE_${mod} CACHE) endif() unset(OPENCV_MODULE_${mod}_DEPS CACHE) unset(OPENCV_MODULE_${mod}_DEPS_EXT CACHE) # \u7701\u7565\u4e00\u7cfb\u5217 unset endforeach() \u53ef\u4ee5\u5f97\u51fa\uff0c\u904d\u5386\u5faa\u73af\u63a7\u5236\u7684\u57fa\u672c\u5199\u6cd5\u4e3a\uff1a foreach(\u6bcf\u4e2a\u5143\u7d20 ${\u5217\u88681} ${\u5217\u88682} ...) \u5faa\u73af\u4f53 endforeach() \u5bf9\u4e8e\u4ee5\u4e0a\u4e24\u4e2a\u4f8b\u5b50 Example 1 \u548c Example 2\uff0c\u6709\u4ee5\u4e0b\u6ce8\u610f\u7684\u5730\u65b9\uff1a Example 1 ${subdirs} \u4e0d\u53ef\u5199\u6210 \"${subdirs}\" \uff0c\u6211\u4eec\u5047\u8bbe\u6b64\u5904 ${subdirs} \u5185\u5bb9\u6709\uff1a a \u3001 b \u3001 c \uff0c\u90a3\u4e48\u904d\u5386\u7684\u65f6\u5019 subdir \u5219\u5206\u522b\u6307\u4ee3 a \u3001 b \u3001 c \u3002\u800c\u5982\u679c\u5199\u6210 \"${subdirs}\" \uff0c\u5c55\u5f00\u5219\u8868\u793a \"a;b;c\" \uff0c\u90a3\u4e48 subdir \u5219\u6307\u4ee3 a;b;c \u8fd9\u4e2a\u53d8\u91cf\u3002 subdir \u662f\u4e2a\u666e\u901a\u53d8\u91cf\uff0c\u56e0\u6b64\u5728\u8bbf\u95ee\uff08\u53d6\u503c\uff09\u65f6\u4e5f\u9700\u8981\u7528 ${} \u7684\u5199\u6cd5\u3002 Example 2 \u5171\u6709 4 \u4e2a\u5f85\u904d\u5386\u7684\u5217\u8868\uff0c\u904d\u5386\u5219\u4f1a\u5c06\u8fd9 4 \u4e2a\u5217\u8868\u4e2d\u7684\u6240\u6709\u5185\u5bb9\u4f9d\u6b21\u8bbf\u95ee\u3002 mod \u4e3a\u4e00\u4e2a\u53d8\u91cf\uff0c\u4e0d\u4f8b\u5916\u7684\u4e5f\u9700\u8981\u7528 ${} \u6765\u8bbf\u95ee\u3002\u540c\u65f6\u6211\u4eec\u8fd8\u80fd\u770b\u5230\u8fd9\u79cd\u5199\u6cd5\uff1a cmake unset(OPENCV_MODULE_${mod}_DEPS CACHE) ${mod} \u7528\u5728\u4e86\u4e00\u4e2a\u53d8\u91cf\u7684\u4e2d\u95f4\uff0c\u5047\u8bbe\u6b64\u65f6 ${mod} \u6307\u7684\u662f aa \uff0c\u90a3\u4e48\u8fd9\u4e2a\u53d8\u91cf\u5219\u8868\u793a\u4e3a\uff1a OPENCV_MODULE_aa_DEPS ::: warning \u6761\u4ef6\u63a7\u5236\u7ed3\u675f\u6807\u5fd7 endif() \u548c\u5faa\u73af\u63a7\u5236\u7ed3\u675f\u6807\u5fd7 endforeach() \u62ec\u53f7\u4e2d\u7684\u5185\u5bb9\u53ef\u4ee5\u4e0d\u5199\uff0c\u4e00\u65e6\u5199\uff0c\u5c31\u5fc5\u987b\u8ddf if() \u548c foreach() \u62ec\u53f7\u4e2d\u7684\u5185\u5bb9\u4e00\u81f4 :::","title":"3.1 \u7528\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#32","text":"foreach \u8fd8\u6709\u5176\u4ed6\u5199\u6cd5\uff0c\u4f8b\u5982\u5bf9\u4e8e foreach(m ${members}) # ... endforeach() \u6709\u66f4\u76f4\u89c2\u7684\u5199\u6cd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5199\u6210 foreach(m IN LIST members) # ... endforeach()","title":"3.2 \u5176\u4ed6\u5199\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#4","text":"\u5982\u679c\u6211\u4eec\u60f3\u904d\u5386\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u5939\u8981\u600e\u4e48\u529e\uff1f\u5728\u7ec8\u7aef\u4e2d\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ls \u6765\u5217\u51fa\u5f53\u524d\u8def\u5f84\u4e0b\u7684\u6240\u6709\u5185\u5bb9\uff0c\u5305\u62ec\u6587\u4ef6\u5939\uff0c\u5f53\u7136\u4e5f\u5305\u62ec\u4e86\u6587\u4ef6\uff0c\u5728 CMake \u4e2d\u6211\u4eec\u8981\u5982\u4f55\u8c03\u7528\u547d\u4ee4\u884c\u5462\uff1f","title":"4. \u793a\u4f8b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#41","text":"","title":"4.1 \u5217\u51fa\u6587\u4ef6\u4e0e\u6587\u4ef6\u5939"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#411-execute_process","text":"\u5148\u5217\u51fa\u5b98\u7f51\u7ed9\u51fa\u7684\u547d\u4ee4\u539f\u578b\uff1a ```cmake :collapsed-lines=8 execute_process(COMMAND [ ] [COMMAND [ ]]... [WORKING_DIRECTORY ] [TIMEOUT ] [RESULT_VARIABLE ] [RESULTS_VARIABLE ] [OUTPUT_VARIABLE ] [ERROR_VARIABLE ] [INPUT_FILE ] [OUTPUT_FILE ] [ERROR_FILE ] [OUTPUT_QUIET] [ERROR_QUIET] [COMMAND_ECHO ] [OUTPUT_STRIP_TRAILING_WHITESPACE] [ERROR_STRIP_TRAILING_WHITESPACE] [ENCODING ] [ECHO_OUTPUT_VARIABLE] [ECHO_ERROR_VARIABLE] [COMMAND_ERROR_IS_FATAL ]) \u8fd9\u91cc\u5217\u51fa\u5e38\u7528\u7684\u51e0\u4e2a\u9009\u9879\uff1a&#x20; - `COMMAND` - \u7528\u4e8e\u6307\u5b9a\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u547d\u4ee4\u884c\u3002 - CMake \u76f4\u63a5\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf API \u6267\u884c\u5b50\u8fdb\u7a0b\u3002\u6240\u6709\u53c2\u6570\u90fd\u88ab\u9010\u5b57\u4f20\u9012\u7ed9\u5b50\u8fdb\u7a0b\u3002\u6ca1\u6709\u4f7f\u7528\u4e2d\u95f4 Shell\uff0c\u6240\u4ee5\u50cf `>` \u8fd9\u6837\u7684 Shell \u64cd\u4f5c\u7b26\u88ab\u89c6\u4e3a\u666e\u901a\u53c2\u6570\u3002 - \u5982\u679c\u9700\u8981\u8fde\u7eed\u6267\u884c\u591a\u4e2a\u547d\u4ee4\uff0c\u8bf7\u4f7f\u7528\u591a\u4e2a `execute_process()` \u8c03\u7528\uff0c\u5e76\u4f7f\u7528\u5355\u4e2a `COMMAND` \u53c2\u6570\u3002 - `OUTPUT_VARIABLE` - \u53d8\u91cf\u540d\u5c06\u5206\u522b\u7528\u6807\u51c6\u8f93\u51fa\u7ba1\u9053\u7684\u5185\u5bb9\u8bbe\u7f6e\u3002 - `ERROR_VARIABLE` - \u53d8\u91cf\u540d\u5c06\u5206\u522b\u7528\u6807\u51c6\u9519\u8bef\u7ba1\u9053\u7684\u5185\u5bb9\u8bbe\u7f6e\u3002 \u56e0\u6b64\uff0c\u5217\u51fa\u5f53\u524d\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6\u5939\uff0c\u5c31\u53ef\u4ee5\u5199\u4e3a ```cmake execute_process(COMMAND ls ${CMAKE_CURRENT_LIST_DIR} OUTPUT_VARIABLE subs) \u5176\u4e2d\uff0c\u8f93\u51fa\u7684\u53d8\u91cf\u4e3a subs \uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4ec5\u80fd\u5728\u652f\u6301 ls \u547d\u4ee4\u7684\u7ec8\u7aef\u4e0a\u4f7f\u7528\uff0c\u4f8b\u5982 Shell \u3001 Windows PowerShell \u7b49\u3002","title":"4.1.1 \u6267\u884c\u5b50\u8fdb\u7a0b\uff1aexecute_process"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#412-file","text":"\u4e3a\u5b9e\u73b0\u540c\u6837\u6548\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u66f4\u52a0\u901a\u7528\u7684 file \u547d\u4ee4 set(cur_path \"${CMAKE_CURRENT_LIST_DIR}\") file(GLOB subs RELATIVE \"${cur_path}\" \"${cur_path}/*\") \u5176\u4e2d\uff0c\u8f93\u51fa\u7684\u53d8\u91cf\u4e3a subs","title":"4.1.2 \u4f7f\u7528 file \u64cd\u4f5c"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/04/#42","text":"\u4f8b\u5982\uff0c\u5217\u51fa\u5f53\u524d\u76ee\u5f55\u4e0b\u6240\u6709\u7684\u6587\u4ef6\u5939\uff0c\u5e76\u6dfb\u52a0\u81f3 dirs \u4e2d set(dirs) set(cur_path \"${CMAKE_CURRENT_LIST_DIR}\") file(GLOB subs RELATIVE \"${cur_path}\" \"${cur_path}/*\") foreach(_sub ${subs}) if(IS_DIRECTORY ${_sub}) list(APPEND dirs ${_sub}) endif() endforeach()","title":"4.2 \u7528\u6cd5\u793a\u4f8b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/","text":"\u301005\u3011\u76ee\u6807\u6784\u5efa \u6559\u5b66\u89c6\u9891 ::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili @ bilibili 1. \u524d\u671f\u51c6\u5907 \u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u4e86\u89e3\u4e00\u4e9b\u57fa\u672c\u7684\u77e5\u8bc6\u5e76\u56de\u987e \u301001\u3011\u5b89\u88c5\u4e0e\u57fa\u672c\u4ecb\u7ecd \u7684\u5185\u5bb9\u4f5c\u4e3a\u524d\u671f\u51c6\u5907 1.1 \u7f16\u8bd1\u7684 4 \u4e2a\u6b65\u9aa4 \u7f16\u8bd1\u578b\u8bed\u8a00\u7f16\u8bd1\u4e00\u822c\u90fd\u6709 4 \u4e2a\u6b65\u9aa4\uff0c\u5206\u522b\u662f\uff1a==\u9884\u7f16\u8bd1==\u3001==\u7f16\u8bd1==\u3001==\u6c47\u7f16==\u3001==\u94fe\u63a5==\uff0c\u8fd9\u91cc\u7684\u7f16\u8bd1\u4ec5\u6307\u5c06\u6e90\u4ee3\u7801\u7ffb\u8bd1\u6210\u6c47\u7f16\u4ee3\u7801\u3002\u800c\u6211\u4eec\u5e73\u65f6\u79f0\u7684\u7f16\u8bd1\u5219\u6307\u5c06\u6e90\u4ee3\u7801\u7ffb\u8bd1\u6210\u53ef\u6267\u884c\u6587\u4ef6\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002Ubuntu \u4e0b\u5e38\u89c1\u7684\u7f16\u8bd1\u5de5\u5177\u662f Unix Makefiles\uff0c\u6211\u4eec\u5728\u7ec8\u7aef\u8f93\u5165 make \u7684\u65f6\u5019\uff0c\u7528\u5230\u7684\u5c31\u662f Unix Makefiles\u3002\u800c\u6240\u6709\u7684\u7f16\u8bd1\u5de5\u5177\u5747\u4f1a\u6839\u636e\u6307\u5b9a\u7684\u6216\u8005\u9ed8\u8ba4\u7684\u73af\u5883\u53d8\u91cf\uff0c\u4f8b\u5982\u5728 Makefile \u6587\u4ef6\u4e2d\uff0c\u53ef\u80fd\u53ef\u4ee5\u627e\u5230\u7c7b\u4f3c CC = gcc CXX = g++ \u7684\u5185\u5bb9\uff0c\u4ece\u800c\u9009\u62e9\u6307\u5b9a\u7684\u7f16\u8bd1\u5668\u3002\u7f16\u8bd1\u5668\u5219\u6839\u636e\u7f16\u8bd1\u5de5\u5177\u6240\u5236\u5b9a\u7684\u89c4\u5219\u5bf9\u4e00\u7cfb\u5217\u6e90\u7801\u8fdb\u884c\u89e3\u6790\u3001\u7f16\u8bd1\u3001\u94fe\u63a5\uff0c\u4f8b\u5982\u53ef\u4ee5\u5728 Makefile \u6587\u4ef6\u4e2d\u6307\u5b9a CFLAGS = -g -O2 \u5e76\u4f7f\u7528\u7c7b\u4f3c $(CC) $(CFLAGS) \u7684\u8bed\u53e5\u5b8c\u6210\u5bf9\u7f16\u8bd1\u5668\u76f8\u5173\u7f16\u8bd1\u9009\u9879\u7684\u8bbe\u7f6e\uff0c\u6700\u7ec8\u5728\u7f16\u8bd1\u65f6\u751f\u6210\u5bf9\u5e94\u7684\u7b26\u5408\u8981\u6c42\u7684\u76ee\u6807\uff08\u53ef\u6267\u884c\u6587\u4ef6\u3001\u52a8\u6001\u5e93\u3001\u9759\u6001\u5e93\uff09 1.2 \u56de\u987e CMake \u7684\u5730\u4f4d CMake \u4f5c\u4e3a\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u7f16\u8bd1\u5de5\u5177\uff0c\u80fd\u591f\u4f7f\u7528\u901a\u7528\u7684\u8bed\u6cd5\uff08\u7ec4\u6001\u6863\uff09\u751f\u6210\u7f16\u8bd1\u5de5\u5177\u80fd\u591f\u89e3\u6790\u7684\u6587\u4ef6\uff08\u5efa\u6784\u6863\uff09\uff0c\u4ece\u800c\u5b8c\u6210\u5bf9\u9879\u76ee\u7684\u6784\u5efa\uff0c\u4f8b\u5982\u4f1a\u751f\u6210 MSBuild \u80fd\u591f\u89e3\u6790\u7684 .sln \u548c .vcxproj \u6587\u4ef6 Unix Makefiles \u80fd\u591f\u89e3\u6790\u7684 Makefile \u6587\u4ef6 MinGW Makefiles \u80fd\u591f\u89e3\u6790\u7684 Makefile \u6587\u4ef6 Ninja \u80fd\u591f\u89e3\u6790\u7684 build.ninja \u6587\u4ef6 1.3 \u52a8\u6001\u5e93 / \u9759\u6001\u5e93 1.3.1 \u662f\u4ec0\u4e48 \u5728 Windows \u4e0b\uff0c\u7ecf\u5e38\u4f1a\u770b\u5230\u6269\u5c55\u540d\u4e3a .dll \u7684\u6587\u4ef6\uff0c\u79f0\u4e3a\u52a8\u6001\u94fe\u63a5\u5e93 Dynamic-Link Library \u3002\u540c\u6837\uff0c\u5728Ubuntu\u4e0b /usr/local/lib \u76ee\u5f55\u4e0b\u4e5f\u80fd\u770b\u5230\u4e00\u7cfb\u5217\u540d\u4e3a *.so \u7684\u6587\u4ef6\uff0c\u79f0\u4e3a\u5171\u4eab\u5bf9\u8c61 Shared Object \uff0c\u8fd9\u4e00\u7c7b\u90fd\u5c5e\u4e8e\u52a8\u6001\u5e93\u3002 \u53e6\u5916\uff0c\u5728 Windows \u4e0b\u4e5f\u6709\u90e8\u5206\u6269\u5c55\u540d\u4e3a *.lib \u7684\u6587\u4ef6\uff0cUbuntu \u4e0b\u4e5f\u8bb8\u80fd\u5728 /usr/local/lib \u76ee\u5f55\u4e0b\u770b\u5230\u4e00\u4e9b *.a \u6587\u4ef6\uff0c\u8fd9\u4e9b\u90fd\u5c5e\u4e8e\u9759\u6001\u5e93\u3002 ::: tip Windows \u4e0b\u7684 *.lib \u6587\u4ef6\u6709\u4e24\u79cd\uff0c\u4e00\u79cd\u662f\u9759\u6001\u5e93\uff0c\u4e00\u79cd\u662fDLL\u5bfc\u5165\u5e93\uff0c\u540e\u8005\u5c45\u591a\uff0c\u4e0d\u8fc7\u5728 CMake \u5f00\u53d1\u4e0a\u7b80\u5355\u5f53\u505a\u9759\u6001\u5e93\u4e5f\u662f\u53ef\u4ee5\u7684\u3002 ::: 1.3.2 \u533a\u522b \u9759\u6001\u5e93\u2014\u2014\u8fd9\u79cd\u5e93\u5728\u7f16\u8bd1\u7684\u65f6\u5019\u4f1a\u76f4\u63a5\u6574\u5408\u5230\u76ee\u6807\u7a0b\u5e8f\u4e2d\uff0c\u6240\u4ee5\u5229\u7528\u9759\u6001\u5e93\u7f16\u8bd1\u6210\u7684\u6587\u4ef6\u4f1a\u6bd4\u8f83\u5927\uff0c\u8fd9\u7c7b\u51fd\u6570\u5e93\u6700\u5927\u7684\u4f18\u70b9\u5c31\u662f\u7f16\u8bd1\u6210\u529f\u7684\u53ef\u6267\u884c\u6587\u4ef6\u53ef\u4ee5\u72ec\u7acb\u8fd0\u884c\uff0c\u800c\u4e0d\u518d\u9700\u8981\u5411\u5916\u90e8\u8981\u6c42\u8bfb\u53d6\u51fd\u6570\u5e93\u7684\u5185\u5bb9\uff1b\u4f46\u662f\u4ece\u5347\u7ea7\u96be\u6613\u5ea6\u6765\u770b\u660e\u663e\u6ca1\u6709\u4f18\u52bf\uff0c\u5982\u679c\u51fd\u6570\u5e93\u66f4\u65b0\uff0c\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u3002 \u52a8\u6001\u5e93\u2014\u2014\u4e0e\u9759\u6001\u51fd\u6570\u5e93\u88ab\u6574\u4e2a\u6355\u6349\u5230\u7a0b\u5e8f\u4e2d\u4e0d\u540c\uff0c\u52a8\u6001\u51fd\u6570\u5e93\u5728\u7f16\u8bd1\u7684\u65f6\u5019\uff0c\u5728\u7a0b\u5e8f\u91cc\u53ea\u6709\u4e00\u4e2a\u7b26\u53f7\u800c\u5df2\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53\u53ef\u6267\u884c\u6587\u4ef6\u9700\u8981\u4f7f\u7528\u5230\u51fd\u6570\u5e93\u7684\u673a\u5236\u65f6\uff0c\u7a0b\u5e8f\u624d\u4f1a\u53bb\u89e3\u6790\u8fd9\u4e2a\u7b26\u53f7\u5e76\u5b8c\u6210\u52a8\u6001\u5e93\u5730\u5740\u7684\u91cd\u5b9a\u4f4d\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u6267\u884c\u6587\u4ef6\u65e0\u6cd5\u5355\u72ec\u8fd0\u884c\u3002\u8fd9\u6837\u4ece\u4ea7\u54c1\u529f\u80fd\u5347\u7ea7\u7684\u89d2\u5ea6\u6765\u8bf4\u662f\u65b9\u4fbf\u7684\uff0c\u53ea\u8981\u66ff\u6362\u5bf9\u5e94\u52a8\u6001\u5e93\u5373\u53ef\u5b8c\u6210\u5347\u7ea7\uff0c\u4e0d\u5fc5\u91cd\u65b0\u7f16\u8bd1\u6574\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u3002 2. \u76ee\u6807\u6784\u5efa 2.1 \u56de\u987e\uff1a\u53ef\u6267\u884c\u6587\u4ef6\u6784\u5efa \u73b0\u7ed9\u5b9a\u4e00\u4e2a\u6587\u4ef6\u67b6\u6784\uff1a . \u251c\u2500\u2500 CMakeLists.txt (\u5f85\u521b\u5efa) \u2514\u2500\u2500 main.cpp \u8fd9\u662f\u6700\u7b80\u5355\u7684\u4e00\u7c7b\u60c5\u51b5\uff0c\u5373\u4ec5\u6709\u4e00\u4e2a *.cpp \u6784\u6210\u53ef\u6267\u884c\u7a0b\u5e8f\u7684\u6e90\u6587\u4ef6\u3002\u5bf9\u4e8e\u8fd9\u79cd\u67b6\u6784\u7684\u6784\u5efa\u65b9\u5f0f\u5728 \u301001\u3011\u5b89\u88c5\u4e0e\u57fa\u672c\u4ecb\u7ecd \u4e2d\u5df2\u7ecf\u505a\u8fc7\u4e86\u6f14\u793a\u3002\u5bf9\u4e8e\u8fd9\u79cd\u901a\u5e38\u53ea\u9700\u8981\u77ed\u77ed\u51e0\u884c CMake \u8bed\u53e5\u5373\u53ef\u5b8c\u6210\uff0c\u9996\u5148\u5728\u5f53\u524d\u76ee\u5f55\u76f4\u63a5\u521b\u5efa CMakeLists.txt\uff0c\u8f93\u5165\uff1a cmake_minimum_required(VERSION 3.16) # \u6307\u5b9a CMake \u6700\u5c0f\u7248\u672c\u53f7\uff0c\u5c0f\u4e8e\u6b64\u7248\u672c\u7684\u65e0\u6cd5\u901a\u8fc7 CMake project(MyProject) # \u5b9a\u4e49\u9879\u76ee\u540d add_executable(my_main main.cpp) # \u4f7f\u7528 main.cpp \u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6 my_main \u5176\u4e2d my_main \u662f\u76ee\u6807\u540d\uff0c\u5728 CMake \u4e2d\u662f\u5177\u6709 TARGET \u5c5e\u6027\u7684\u53d8\u91cf\uff0c\u5373\u76ee\u6807\uff0c\u540c\u65f6\u4e5f\u662f\u53ef\u6267\u884c\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u3002CMake \u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u4e0e\u76ee\u6807\u94fe\u63a5\u6709\u5173\u7684\u64cd\u4f5c\u65b9\u5f0f\u3002\u5176\u4e2d\u5982\u679c my_main \u76ee\u6807\u4f9d\u8d56\u4e86\u5176\u4ed6\u7684\u76ee\u6807\uff0c\u4f8b\u5982 main.cpp \u6587\u4ef6\u4e2d\u4f7f\u7528\u5230\u4e86\u6765\u81ea\u5176\u4ed6 *.cpp \u6587\u4ef6\u5b9a\u4e49\u7684\u51fd\u6570\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5728 CMakeLists.txt \u4e2d\u8f93\u5165 target_link_libraries( my_main PRIVATE xxxx ) \u8fd9\u91cc\u7684 xxxx \u5c31\u8868\u793a\u5305\u542b\u4e86\u8fd9\u4e9b\u51fd\u6570\u5b9a\u4e49\u7684\u76ee\u6807\u3002\u8fd9\u91cc\u8868\u793a\u9700\u8981\u5c06 my_main \u8fd9\u4e2a\u76ee\u6807\u94fe\u63a5\u81f3 xxxx \u4e0a\u3002 \u6b64\u5916\uff0c\u6587\u6863\u4e2d\u7ed9\u51fa\u4e86\u8fd9\u6837\u4e00\u53e5\u8bdd\uff1a New in version 3.13: The <target> doesn't have to be defined in the same directory as the target_link_libraries call. \u7ffb\u8bd1\u8fc7\u6765\u5c31\u662f 3.13 \u7248\u672c\u7684\u65b0\u5185\u5bb9\uff1a <target> \u4e0d\u9700\u8981\u5728\u4e0e\u8c03\u7528 target_link_libraries \u547d\u4ee4\u76f8\u540c\u7684\u76ee\u5f55\u4e2d\u88ab\u5b9a\u4e49\u3002 \u8fd9\u53e5\u8bdd\u5f88\u5173\u952e\uff0c\u8868\u793a\u5728\u8f83\u65b0\u7684 CMake \u7248\u672c\u4e2d\uff0c\u5141\u8bb8\u5728\u6574\u4e2a\u9879\u76ee\u4e2d\u8de8 CMakeLists.txt \u6587\u4ef6\u8fdb\u884c\u94fe\u63a5\u64cd\u4f5c\uff0c\u4f8b\u5982\uff0c\u5373\u4f7f\u4e0a\u6587\u7684 my_main \u5728\u7236\u76ee\u5f55\u7684\u4f5c\u7528\u57df\uff0c xxxx \u5728\u5b50\u76ee\u5f55\u7684\u4f5c\u7528\u57df\uff0c my_main \u6240\u5728\u7684 CMakeLists.txt \u4e5f\u80fd\u8bbf\u95ee\u5230 xxxx \u8fd9\u4e00\u76ee\u6807\u53d8\u91cf\u3002\u8fd9\u4e00\u70b9\u6709\u522b\u4e8e\u666e\u901a\u7684\u53d8\u91cf\uff0c\u53ef\u4ee5\u5f53\u505a\u662f\u5177\u6709\u76ee\u6807\u5c5e\u6027\u7684\u53d8\u91cf\u7684\u4e13\u5c5e\u529f\u80fd\u3002 \u53e6\u5916\u4ee3\u7801\u4e2d\u8fd8\u51fa\u73b0\u4e86 PRIVATE \u7684\u6807\u5fd7\uff0c\u8fd9\u4e2a\u5c5e\u4e8e\u76ee\u6807\u7684\u4f20\u64ad\u65b9\u5f0f\uff0c\u5728\u540e\u6587\u4f1a\u8fdb\u884c\u4ecb\u7ecd\u3002 2.2 \u666e\u901a\u5e93\u76ee\u6807\u6784\u5efa \u5728\u6587\u4ef6\u7ed3\u6784\u590d\u6742\u65f6\uff0c\u6216\u8005\u9700\u8981\u5c06\u529f\u80fd\u6a21\u5757\u9694\u79bb\u3001\u62bd\u8c61\u51fa\u6765\u65f6\uff0c\u7ecf\u5e38\u9700\u8981\u4e3a\u67d0\u4e2a\u6a21\u5757\u6784\u5efa\u4e00\u4e2a\u5e93\uff0c\u6700\u7ec8\u5c06\u8fd9\u4e9b\u5e93\u94fe\u63a5\u81f3\u53ef\u6267\u884c\u6587\u4ef6\u7684\u76ee\u6807\u4e0a\u3002 \u8bed\u6cd5\u662f\uff1a add_library(\u76ee\u6807\u540d [SHARED | [STATIC]] \u6e90\u6587\u4ef6) \u8fd8\u662f\u521a\u624d\u7684\u6587\u4ef6\u7ed3\u6784\uff0c\u5148\u521b\u5efa\u65b0\u7684\u6587\u4ef6\u5939\u53ca\u6587\u4ef6\uff1a . \u251c\u2500\u2500 CMakeLists.txt \u251c\u2500\u2500 main.cpp \u2514\u2500\u2500 MyLib1 \u251c\u2500\u2500 CMakeLists.txt (\u5f85\u521b\u5efa) \u251c\u2500\u2500 include \u2502 \u2514\u2500\u2500 MyLib1.h \u2514\u2500\u2500 src \u251c\u2500\u2500 a.cpp \u251c\u2500\u2500 b.cpp \u2514\u2500\u2500 c.cpp \u9996\u5148\u9879\u76ee\u6839\u76ee\u5f55\u7684 CMakeLists.txt \u9700\u8981\u6dfb\u52a0 add_subdirectory(MyLib1) \u6765\u8ba9\u8be5\u6a21\u5757\u6dfb\u52a0\u81f3\u8be5\u9879\u76ee\u3002\u6b64\u5916\uff0c\u6bcf\u4e2a\u5e93\u9700\u8981\u6709\u4e00\u4e2a\u5355\u72ec\u7684 CMakeLists.txt \u8fdb\u884c\u7ba1\u7406\uff0c\u56e0\u6b64\u9700\u8981\u5728 MyLib1 \u6587\u4ef6\u5939\u5185\u521b\u5efa\u8be5\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a # \u641c\u7d22 src \u6587\u4ef6\u5939\u4e0b\u7684\u6240\u6709\u6e90\u6587\u4ef6\uff0c\u5e76\u6dfb\u52a0\u81f3\u5c40\u90e8\u53d8\u91cf\uff1amy_lib_dir # \u9898\u5916\u8bdd\uff1aaux \u8868\u793a auxiliary \u5373\u8f85\u52a9\u7684\u610f\u601d\uff0c\u8868\u793a\u8fd9\u4e2a\u529f\u80fd\u662f\u4e2a\u8f85\u52a9\u529f\u80fd aux_source_directory(src my_lib_dir) # SHARED \u8868\u793a\u8be5\u76ee\u6807\u4e3a\u52a8\u6001\u5e93\uff0cSTATIC \u5219\u8868\u793a\u9759\u6001\u5e93 add_library(MyLib1 SHARED ${my_lib_dir}) # \u4ee5\u4e0a\u5185\u5bb9\u4e5f\u53ef\u4ee5\u5199\u6210\u4e0b\u4e00\u884c\uff0c\u4f46\u8fd9\u4e48\u957f\u7684\u540d\u5b57\uff0c\u8c01\u4f1a\u8fd9\u4e48\u505a\u5462\uff1f # add_library(MyLib1 SHARED src/a.cpp src/b.cpp src/c.cpp) \u6ce8\u610f\uff0c\u6b64\u5904\u751f\u6210\u7684\u52a8\u6001\u5e93 libMyLib1.so \u65e0\u6cd5\u505a\u5230\u5185\u5b58\u4e0a\u7684\u590d\u7528\uff0c\u5728\u591a\u4e2a\u8fdb\u7a0b\u4f7f\u7528\u5230\u8be5\u52a8\u6001\u5e93\u65f6\uff0c\u4ecd\u7136\u4f1a\u5f00\u8f9f\u4e00\u5757\u5185\u5b58\u5b58\u50a8\u8be5\u52a8\u6001\u5e93\u5185\u5bb9\u3002\u4e3a\u4e86\u771f\u6b63\u5b9e\u73b0\u5185\u5b58\u4e0a\u7684\u590d\u7528\uff0c\u9700\u8981\u4f7f\u7528\u5730\u5740\u65e0\u5173\u4ee3\u7801\u673a\u5236(position-independent code)\uff1a set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -fPIC\") \u8bdd\u8bf4\u56de\u6765\uff0c\u672c\u5e93\u5185\u7684\u4e09\u4e2a\u6e90\u6587\u4ef6\u90fd\u4f1a\u5305\u62ec include \u5934\u6587\u4ef6\u5939\u4e2d\u7684\u5185\u5bb9\uff0c\u56e0\u6b64\u5728\u7f16\u8bd1\u65f6\u9700\u8981\u7ed9\u76ee\u6807\u6dfb\u52a0\u5934\u6587\u4ef6\u7684\u641c\u7d22\u8def\u5f84\uff1a target_include_directories(MyLib1 PUBLIC include) # \u8fd9\u53e5\u547d\u4ee4\u8868\u793a\uff0c\u4e3a MyLib1 \u76ee\u6807\u6dfb\u52a0\u5f53\u524d CMakeLists.txt \u6240\u5728\u76ee\u5f55\u4e0b include \u6587\u4ef6\u5939\u7684\u641c\u7d22\u8def\u5f84 # PUBLIC \u89c4\u5b9a MyLib1 \u7684\u5305\u542b\u76ee\u5f55\u641c\u7d22\u8def\u5f84\u4ee5\u516c\u5f00\u65b9\u5f0f\u4f20\u9012\u7ed9\u5176\u4f59\u76ee\u6807 # \u751f\u6210\u7684\u5efa\u6784\u6863\u4e2d\u4f1a\u5305\u542b\u5f62\u5982\u4ee5\u4e0b\u7684\u5185\u5bb9 gcc mylib1.cpp -I include -o MyLib1 \u4e0a\u6587\u7684 PUBLIC \u5c5e\u6027\uff0c\u6709\u65f6\u5019\u8fd8\u4f1a\u89c1\u5230 INTERFACE \u3001 PRIVATE \u5c5e\u6027\uff0c\u4e00\u5171 3 \u4e2a\u4f20\u9012\u65b9\u5f0f\u3002\u4e0b\u9762\u5bf9\u8fd9\u4e09\u4e2a\u4f20\u9012\u65b9\u5f0f\u505a\u4e2a\u4ecb\u7ecd\uff1a PUBLIC \uff1a\u5728\u7ed1\u5b9a\u5f53\u524d\u76ee\u6807\u65f6\u7ed9\u6307\u5b9a\u7684\u5185\u5bb9\u8bbe\u7f6e\u516c\u6709\u5c5e\u6027\uff0c\u5176\u4ed6\u76ee\u6807\u5728\u94fe\u63a5\u5f53\u524d\u76ee\u6807\u65f6\uff0c\u80fd\u8bbf\u95ee\u8fd9\u4e9b\u6307\u5b9a\u7684\u5185\u5bb9 PRIVATE \uff1a\u5728\u7ed1\u5b9a\u5f53\u524d\u76ee\u6807\u65f6\u7ed9\u6307\u5b9a\u7684\u5185\u5bb9\u8bbe\u7f6e\u79c1\u6709\u5c5e\u6027\uff0c\u5176\u4ed6\u76ee\u6807\u5728\u94fe\u63a5\u5f53\u524d\u76ee\u6807\u65f6\uff0c\u65e0\u6cd5\u8bbf\u95ee\u8fd9\u4e9b\u5185\u5bb9 INTERFACE \uff1a\u5728\u7ed1\u5b9a\u5f53\u524d\u76ee\u6807\u65f6\u7ed9\u6307\u5b9a\u7684\u5185\u5bb9\u8bbe\u7f6e\u63a5\u53e3\u5c5e\u6027\uff0c\u901a\u5e38\u5728\u63a5\u53e3\u5e93\u4e2d\u4f7f\u7528\u3002\u5176\u4ed6\u76ee\u6807\u5728\u94fe\u63a5\u5f53\u524d\u76ee\u6807\u65f6\uff0c\u53ea\u5141\u8bb8\u8bbf\u95ee\u5176\u58f0\u660e\uff08\u63a5\u53e3\uff09 \u6700\u540e\uff0c\u5982\u679c\u6b64\u76ee\u6807\u6709\u4f9d\u8d56 \u672c\u9879\u76ee\u4e2d\u5176\u4ed6\u76ee\u6807 \u9879\u76ee\u4ee5\u5916\u7b2c\u4e09\u65b9\u76ee\u6807\uff08\u4f8b\u5982 OpenCV\uff09 \u7684\u5185\u5bb9\uff0c\u90a3\u5fc5\u987b\u8981\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff1a target_link_libraries( MyLib1 PUBLIC xxxx ) \u540c\u6837\uff0c\u4e3a\u6307\u5b9a\u76ee\u6807\u94fe\u63a5\u5e93\u7684\u8bed\u53e5\u4e5f\u63d0\u4f9b\u4e86 PUBLIC \u3001 PRIVATE \u3001 INTERFACE \u4e09\u4e2a\u5c5e\u6027\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002 \u8fd9\u91cc\u6d89\u53ca\u5230\u7684\u4e24\u4e2a\u8bed\u53e5\uff0c\u6211\u4eec\u505a\u4e2a\u6c47\u603b\uff1a target_include_directories \uff1a\u4e3a\u76ee\u6807\u6dfb\u52a0\u9700\u8981\u5305\u542b\u7684\u6587\u4ef6\uff08\u4e00\u822c\u662f\u5934\u6587\u4ef6\uff09\u7684\u641c\u7d22\u8def\u5f84\uff0c\u8be5\u8def\u5f84\u5c06\u7ed1\u5b9a\u81f3\u76ee\u6807\u4e0a target_link_libraries \uff1a\u4e3a\u76ee\u6807\u6dfb\u52a0\u4f9d\u8d56\u7684\u5e93\uff0c\u8be5\u5e93\u4e5f\u5c06\u7ed1\u5b9a\u81f3\u76ee\u6807\u4e0a ::: important \u4e0a\u6587\u7684\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\u5c5e\u4e8e\u76ee\u6807\u5c5e\u6027\u5f53\u4e2d \u201c\u4f7f\u7528\u8981\u6c42\u201d \u7684\u4e00\u90e8\u5206\uff0c\u6b64\u5916\u8fd8\u6709\u5176\u4ed6\u4e24\u79cd\u4f7f\u7528\u8981\u6c42\uff0c\u4f8b\u5982\u4f7f\u7528 add_library(mylib1 SHARED mylib1.cpp) target_compile_options(mylib1 PUBLIC -Wall) # \u8fd9\u53e5\u547d\u4ee4\u8868\u793a\uff0c\u5728\u6784\u5efa mylib1 \u76ee\u6807\u65f6\u6dfb\u52a0 -Wall \u9009\u9879 # PUBLIC \u89c4\u5b9a mylib1 \u7684 -Wall \u7f16\u8bd1\u9009\u9879\u5c06\u4f1a\u4f20\u9012\u7ed9\u5176\u4f59\u76ee\u6807 # \u751f\u6210\u7684\u5efa\u6784\u6863\u4e2d\u4f1a\u5305\u542b\u5f62\u5982\u4ee5\u4e0b\u7684\u5185\u5bb9 gcc -fPIC -shared main.cpp -o libmylib1.so -Wall \u4ee5\u53ca target_compile_definitions(mylib1 PRIVATE HAVE_ABC) # \u8fd9\u53e5\u547d\u4ee4\u8868\u793a\uff0c\u5728\u6784\u5efa mylib1 \u76ee\u6807\u65f6\u6dfb\u52a0 -D HAVE_ABC \u9009\u9879 # PRIVATE \u89c4\u5b9a mylib1 \u7684 HAVE_ABC \u9884\u7f16\u8bd1\u5b8f\u4e0d\u4f20\u9012\u7ed9\u5176\u4f59\u76ee\u6807 # \u751f\u6210\u7684\u5efa\u6784\u6863\u4e2d\u4f1a\u5305\u542b\u5f62\u5982\u4ee5\u4e0b\u7684\u5185\u5bb9 gcc -fPIC -shared main.cpp -o libmylib1.so -D HAVE_ABC \u8fd9\u4e9b\u90fd\u5c5e\u4e8e\u76ee\u6807\u5c5e\u6027\u5f53\u4e2d\u7684\u4f7f\u7528\u8981\u6c42\uff0c\u800c target_link_libraries \u5219\u4fdd\u8bc1\u4e86\u4ee5\u4e0a\u4f7f\u7528\u8981\u6c42\u8be5\u5982\u4f55\u88ab\u4f20\u9012\u3002 add_executable(demo main.cpp) target_link_libraries(demo PRIVATE mylib1) # \u8fd9\u53e5\u547d\u4ee4\u8868\u793a\uff0c\u4e3a demo \u76ee\u6807\u94fe\u63a5 mylib1 \u76ee\u6807 # PRIVATE \u89c4\u5b9a mylib1 \u7684\u4f7f\u7528\u8981\u6c42\u4e0d\u4f20\u9012\u7ed9\u5176\u4f59\u76ee\u6807 # \u751f\u6210\u7684\u5efa\u6784\u6863\u4e2d\u4f1a\u5305\u542b\u5f62\u5982\u4ee5\u4e0b\u7684\u5185\u5bb9 gcc main.cpp -o demo -Wall -l mylib1 ::: 2.3 \u63a5\u53e3\u5e93\u76ee\u6807\u6784\u5efa \u5728\u7a0b\u5e8f\u5f00\u53d1\u4e2d\uff0c\u6709\u65f6\u5019\u4f1a\u9047\u5230\u53ea\u6709\u5934\u6587\u4ef6\uff08 *.h \u3001 *.hpp \uff09\uff0c\u800c\u6ca1\u6709\u6e90\u6587\u4ef6\uff08 *.c \u3001 *.cpp \uff09\u7684\u60c5\u51b5\uff0c\u800c\u6211\u4eec\u77e5\u9053\uff0c\u4e00\u822c\u5728\u4f7f\u7528 add_library \u7684\u65f6\u5019\u53ea\u80fd\u4e3a\u6e90\u6587\u4ef6\uff08 *.h \u4ee5\u53ca *.hpp \u4e4b\u7c7b\u7684\u5934\u6587\u4ef6\u4e0d\u5c5e\u4e8e\u6e90\u6587\u4ef6\uff09\u751f\u6210\u76ee\u6807\u5e93\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u5bf9\u53ea\u6709\u5934\u6587\u4ef6\u7684\u5e93\u751f\u6210\u76ee\u6807\uff0c\u5e76\u4e14\u8fdb\u884c\u94fe\u63a5\uff0c\u6211\u4eec\u9700\u8981\u521b\u5efa\u63a5\u53e3\u5e93\u3002\u8fd9\u79cd\u76ee\u6807\u7531\u4e8e\u6ca1\u6709\u6e90\u6587\u4ef6\uff0c\u4e0d\u4f1a\u5b9e\u8d28\u6027\u7684\u53c2\u4e0e\u6784\u5efa\uff08\u7f16\u8bd1\uff09\uff0c\u4f46\u63d0\u4f9b\u4e86\u4e0e\u666e\u901a\u76ee\u6807\u76f8\u540c\u7684\u64cd\u4f5c\u65b9\u5f0f\uff0c\u56e0\u6b64\u63a5\u53e3\u5e93\u5c5e\u4e8e\u4f2a\u76ee\u6807\u3002 \u8fd8\u662f\u521a\u624d\u7684\u6587\u4ef6\u7ed3\u6784\uff0c\u5148\u521b\u5efa\u53ea\u6709\u5934\u6587\u4ef6\u7684\u6587\u4ef6\u5939\u53ca CMakeLists.txt \uff1a . \u251c\u2500\u2500 CMakeLists.txt \u251c\u2500\u2500 main.cpp \u251c\u2500\u2500 MyLib1 \u2502 \u251c\u2500\u2500 CMakeLists.txt \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2514\u2500\u2500 MyLib1.h \u2502 \u2514\u2500\u2500 src \u2502 \u251c\u2500\u2500 a.cpp \u2502 \u251c\u2500\u2500 b.cpp \u2502 \u2514\u2500\u2500 c.cpp \u2514\u2500\u2500 MyLib2 \u251c\u2500\u2500 CMakeLists.txt (\u5f85\u521b\u5efa) \u2514\u2500\u2500 include \u2514\u2500\u2500 MyLib2.hpp \u9996\u5148\u9879\u76ee\u6839\u76ee\u5f55\u7684 CMakeLists.txt \u9700\u8981\u6dfb\u52a0 add_subdirectory(MyLib2) \u521b\u5efa\u63a5\u53e3\u5e93\u7684\u8bed\u6cd5\u4e0e\u666e\u901a\u5e93\u7c7b\u4f3c\uff0c\u53ea\u662f\u5c11\u4e86\u6e90\u6587\u4ef6\u7684\u6dfb\u52a0\u7684\u6b65\u9aa4\uff1a add_library(MyLib2 INTERFACE) target_include_directories( MyLib2 INTERFACE include # \u63a5\u53e3\u5e93\u7684\u76ee\u6807\u53ea\u80fd\u4f7f\u7528 INTERFACE \u5c5e\u6027 ) target_link_libraries( MyLib2 INTERFACE xxx ) 2.4 \u5bfc\u5165\u76ee\u6807\u6784\u5efa \u6211\u4eec\u4f1a\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\uff0c\u4ec5\u63d0\u4f9b\u4e86\u82e5\u5e72\u5934\u6587\u4ef6\u548c\u82e5\u5e72\u5e93\u6587\u4ef6\uff08\u4f8b\u5982 *.so \u548c *.a \uff09\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6211\u4eec\u65e0\u6cd5\u901a\u8fc7\u81ea\u5df1 add_library \u4ece\u6e90\u6587\u4ef6\u521b\u5efa\u76ee\u6807\uff0c\u6211\u4eec\u9700\u8981\u5f15\u5165 \u5bfc\u5165\u76ee\u6807 \u3002 \u5047\u8bbe\u67d0\u5bb6\u76f8\u673a\u5382\u5546\u7684 SDK \u63d0\u4f9b\u4e86\u4ee5\u4e0b\u5185\u5bb9\uff0c\u5047\u8bbe\u5c06\u5176\u653e\u5728\u4e86\u9879\u76ee\u6587\u4ef6\u5939\u7684 camera \u6587\u4ef6\u5939\u4e0b\uff0c\u8bf7\u6839\u636e\u4ee5\u4e0b\u6587\u4ef6\u7ed3\u6784\u521b\u5efa\u4e00\u4e2a CMake \u76ee\u6807 . \u251c\u2500\u2500 include \u2502 \u251c\u2500\u2500 CameraApi.h \u2502 \u251c\u2500\u2500 CameraDefine.h \u2502 \u2514\u2500\u2500 CameraStatus.h \u2514\u2500\u2500 lib \u2514\u2500\u2500 libMVSDK.so \u5728 camera \u6587\u4ef6\u5939\u4e2d\u521b\u5efa CMakeLists.txt \u6587\u4ef6\uff0c\u5199\u5165 add_library(camera SHARED IMPORTED) set_target_properties(camera PROPERTIES INTERFACE_INCLUDE_DIRECTORIES \"${CMAKE_CURRENT_LIST_DIR}/include\" IMPORTED_LOCATION \"${CMAKE_CURRENT_LIST_DIR}/lib/libMVSDK.so\" ) \u5bf9\u4e8e INTERFACE_INCLUDE_DIRECTORIES \u7684\u5c5e\u6027\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528\u5e38\u89c4\u7684\u5199\u6cd5\uff0c\u5199\u6210 target_include_directories( camera INTERFACE include ) ::: warning - \u5728\u8bbe\u7f6e IMPORTED_LOCATION \u5c5e\u6027\u7684\u65f6\u5019\u9700\u8981\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84 - \u5bf9\u4e8e lib \u76ee\u5f55\u4e2d\u5b58\u5728\u591a\u4e2a *.so \u7b49\u52a8\u6001\u5e93\u7684\u60c5\u51b5\u4e0b\uff0c\u8bf7\u627e\u5230\u771f\u6b63\u7684\u52a8\u6001\u5e93\uff08\u5176\u4ed6\u52a8\u6001\u5e93\u4e00\u822c\u662f\u966a\u886c\u7684\uff09 ::: 3. \u8865\u5145\u5185\u5bb9 3.1 \u5176\u4f59\u76ee\u6807\u5e93 \u6839\u636e CMake\u5b98\u7f51 \u5bf9\u76ee\u6807\u5e93\u7684\u5212\u5206\uff0c\u53ef\u7b80\u5355\u5206\u4e3a\u4e24\u7c7b\uff1a\u4e8c\u8fdb\u5236\u76ee\u6807\u3001\u4f2a\u76ee\u6807\uff0c\u5176\u5927\u81f4\u5185\u5bb9\u5982\u4e0b \u251c\u2500\u2500 \u4e8c\u8fdb\u5236\u76ee\u6807 \u2502 \u251c\u2500\u2500 \u53ef\u6267\u884c\u6587\u4ef6 \u2502 \u2514\u2500\u2500 \u4e8c\u8fdb\u5236\u5e93 \u2502 \u251c\u2500\u2500 \u666e\u901a\u5e93\uff08\u52a8\u6001\u5e93\u3001\u9759\u6001\u5e93\uff09 \u2502 \u2514\u2500\u2500 \u5bf9\u8c61\u5e93 \u2514\u2500\u2500 \u4f2a\u76ee\u6807 \u251c\u2500\u2500 \u5bfc\u5165\u76ee\u6807 \u251c\u2500\u2500 \u522b\u540d\u76ee\u6807 \u2514\u2500\u2500 \u63a5\u53e3\u5e93 3.1.1 \u5bf9\u8c61\u5e93 \u5141\u8bb8\u5c06\u591a\u4e2a\u6e90\u6587\u4ef6\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684\u76ee\u6807\uff0c\u800c\u4e0d\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u6216\u666e\u901a\u5e93\u3002\u5bf9\u8c61\u5e93\u53ef\u4ee5\u88ab\u5176\u4ed6\u76ee\u6807\uff08\u4f8b\u5982\u53ef\u6267\u884c\u6587\u4ef6\u6216\u666e\u901a\u5e93\uff09\u94fe\u63a5\u548c\u4f7f\u7528\u3002 \u8981\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\u5e93\uff0c\u540c\u6837\u53ef\u4ee5\u4f7f\u7528 add_library \u547d\u4ee4\uff0c\u5e76\u5c06 OBJECT \u5173\u952e\u5b57\u4e0e\u6e90\u6587\u4ef6\u5217\u8868\u4e00\u8d77\u4f7f\u7528\u3002\u4e0b\u9762\u662f\u4e00\u4e2a CMakeLists.txt \u793a\u4f8b\uff1a # \u6dfb\u52a0\u5bf9\u8c61\u5e93 add_library( my_object_lib OBJECT file1.cpp file2.cpp file3.cpp ) # \u6dfb\u52a0\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5e76\u94fe\u63a5\u5bf9\u8c61\u5e93 add_executable(my_app main.cpp) target_link_libraries(my_app PRIVATE my_object_lib) \u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c add_library \u547d\u4ee4\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3a my_object_lib \u7684\u5bf9\u8c61\u5e93\uff0c\u5e76\u5c06 file1.cpp \u3001 file2.cpp \u548c file3.cpp \u4f5c\u4e3a\u6e90\u6587\u4ef6\u3002 \u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5bf9\u8c61\u5e93\u4e2d\u7684\u6e90\u6587\u4ef6\u5c06\u4f1a\u88ab\u7f16\u8bd1\u4e3a\u76ee\u6807\u6587\u4ef6\uff0c\u4f46\u4e0d\u4f1a\u751f\u6210\u4e00\u4e2a\u72ec\u7acb\u7684\u53ef\u6267\u884c\u6587\u4ef6\u6216\u5171\u4eab\u5e93\u3002\u5176\u4ed6\u76ee\u6807\u53ef\u4ee5\u94fe\u63a5\u5230\u5bf9\u8c61\u5e93\uff0c\u5e76\u5728\u94fe\u63a5\u65f6\u4f7f\u7528\u5176\u4e2d\u7684\u76ee\u6807\u6587\u4ef6\u548c \u201c\u4f7f\u7528\u8981\u6c42\u201d\uff0c\u4f8b\u5982 # \u6dfb\u52a0\u540d\u4e3a obj \u7684\u5bf9\u8c61\u5e93 add_library(obj OBJECT obj.cpp) # \u5c06 include \u76ee\u5f55\u6dfb\u52a0\u5230 obj \u7684\u5305\u542b\u76ee\u5f55\u4e2d target_include_directories(obj PUBLIC include) # \u6dfb\u52a0\u540d\u4e3a bbb \u7684\u52a8\u6001\u5e93 add_library(bbb SHARED bbb.cpp) # \u94fe\u63a5 obj \u5bf9\u8c61\u5e93\uff0cobj \u7684\u5305\u542b\u76ee\u5f55\u5c06\u4f1a\u4f20\u9012\u7ed9 bbb target_link_libraries(bbb PUBLIC obj) ::: tip \u6b64\u65f6 bbb \u52a8\u6001\u5e93\u5c06\u7531 bbb.cpp.o \u548c obj.cpp.o \u4e24\u4e2a\u76ee\u6807\u6587\u4ef6\u5236\u4f5c\u800c\u6210\uff0c\u5176\u4e2d obj.cpp.o \u7531 obj \u5bf9\u8c61\u5e93\u7f16\u8bd1\u800c\u6765\uff0c bbb.cpp.o \u7531 main.cpp \u7f16\u8bd1\u800c\u6765\u3002==\u8fd9\u91cc\u53ea\u662f\u7f16\u8bd1\uff0c\u6ca1\u6709\u94fe\u63a5\u3002== \u4f46\u8981\u6ce8\u610f\uff0c\u5bf9\u8c61\u5e93\u6240\u6307\u4ee3\u7684\u5bf9\u8c61\u6587\u4ef6\uff08\u4f8b\u5982\u4e0a\u6587\u7684 obj \u5bf9\u8c61\u5e93\u5219\u6307\u4ee3 obj.cpp.o \uff09\u4e0d\u4f1a\u4ece bbb \u4f20\u9012\u5230\u5176\u4ed6\u76ee\u6807\uff0c\u4f8b\u5982\u73b0\u5728\u518d\u5199\u5165\u4ee5\u4e0b\u547d\u4ee4 add_executable(demo main.cpp) target_link_libraries(demo PRIVATE bbb) obj \u5bf9\u8c61\u5e93\u7684 obj.cpp.o \u5bf9\u8c61\u6587\u4ef6\u4e0d\u4f1a\u4f20\u9012\u7ed9 demo \u53ef\u6267\u884c\u6587\u4ef6\u76ee\u6807\uff0c\u53ef\u53c2\u8003 CMake \u5b98\u7f51\u7684\u6587\u6863\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u5bf9\u8c61\u5e93\u7684\u5185\u5bb9 - \u5bf9\u8c61\u5e93 - target_link_libraries - \u5bf9\u8c61\u5e93 - add_library ::: 3.1.2 \u522b\u540d\u76ee\u6807 \u5141\u8bb8\u4e3a\u73b0\u6709\u7684\u76ee\u6807\u521b\u5efa\u4e00\u4e2a\u53ef\u4f9b\u5f15\u7528\u7684\u522b\u540d\u3002\u522b\u540d\u76ee\u6807\u53ef\u4ee5\u7528\u4e8e\u7b80\u5316\u6784\u5efa\u8fc7\u7a0b\u3001\u91cd\u547d\u540d\u76ee\u6807\u6216\u521b\u5efa\u4fbf\u4e8e\u5f15\u7528\u7684\u540d\u79f0\u3002 \u8981\u521b\u5efa\u522b\u540d\u76ee\u6807\uff0c\u53ef\u4ee5\u4f7f\u7528 add_library \u3001 add_executable \u6216 add_custom_target \u547d\u4ee4\uff0c\u5e76\u5c06 ALIAS \u5173\u952e\u5b57\u4e0e\u76ee\u6807\u540d\u79f0\u4e00\u8d77\u4f7f\u7528\u3002\u4e0b\u9762\u662f\u4e00\u4e2a CMakeLists.txt \u793a\u4f8b\uff1a # \u6dfb\u52a0\u4e00\u4e2a\u5e93 add_library(my_library STATIC my_source.cpp) # \u521b\u5efa\u522b\u540d\u76ee\u6807 add_library(lib1 ALIAS my_library) # \u6dfb\u52a0\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5e76\u94fe\u63a5\u522b\u540d\u76ee\u6807 add_executable(my_app main.cpp) target_link_libraries( my_app PRIVATE lib1 ) \u4f46\u8981\u6ce8\u610f\uff0c\u522b\u540d\u76ee\u6807\uff08\u4f8b\u5982\u4e0a\u6587\u4e2d\u7684 lib1 \uff09\u4e0d\u5f97\u4f5c\u4e3a target_link_libraries target_include_directories \u7684\u76ee\u6807\u540d\uff0c\u5373\u4e0d\u5f97\u5199\u6210 target_include_directories( lib1 PUBLIC xxx ) # \u6216\u8005 target_link_libraries( lib1 PRIVATE xxx ) \u7684\u5f62\u5f0f 3.2 \u8bbe\u7f6e\u76ee\u6807\u5c5e\u6027 \u5373\u4f7f\u7528\u547d\u4ee4 set_target_properties \u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u76ee\u6807\u5c5e\u6027\u901a\u5e38\u5f88\u5c11\u76f4\u63a5\u4f7f\u7528\uff0c\u4e00\u822c\u662f\u95f4\u63a5\u4f7f\u7528\uff0c\u4f8b\u5982 \u5728\u4f7f\u7528 target_include_directories \u7684\u65f6\u5019\uff0c\u4f1a\u4e3a\u76ee\u6807\u8bbe\u7f6e INTERFACE_INCLUDE_DIRECTORIES \u5c5e\u6027 \u5728\u4f7f\u7528 target_link_libraries \u7684\u65f6\u5019\uff0c\u4f1a\u4e3a\u76ee\u6807\u8bbe\u7f6e INTERFACE_LINK_LIBRARIES \u5c5e\u6027 \u5b9e\u9645\u4e0a\uff0c\u5bf9\u4e8e\u5bfc\u5165\u76ee\u6807\u3001\u63a5\u53e3\u5e93\u76ee\u6807\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u901a\u8fc7\u4ee5\u4e0a\u547d\u4ee4\u6765\u5b9e\u73b0\u5bf9\u5e94\u529f\u80fd\uff0c\u8b6c\u5982\u8bf4\uff0c\u4e3a\u4e86\u6307\u5b9a\u76ee\u6807\u5305\u542b\u7684\u76ee\u5f55\uff0c\u539f\u5148\u5199\u4e3a target_include_directories( my_target PUBLIC include ) \u73b0\u5728\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 set_target_properties( my_target PROPERTIES INTERFACE_INCLUDE_DIRECTORIES ${CMAKE_CURRENT_LIST_DIR}/include ) \u6216\u8005 set_property( TARGET my_target PROPERTIES INTERFACE_INCLUDE_DIRECTORIES ${CMAKE_CURRENT_LIST_DIR}/include ) \u6765\u5b9e\u73b0\u540c\u6837\u529f\u80fd\uff0c\u6b64\u64cd\u4f5c\u5728\u914d\u7f6e\u5bfc\u5165\u76ee\u6807\u7684\u65f6\u5019\u6bd4\u8f83\u5e38\u89c1\u3002\u6b64\u5916\uff0cCMake \u5b98\u7f51\u63d0\u4f9b\u4e86\u975e\u5e38\u975e\u5e38\u591a\u7684\u5c5e\u6027\uff0c\u53ef\u4ee5\u70b9\u51fb \u6b64\u5904 \u67e5\u9605\u3002 ::: warning \u5728\u8bbe\u7f6e INTERFACE_INCLUDE_DIRECTORIES \u548c INTERFACE_LINK_LIBRARIES \u5c5e\u6027\u7684\u65f6\u5019\u9700\u8981\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84 ::: 3.3 \u975e\u5fc5\u8981\u4e0d\u4f7f\u7528\u5168\u5c40\u5305\u542b\u3001\u94fe\u63a5 \u975e\u5fc5\u8981\u60c5\u51b5\u4e0b\u4e0d\u8981\u4f7f\u7528 link_library include_directories \u8bed\u53e5\uff0c\u4f1a\u5f71\u54cd\u6240\u6709\u5b50\u76ee\u5f55\u7684\u6784\u5efa\uff0c\u5e26\u6765\u6c61\u67d3\u95ee\u9898\u3002\u4f46\u6709\u4e9b\u60c5\u51b5\u4e0b\u8fd9\u4e9b\u8bed\u53e5\u53ef\u4ee5\u5b9e\u73b0\u5176\u4ed6\u529f\u80fd\u3002\u4f8b\u5982 target_include_directories \u53ef\u4ee5\u5c06\u5185\u5bb9\u7ed1\u5b9a\u5230\u76ee\u6807\u5e76\u4e14\u5728\u5bfc\u51fa\u76ee\u6807\u540e\u4f9d\u8d56\u5173\u7cfb\u4ecd\u7136\u751f\u6548\uff0c\u800c\u4f7f\u7528 include_directories \u53ef\u4ee5\u907f\u514d\u5b89\u88c5\u540e\u4ecd\u7136\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\u3002\u5177\u4f53\u539f\u56e0\u548c\u5b9e\u73b0\u7ec6\u8282\u53ef\u53c2\u8003 \u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5 #3.4 \u3002 3.4 \u8bbf\u95ee\u5e93\u7684\u65b9\u5f0f \u5f53\u9700\u8981\u8bbf\u95ee\u7b2c\u4e09\u65b9\u5e93\u7684\u65f6\u5019\uff0c\u7b2c\u4e09\u65b9\u5e93\u9700\u8981\u63d0\u4f9b\u5934\u6587\u4ef6\uff08\u7c7b\u4f3c\u4e8e *.h \u548c *.hpp \uff09\u548c\u5e93\u6587\u4ef6\uff08\u5305\u62ec\u52a8\u6001\u5e93 *.so \u548c\u9759\u6001\u5e93 *.a \u4e24\u79cd\u5f62\u5f0f\uff09\u3002 ::: tip Windows \u4e0b\u7684\u5e93\u6587\u4ef6\u6709\u4e24\u79cd\u5f62\u5f0f - \u52a8\u6001\u5e93 *.dll \u4ee5\u53ca\u5bfc\u5165\u5e93 *.lib - \u9759\u6001\u5e93 *.lib ::: \u5728\u8bbf\u95ee\u672c\u9879\u76ee\u7684\u5e93 A \u65f6\uff0c\u5982\u679c\u5df2\u7ecf\u4f7f\u7528\u4e86 target_include_directories \u7684 PUBLIC \u5c5e\u6027\uff0c\u5c06\u5934\u6587\u4ef6\u8def\u5f84\u7ed1\u5b9a\u5728\u4e86\u76ee\u6807 A \u4e2d\uff0c\u90a3\u4e48\u76ee\u6807 B \u5728\u8bbf\u95ee A \u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981 cmake target_link_libraries(B PUBLIC A) \u5373\u53ef\u8bbf\u95ee\u5230 A \u6240\u5305\u542b\u7684\u5934\u6587\u4ef6\u8def\u5f84\u3002 \u5728\u8bbf\u95ee\u5176\u4ed6\u9879\u76ee\u7684\u7b2c\u4e09\u65b9\u5e93\u65f6\uff0c\u7528\u6237\u9700\u8981\u5355\u72ec\u83b7\u53d6\u5bf9\u5e94\u7684\u5e93\u6587\u4ef6\u4e0e\u5934\u6587\u4ef6\u8def\u5f84\u8fdb\u884c\u94fe\u63a5\uff0c\u4f8b\u5982 OpenCV\uff1a ```cmake add_executable(xxx main.cpp) target_include_directories( xxx PUBLIC ${OpenCV_INCLUDE_DIRS} ) target_link_libraries( xxx PRIVATE ${OpenCV_LIBS} ) ``` \u4f46\u5b9e\u9645\u4e0a\uff0c OpenCV_LIBS \u662f\u5305\u542b\u4e86\u4f17\u591a\u5bfc\u5165\u76ee\u6807\u7684\u5217\u8868\u53d8\u91cf\uff0c\u4f8b\u5982 opencv_core;opencv_highgui \uff0c\u5e76\u4e14\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u53d8\u91cf\u90fd\u8bbe\u7f6e\u4e86 INTERFACE_INCLUDE_DIRECTORIES \u7684\u5c5e\u6027\u3002\u4e0d\u5199 target_include_directories \u547d\u4ee4\u4e5f\u662f\u6b63\u786e\u7684\uff1a ```cmake add_executable(xxx main.cpp) target_link_libraries( xxx PRIVATE ${OpenCV_LIBS} ) ```","title":"\u301005\u3011\u76ee\u6807\u6784\u5efa"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#05","text":"","title":"\u301005\u3011\u76ee\u6807\u6784\u5efa"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#_1","text":"::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili @ bilibili","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#1","text":"\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u4e86\u89e3\u4e00\u4e9b\u57fa\u672c\u7684\u77e5\u8bc6\u5e76\u56de\u987e \u301001\u3011\u5b89\u88c5\u4e0e\u57fa\u672c\u4ecb\u7ecd \u7684\u5185\u5bb9\u4f5c\u4e3a\u524d\u671f\u51c6\u5907","title":"1. \u524d\u671f\u51c6\u5907"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#11-4","text":"\u7f16\u8bd1\u578b\u8bed\u8a00\u7f16\u8bd1\u4e00\u822c\u90fd\u6709 4 \u4e2a\u6b65\u9aa4\uff0c\u5206\u522b\u662f\uff1a==\u9884\u7f16\u8bd1==\u3001==\u7f16\u8bd1==\u3001==\u6c47\u7f16==\u3001==\u94fe\u63a5==\uff0c\u8fd9\u91cc\u7684\u7f16\u8bd1\u4ec5\u6307\u5c06\u6e90\u4ee3\u7801\u7ffb\u8bd1\u6210\u6c47\u7f16\u4ee3\u7801\u3002\u800c\u6211\u4eec\u5e73\u65f6\u79f0\u7684\u7f16\u8bd1\u5219\u6307\u5c06\u6e90\u4ee3\u7801\u7ffb\u8bd1\u6210\u53ef\u6267\u884c\u6587\u4ef6\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002Ubuntu \u4e0b\u5e38\u89c1\u7684\u7f16\u8bd1\u5de5\u5177\u662f Unix Makefiles\uff0c\u6211\u4eec\u5728\u7ec8\u7aef\u8f93\u5165 make \u7684\u65f6\u5019\uff0c\u7528\u5230\u7684\u5c31\u662f Unix Makefiles\u3002\u800c\u6240\u6709\u7684\u7f16\u8bd1\u5de5\u5177\u5747\u4f1a\u6839\u636e\u6307\u5b9a\u7684\u6216\u8005\u9ed8\u8ba4\u7684\u73af\u5883\u53d8\u91cf\uff0c\u4f8b\u5982\u5728 Makefile \u6587\u4ef6\u4e2d\uff0c\u53ef\u80fd\u53ef\u4ee5\u627e\u5230\u7c7b\u4f3c CC = gcc CXX = g++ \u7684\u5185\u5bb9\uff0c\u4ece\u800c\u9009\u62e9\u6307\u5b9a\u7684\u7f16\u8bd1\u5668\u3002\u7f16\u8bd1\u5668\u5219\u6839\u636e\u7f16\u8bd1\u5de5\u5177\u6240\u5236\u5b9a\u7684\u89c4\u5219\u5bf9\u4e00\u7cfb\u5217\u6e90\u7801\u8fdb\u884c\u89e3\u6790\u3001\u7f16\u8bd1\u3001\u94fe\u63a5\uff0c\u4f8b\u5982\u53ef\u4ee5\u5728 Makefile \u6587\u4ef6\u4e2d\u6307\u5b9a CFLAGS = -g -O2 \u5e76\u4f7f\u7528\u7c7b\u4f3c $(CC) $(CFLAGS) \u7684\u8bed\u53e5\u5b8c\u6210\u5bf9\u7f16\u8bd1\u5668\u76f8\u5173\u7f16\u8bd1\u9009\u9879\u7684\u8bbe\u7f6e\uff0c\u6700\u7ec8\u5728\u7f16\u8bd1\u65f6\u751f\u6210\u5bf9\u5e94\u7684\u7b26\u5408\u8981\u6c42\u7684\u76ee\u6807\uff08\u53ef\u6267\u884c\u6587\u4ef6\u3001\u52a8\u6001\u5e93\u3001\u9759\u6001\u5e93\uff09","title":"1.1 \u7f16\u8bd1\u7684 4 \u4e2a\u6b65\u9aa4"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#12-cmake","text":"CMake \u4f5c\u4e3a\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u7f16\u8bd1\u5de5\u5177\uff0c\u80fd\u591f\u4f7f\u7528\u901a\u7528\u7684\u8bed\u6cd5\uff08\u7ec4\u6001\u6863\uff09\u751f\u6210\u7f16\u8bd1\u5de5\u5177\u80fd\u591f\u89e3\u6790\u7684\u6587\u4ef6\uff08\u5efa\u6784\u6863\uff09\uff0c\u4ece\u800c\u5b8c\u6210\u5bf9\u9879\u76ee\u7684\u6784\u5efa\uff0c\u4f8b\u5982\u4f1a\u751f\u6210 MSBuild \u80fd\u591f\u89e3\u6790\u7684 .sln \u548c .vcxproj \u6587\u4ef6 Unix Makefiles \u80fd\u591f\u89e3\u6790\u7684 Makefile \u6587\u4ef6 MinGW Makefiles \u80fd\u591f\u89e3\u6790\u7684 Makefile \u6587\u4ef6 Ninja \u80fd\u591f\u89e3\u6790\u7684 build.ninja \u6587\u4ef6","title":"1.2 \u56de\u987e CMake \u7684\u5730\u4f4d"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#13","text":"","title":"1.3 \u52a8\u6001\u5e93 / \u9759\u6001\u5e93"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#131","text":"\u5728 Windows \u4e0b\uff0c\u7ecf\u5e38\u4f1a\u770b\u5230\u6269\u5c55\u540d\u4e3a .dll \u7684\u6587\u4ef6\uff0c\u79f0\u4e3a\u52a8\u6001\u94fe\u63a5\u5e93 Dynamic-Link Library \u3002\u540c\u6837\uff0c\u5728Ubuntu\u4e0b /usr/local/lib \u76ee\u5f55\u4e0b\u4e5f\u80fd\u770b\u5230\u4e00\u7cfb\u5217\u540d\u4e3a *.so \u7684\u6587\u4ef6\uff0c\u79f0\u4e3a\u5171\u4eab\u5bf9\u8c61 Shared Object \uff0c\u8fd9\u4e00\u7c7b\u90fd\u5c5e\u4e8e\u52a8\u6001\u5e93\u3002 \u53e6\u5916\uff0c\u5728 Windows \u4e0b\u4e5f\u6709\u90e8\u5206\u6269\u5c55\u540d\u4e3a *.lib \u7684\u6587\u4ef6\uff0cUbuntu \u4e0b\u4e5f\u8bb8\u80fd\u5728 /usr/local/lib \u76ee\u5f55\u4e0b\u770b\u5230\u4e00\u4e9b *.a \u6587\u4ef6\uff0c\u8fd9\u4e9b\u90fd\u5c5e\u4e8e\u9759\u6001\u5e93\u3002 ::: tip Windows \u4e0b\u7684 *.lib \u6587\u4ef6\u6709\u4e24\u79cd\uff0c\u4e00\u79cd\u662f\u9759\u6001\u5e93\uff0c\u4e00\u79cd\u662fDLL\u5bfc\u5165\u5e93\uff0c\u540e\u8005\u5c45\u591a\uff0c\u4e0d\u8fc7\u5728 CMake \u5f00\u53d1\u4e0a\u7b80\u5355\u5f53\u505a\u9759\u6001\u5e93\u4e5f\u662f\u53ef\u4ee5\u7684\u3002 :::","title":"1.3.1 \u662f\u4ec0\u4e48"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#132","text":"\u9759\u6001\u5e93\u2014\u2014\u8fd9\u79cd\u5e93\u5728\u7f16\u8bd1\u7684\u65f6\u5019\u4f1a\u76f4\u63a5\u6574\u5408\u5230\u76ee\u6807\u7a0b\u5e8f\u4e2d\uff0c\u6240\u4ee5\u5229\u7528\u9759\u6001\u5e93\u7f16\u8bd1\u6210\u7684\u6587\u4ef6\u4f1a\u6bd4\u8f83\u5927\uff0c\u8fd9\u7c7b\u51fd\u6570\u5e93\u6700\u5927\u7684\u4f18\u70b9\u5c31\u662f\u7f16\u8bd1\u6210\u529f\u7684\u53ef\u6267\u884c\u6587\u4ef6\u53ef\u4ee5\u72ec\u7acb\u8fd0\u884c\uff0c\u800c\u4e0d\u518d\u9700\u8981\u5411\u5916\u90e8\u8981\u6c42\u8bfb\u53d6\u51fd\u6570\u5e93\u7684\u5185\u5bb9\uff1b\u4f46\u662f\u4ece\u5347\u7ea7\u96be\u6613\u5ea6\u6765\u770b\u660e\u663e\u6ca1\u6709\u4f18\u52bf\uff0c\u5982\u679c\u51fd\u6570\u5e93\u66f4\u65b0\uff0c\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u3002 \u52a8\u6001\u5e93\u2014\u2014\u4e0e\u9759\u6001\u51fd\u6570\u5e93\u88ab\u6574\u4e2a\u6355\u6349\u5230\u7a0b\u5e8f\u4e2d\u4e0d\u540c\uff0c\u52a8\u6001\u51fd\u6570\u5e93\u5728\u7f16\u8bd1\u7684\u65f6\u5019\uff0c\u5728\u7a0b\u5e8f\u91cc\u53ea\u6709\u4e00\u4e2a\u7b26\u53f7\u800c\u5df2\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53\u53ef\u6267\u884c\u6587\u4ef6\u9700\u8981\u4f7f\u7528\u5230\u51fd\u6570\u5e93\u7684\u673a\u5236\u65f6\uff0c\u7a0b\u5e8f\u624d\u4f1a\u53bb\u89e3\u6790\u8fd9\u4e2a\u7b26\u53f7\u5e76\u5b8c\u6210\u52a8\u6001\u5e93\u5730\u5740\u7684\u91cd\u5b9a\u4f4d\uff0c\u4e5f\u5c31\u662f\u8bf4\u53ef\u6267\u884c\u6587\u4ef6\u65e0\u6cd5\u5355\u72ec\u8fd0\u884c\u3002\u8fd9\u6837\u4ece\u4ea7\u54c1\u529f\u80fd\u5347\u7ea7\u7684\u89d2\u5ea6\u6765\u8bf4\u662f\u65b9\u4fbf\u7684\uff0c\u53ea\u8981\u66ff\u6362\u5bf9\u5e94\u52a8\u6001\u5e93\u5373\u53ef\u5b8c\u6210\u5347\u7ea7\uff0c\u4e0d\u5fc5\u91cd\u65b0\u7f16\u8bd1\u6574\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u3002","title":"1.3.2 \u533a\u522b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#2","text":"","title":"2. \u76ee\u6807\u6784\u5efa"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#21","text":"\u73b0\u7ed9\u5b9a\u4e00\u4e2a\u6587\u4ef6\u67b6\u6784\uff1a . \u251c\u2500\u2500 CMakeLists.txt (\u5f85\u521b\u5efa) \u2514\u2500\u2500 main.cpp \u8fd9\u662f\u6700\u7b80\u5355\u7684\u4e00\u7c7b\u60c5\u51b5\uff0c\u5373\u4ec5\u6709\u4e00\u4e2a *.cpp \u6784\u6210\u53ef\u6267\u884c\u7a0b\u5e8f\u7684\u6e90\u6587\u4ef6\u3002\u5bf9\u4e8e\u8fd9\u79cd\u67b6\u6784\u7684\u6784\u5efa\u65b9\u5f0f\u5728 \u301001\u3011\u5b89\u88c5\u4e0e\u57fa\u672c\u4ecb\u7ecd \u4e2d\u5df2\u7ecf\u505a\u8fc7\u4e86\u6f14\u793a\u3002\u5bf9\u4e8e\u8fd9\u79cd\u901a\u5e38\u53ea\u9700\u8981\u77ed\u77ed\u51e0\u884c CMake \u8bed\u53e5\u5373\u53ef\u5b8c\u6210\uff0c\u9996\u5148\u5728\u5f53\u524d\u76ee\u5f55\u76f4\u63a5\u521b\u5efa CMakeLists.txt\uff0c\u8f93\u5165\uff1a cmake_minimum_required(VERSION 3.16) # \u6307\u5b9a CMake \u6700\u5c0f\u7248\u672c\u53f7\uff0c\u5c0f\u4e8e\u6b64\u7248\u672c\u7684\u65e0\u6cd5\u901a\u8fc7 CMake project(MyProject) # \u5b9a\u4e49\u9879\u76ee\u540d add_executable(my_main main.cpp) # \u4f7f\u7528 main.cpp \u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6 my_main \u5176\u4e2d my_main \u662f\u76ee\u6807\u540d\uff0c\u5728 CMake \u4e2d\u662f\u5177\u6709 TARGET \u5c5e\u6027\u7684\u53d8\u91cf\uff0c\u5373\u76ee\u6807\uff0c\u540c\u65f6\u4e5f\u662f\u53ef\u6267\u884c\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u3002CMake \u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u4e0e\u76ee\u6807\u94fe\u63a5\u6709\u5173\u7684\u64cd\u4f5c\u65b9\u5f0f\u3002\u5176\u4e2d\u5982\u679c my_main \u76ee\u6807\u4f9d\u8d56\u4e86\u5176\u4ed6\u7684\u76ee\u6807\uff0c\u4f8b\u5982 main.cpp \u6587\u4ef6\u4e2d\u4f7f\u7528\u5230\u4e86\u6765\u81ea\u5176\u4ed6 *.cpp \u6587\u4ef6\u5b9a\u4e49\u7684\u51fd\u6570\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5728 CMakeLists.txt \u4e2d\u8f93\u5165 target_link_libraries( my_main PRIVATE xxxx ) \u8fd9\u91cc\u7684 xxxx \u5c31\u8868\u793a\u5305\u542b\u4e86\u8fd9\u4e9b\u51fd\u6570\u5b9a\u4e49\u7684\u76ee\u6807\u3002\u8fd9\u91cc\u8868\u793a\u9700\u8981\u5c06 my_main \u8fd9\u4e2a\u76ee\u6807\u94fe\u63a5\u81f3 xxxx \u4e0a\u3002 \u6b64\u5916\uff0c\u6587\u6863\u4e2d\u7ed9\u51fa\u4e86\u8fd9\u6837\u4e00\u53e5\u8bdd\uff1a New in version 3.13: The <target> doesn't have to be defined in the same directory as the target_link_libraries call. \u7ffb\u8bd1\u8fc7\u6765\u5c31\u662f 3.13 \u7248\u672c\u7684\u65b0\u5185\u5bb9\uff1a <target> \u4e0d\u9700\u8981\u5728\u4e0e\u8c03\u7528 target_link_libraries \u547d\u4ee4\u76f8\u540c\u7684\u76ee\u5f55\u4e2d\u88ab\u5b9a\u4e49\u3002 \u8fd9\u53e5\u8bdd\u5f88\u5173\u952e\uff0c\u8868\u793a\u5728\u8f83\u65b0\u7684 CMake \u7248\u672c\u4e2d\uff0c\u5141\u8bb8\u5728\u6574\u4e2a\u9879\u76ee\u4e2d\u8de8 CMakeLists.txt \u6587\u4ef6\u8fdb\u884c\u94fe\u63a5\u64cd\u4f5c\uff0c\u4f8b\u5982\uff0c\u5373\u4f7f\u4e0a\u6587\u7684 my_main \u5728\u7236\u76ee\u5f55\u7684\u4f5c\u7528\u57df\uff0c xxxx \u5728\u5b50\u76ee\u5f55\u7684\u4f5c\u7528\u57df\uff0c my_main \u6240\u5728\u7684 CMakeLists.txt \u4e5f\u80fd\u8bbf\u95ee\u5230 xxxx \u8fd9\u4e00\u76ee\u6807\u53d8\u91cf\u3002\u8fd9\u4e00\u70b9\u6709\u522b\u4e8e\u666e\u901a\u7684\u53d8\u91cf\uff0c\u53ef\u4ee5\u5f53\u505a\u662f\u5177\u6709\u76ee\u6807\u5c5e\u6027\u7684\u53d8\u91cf\u7684\u4e13\u5c5e\u529f\u80fd\u3002 \u53e6\u5916\u4ee3\u7801\u4e2d\u8fd8\u51fa\u73b0\u4e86 PRIVATE \u7684\u6807\u5fd7\uff0c\u8fd9\u4e2a\u5c5e\u4e8e\u76ee\u6807\u7684\u4f20\u64ad\u65b9\u5f0f\uff0c\u5728\u540e\u6587\u4f1a\u8fdb\u884c\u4ecb\u7ecd\u3002","title":"2.1 \u56de\u987e\uff1a\u53ef\u6267\u884c\u6587\u4ef6\u6784\u5efa"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#22","text":"\u5728\u6587\u4ef6\u7ed3\u6784\u590d\u6742\u65f6\uff0c\u6216\u8005\u9700\u8981\u5c06\u529f\u80fd\u6a21\u5757\u9694\u79bb\u3001\u62bd\u8c61\u51fa\u6765\u65f6\uff0c\u7ecf\u5e38\u9700\u8981\u4e3a\u67d0\u4e2a\u6a21\u5757\u6784\u5efa\u4e00\u4e2a\u5e93\uff0c\u6700\u7ec8\u5c06\u8fd9\u4e9b\u5e93\u94fe\u63a5\u81f3\u53ef\u6267\u884c\u6587\u4ef6\u7684\u76ee\u6807\u4e0a\u3002 \u8bed\u6cd5\u662f\uff1a add_library(\u76ee\u6807\u540d [SHARED | [STATIC]] \u6e90\u6587\u4ef6) \u8fd8\u662f\u521a\u624d\u7684\u6587\u4ef6\u7ed3\u6784\uff0c\u5148\u521b\u5efa\u65b0\u7684\u6587\u4ef6\u5939\u53ca\u6587\u4ef6\uff1a . \u251c\u2500\u2500 CMakeLists.txt \u251c\u2500\u2500 main.cpp \u2514\u2500\u2500 MyLib1 \u251c\u2500\u2500 CMakeLists.txt (\u5f85\u521b\u5efa) \u251c\u2500\u2500 include \u2502 \u2514\u2500\u2500 MyLib1.h \u2514\u2500\u2500 src \u251c\u2500\u2500 a.cpp \u251c\u2500\u2500 b.cpp \u2514\u2500\u2500 c.cpp \u9996\u5148\u9879\u76ee\u6839\u76ee\u5f55\u7684 CMakeLists.txt \u9700\u8981\u6dfb\u52a0 add_subdirectory(MyLib1) \u6765\u8ba9\u8be5\u6a21\u5757\u6dfb\u52a0\u81f3\u8be5\u9879\u76ee\u3002\u6b64\u5916\uff0c\u6bcf\u4e2a\u5e93\u9700\u8981\u6709\u4e00\u4e2a\u5355\u72ec\u7684 CMakeLists.txt \u8fdb\u884c\u7ba1\u7406\uff0c\u56e0\u6b64\u9700\u8981\u5728 MyLib1 \u6587\u4ef6\u5939\u5185\u521b\u5efa\u8be5\u6587\u4ef6\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a # \u641c\u7d22 src \u6587\u4ef6\u5939\u4e0b\u7684\u6240\u6709\u6e90\u6587\u4ef6\uff0c\u5e76\u6dfb\u52a0\u81f3\u5c40\u90e8\u53d8\u91cf\uff1amy_lib_dir # \u9898\u5916\u8bdd\uff1aaux \u8868\u793a auxiliary \u5373\u8f85\u52a9\u7684\u610f\u601d\uff0c\u8868\u793a\u8fd9\u4e2a\u529f\u80fd\u662f\u4e2a\u8f85\u52a9\u529f\u80fd aux_source_directory(src my_lib_dir) # SHARED \u8868\u793a\u8be5\u76ee\u6807\u4e3a\u52a8\u6001\u5e93\uff0cSTATIC \u5219\u8868\u793a\u9759\u6001\u5e93 add_library(MyLib1 SHARED ${my_lib_dir}) # \u4ee5\u4e0a\u5185\u5bb9\u4e5f\u53ef\u4ee5\u5199\u6210\u4e0b\u4e00\u884c\uff0c\u4f46\u8fd9\u4e48\u957f\u7684\u540d\u5b57\uff0c\u8c01\u4f1a\u8fd9\u4e48\u505a\u5462\uff1f # add_library(MyLib1 SHARED src/a.cpp src/b.cpp src/c.cpp) \u6ce8\u610f\uff0c\u6b64\u5904\u751f\u6210\u7684\u52a8\u6001\u5e93 libMyLib1.so \u65e0\u6cd5\u505a\u5230\u5185\u5b58\u4e0a\u7684\u590d\u7528\uff0c\u5728\u591a\u4e2a\u8fdb\u7a0b\u4f7f\u7528\u5230\u8be5\u52a8\u6001\u5e93\u65f6\uff0c\u4ecd\u7136\u4f1a\u5f00\u8f9f\u4e00\u5757\u5185\u5b58\u5b58\u50a8\u8be5\u52a8\u6001\u5e93\u5185\u5bb9\u3002\u4e3a\u4e86\u771f\u6b63\u5b9e\u73b0\u5185\u5b58\u4e0a\u7684\u590d\u7528\uff0c\u9700\u8981\u4f7f\u7528\u5730\u5740\u65e0\u5173\u4ee3\u7801\u673a\u5236(position-independent code)\uff1a set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -fPIC\") \u8bdd\u8bf4\u56de\u6765\uff0c\u672c\u5e93\u5185\u7684\u4e09\u4e2a\u6e90\u6587\u4ef6\u90fd\u4f1a\u5305\u62ec include \u5934\u6587\u4ef6\u5939\u4e2d\u7684\u5185\u5bb9\uff0c\u56e0\u6b64\u5728\u7f16\u8bd1\u65f6\u9700\u8981\u7ed9\u76ee\u6807\u6dfb\u52a0\u5934\u6587\u4ef6\u7684\u641c\u7d22\u8def\u5f84\uff1a target_include_directories(MyLib1 PUBLIC include) # \u8fd9\u53e5\u547d\u4ee4\u8868\u793a\uff0c\u4e3a MyLib1 \u76ee\u6807\u6dfb\u52a0\u5f53\u524d CMakeLists.txt \u6240\u5728\u76ee\u5f55\u4e0b include \u6587\u4ef6\u5939\u7684\u641c\u7d22\u8def\u5f84 # PUBLIC \u89c4\u5b9a MyLib1 \u7684\u5305\u542b\u76ee\u5f55\u641c\u7d22\u8def\u5f84\u4ee5\u516c\u5f00\u65b9\u5f0f\u4f20\u9012\u7ed9\u5176\u4f59\u76ee\u6807 # \u751f\u6210\u7684\u5efa\u6784\u6863\u4e2d\u4f1a\u5305\u542b\u5f62\u5982\u4ee5\u4e0b\u7684\u5185\u5bb9 gcc mylib1.cpp -I include -o MyLib1 \u4e0a\u6587\u7684 PUBLIC \u5c5e\u6027\uff0c\u6709\u65f6\u5019\u8fd8\u4f1a\u89c1\u5230 INTERFACE \u3001 PRIVATE \u5c5e\u6027\uff0c\u4e00\u5171 3 \u4e2a\u4f20\u9012\u65b9\u5f0f\u3002\u4e0b\u9762\u5bf9\u8fd9\u4e09\u4e2a\u4f20\u9012\u65b9\u5f0f\u505a\u4e2a\u4ecb\u7ecd\uff1a PUBLIC \uff1a\u5728\u7ed1\u5b9a\u5f53\u524d\u76ee\u6807\u65f6\u7ed9\u6307\u5b9a\u7684\u5185\u5bb9\u8bbe\u7f6e\u516c\u6709\u5c5e\u6027\uff0c\u5176\u4ed6\u76ee\u6807\u5728\u94fe\u63a5\u5f53\u524d\u76ee\u6807\u65f6\uff0c\u80fd\u8bbf\u95ee\u8fd9\u4e9b\u6307\u5b9a\u7684\u5185\u5bb9 PRIVATE \uff1a\u5728\u7ed1\u5b9a\u5f53\u524d\u76ee\u6807\u65f6\u7ed9\u6307\u5b9a\u7684\u5185\u5bb9\u8bbe\u7f6e\u79c1\u6709\u5c5e\u6027\uff0c\u5176\u4ed6\u76ee\u6807\u5728\u94fe\u63a5\u5f53\u524d\u76ee\u6807\u65f6\uff0c\u65e0\u6cd5\u8bbf\u95ee\u8fd9\u4e9b\u5185\u5bb9 INTERFACE \uff1a\u5728\u7ed1\u5b9a\u5f53\u524d\u76ee\u6807\u65f6\u7ed9\u6307\u5b9a\u7684\u5185\u5bb9\u8bbe\u7f6e\u63a5\u53e3\u5c5e\u6027\uff0c\u901a\u5e38\u5728\u63a5\u53e3\u5e93\u4e2d\u4f7f\u7528\u3002\u5176\u4ed6\u76ee\u6807\u5728\u94fe\u63a5\u5f53\u524d\u76ee\u6807\u65f6\uff0c\u53ea\u5141\u8bb8\u8bbf\u95ee\u5176\u58f0\u660e\uff08\u63a5\u53e3\uff09 \u6700\u540e\uff0c\u5982\u679c\u6b64\u76ee\u6807\u6709\u4f9d\u8d56 \u672c\u9879\u76ee\u4e2d\u5176\u4ed6\u76ee\u6807 \u9879\u76ee\u4ee5\u5916\u7b2c\u4e09\u65b9\u76ee\u6807\uff08\u4f8b\u5982 OpenCV\uff09 \u7684\u5185\u5bb9\uff0c\u90a3\u5fc5\u987b\u8981\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff1a target_link_libraries( MyLib1 PUBLIC xxxx ) \u540c\u6837\uff0c\u4e3a\u6307\u5b9a\u76ee\u6807\u94fe\u63a5\u5e93\u7684\u8bed\u53e5\u4e5f\u63d0\u4f9b\u4e86 PUBLIC \u3001 PRIVATE \u3001 INTERFACE \u4e09\u4e2a\u5c5e\u6027\uff0c\u8fd9\u91cc\u4e0d\u518d\u8d58\u8ff0\u3002 \u8fd9\u91cc\u6d89\u53ca\u5230\u7684\u4e24\u4e2a\u8bed\u53e5\uff0c\u6211\u4eec\u505a\u4e2a\u6c47\u603b\uff1a target_include_directories \uff1a\u4e3a\u76ee\u6807\u6dfb\u52a0\u9700\u8981\u5305\u542b\u7684\u6587\u4ef6\uff08\u4e00\u822c\u662f\u5934\u6587\u4ef6\uff09\u7684\u641c\u7d22\u8def\u5f84\uff0c\u8be5\u8def\u5f84\u5c06\u7ed1\u5b9a\u81f3\u76ee\u6807\u4e0a target_link_libraries \uff1a\u4e3a\u76ee\u6807\u6dfb\u52a0\u4f9d\u8d56\u7684\u5e93\uff0c\u8be5\u5e93\u4e5f\u5c06\u7ed1\u5b9a\u81f3\u76ee\u6807\u4e0a ::: important \u4e0a\u6587\u7684\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\u5c5e\u4e8e\u76ee\u6807\u5c5e\u6027\u5f53\u4e2d \u201c\u4f7f\u7528\u8981\u6c42\u201d \u7684\u4e00\u90e8\u5206\uff0c\u6b64\u5916\u8fd8\u6709\u5176\u4ed6\u4e24\u79cd\u4f7f\u7528\u8981\u6c42\uff0c\u4f8b\u5982\u4f7f\u7528 add_library(mylib1 SHARED mylib1.cpp) target_compile_options(mylib1 PUBLIC -Wall) # \u8fd9\u53e5\u547d\u4ee4\u8868\u793a\uff0c\u5728\u6784\u5efa mylib1 \u76ee\u6807\u65f6\u6dfb\u52a0 -Wall \u9009\u9879 # PUBLIC \u89c4\u5b9a mylib1 \u7684 -Wall \u7f16\u8bd1\u9009\u9879\u5c06\u4f1a\u4f20\u9012\u7ed9\u5176\u4f59\u76ee\u6807 # \u751f\u6210\u7684\u5efa\u6784\u6863\u4e2d\u4f1a\u5305\u542b\u5f62\u5982\u4ee5\u4e0b\u7684\u5185\u5bb9 gcc -fPIC -shared main.cpp -o libmylib1.so -Wall \u4ee5\u53ca target_compile_definitions(mylib1 PRIVATE HAVE_ABC) # \u8fd9\u53e5\u547d\u4ee4\u8868\u793a\uff0c\u5728\u6784\u5efa mylib1 \u76ee\u6807\u65f6\u6dfb\u52a0 -D HAVE_ABC \u9009\u9879 # PRIVATE \u89c4\u5b9a mylib1 \u7684 HAVE_ABC \u9884\u7f16\u8bd1\u5b8f\u4e0d\u4f20\u9012\u7ed9\u5176\u4f59\u76ee\u6807 # \u751f\u6210\u7684\u5efa\u6784\u6863\u4e2d\u4f1a\u5305\u542b\u5f62\u5982\u4ee5\u4e0b\u7684\u5185\u5bb9 gcc -fPIC -shared main.cpp -o libmylib1.so -D HAVE_ABC \u8fd9\u4e9b\u90fd\u5c5e\u4e8e\u76ee\u6807\u5c5e\u6027\u5f53\u4e2d\u7684\u4f7f\u7528\u8981\u6c42\uff0c\u800c target_link_libraries \u5219\u4fdd\u8bc1\u4e86\u4ee5\u4e0a\u4f7f\u7528\u8981\u6c42\u8be5\u5982\u4f55\u88ab\u4f20\u9012\u3002 add_executable(demo main.cpp) target_link_libraries(demo PRIVATE mylib1) # \u8fd9\u53e5\u547d\u4ee4\u8868\u793a\uff0c\u4e3a demo \u76ee\u6807\u94fe\u63a5 mylib1 \u76ee\u6807 # PRIVATE \u89c4\u5b9a mylib1 \u7684\u4f7f\u7528\u8981\u6c42\u4e0d\u4f20\u9012\u7ed9\u5176\u4f59\u76ee\u6807 # \u751f\u6210\u7684\u5efa\u6784\u6863\u4e2d\u4f1a\u5305\u542b\u5f62\u5982\u4ee5\u4e0b\u7684\u5185\u5bb9 gcc main.cpp -o demo -Wall -l mylib1 :::","title":"2.2 \u666e\u901a\u5e93\u76ee\u6807\u6784\u5efa"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#23","text":"\u5728\u7a0b\u5e8f\u5f00\u53d1\u4e2d\uff0c\u6709\u65f6\u5019\u4f1a\u9047\u5230\u53ea\u6709\u5934\u6587\u4ef6\uff08 *.h \u3001 *.hpp \uff09\uff0c\u800c\u6ca1\u6709\u6e90\u6587\u4ef6\uff08 *.c \u3001 *.cpp \uff09\u7684\u60c5\u51b5\uff0c\u800c\u6211\u4eec\u77e5\u9053\uff0c\u4e00\u822c\u5728\u4f7f\u7528 add_library \u7684\u65f6\u5019\u53ea\u80fd\u4e3a\u6e90\u6587\u4ef6\uff08 *.h \u4ee5\u53ca *.hpp \u4e4b\u7c7b\u7684\u5934\u6587\u4ef6\u4e0d\u5c5e\u4e8e\u6e90\u6587\u4ef6\uff09\u751f\u6210\u76ee\u6807\u5e93\u3002 \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u5bf9\u53ea\u6709\u5934\u6587\u4ef6\u7684\u5e93\u751f\u6210\u76ee\u6807\uff0c\u5e76\u4e14\u8fdb\u884c\u94fe\u63a5\uff0c\u6211\u4eec\u9700\u8981\u521b\u5efa\u63a5\u53e3\u5e93\u3002\u8fd9\u79cd\u76ee\u6807\u7531\u4e8e\u6ca1\u6709\u6e90\u6587\u4ef6\uff0c\u4e0d\u4f1a\u5b9e\u8d28\u6027\u7684\u53c2\u4e0e\u6784\u5efa\uff08\u7f16\u8bd1\uff09\uff0c\u4f46\u63d0\u4f9b\u4e86\u4e0e\u666e\u901a\u76ee\u6807\u76f8\u540c\u7684\u64cd\u4f5c\u65b9\u5f0f\uff0c\u56e0\u6b64\u63a5\u53e3\u5e93\u5c5e\u4e8e\u4f2a\u76ee\u6807\u3002 \u8fd8\u662f\u521a\u624d\u7684\u6587\u4ef6\u7ed3\u6784\uff0c\u5148\u521b\u5efa\u53ea\u6709\u5934\u6587\u4ef6\u7684\u6587\u4ef6\u5939\u53ca CMakeLists.txt \uff1a . \u251c\u2500\u2500 CMakeLists.txt \u251c\u2500\u2500 main.cpp \u251c\u2500\u2500 MyLib1 \u2502 \u251c\u2500\u2500 CMakeLists.txt \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2514\u2500\u2500 MyLib1.h \u2502 \u2514\u2500\u2500 src \u2502 \u251c\u2500\u2500 a.cpp \u2502 \u251c\u2500\u2500 b.cpp \u2502 \u2514\u2500\u2500 c.cpp \u2514\u2500\u2500 MyLib2 \u251c\u2500\u2500 CMakeLists.txt (\u5f85\u521b\u5efa) \u2514\u2500\u2500 include \u2514\u2500\u2500 MyLib2.hpp \u9996\u5148\u9879\u76ee\u6839\u76ee\u5f55\u7684 CMakeLists.txt \u9700\u8981\u6dfb\u52a0 add_subdirectory(MyLib2) \u521b\u5efa\u63a5\u53e3\u5e93\u7684\u8bed\u6cd5\u4e0e\u666e\u901a\u5e93\u7c7b\u4f3c\uff0c\u53ea\u662f\u5c11\u4e86\u6e90\u6587\u4ef6\u7684\u6dfb\u52a0\u7684\u6b65\u9aa4\uff1a add_library(MyLib2 INTERFACE) target_include_directories( MyLib2 INTERFACE include # \u63a5\u53e3\u5e93\u7684\u76ee\u6807\u53ea\u80fd\u4f7f\u7528 INTERFACE \u5c5e\u6027 ) target_link_libraries( MyLib2 INTERFACE xxx )","title":"2.3 \u63a5\u53e3\u5e93\u76ee\u6807\u6784\u5efa"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#24","text":"\u6211\u4eec\u4f1a\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\uff0c\u4ec5\u63d0\u4f9b\u4e86\u82e5\u5e72\u5934\u6587\u4ef6\u548c\u82e5\u5e72\u5e93\u6587\u4ef6\uff08\u4f8b\u5982 *.so \u548c *.a \uff09\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6211\u4eec\u65e0\u6cd5\u901a\u8fc7\u81ea\u5df1 add_library \u4ece\u6e90\u6587\u4ef6\u521b\u5efa\u76ee\u6807\uff0c\u6211\u4eec\u9700\u8981\u5f15\u5165 \u5bfc\u5165\u76ee\u6807 \u3002 \u5047\u8bbe\u67d0\u5bb6\u76f8\u673a\u5382\u5546\u7684 SDK \u63d0\u4f9b\u4e86\u4ee5\u4e0b\u5185\u5bb9\uff0c\u5047\u8bbe\u5c06\u5176\u653e\u5728\u4e86\u9879\u76ee\u6587\u4ef6\u5939\u7684 camera \u6587\u4ef6\u5939\u4e0b\uff0c\u8bf7\u6839\u636e\u4ee5\u4e0b\u6587\u4ef6\u7ed3\u6784\u521b\u5efa\u4e00\u4e2a CMake \u76ee\u6807 . \u251c\u2500\u2500 include \u2502 \u251c\u2500\u2500 CameraApi.h \u2502 \u251c\u2500\u2500 CameraDefine.h \u2502 \u2514\u2500\u2500 CameraStatus.h \u2514\u2500\u2500 lib \u2514\u2500\u2500 libMVSDK.so \u5728 camera \u6587\u4ef6\u5939\u4e2d\u521b\u5efa CMakeLists.txt \u6587\u4ef6\uff0c\u5199\u5165 add_library(camera SHARED IMPORTED) set_target_properties(camera PROPERTIES INTERFACE_INCLUDE_DIRECTORIES \"${CMAKE_CURRENT_LIST_DIR}/include\" IMPORTED_LOCATION \"${CMAKE_CURRENT_LIST_DIR}/lib/libMVSDK.so\" ) \u5bf9\u4e8e INTERFACE_INCLUDE_DIRECTORIES \u7684\u5c5e\u6027\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528\u5e38\u89c4\u7684\u5199\u6cd5\uff0c\u5199\u6210 target_include_directories( camera INTERFACE include ) ::: warning - \u5728\u8bbe\u7f6e IMPORTED_LOCATION \u5c5e\u6027\u7684\u65f6\u5019\u9700\u8981\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84 - \u5bf9\u4e8e lib \u76ee\u5f55\u4e2d\u5b58\u5728\u591a\u4e2a *.so \u7b49\u52a8\u6001\u5e93\u7684\u60c5\u51b5\u4e0b\uff0c\u8bf7\u627e\u5230\u771f\u6b63\u7684\u52a8\u6001\u5e93\uff08\u5176\u4ed6\u52a8\u6001\u5e93\u4e00\u822c\u662f\u966a\u886c\u7684\uff09 :::","title":"2.4 \u5bfc\u5165\u76ee\u6807\u6784\u5efa"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#3","text":"","title":"3. \u8865\u5145\u5185\u5bb9"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#31","text":"\u6839\u636e CMake\u5b98\u7f51 \u5bf9\u76ee\u6807\u5e93\u7684\u5212\u5206\uff0c\u53ef\u7b80\u5355\u5206\u4e3a\u4e24\u7c7b\uff1a\u4e8c\u8fdb\u5236\u76ee\u6807\u3001\u4f2a\u76ee\u6807\uff0c\u5176\u5927\u81f4\u5185\u5bb9\u5982\u4e0b \u251c\u2500\u2500 \u4e8c\u8fdb\u5236\u76ee\u6807 \u2502 \u251c\u2500\u2500 \u53ef\u6267\u884c\u6587\u4ef6 \u2502 \u2514\u2500\u2500 \u4e8c\u8fdb\u5236\u5e93 \u2502 \u251c\u2500\u2500 \u666e\u901a\u5e93\uff08\u52a8\u6001\u5e93\u3001\u9759\u6001\u5e93\uff09 \u2502 \u2514\u2500\u2500 \u5bf9\u8c61\u5e93 \u2514\u2500\u2500 \u4f2a\u76ee\u6807 \u251c\u2500\u2500 \u5bfc\u5165\u76ee\u6807 \u251c\u2500\u2500 \u522b\u540d\u76ee\u6807 \u2514\u2500\u2500 \u63a5\u53e3\u5e93","title":"3.1 \u5176\u4f59\u76ee\u6807\u5e93"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#311","text":"\u5141\u8bb8\u5c06\u591a\u4e2a\u6e90\u6587\u4ef6\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684\u76ee\u6807\uff0c\u800c\u4e0d\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u6216\u666e\u901a\u5e93\u3002\u5bf9\u8c61\u5e93\u53ef\u4ee5\u88ab\u5176\u4ed6\u76ee\u6807\uff08\u4f8b\u5982\u53ef\u6267\u884c\u6587\u4ef6\u6216\u666e\u901a\u5e93\uff09\u94fe\u63a5\u548c\u4f7f\u7528\u3002 \u8981\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\u5e93\uff0c\u540c\u6837\u53ef\u4ee5\u4f7f\u7528 add_library \u547d\u4ee4\uff0c\u5e76\u5c06 OBJECT \u5173\u952e\u5b57\u4e0e\u6e90\u6587\u4ef6\u5217\u8868\u4e00\u8d77\u4f7f\u7528\u3002\u4e0b\u9762\u662f\u4e00\u4e2a CMakeLists.txt \u793a\u4f8b\uff1a # \u6dfb\u52a0\u5bf9\u8c61\u5e93 add_library( my_object_lib OBJECT file1.cpp file2.cpp file3.cpp ) # \u6dfb\u52a0\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5e76\u94fe\u63a5\u5bf9\u8c61\u5e93 add_executable(my_app main.cpp) target_link_libraries(my_app PRIVATE my_object_lib) \u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c add_library \u547d\u4ee4\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3a my_object_lib \u7684\u5bf9\u8c61\u5e93\uff0c\u5e76\u5c06 file1.cpp \u3001 file2.cpp \u548c file3.cpp \u4f5c\u4e3a\u6e90\u6587\u4ef6\u3002 \u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5bf9\u8c61\u5e93\u4e2d\u7684\u6e90\u6587\u4ef6\u5c06\u4f1a\u88ab\u7f16\u8bd1\u4e3a\u76ee\u6807\u6587\u4ef6\uff0c\u4f46\u4e0d\u4f1a\u751f\u6210\u4e00\u4e2a\u72ec\u7acb\u7684\u53ef\u6267\u884c\u6587\u4ef6\u6216\u5171\u4eab\u5e93\u3002\u5176\u4ed6\u76ee\u6807\u53ef\u4ee5\u94fe\u63a5\u5230\u5bf9\u8c61\u5e93\uff0c\u5e76\u5728\u94fe\u63a5\u65f6\u4f7f\u7528\u5176\u4e2d\u7684\u76ee\u6807\u6587\u4ef6\u548c \u201c\u4f7f\u7528\u8981\u6c42\u201d\uff0c\u4f8b\u5982 # \u6dfb\u52a0\u540d\u4e3a obj \u7684\u5bf9\u8c61\u5e93 add_library(obj OBJECT obj.cpp) # \u5c06 include \u76ee\u5f55\u6dfb\u52a0\u5230 obj \u7684\u5305\u542b\u76ee\u5f55\u4e2d target_include_directories(obj PUBLIC include) # \u6dfb\u52a0\u540d\u4e3a bbb \u7684\u52a8\u6001\u5e93 add_library(bbb SHARED bbb.cpp) # \u94fe\u63a5 obj \u5bf9\u8c61\u5e93\uff0cobj \u7684\u5305\u542b\u76ee\u5f55\u5c06\u4f1a\u4f20\u9012\u7ed9 bbb target_link_libraries(bbb PUBLIC obj) ::: tip \u6b64\u65f6 bbb \u52a8\u6001\u5e93\u5c06\u7531 bbb.cpp.o \u548c obj.cpp.o \u4e24\u4e2a\u76ee\u6807\u6587\u4ef6\u5236\u4f5c\u800c\u6210\uff0c\u5176\u4e2d obj.cpp.o \u7531 obj \u5bf9\u8c61\u5e93\u7f16\u8bd1\u800c\u6765\uff0c bbb.cpp.o \u7531 main.cpp \u7f16\u8bd1\u800c\u6765\u3002==\u8fd9\u91cc\u53ea\u662f\u7f16\u8bd1\uff0c\u6ca1\u6709\u94fe\u63a5\u3002== \u4f46\u8981\u6ce8\u610f\uff0c\u5bf9\u8c61\u5e93\u6240\u6307\u4ee3\u7684\u5bf9\u8c61\u6587\u4ef6\uff08\u4f8b\u5982\u4e0a\u6587\u7684 obj \u5bf9\u8c61\u5e93\u5219\u6307\u4ee3 obj.cpp.o \uff09\u4e0d\u4f1a\u4ece bbb \u4f20\u9012\u5230\u5176\u4ed6\u76ee\u6807\uff0c\u4f8b\u5982\u73b0\u5728\u518d\u5199\u5165\u4ee5\u4e0b\u547d\u4ee4 add_executable(demo main.cpp) target_link_libraries(demo PRIVATE bbb) obj \u5bf9\u8c61\u5e93\u7684 obj.cpp.o \u5bf9\u8c61\u6587\u4ef6\u4e0d\u4f1a\u4f20\u9012\u7ed9 demo \u53ef\u6267\u884c\u6587\u4ef6\u76ee\u6807\uff0c\u53ef\u53c2\u8003 CMake \u5b98\u7f51\u7684\u6587\u6863\u4e86\u89e3\u66f4\u591a\u5173\u4e8e\u5bf9\u8c61\u5e93\u7684\u5185\u5bb9 - \u5bf9\u8c61\u5e93 - target_link_libraries - \u5bf9\u8c61\u5e93 - add_library :::","title":"3.1.1 \u5bf9\u8c61\u5e93"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#312","text":"\u5141\u8bb8\u4e3a\u73b0\u6709\u7684\u76ee\u6807\u521b\u5efa\u4e00\u4e2a\u53ef\u4f9b\u5f15\u7528\u7684\u522b\u540d\u3002\u522b\u540d\u76ee\u6807\u53ef\u4ee5\u7528\u4e8e\u7b80\u5316\u6784\u5efa\u8fc7\u7a0b\u3001\u91cd\u547d\u540d\u76ee\u6807\u6216\u521b\u5efa\u4fbf\u4e8e\u5f15\u7528\u7684\u540d\u79f0\u3002 \u8981\u521b\u5efa\u522b\u540d\u76ee\u6807\uff0c\u53ef\u4ee5\u4f7f\u7528 add_library \u3001 add_executable \u6216 add_custom_target \u547d\u4ee4\uff0c\u5e76\u5c06 ALIAS \u5173\u952e\u5b57\u4e0e\u76ee\u6807\u540d\u79f0\u4e00\u8d77\u4f7f\u7528\u3002\u4e0b\u9762\u662f\u4e00\u4e2a CMakeLists.txt \u793a\u4f8b\uff1a # \u6dfb\u52a0\u4e00\u4e2a\u5e93 add_library(my_library STATIC my_source.cpp) # \u521b\u5efa\u522b\u540d\u76ee\u6807 add_library(lib1 ALIAS my_library) # \u6dfb\u52a0\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5e76\u94fe\u63a5\u522b\u540d\u76ee\u6807 add_executable(my_app main.cpp) target_link_libraries( my_app PRIVATE lib1 ) \u4f46\u8981\u6ce8\u610f\uff0c\u522b\u540d\u76ee\u6807\uff08\u4f8b\u5982\u4e0a\u6587\u4e2d\u7684 lib1 \uff09\u4e0d\u5f97\u4f5c\u4e3a target_link_libraries target_include_directories \u7684\u76ee\u6807\u540d\uff0c\u5373\u4e0d\u5f97\u5199\u6210 target_include_directories( lib1 PUBLIC xxx ) # \u6216\u8005 target_link_libraries( lib1 PRIVATE xxx ) \u7684\u5f62\u5f0f","title":"3.1.2 \u522b\u540d\u76ee\u6807"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#32","text":"\u5373\u4f7f\u7528\u547d\u4ee4 set_target_properties \u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u76ee\u6807\u5c5e\u6027\u901a\u5e38\u5f88\u5c11\u76f4\u63a5\u4f7f\u7528\uff0c\u4e00\u822c\u662f\u95f4\u63a5\u4f7f\u7528\uff0c\u4f8b\u5982 \u5728\u4f7f\u7528 target_include_directories \u7684\u65f6\u5019\uff0c\u4f1a\u4e3a\u76ee\u6807\u8bbe\u7f6e INTERFACE_INCLUDE_DIRECTORIES \u5c5e\u6027 \u5728\u4f7f\u7528 target_link_libraries \u7684\u65f6\u5019\uff0c\u4f1a\u4e3a\u76ee\u6807\u8bbe\u7f6e INTERFACE_LINK_LIBRARIES \u5c5e\u6027 \u5b9e\u9645\u4e0a\uff0c\u5bf9\u4e8e\u5bfc\u5165\u76ee\u6807\u3001\u63a5\u53e3\u5e93\u76ee\u6807\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u901a\u8fc7\u4ee5\u4e0a\u547d\u4ee4\u6765\u5b9e\u73b0\u5bf9\u5e94\u529f\u80fd\uff0c\u8b6c\u5982\u8bf4\uff0c\u4e3a\u4e86\u6307\u5b9a\u76ee\u6807\u5305\u542b\u7684\u76ee\u5f55\uff0c\u539f\u5148\u5199\u4e3a target_include_directories( my_target PUBLIC include ) \u73b0\u5728\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 set_target_properties( my_target PROPERTIES INTERFACE_INCLUDE_DIRECTORIES ${CMAKE_CURRENT_LIST_DIR}/include ) \u6216\u8005 set_property( TARGET my_target PROPERTIES INTERFACE_INCLUDE_DIRECTORIES ${CMAKE_CURRENT_LIST_DIR}/include ) \u6765\u5b9e\u73b0\u540c\u6837\u529f\u80fd\uff0c\u6b64\u64cd\u4f5c\u5728\u914d\u7f6e\u5bfc\u5165\u76ee\u6807\u7684\u65f6\u5019\u6bd4\u8f83\u5e38\u89c1\u3002\u6b64\u5916\uff0cCMake \u5b98\u7f51\u63d0\u4f9b\u4e86\u975e\u5e38\u975e\u5e38\u591a\u7684\u5c5e\u6027\uff0c\u53ef\u4ee5\u70b9\u51fb \u6b64\u5904 \u67e5\u9605\u3002 ::: warning \u5728\u8bbe\u7f6e INTERFACE_INCLUDE_DIRECTORIES \u548c INTERFACE_LINK_LIBRARIES \u5c5e\u6027\u7684\u65f6\u5019\u9700\u8981\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84 :::","title":"3.2 \u8bbe\u7f6e\u76ee\u6807\u5c5e\u6027"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#33","text":"\u975e\u5fc5\u8981\u60c5\u51b5\u4e0b\u4e0d\u8981\u4f7f\u7528 link_library include_directories \u8bed\u53e5\uff0c\u4f1a\u5f71\u54cd\u6240\u6709\u5b50\u76ee\u5f55\u7684\u6784\u5efa\uff0c\u5e26\u6765\u6c61\u67d3\u95ee\u9898\u3002\u4f46\u6709\u4e9b\u60c5\u51b5\u4e0b\u8fd9\u4e9b\u8bed\u53e5\u53ef\u4ee5\u5b9e\u73b0\u5176\u4ed6\u529f\u80fd\u3002\u4f8b\u5982 target_include_directories \u53ef\u4ee5\u5c06\u5185\u5bb9\u7ed1\u5b9a\u5230\u76ee\u6807\u5e76\u4e14\u5728\u5bfc\u51fa\u76ee\u6807\u540e\u4f9d\u8d56\u5173\u7cfb\u4ecd\u7136\u751f\u6548\uff0c\u800c\u4f7f\u7528 include_directories \u53ef\u4ee5\u907f\u514d\u5b89\u88c5\u540e\u4ecd\u7136\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\u3002\u5177\u4f53\u539f\u56e0\u548c\u5b9e\u73b0\u7ec6\u8282\u53ef\u53c2\u8003 \u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5 #3.4 \u3002","title":"3.3 \u975e\u5fc5\u8981\u4e0d\u4f7f\u7528\u5168\u5c40\u5305\u542b\u3001\u94fe\u63a5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/05/#34","text":"\u5f53\u9700\u8981\u8bbf\u95ee\u7b2c\u4e09\u65b9\u5e93\u7684\u65f6\u5019\uff0c\u7b2c\u4e09\u65b9\u5e93\u9700\u8981\u63d0\u4f9b\u5934\u6587\u4ef6\uff08\u7c7b\u4f3c\u4e8e *.h \u548c *.hpp \uff09\u548c\u5e93\u6587\u4ef6\uff08\u5305\u62ec\u52a8\u6001\u5e93 *.so \u548c\u9759\u6001\u5e93 *.a \u4e24\u79cd\u5f62\u5f0f\uff09\u3002 ::: tip Windows \u4e0b\u7684\u5e93\u6587\u4ef6\u6709\u4e24\u79cd\u5f62\u5f0f - \u52a8\u6001\u5e93 *.dll \u4ee5\u53ca\u5bfc\u5165\u5e93 *.lib - \u9759\u6001\u5e93 *.lib ::: \u5728\u8bbf\u95ee\u672c\u9879\u76ee\u7684\u5e93 A \u65f6\uff0c\u5982\u679c\u5df2\u7ecf\u4f7f\u7528\u4e86 target_include_directories \u7684 PUBLIC \u5c5e\u6027\uff0c\u5c06\u5934\u6587\u4ef6\u8def\u5f84\u7ed1\u5b9a\u5728\u4e86\u76ee\u6807 A \u4e2d\uff0c\u90a3\u4e48\u76ee\u6807 B \u5728\u8bbf\u95ee A \u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981 cmake target_link_libraries(B PUBLIC A) \u5373\u53ef\u8bbf\u95ee\u5230 A \u6240\u5305\u542b\u7684\u5934\u6587\u4ef6\u8def\u5f84\u3002 \u5728\u8bbf\u95ee\u5176\u4ed6\u9879\u76ee\u7684\u7b2c\u4e09\u65b9\u5e93\u65f6\uff0c\u7528\u6237\u9700\u8981\u5355\u72ec\u83b7\u53d6\u5bf9\u5e94\u7684\u5e93\u6587\u4ef6\u4e0e\u5934\u6587\u4ef6\u8def\u5f84\u8fdb\u884c\u94fe\u63a5\uff0c\u4f8b\u5982 OpenCV\uff1a ```cmake add_executable(xxx main.cpp) target_include_directories( xxx PUBLIC ${OpenCV_INCLUDE_DIRS} ) target_link_libraries( xxx PRIVATE ${OpenCV_LIBS} ) ``` \u4f46\u5b9e\u9645\u4e0a\uff0c OpenCV_LIBS \u662f\u5305\u542b\u4e86\u4f17\u591a\u5bfc\u5165\u76ee\u6807\u7684\u5217\u8868\u53d8\u91cf\uff0c\u4f8b\u5982 opencv_core;opencv_highgui \uff0c\u5e76\u4e14\u5217\u8868\u4e2d\u7684\u6bcf\u4e2a\u53d8\u91cf\u90fd\u8bbe\u7f6e\u4e86 INTERFACE_INCLUDE_DIRECTORIES \u7684\u5c5e\u6027\u3002\u4e0d\u5199 target_include_directories \u547d\u4ee4\u4e5f\u662f\u6b63\u786e\u7684\uff1a ```cmake add_executable(xxx main.cpp) target_link_libraries( xxx PRIVATE ${OpenCV_LIBS} ) ```","title":"3.4 \u8bbf\u95ee\u5e93\u7684\u65b9\u5f0f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/","text":"\u301006\u3011\u53d8\u91cf\u53c2\u4e0e C++ \u7684\u7f16\u8bd1 \u6559\u5b66\u89c6\u9891 ::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili @ bilibili 1. \u524d\u8a00 \u5728\u5f00\u53d1\u4e2d\uff0c\u5f80\u5f80\u4f1a\u6709\u4ee5\u4e0b\u9700\u6c42\uff0c\u9700\u8981\u7528\u6237\u6216\u8005\u7a0b\u5e8f\u5458\u6765\u9009\u62e9\u7f16\u8bd1\u67d0\u6bb5\u4ee3\u7801\u3002\u4f8b\u5982\u5728C/C++\u8bed\u8a00\u4e2d\uff0c\u8fd9\u79cd\u901a\u5e38\u7684\u505a\u6cd5\u662f\u4f7f\u7528\u9884\u7f16\u8bd1\u547d\u4ee4 #define \uff1a #define HAVE_ABC /* code */ #ifdef HAVE_ABC class ABC { /* code */ }; #endif // HAVE_ABC \u8fd9\u79cd\u9700\u8981\u624b\u52a8\u4fee\u6539\u6e90\u7801\uff0c\u64cd\u4f5c\u4e0a\u4e0d\u5b89\u5168\u4e14\u6bd4\u8f83\u7e41\u7410\u3002\u5982\u679c\u80fd\u5728\u7a0b\u5e8f\u7f16\u8bd1\u671f\u95f4\u4ea7\u751f \u67d0\u4e9b\u9884\u7f16\u8bd1\u5b8f \u5305\u542b\u5b8f\u3001\u5e38\u91cf\u8868\u8fbe\u5f0f\u7b49\u5185\u5bb9\u7684\u5934\u6587\u4ef6 \u5c06\u5728\u5b89\u5168\u6027\u3001\u64cd\u4f5c\u7684\u4fbf\u6377\u6027\u4e0a\u4f1a\u6709\u663e\u8457\u63d0\u5347\u3002\u7f16\u8bd1\u5668\u63d0\u4f9b\u4e86\u4e00\u4e9b\u6307\u4ee4\uff0c\u53ef\u4ee5\u5728\u7f16\u8bd1\u671f\u95f4\u4ea7\u751f\u9884\u7f16\u8bd1\u5b8f\uff0c\u4f8b\u5982 GCC \u7684 -D \u9009\u9879\uff1a g++ -DXXX main.cpp \u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u7f16\u8bd1\u671f\u95f4\u4ea7\u751f\u4e00\u4e2a\u9884\u7f16\u8bd1\u5b8f XXX \uff0cCMake \u5219\u63d0\u4f9b\u4e86\u4e00\u7ec4\u529f\u80fd\uff0c\u53ef\u4ee5\u5728 CMake \u914d\u7f6e\u671f\u95f4\u4ea7\u751f\u9884\u7f16\u8bd1\u5b8f\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u7f16\u8bd1\u671f\u95f4\u4ea7\u751f\u9884\u7f16\u8bd1\u5b8f 2. \u4f7f\u7528\u6a21\u677f\u6587\u4ef6\u751f\u6210\u5934\u6587\u4ef6 \u4e00\u4e2a\u6700\u76f4\u63a5\u7684\u65b9\u6cd5\uff0c\u5219\u662f\u751f\u6210\u5305\u542b\u4e00\u7cfb\u5217\u5b8f\u5b9a\u4e49\u7684\u5934\u6587\u4ef6\uff0c\u518d\u8ba9\u6e90\u6587\u4ef6\u53bb\u5305\u542b\u8fd9\u4e9b\u5934\u6587\u4ef6\uff0c\u8fbe\u5230\u8ba9\u7528\u6237\u81ea\u4e3b\u914d\u7f6e\u7684\u529f\u80fd\u3002 2.1 \u914d\u7f6e *.in \u6a21\u677f\u6587\u4ef6 \u5728 \u301001\u3011\u5b89\u88c5\u4e0e\u57fa\u672c\u4ecb\u7ecd \u4e2d\u6211\u4eec\u66fe\u4ecb\u7ecd\u8fc7 *.in \u6587\u4ef6\u4e3a\u4e00\u4e2a\u6a21\u677f\u6587\u4ef6\uff0cCMake \u89e3\u6790\u671f\u95f4\u80fd\u591f\u5229\u7528\u8fd9\u4e00\u6a21\u677f\u6587\u4ef6\u751f\u6210\u5b9e\u9645\u7684\u6587\u4ef6\u3002\u6211\u4eec\u770b\u5230 <opencv-path>/cmake/templates/ \u6587\u4ef6\u5939\u4e0b\uff0c\u5305\u542b\u4e86\u4e00\u4e2a cvconfig.h.in \u6587\u4ef6\uff0c\u90e8\u5206\u5185\u5bb9\u5982\u4e0b\uff1a /* code */ /* OpenCV compiled as static or dynamic libs */ #cmakedefine BUILD_SHARED_LIBS /* OpenCV intrinsics optimized code */ #cmakedefine CV_ENABLE_INTRINSICS /* OpenCV additional optimized code */ #cmakedefine CV_DISABLE_OPTIMIZATION /* Compile for 'real' NVIDIA GPU architectures */ #define CUDA_ARCH_BIN \"${OPENCV_CUDA_ARCH_BIN}\" /* code */ \u5982\u679c\u4ece\u6e90\u7801\u7f16\u8bd1\u8fc7 OpenCV\uff0c\u6211\u4eec\u5219\u53ef\u4ee5\u5728 <opencv-path>/build/ \u6587\u4ef6\u5939\u4e0b\uff0c\u627e\u5230\u4e00\u4e2a\u53eb\u505a cvconfig.h \u7684\u6587\u4ef6\uff0c\u90e8\u5206\u5185\u5bb9\u5982\u4e0b\uff1a /* code */ /* OpenCV compiled as static or dynamic libs */ #define BUILD_SHARED_LIBS /* OpenCV intrinsics optimized code */ #define CV_ENABLE_INTRINSICS /* OpenCV additional optimized code */ /* #undef CV_DISABLE_OPTIMIZATION */ /* Compile for 'real' NVIDIA GPU architectures */ #define CUDA_ARCH_BIN \"\" /* code */ \u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a cvconfig.h.in \u6587\u4ef6\u7684\u5927\u90e8\u5206\u8bed\u6cd5\u4e0e cvconfig.h \u4e00\u81f4\uff0c\u4f46\u5176\u4e2d\u6d89\u53ca\u5230\u4e00\u4e9b CMake \u53d8\u91cf\u7684\u5730\u65b9\uff0c\u8fd9\u4e9b\u5185\u5bb9\u5728 cvconfig.h \u4e2d\u53d1\u751f\u4e86\u8f6c\u5316\u3002 \u7ecf\u8fc7\u5bfb\u627e\uff0c\u53ef\u4ee5\u770b\u5230\uff1a\u5728 <opencv-path/cmake/ \u6587\u4ef6\u5939\u4e0b\u7684 OpenCVGenHeaders.cmake \u6587\u4ef6\u7684\u7b2c\u4e00\u884c\u5305\u542b\u8fd9\u4e48\u4e24\u53e5\u5185\u5bb9\uff1a # platform-specific config file configure_file(\"${OpenCV_SOURCE_DIR}/cmake/templates/cvconfig.h.in\" \"${OPENCV_CONFIG_FILE_INCLUDE_DIR}/cvconfig.h\") configure_file(\"${OpenCV_SOURCE_DIR}/cmake/templates/cvconfig.h.in\" \"${OPENCV_CONFIG_FILE_INCLUDE_DIR}/opencv2/cvconfig.h\") \u6211\u4eec\u53ef\u4ee5\u63a8\u6d4b\uff0c cvconfig.h \u5c31\u662f\u901a\u8fc7 cvconfig.h.in \u6587\u4ef6\u800c\u751f\u6210\u7684\uff0c\u5176\u4e2d\u7528\u4e8e\u8f6c\u5316\u7684\u8bed\u53e5\u5c31\u662f configure_file \u3002 2.2 configure_file \u57fa\u672c\u7528\u6cd5\uff1a configure_file(aaa.h.in bbb.h) # \u4f7f\u7528 aaa.h.in \u4e3a\u6a21\u677f\u751f\u6210 bbb.h \u5728\u4f7f\u7528 configure_file \u4e4b\u524d\u9700\u8981\u521b\u5efa\u4e00\u4e2a aaa.h.in \u6587\u4ef6\uff0c\u7528\u4e8e\u751f\u6210 bbb.h \uff0c\u5176\u4e2d aaa.h.in \u6587\u4ef6\u4e0e\u5f85\u751f\u6210\u7684 bbb.h \u6587\u4ef6\u57fa\u672c\u4e00\u81f4\uff0c\u5373\u4e0e\u666e\u901a\u7684 C++ \u6587\u4ef6\u57fa\u672c\u4e00\u81f4\uff0c\u53ea\u662f\u5728\u9700\u8981\u66ff\u6362\u7684\u5730\u65b9\u4f7f\u7528 CMake \u7684\u76f8\u5173\u6807\u5fd7\uff0c\u4f8b\u5982\uff1a #cmakedefine CONFIG_DIR \"@CONFIG_DIR@\" #define CONFIG_DIR_1 \"@CONFIG_DIR@\" constexpr auto CONFIG_DIR_2 = \"@CONFIG_DIR@\"; #cmakedefine CONFIG_DIR_3 \"@CONFIG_DIR_2@\" #define CONFIG_DIR_4 \"@CONFIG_DIR_3@\" \u5176\u4e2d #cmakedefine \u5c31\u8868\u793a\u4f1a\u5728 CMake \u6267\u884c\u914d\u7f6e\u65f6\u671f\uff0c\u66ff\u6362\u4e3a\u9884\u5b9a\u4e49\u7684 CMake \u53d8\u91cf\u6216\u7528\u6237\u5b9a\u4e49\u7684\u53d8\u91cf\u3002\u6b64\u5916\uff0c\u4f7f\u7528 @xxx@ \u7684\u5185\u5bb9\u4e5f\u662f\u6a21\u677f\uff0c\u4e5f\u4f1a\u5728 CMake \u6267\u884c\u914d\u7f6e\u65f6\u671f\u8fdb\u884c\u6587\u672c\u66ff\u6362\u3002 \u5728 CMakeLists.txt \u4e2d\u5199\u5165\uff1a set(CONFIG_DIR \"aa/bb/cc\") configure_file( config.h.in ${CMAKE_SOURCE_DIR}/config.h @ONLY # \u6b64\u9879\u53ef\u9009\uff0c@ONLY \u8868\u793a\u4ec5\u5c06 *.in \u6587\u4ef6\u4e2d\u7684 @xxx@ \u505a\u66ff\u6362\uff0c\u800c ${xxx} \u4e0d\u505a\u66ff\u6362 ) \u53ef\u4ee5\u770b\u5230 CMakeLists.txt \u53ea\u5bf9 CONFIG_DIR \u8fdb\u884c\u4e86\u5b9a\u4e49\u3002\u800c\u7b2c 4 \u884c\u548c\u7b2c 5 \u884c\u63d0\u5230\u7684 CONFIG_DIR_2 \u548c CONFIG_DIR_3 \u5747\u672a\u88ab\u5b9a\u4e49\u3002 \u5728\u7ecf\u8fc7 cmake \u547d\u4ee4\u540e\uff0c\u4f1a\u5728 CMakeLists.txt \u5f53\u524d\u8def\u5f84\u4e0b\u751f\u6210 config.h \u6587\u4ef6\uff0c\u5176\u5185\u5bb9\u5982\u4e0b\uff1a #define CONFIG_DIR \"aa/bb/cc\" #define CONFIG_DIR_1 \"aa/bb/cc\" constexpr auto CONFIG_DIR_2 = \"aa/bb/cc\"; /* #undef CONFIG_DIR_3 */ #define CONFIG_DIR_4 \"\" 2.3 \u4e0e option \u914d\u5408 \u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 option() \u9009\u9879\u6765\u5236\u4f5c\u6761\u4ef6\u7f16\u8bd1\u7684\u5b8f\uff0c\u4f8b\u5982\uff1a\u5728 config.h.in \u4e2d\u5199\u5165\uff1a #cmakedefine A #cmakedefine B \u5728 CMakeLists.txt \u4e2d\u5199\u5165\uff1a option(A \"a\" ON) option(B \"b\" OFF) configure_file(config.h.in ${CMAKE_SOURCE_DIR}/config.h) \u751f\u6210\u7684 config.h \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a #define A /* #undef B */ \u4f8b\u5982\uff0c\u5728 <opencv-path>/CMakeLists.txt \u6587\u4ef6\u4e0b\uff0c\u6709\uff1a OCV_OPTION(OPENCV_ENABLE_NONFREE \"Enable non-free algorithms\" OFF) \u5728 <opencv-path>/cmake/templates/ \u6587\u4ef6\u5939\u4e2d\u7684 opencv_modules.hpp.in \u6709\uff1a #cmakedefine OPENCV_ENABLE_NONFREE \u5982\u679c\u6211\u4eec\u901a\u8fc7 cmake-gui \u5c06 OPENCV_ENABLE_NONFREE \u4fee\u6539\u4e3a ON \uff0c\u90a3\u4e48\u53ef\u4ee5\u786e\u5b9a\uff0c\u4f1a\u751f\u6210\uff1a #define OPENCV_ENABLE_NONFREE 2.4 \u4f7f\u7528\u573a\u666f \u5728 \u6279\u91cf\u751f\u6210 \u4e00\u7cfb\u5217\u5b8f\u5b9a\u4e49\u53d8\u91cf\uff0c\u6216\u8005 \u751f\u6210\u4e0e\u8def\u5f84\u6709\u5173\u7684\u53d8\u91cf \u7684\u65f6\u5019\uff0c\u4f7f\u7528 configure_file \u662f\u5f88\u65b9\u4fbf\u7684\uff0c\u4f46\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u6216\u51e0\u4e2a\u7684\u5b8f\u5b9a\u4e49\u53d8\u91cf\uff0c\u90a3\u4e48\u4f7f\u7528 configure_file \u6765\u7ef4\u62a4\u4e00\u4e2a *.in \u6587\u4ef6\u5c06\u663e\u5f97\u5341\u5206\u5197\u6742\u3002 3. CMake \u6dfb\u52a0\u9884\u5b9a\u4e49\u53d8\u91cf \u6b63\u5982\u4e0a\u8ff0\u4f7f\u7528\u573a\u666f\u6240\u8bf4\uff0c\u5355\u4e2a\u6216\u5c11\u91cf\u7684\u5b8f\u5b9a\u4e49\uff0c\u4f7f\u7528 configure_file \u5e76\u4e0d\u65b9\u4fbf\uff0c\u4e0b\u9762\u63d0\u4f9b\u51e0\u4e2a\u89e3\u51b3\u6b64\u95ee\u9898\u7684\u65b9\u6cd5\u3002 3.1 add_definitions 3.1.1 \u7528\u6cd5 add_definitions(-DXXX) \u5728 main.cpp \u4e2d\u5199\u5165 #include <iostream> using namespace std; #ifdef XXX inline void foo() { cout << \"this is XXX\" <<endl; } #endif // XXX #ifdef YYY inline void foo() { cout << \"this is YYY\" <<endl; } #endif // YYY int main(int argc, char *argv[]) { foo(); return 0; } \u7f16\u8bd1\u540e\uff0c\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b this is XXX \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c add_definitions \u751f\u6548\u7684\u6587\u4ef6\u4e3a\u5f53\u524d CMakeLists.txt \u6587\u4ef6\u4ee5\u53ca\u5b50\u76ee\u5f55\u7684 CMakeLists.txt \u6587\u4ef6\uff0c\u53ef\u7c7b\u6bd4\u53d8\u91cf\u7684\u4f5c\u7528\u57df\u3002\u5e76\u4e14\uff0c\u5bf9\u4e8e\u5176\u4e2d\u4e00\u4e2a CMakeLists.txt \u6587\u4ef6\uff0c\u5373\u4f7f\u5199\u6210 add_executable(demo main.cpp) add_definitions(-DXXX) \u5373\uff0c\u5728\u521b\u5efa\u53ef\u6267\u884c\u7a0b\u5e8f\u8fd9\u4e2a\u4e8c\u8fdb\u5236\u76ee\u6807\u4e4b\u540e\u518d\u4e66\u5199 add_definitions \uff0c\u8be5\u9884\u7f16\u8bd1\u5b8f\u5b9a\u4e49 \u4ecd\u7136\u80fd\u591f\u751f\u6548 \uff0c\u56e0\u4e3a\u8be5\u547d\u4ee4\u4f5c\u7528\u57df \u751f\u6210\u9636\u6bb5 \uff0c\u53ef\u53c2\u8003 \u301009\u3011\u751f\u6210\u5668\u8868\u8fbe\u5f0f \u3002\u6211\u4eec\u6682\u65f6\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3 \u8fd9\u4e00\u64cd\u4f5c\u7b49\u540c\u4e8e\u4f7f\u7528 g++ main.cpp -DXXX \u7684\u547d\u4ee4\u884c\u8fdb\u884c\u7f16\u8bd1 \u53ea\u8981\u6784\u5efa\u51fa\u7684\u76ee\u6807\uff08\u4e0a\u9762\u7684\u4f8b\u5b50\u662f demo \uff09\u6240\u5728\u7684\u4f5c\u7528\u57df\u4e2d\u5177\u6709\u9884\u7f16\u8bd1\u5b8f\u5b9a\u4e49 XXX \uff0c\u90a3\u4e48\u8be5\u5b8f\u5b9a\u4e49\u90fd\u80fd\u751f\u6548\uff08\u5373\u5168\u5c40\u751f\u6548\uff09\u3002 3.1.2 \u4e0e option \u914d\u5408 \u5b9e\u9645\u4e0a\uff0c\u5bf9\u4e8e\u5168\u5c40\u751f\u6548\u7684 add_definitions \u6211\u4eec\u66f4\u591a\u7684\u662f\u5c06\u5176\u4e0e option \u547d\u4ee4\u7ed3\u5408\u8d77\u6765\u4f7f\u7528\uff0c\u53c2\u8003\u4e0b\u9762\u7684\u4ee3\u7801\uff1a # \u5b9a\u4e49\u4e8e <opencv-path>/CMakeLists.txt \u4e2d\u7684\u5185\u5bb9 OCV_OPTION(ENABLE_IMPL_COLLECTION \"xxx\" OFF ) # code if(ENABLE_IMPL_COLLECTION) add_definitions(-DCV_COLLECT_IMPL_DATA) endif() \u6211\u4eec\u53ea\u9700\u5728\u7ec8\u7aef\u4e2d\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9\uff0c\u5373\u53ef\u5b9e\u73b0\u8be5\u7f16\u8bd1\u9009\u9879\u7684\u5f00\u542f\uff0c\u5e76\u6dfb\u52a0\u5bf9\u5e94\u7684\u5b8f cmake -D ENABLE_IMPL_COLLECTION=ON .. 3.1.3 \u6ce8\u610f\u4e8b\u9879 \u7531\u4e8e\u4e0a\u6587\u4e2d\u63d0\u5230 add_definitions \u7684\u751f\u6548\u673a\u5236\u4e0e CMake \u4e2d\u53d8\u91cf\u7684\u4f5c\u7528\u57df\u57fa\u672c\u4e00\u81f4\uff0c\u56e0\u6b64\u5728\u4e00\u4e2a CMakeLists.txt \u4e2d\u5982\u679c\u521b\u5efa\u591a\u4e2a\u76ee\u6807\uff0c\u90a3\u4e48\u8fd9\u4e9b\u76ee\u6807\u5747\u80fd\u4eab\u6709\u8fd9\u4e2a\u4f5c\u7528\u57df\u4e0b\u7684 add_definitions \u6240\u5e26\u6765\u7684\u6548\u679c\u4f7f\u7528 add_definitions \u6784\u5efa\u7684\u76ee\u6807\u3002\u5177\u4f53\u7684\u8bf4\uff0c\u5c31\u662f\u5728 \u5f53\u524d\u7684 CMakeLists.txt \u6587\u4ef6 \u5b50\u76ee\u5f55\uff08\u4f7f\u7528 add_subdirectory \u6240\u6dfb\u52a0\u7684\u6a21\u5757\uff09\u7684 CMakeLists.txt \u6587\u4ef6\u4e2d \u751f\u6548\uff0c\u4f8b\u5982\u4ee5\u4e0b\u7684\u5e03\u5c40\u3002 project: CMakeLists \u2502 \u2514\u2500\u2500 A: CMakeLists \u2502 \u251c\u2500\u2500 B: CMakeLists \u2502 \u2502 \u2502 \u2514\u2500\u2500 D: CMakeLists \u2502 \u2514\u2500\u2500 C: CMakeLists \u4f8b\u5982\uff0c\u5728 A \u76ee\u5f55\u4e2d\u4f7f\u7528 add_definitions \u5b9a\u4e49\u7684\u5185\u5bb9\uff0c\u5728 A \u3001 B \u3001 C \u3001 D \u76ee\u5f55\u4e2d\u5747\u751f\u6548\uff0c\u800c B \u4f7f\u7528 add_definitions \u5b9a\u4e49\u7684\u5185\u5bb9\u4ec5\u5728 B \u3001 D \u76ee\u5f55\u4e2d\u751f\u6548 3.2 target_compile_definitions \u5728 \u301005\u3011\u76ee\u6807\u6784\u5efa - \u666e\u901a\u5e93\u76ee\u6807\u6784\u5efa \u4e2d\u63d0\u5230\u4e86 target_compile_definitions \u547d\u4ee4\uff0c\u8fd9\u4e5f\u662f\u76ee\u6807\u5c5e\u6027\u5f53\u4e2d \u201c\u4f7f\u7528\u8981\u6c42\u201d \u7684\u4e00\u90e8\u5206\u3002\u5728\u6dfb\u52a0\u9884\u5b9a\u4e49\u5b8f\u7684\u529f\u80fd\u4e0a\uff0c\u76f8\u6bd4\u4e8e add_definitions \uff0c target_compile_definitions \u5219\u66f4\u5177\u6709\u9488\u5bf9\u6027\uff0c\u5b83\u80fd\u660e\u786e\u7684\u6307\u5b9a\u662f\u54ea\u4e2a\u76ee\u6807\u5728\u6784\u5efa\u7684\u65f6\u5019\u5f15\u5165\u9884\u7f16\u8bd1\u5b8f\u3002\u4e0b\u9762\u9996\u5148\u7ed9\u51fa OpenCV \u4e2d\u7684\u4f8b\u5b50 # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d _ocv_create_module \u5b8f\u4e2d target_compile_definitions(${the_module} PRIVATE CVAPI_EXPORTS) \u5728 <opencv-path>/modules/core/src \u6587\u4ef6\u5939\u4e0b\u7684 system.cpp \u8fd9\u4e00\u6e90\u6587\u4ef6\uff0c\u6709\u5f15\u7528\u5230 CVAPI_EXPORTS \u7684\u5730\u65b9\uff1a #if defined CVAPI_EXPORTS && defined _WIN32 && !defined WINCE // ... #endif \u5b83\u4e3a\u6307\u5b9a\u7684\u6a21\u5757\u6dfb\u52a0\u9884\u7f16\u8bd1\u5b8f\uff0c\u4f7f\u5f97\u8be5\u5b8f\u4e0d\u4f1a\u88ab\u66b4\u9732\u7ed9\u975e\u6307\u5b9a\u7684\u76ee\u6807\uff0c\u56e0\u6b64\u4f1a\u5f88\u5b89\u5168\u3002\u5e76\u4e14\uff0c\u4e00\u822c\u8bbe\u7f6e\u4e3a PRIVATE \u7684\u9884\u7f16\u8bd1\u5b8f\u4e0d\u80fd\u88ab\u5176\u4f59\u5305\u542b\u8be5\u76ee\u6807\u7684\u5176\u4ed6\u76ee\u6807\u6240\u5171\u4eab\uff0c\u8fd9\u4e0e CMake \u76ee\u6807\u6784\u5efa\u65f6\u63a5\u89e6\u5230\u7684 target_include_directories \u4ee5\u53ca target_link_libraries \u7684\u7528\u6cd5\u7c7b\u4f3c\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ee5\u4e0b\u4ee3\u7801 target_compile_definitions( my_lib PUBLIC xxx ) \u53ef\u4ee5\u5b9e\u73b0\u5176\u4ed6\u76ee\u6807\u5728\u94fe\u63a5 my_lib \u8fd9\u4e2a\u76ee\u6807\u7684\u65f6\u5019\u540c\u6837\u4eab\u6709 xxx \u8fd9\u4e2a\u9884\u7f16\u8bd1\u5b8f\u5b9a\u4e49\u3002","title":"\u301006\u3011\u53d8\u91cf\u53c2\u4e0e C++ \u7684\u7f16\u8bd1"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#06-c","text":"","title":"\u301006\u3011\u53d8\u91cf\u53c2\u4e0e C++ \u7684\u7f16\u8bd1"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#_1","text":"::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili @ bilibili","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#1","text":"\u5728\u5f00\u53d1\u4e2d\uff0c\u5f80\u5f80\u4f1a\u6709\u4ee5\u4e0b\u9700\u6c42\uff0c\u9700\u8981\u7528\u6237\u6216\u8005\u7a0b\u5e8f\u5458\u6765\u9009\u62e9\u7f16\u8bd1\u67d0\u6bb5\u4ee3\u7801\u3002\u4f8b\u5982\u5728C/C++\u8bed\u8a00\u4e2d\uff0c\u8fd9\u79cd\u901a\u5e38\u7684\u505a\u6cd5\u662f\u4f7f\u7528\u9884\u7f16\u8bd1\u547d\u4ee4 #define \uff1a #define HAVE_ABC /* code */ #ifdef HAVE_ABC class ABC { /* code */ }; #endif // HAVE_ABC \u8fd9\u79cd\u9700\u8981\u624b\u52a8\u4fee\u6539\u6e90\u7801\uff0c\u64cd\u4f5c\u4e0a\u4e0d\u5b89\u5168\u4e14\u6bd4\u8f83\u7e41\u7410\u3002\u5982\u679c\u80fd\u5728\u7a0b\u5e8f\u7f16\u8bd1\u671f\u95f4\u4ea7\u751f \u67d0\u4e9b\u9884\u7f16\u8bd1\u5b8f \u5305\u542b\u5b8f\u3001\u5e38\u91cf\u8868\u8fbe\u5f0f\u7b49\u5185\u5bb9\u7684\u5934\u6587\u4ef6 \u5c06\u5728\u5b89\u5168\u6027\u3001\u64cd\u4f5c\u7684\u4fbf\u6377\u6027\u4e0a\u4f1a\u6709\u663e\u8457\u63d0\u5347\u3002\u7f16\u8bd1\u5668\u63d0\u4f9b\u4e86\u4e00\u4e9b\u6307\u4ee4\uff0c\u53ef\u4ee5\u5728\u7f16\u8bd1\u671f\u95f4\u4ea7\u751f\u9884\u7f16\u8bd1\u5b8f\uff0c\u4f8b\u5982 GCC \u7684 -D \u9009\u9879\uff1a g++ -DXXX main.cpp \u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u7f16\u8bd1\u671f\u95f4\u4ea7\u751f\u4e00\u4e2a\u9884\u7f16\u8bd1\u5b8f XXX \uff0cCMake \u5219\u63d0\u4f9b\u4e86\u4e00\u7ec4\u529f\u80fd\uff0c\u53ef\u4ee5\u5728 CMake \u914d\u7f6e\u671f\u95f4\u4ea7\u751f\u9884\u7f16\u8bd1\u5b8f\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u7f16\u8bd1\u671f\u95f4\u4ea7\u751f\u9884\u7f16\u8bd1\u5b8f","title":"1. \u524d\u8a00"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#2","text":"\u4e00\u4e2a\u6700\u76f4\u63a5\u7684\u65b9\u6cd5\uff0c\u5219\u662f\u751f\u6210\u5305\u542b\u4e00\u7cfb\u5217\u5b8f\u5b9a\u4e49\u7684\u5934\u6587\u4ef6\uff0c\u518d\u8ba9\u6e90\u6587\u4ef6\u53bb\u5305\u542b\u8fd9\u4e9b\u5934\u6587\u4ef6\uff0c\u8fbe\u5230\u8ba9\u7528\u6237\u81ea\u4e3b\u914d\u7f6e\u7684\u529f\u80fd\u3002","title":"2. \u4f7f\u7528\u6a21\u677f\u6587\u4ef6\u751f\u6210\u5934\u6587\u4ef6"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#21-in","text":"\u5728 \u301001\u3011\u5b89\u88c5\u4e0e\u57fa\u672c\u4ecb\u7ecd \u4e2d\u6211\u4eec\u66fe\u4ecb\u7ecd\u8fc7 *.in \u6587\u4ef6\u4e3a\u4e00\u4e2a\u6a21\u677f\u6587\u4ef6\uff0cCMake \u89e3\u6790\u671f\u95f4\u80fd\u591f\u5229\u7528\u8fd9\u4e00\u6a21\u677f\u6587\u4ef6\u751f\u6210\u5b9e\u9645\u7684\u6587\u4ef6\u3002\u6211\u4eec\u770b\u5230 <opencv-path>/cmake/templates/ \u6587\u4ef6\u5939\u4e0b\uff0c\u5305\u542b\u4e86\u4e00\u4e2a cvconfig.h.in \u6587\u4ef6\uff0c\u90e8\u5206\u5185\u5bb9\u5982\u4e0b\uff1a /* code */ /* OpenCV compiled as static or dynamic libs */ #cmakedefine BUILD_SHARED_LIBS /* OpenCV intrinsics optimized code */ #cmakedefine CV_ENABLE_INTRINSICS /* OpenCV additional optimized code */ #cmakedefine CV_DISABLE_OPTIMIZATION /* Compile for 'real' NVIDIA GPU architectures */ #define CUDA_ARCH_BIN \"${OPENCV_CUDA_ARCH_BIN}\" /* code */ \u5982\u679c\u4ece\u6e90\u7801\u7f16\u8bd1\u8fc7 OpenCV\uff0c\u6211\u4eec\u5219\u53ef\u4ee5\u5728 <opencv-path>/build/ \u6587\u4ef6\u5939\u4e0b\uff0c\u627e\u5230\u4e00\u4e2a\u53eb\u505a cvconfig.h \u7684\u6587\u4ef6\uff0c\u90e8\u5206\u5185\u5bb9\u5982\u4e0b\uff1a /* code */ /* OpenCV compiled as static or dynamic libs */ #define BUILD_SHARED_LIBS /* OpenCV intrinsics optimized code */ #define CV_ENABLE_INTRINSICS /* OpenCV additional optimized code */ /* #undef CV_DISABLE_OPTIMIZATION */ /* Compile for 'real' NVIDIA GPU architectures */ #define CUDA_ARCH_BIN \"\" /* code */ \u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a cvconfig.h.in \u6587\u4ef6\u7684\u5927\u90e8\u5206\u8bed\u6cd5\u4e0e cvconfig.h \u4e00\u81f4\uff0c\u4f46\u5176\u4e2d\u6d89\u53ca\u5230\u4e00\u4e9b CMake \u53d8\u91cf\u7684\u5730\u65b9\uff0c\u8fd9\u4e9b\u5185\u5bb9\u5728 cvconfig.h \u4e2d\u53d1\u751f\u4e86\u8f6c\u5316\u3002 \u7ecf\u8fc7\u5bfb\u627e\uff0c\u53ef\u4ee5\u770b\u5230\uff1a\u5728 <opencv-path/cmake/ \u6587\u4ef6\u5939\u4e0b\u7684 OpenCVGenHeaders.cmake \u6587\u4ef6\u7684\u7b2c\u4e00\u884c\u5305\u542b\u8fd9\u4e48\u4e24\u53e5\u5185\u5bb9\uff1a # platform-specific config file configure_file(\"${OpenCV_SOURCE_DIR}/cmake/templates/cvconfig.h.in\" \"${OPENCV_CONFIG_FILE_INCLUDE_DIR}/cvconfig.h\") configure_file(\"${OpenCV_SOURCE_DIR}/cmake/templates/cvconfig.h.in\" \"${OPENCV_CONFIG_FILE_INCLUDE_DIR}/opencv2/cvconfig.h\") \u6211\u4eec\u53ef\u4ee5\u63a8\u6d4b\uff0c cvconfig.h \u5c31\u662f\u901a\u8fc7 cvconfig.h.in \u6587\u4ef6\u800c\u751f\u6210\u7684\uff0c\u5176\u4e2d\u7528\u4e8e\u8f6c\u5316\u7684\u8bed\u53e5\u5c31\u662f configure_file \u3002","title":"2.1 \u914d\u7f6e *.in \u6a21\u677f\u6587\u4ef6"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#22-configure_file","text":"\u57fa\u672c\u7528\u6cd5\uff1a configure_file(aaa.h.in bbb.h) # \u4f7f\u7528 aaa.h.in \u4e3a\u6a21\u677f\u751f\u6210 bbb.h \u5728\u4f7f\u7528 configure_file \u4e4b\u524d\u9700\u8981\u521b\u5efa\u4e00\u4e2a aaa.h.in \u6587\u4ef6\uff0c\u7528\u4e8e\u751f\u6210 bbb.h \uff0c\u5176\u4e2d aaa.h.in \u6587\u4ef6\u4e0e\u5f85\u751f\u6210\u7684 bbb.h \u6587\u4ef6\u57fa\u672c\u4e00\u81f4\uff0c\u5373\u4e0e\u666e\u901a\u7684 C++ \u6587\u4ef6\u57fa\u672c\u4e00\u81f4\uff0c\u53ea\u662f\u5728\u9700\u8981\u66ff\u6362\u7684\u5730\u65b9\u4f7f\u7528 CMake \u7684\u76f8\u5173\u6807\u5fd7\uff0c\u4f8b\u5982\uff1a #cmakedefine CONFIG_DIR \"@CONFIG_DIR@\" #define CONFIG_DIR_1 \"@CONFIG_DIR@\" constexpr auto CONFIG_DIR_2 = \"@CONFIG_DIR@\"; #cmakedefine CONFIG_DIR_3 \"@CONFIG_DIR_2@\" #define CONFIG_DIR_4 \"@CONFIG_DIR_3@\" \u5176\u4e2d #cmakedefine \u5c31\u8868\u793a\u4f1a\u5728 CMake \u6267\u884c\u914d\u7f6e\u65f6\u671f\uff0c\u66ff\u6362\u4e3a\u9884\u5b9a\u4e49\u7684 CMake \u53d8\u91cf\u6216\u7528\u6237\u5b9a\u4e49\u7684\u53d8\u91cf\u3002\u6b64\u5916\uff0c\u4f7f\u7528 @xxx@ \u7684\u5185\u5bb9\u4e5f\u662f\u6a21\u677f\uff0c\u4e5f\u4f1a\u5728 CMake \u6267\u884c\u914d\u7f6e\u65f6\u671f\u8fdb\u884c\u6587\u672c\u66ff\u6362\u3002 \u5728 CMakeLists.txt \u4e2d\u5199\u5165\uff1a set(CONFIG_DIR \"aa/bb/cc\") configure_file( config.h.in ${CMAKE_SOURCE_DIR}/config.h @ONLY # \u6b64\u9879\u53ef\u9009\uff0c@ONLY \u8868\u793a\u4ec5\u5c06 *.in \u6587\u4ef6\u4e2d\u7684 @xxx@ \u505a\u66ff\u6362\uff0c\u800c ${xxx} \u4e0d\u505a\u66ff\u6362 ) \u53ef\u4ee5\u770b\u5230 CMakeLists.txt \u53ea\u5bf9 CONFIG_DIR \u8fdb\u884c\u4e86\u5b9a\u4e49\u3002\u800c\u7b2c 4 \u884c\u548c\u7b2c 5 \u884c\u63d0\u5230\u7684 CONFIG_DIR_2 \u548c CONFIG_DIR_3 \u5747\u672a\u88ab\u5b9a\u4e49\u3002 \u5728\u7ecf\u8fc7 cmake \u547d\u4ee4\u540e\uff0c\u4f1a\u5728 CMakeLists.txt \u5f53\u524d\u8def\u5f84\u4e0b\u751f\u6210 config.h \u6587\u4ef6\uff0c\u5176\u5185\u5bb9\u5982\u4e0b\uff1a #define CONFIG_DIR \"aa/bb/cc\" #define CONFIG_DIR_1 \"aa/bb/cc\" constexpr auto CONFIG_DIR_2 = \"aa/bb/cc\"; /* #undef CONFIG_DIR_3 */ #define CONFIG_DIR_4 \"\"","title":"2.2 configure_file"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#23-option","text":"\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 option() \u9009\u9879\u6765\u5236\u4f5c\u6761\u4ef6\u7f16\u8bd1\u7684\u5b8f\uff0c\u4f8b\u5982\uff1a\u5728 config.h.in \u4e2d\u5199\u5165\uff1a #cmakedefine A #cmakedefine B \u5728 CMakeLists.txt \u4e2d\u5199\u5165\uff1a option(A \"a\" ON) option(B \"b\" OFF) configure_file(config.h.in ${CMAKE_SOURCE_DIR}/config.h) \u751f\u6210\u7684 config.h \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a #define A /* #undef B */ \u4f8b\u5982\uff0c\u5728 <opencv-path>/CMakeLists.txt \u6587\u4ef6\u4e0b\uff0c\u6709\uff1a OCV_OPTION(OPENCV_ENABLE_NONFREE \"Enable non-free algorithms\" OFF) \u5728 <opencv-path>/cmake/templates/ \u6587\u4ef6\u5939\u4e2d\u7684 opencv_modules.hpp.in \u6709\uff1a #cmakedefine OPENCV_ENABLE_NONFREE \u5982\u679c\u6211\u4eec\u901a\u8fc7 cmake-gui \u5c06 OPENCV_ENABLE_NONFREE \u4fee\u6539\u4e3a ON \uff0c\u90a3\u4e48\u53ef\u4ee5\u786e\u5b9a\uff0c\u4f1a\u751f\u6210\uff1a #define OPENCV_ENABLE_NONFREE","title":"2.3 \u4e0e option \u914d\u5408"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#24","text":"\u5728 \u6279\u91cf\u751f\u6210 \u4e00\u7cfb\u5217\u5b8f\u5b9a\u4e49\u53d8\u91cf\uff0c\u6216\u8005 \u751f\u6210\u4e0e\u8def\u5f84\u6709\u5173\u7684\u53d8\u91cf \u7684\u65f6\u5019\uff0c\u4f7f\u7528 configure_file \u662f\u5f88\u65b9\u4fbf\u7684\uff0c\u4f46\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u6216\u51e0\u4e2a\u7684\u5b8f\u5b9a\u4e49\u53d8\u91cf\uff0c\u90a3\u4e48\u4f7f\u7528 configure_file \u6765\u7ef4\u62a4\u4e00\u4e2a *.in \u6587\u4ef6\u5c06\u663e\u5f97\u5341\u5206\u5197\u6742\u3002","title":"2.4 \u4f7f\u7528\u573a\u666f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#3-cmake","text":"\u6b63\u5982\u4e0a\u8ff0\u4f7f\u7528\u573a\u666f\u6240\u8bf4\uff0c\u5355\u4e2a\u6216\u5c11\u91cf\u7684\u5b8f\u5b9a\u4e49\uff0c\u4f7f\u7528 configure_file \u5e76\u4e0d\u65b9\u4fbf\uff0c\u4e0b\u9762\u63d0\u4f9b\u51e0\u4e2a\u89e3\u51b3\u6b64\u95ee\u9898\u7684\u65b9\u6cd5\u3002","title":"3. CMake \u6dfb\u52a0\u9884\u5b9a\u4e49\u53d8\u91cf"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#31-add_definitions","text":"","title":"3.1 add_definitions"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#311","text":"add_definitions(-DXXX) \u5728 main.cpp \u4e2d\u5199\u5165 #include <iostream> using namespace std; #ifdef XXX inline void foo() { cout << \"this is XXX\" <<endl; } #endif // XXX #ifdef YYY inline void foo() { cout << \"this is YYY\" <<endl; } #endif // YYY int main(int argc, char *argv[]) { foo(); return 0; } \u7f16\u8bd1\u540e\uff0c\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b this is XXX \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c add_definitions \u751f\u6548\u7684\u6587\u4ef6\u4e3a\u5f53\u524d CMakeLists.txt \u6587\u4ef6\u4ee5\u53ca\u5b50\u76ee\u5f55\u7684 CMakeLists.txt \u6587\u4ef6\uff0c\u53ef\u7c7b\u6bd4\u53d8\u91cf\u7684\u4f5c\u7528\u57df\u3002\u5e76\u4e14\uff0c\u5bf9\u4e8e\u5176\u4e2d\u4e00\u4e2a CMakeLists.txt \u6587\u4ef6\uff0c\u5373\u4f7f\u5199\u6210 add_executable(demo main.cpp) add_definitions(-DXXX) \u5373\uff0c\u5728\u521b\u5efa\u53ef\u6267\u884c\u7a0b\u5e8f\u8fd9\u4e2a\u4e8c\u8fdb\u5236\u76ee\u6807\u4e4b\u540e\u518d\u4e66\u5199 add_definitions \uff0c\u8be5\u9884\u7f16\u8bd1\u5b8f\u5b9a\u4e49 \u4ecd\u7136\u80fd\u591f\u751f\u6548 \uff0c\u56e0\u4e3a\u8be5\u547d\u4ee4\u4f5c\u7528\u57df \u751f\u6210\u9636\u6bb5 \uff0c\u53ef\u53c2\u8003 \u301009\u3011\u751f\u6210\u5668\u8868\u8fbe\u5f0f \u3002\u6211\u4eec\u6682\u65f6\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3 \u8fd9\u4e00\u64cd\u4f5c\u7b49\u540c\u4e8e\u4f7f\u7528 g++ main.cpp -DXXX \u7684\u547d\u4ee4\u884c\u8fdb\u884c\u7f16\u8bd1 \u53ea\u8981\u6784\u5efa\u51fa\u7684\u76ee\u6807\uff08\u4e0a\u9762\u7684\u4f8b\u5b50\u662f demo \uff09\u6240\u5728\u7684\u4f5c\u7528\u57df\u4e2d\u5177\u6709\u9884\u7f16\u8bd1\u5b8f\u5b9a\u4e49 XXX \uff0c\u90a3\u4e48\u8be5\u5b8f\u5b9a\u4e49\u90fd\u80fd\u751f\u6548\uff08\u5373\u5168\u5c40\u751f\u6548\uff09\u3002","title":"3.1.1 \u7528\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#312-option","text":"\u5b9e\u9645\u4e0a\uff0c\u5bf9\u4e8e\u5168\u5c40\u751f\u6548\u7684 add_definitions \u6211\u4eec\u66f4\u591a\u7684\u662f\u5c06\u5176\u4e0e option \u547d\u4ee4\u7ed3\u5408\u8d77\u6765\u4f7f\u7528\uff0c\u53c2\u8003\u4e0b\u9762\u7684\u4ee3\u7801\uff1a # \u5b9a\u4e49\u4e8e <opencv-path>/CMakeLists.txt \u4e2d\u7684\u5185\u5bb9 OCV_OPTION(ENABLE_IMPL_COLLECTION \"xxx\" OFF ) # code if(ENABLE_IMPL_COLLECTION) add_definitions(-DCV_COLLECT_IMPL_DATA) endif() \u6211\u4eec\u53ea\u9700\u5728\u7ec8\u7aef\u4e2d\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9\uff0c\u5373\u53ef\u5b9e\u73b0\u8be5\u7f16\u8bd1\u9009\u9879\u7684\u5f00\u542f\uff0c\u5e76\u6dfb\u52a0\u5bf9\u5e94\u7684\u5b8f cmake -D ENABLE_IMPL_COLLECTION=ON ..","title":"3.1.2 \u4e0e option \u914d\u5408"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#313","text":"\u7531\u4e8e\u4e0a\u6587\u4e2d\u63d0\u5230 add_definitions \u7684\u751f\u6548\u673a\u5236\u4e0e CMake \u4e2d\u53d8\u91cf\u7684\u4f5c\u7528\u57df\u57fa\u672c\u4e00\u81f4\uff0c\u56e0\u6b64\u5728\u4e00\u4e2a CMakeLists.txt \u4e2d\u5982\u679c\u521b\u5efa\u591a\u4e2a\u76ee\u6807\uff0c\u90a3\u4e48\u8fd9\u4e9b\u76ee\u6807\u5747\u80fd\u4eab\u6709\u8fd9\u4e2a\u4f5c\u7528\u57df\u4e0b\u7684 add_definitions \u6240\u5e26\u6765\u7684\u6548\u679c\u4f7f\u7528 add_definitions \u6784\u5efa\u7684\u76ee\u6807\u3002\u5177\u4f53\u7684\u8bf4\uff0c\u5c31\u662f\u5728 \u5f53\u524d\u7684 CMakeLists.txt \u6587\u4ef6 \u5b50\u76ee\u5f55\uff08\u4f7f\u7528 add_subdirectory \u6240\u6dfb\u52a0\u7684\u6a21\u5757\uff09\u7684 CMakeLists.txt \u6587\u4ef6\u4e2d \u751f\u6548\uff0c\u4f8b\u5982\u4ee5\u4e0b\u7684\u5e03\u5c40\u3002 project: CMakeLists \u2502 \u2514\u2500\u2500 A: CMakeLists \u2502 \u251c\u2500\u2500 B: CMakeLists \u2502 \u2502 \u2502 \u2514\u2500\u2500 D: CMakeLists \u2502 \u2514\u2500\u2500 C: CMakeLists \u4f8b\u5982\uff0c\u5728 A \u76ee\u5f55\u4e2d\u4f7f\u7528 add_definitions \u5b9a\u4e49\u7684\u5185\u5bb9\uff0c\u5728 A \u3001 B \u3001 C \u3001 D \u76ee\u5f55\u4e2d\u5747\u751f\u6548\uff0c\u800c B \u4f7f\u7528 add_definitions \u5b9a\u4e49\u7684\u5185\u5bb9\u4ec5\u5728 B \u3001 D \u76ee\u5f55\u4e2d\u751f\u6548","title":"3.1.3 \u6ce8\u610f\u4e8b\u9879"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/06/#32-target_compile_definitions","text":"\u5728 \u301005\u3011\u76ee\u6807\u6784\u5efa - \u666e\u901a\u5e93\u76ee\u6807\u6784\u5efa \u4e2d\u63d0\u5230\u4e86 target_compile_definitions \u547d\u4ee4\uff0c\u8fd9\u4e5f\u662f\u76ee\u6807\u5c5e\u6027\u5f53\u4e2d \u201c\u4f7f\u7528\u8981\u6c42\u201d \u7684\u4e00\u90e8\u5206\u3002\u5728\u6dfb\u52a0\u9884\u5b9a\u4e49\u5b8f\u7684\u529f\u80fd\u4e0a\uff0c\u76f8\u6bd4\u4e8e add_definitions \uff0c target_compile_definitions \u5219\u66f4\u5177\u6709\u9488\u5bf9\u6027\uff0c\u5b83\u80fd\u660e\u786e\u7684\u6307\u5b9a\u662f\u54ea\u4e2a\u76ee\u6807\u5728\u6784\u5efa\u7684\u65f6\u5019\u5f15\u5165\u9884\u7f16\u8bd1\u5b8f\u3002\u4e0b\u9762\u9996\u5148\u7ed9\u51fa OpenCV \u4e2d\u7684\u4f8b\u5b50 # \u5b9a\u4e49\u4e8e <opencv-path>/cmake/OpenCVModule.cmake \u4e2d _ocv_create_module \u5b8f\u4e2d target_compile_definitions(${the_module} PRIVATE CVAPI_EXPORTS) \u5728 <opencv-path>/modules/core/src \u6587\u4ef6\u5939\u4e0b\u7684 system.cpp \u8fd9\u4e00\u6e90\u6587\u4ef6\uff0c\u6709\u5f15\u7528\u5230 CVAPI_EXPORTS \u7684\u5730\u65b9\uff1a #if defined CVAPI_EXPORTS && defined _WIN32 && !defined WINCE // ... #endif \u5b83\u4e3a\u6307\u5b9a\u7684\u6a21\u5757\u6dfb\u52a0\u9884\u7f16\u8bd1\u5b8f\uff0c\u4f7f\u5f97\u8be5\u5b8f\u4e0d\u4f1a\u88ab\u66b4\u9732\u7ed9\u975e\u6307\u5b9a\u7684\u76ee\u6807\uff0c\u56e0\u6b64\u4f1a\u5f88\u5b89\u5168\u3002\u5e76\u4e14\uff0c\u4e00\u822c\u8bbe\u7f6e\u4e3a PRIVATE \u7684\u9884\u7f16\u8bd1\u5b8f\u4e0d\u80fd\u88ab\u5176\u4f59\u5305\u542b\u8be5\u76ee\u6807\u7684\u5176\u4ed6\u76ee\u6807\u6240\u5171\u4eab\uff0c\u8fd9\u4e0e CMake \u76ee\u6807\u6784\u5efa\u65f6\u63a5\u89e6\u5230\u7684 target_include_directories \u4ee5\u53ca target_link_libraries \u7684\u7528\u6cd5\u7c7b\u4f3c\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ee5\u4e0b\u4ee3\u7801 target_compile_definitions( my_lib PUBLIC xxx ) \u53ef\u4ee5\u5b9e\u73b0\u5176\u4ed6\u76ee\u6807\u5728\u94fe\u63a5 my_lib \u8fd9\u4e2a\u76ee\u6807\u7684\u65f6\u5019\u540c\u6837\u4eab\u6709 xxx \u8fd9\u4e2a\u9884\u7f16\u8bd1\u5b8f\u5b9a\u4e49\u3002","title":"3.2 target_compile_definitions"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/","text":"\u301007\u3011\u5b8f\u4e0e\u51fd\u6570 \u6559\u5b66\u89c6\u9891 ::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili 1. \u524d\u8a00 \u6211\u4eec\u5047\u8bbe\u6709\u4ee5\u4e0b\u6587\u4ef6\u67b6\u6784\uff1a . \u251c\u2500\u2500 core1 \u2502 \u251c\u2500\u2500 CMakeLists.txt \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2514\u2500\u2500 core1.hpp \u2502 \u2514\u2500\u2500 src \u2502 \u251c\u2500\u2500 core1.cpp \u2502 \u251c\u2500\u2500 core_cal.cpp \u2502 \u2514\u2500\u2500 util.cpp \u2514\u2500\u2500 core2 \u251c\u2500\u2500 CMakeLists.txt \u251c\u2500\u2500 include \u2502 \u2514\u2500\u2500 core2.hpp \u2514\u2500\u2500 src \u251c\u2500\u2500 core2.cpp \u251c\u2500\u2500 core_cal.cpp \u2514\u2500\u2500 util.cpp \u4e24\u4e2a\u6a21\u5757\uff0c\u540c\u6837\u7684\u67b6\u6784\uff0c\u56e0\u6b64\u9700\u8981\u540c\u6837\u7684\u6784\u5efa\u65b9\u5f0f\uff0c\u5047\u8bbe core1 \u4f9d\u8d56 OpenCV\uff0c\u5047\u8bbe core2 \u4f9d\u8d56 core1 \uff1a # core1/CMakeLists.txt \u90e8\u5206\u5185\u5bb9 find_package(OpenCV REQUIRED) aux_source_directory(src core1_dir) add_library( core1 SHARED ${core1_dir} ) target_include_directories( core1 PUBLIC include ) target_link_libraries( core1 PUBLIC ${OpenCV_LIBS} ) # core2/CMakeLists.txt \u90e8\u5206\u5185\u5bb9 aux_source_directory(src core2_dir) add_library( core2 SHARED ${core2_dir} ) target_include_directories( core2 PUBLIC include ) target_link_libraries( core2 PUBLIC core1 ) \u53ef\u4ee5\u770b\u51fa\uff0c\u4e0a\u9762\u4e00\u6bb5 CMakeLists.txt \u7684\u4ee3\u7801\u91cd\u590d\u7387\u6bd4\u8f83\u9ad8\uff0c\u6bcf\u6b21\u521b\u5efa\u5e93\u76ee\u6807\u90fd\u662f\u51e0\u4e4e\u4e00\u6837\u7684\u64cd\u4f5c\uff0c\u4e3a\u6b64\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b8f\u3001\u51fd\u6570\u64cd\u4f5c\u3002\u8fd9\u6837\u53ef\u4ee5\u4f7f\u5f97\u6784\u5efa\u64cd\u4f5c\u7f29\u77ed\u81f3\u51e0\u884c\uff0c\u4f8b\u5982 OpenCV \u7684 core \u6a21\u5757\uff1a ocv_add_module(core OPTIONAL opencv_cudev WRAP java objc python js) \u5176\u4e2d\uff0c ocv_add_module \u5c31\u662f OpenCV \u5b9a\u4e49\u4e8e OpenCVModule.cmake \u6587\u4ef6\u4e2d\u7684\u5b8f\u3002 \u5bf9\u4e8e\u4e0a\u8ff0\u4f8b\u5b50\u6211\u4eec\u5148\u7ed9\u51fa\u7ed3\u679c\uff0c\u5982\u679c\u6211\u4eec\u521b\u5efa\u4e86\u8fd9\u6837\u4e00\u4e2a\u5b8f macro(add_module name) # \u53c2\u6570\u89e3\u6790 set(multy_args DEP_LIBS) cmake_parse_arguments(MOD \"\" \"\" \"${multy_args}\" ${ARGN}) # \u521b\u5efa target aux_source_directory(src _src_dir) add_library(${name} SHARED ${_src_dir}) # \u8bbe\u7f6e target \u5c5e\u6027 target_include_directories(${name} PUBLIC include) target_link_libraries(${name} PUBLIC ${MOD_DEP_LIBS}) unset(_src_dir) endmacro() \u6211\u4eec\u5c31\u53ef\u4ee5\u6539\u5199\u6210\u4ee5\u4e0b\u5f62\u5f0f # core1/CMakeLists.txt \u90e8\u5206\u5185\u5bb9 find_package(OpenCV REQUIRED) add_module( core1 DEP_LIBS ${OpenCV_LIBS} ) # core2/CMakeLists.txt \u90e8\u5206\u5185\u5bb9 add_module( core2 DEP_LIBS core1 ) \u8fd9\u79cd\u60c5\u51b5\u4e0d\u4ec5\u51cf\u5c11\u4e86\u4e66\u5199\u96be\u5ea6\uff0c\u8fd8\u63d0\u9ad8\u4e86\u53ef\u8bfb\u6027\u3002 2. \u5b8f\u3001\u51fd\u6570 2.1 \u51fd\u6570\u57fa\u672c\u7528\u6cd5 2.1.1 \u5b9a\u4e49 function(my_func) # function endfunction() 2.1.2 \u8c03\u7528 \u51fd\u6570\u8c03\u7528\u7684\u51fd\u6570\u540d\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u4e0d\u8fc7\u901a\u5e38\u5728 CMake \u4e2d\u51fd\u6570\u540d\u5efa\u8bae\u5199\u5c0f\u5199\u3002 my_func() # \u53ef\u4ee5 MY_FUNC() # \u53ef\u4ee5 mY_fUnC() # \u6709\u4e9b\u9006\u5929\uff0c\u4f46\u4e5f\u53ef\u4ee5 \u9664\u6b64\u4e4b\u5916\uff0c\u4e00\u4e2a\u51fd\u6570\u8fd8\u6253\u5f00\u4e00\u4e2a\u65b0\u7684\u4f5c\u7528\u57df\uff0c\u8fd9\u70b9\u4e0eC/C++\u4e00\u81f4\u3002\u540c\u6837\uff0c\u4f7f\u7528 set(xxx PARENT_SCOPE) \u53ef\u4ee5\u63d0\u5347\u53d8\u91cf\u4f5c\u7528\u57df\u3002 CMake 3.18 \u8d77\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 cmake_language(CALL ...) \u5b50\u547d\u4ee4\u6765\u8c03\u7528\u51fd\u6570\uff0c\u53ef\u4ee5\u53c2\u8003 \u5b98\u65b9\u624b\u518c \uff1a function(my_foo x1 x2) message(STATUS \"x1 = ${x1}, x2 = ${x2}\") endfunction() cmake_language(CALL my_foo 2 7) 2.1.3 \u53c2\u6570 \u4f7f\u7528\u5f62\u53c2 \u5f53\u51fd\u6570\u88ab\u8c03\u7528\u65f6\uff0c\u9996\u5148\u901a\u8fc7\u5b9e\u53c2\u66ff\u6362\u5f62\u53c2 \uff0c\u7136\u540e\u4f5c\u4e3a\u666e\u901a\u547d\u4ee4\u8c03\u7528\u3002 function(my_foo x1 x2 x3) message(STATUS \"x1 = ${x1}, x2 = ${x2}, x3 = ${x3}\") endfunction() my_foo(2 7 4) # \u663e\u793a\u7ed3\u679c # -- x1 = 2, x2 = 7, x3 = 4 \u4f7f\u7528 ARGC\u3001ARGVn \u9664\u4e86\u5f15\u7528\u5f62\u53c2\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u5f15\u7528 ARGC \u53d8\u91cf \u548c ARGVn \u53d8\u91cf\u6765\u5f15\u7528\u53c2\u6570\uff0c ARGC \u8868\u793a\u53c2\u6570\u6570\u91cf\uff0c\u4ee5\u53ca ARGV0, ARGV1, ARGV2, ... \u5c06\u5177\u6709\u4f20\u5165\u53c2\u6570\u7684\u503c\uff0c\u6709\u52a9\u4e8e\u521b\u5efa\u5e26\u6709\u53ef\u9009\u53c2\u6570\u7684\u51fd\u6570\u3002\u540c\u65f6 ARGV \u4fdd\u5b58\u4e86\u6240\u6709\u7684\u53c2\u6570\u5217\u8868 function(my_foo) message(STATUS \"ARGC = ${ARGC}\") message(STATUS \"x1 = ${ARGV0}, x2 = ${ARGV1}, x3 = ${ARGV2}\") endfunction() my_foo(2 7 4) # \u663e\u793a\u7ed3\u679c # -- ARGC = 3 # -- x1 = 2, x2 = 7, x3 = 4 \u4f7f\u7528 ARGN \u6b64\u5916\uff0c ARGN \u53d8\u91cf\u4fdd\u5b58\u8d85\u8fc7\u5f62\u53c2\u5217\u8868\u4e4b\u540e\u7684\u53c2\u6570\u3002\u5982\u679c\u5b9e\u53c2\u6570\u91cf\u5927\u4e8e\u5f62\u53c2\u6570\u91cf\uff0c\u7528 ARGN \u53d8\u91cf\u5f15\u7528\u9884\u671f\u4e4b\u5916\u7684\u53c2\u6570\u3002 function(my_foo x1) message(STATUS \"x1 = ${x1}\") message(STATUS \"ARGN = ${ARGN}\") endfunction() # \u8c03\u7528\uff0c\u6267\u884c\u4e86 set(x1 2)... \u7684\u64cd\u4f5c my_foo(2 7 4) # \u663e\u793a\u7ed3\u679c # -- x1 = 2 # -- ARGN = 7;4 \u5f62\u53c2\u4e3a\u53d8\u91cf \u4ee5\u4e0a\u7684\u4f8b\u5b50\u4e2d\uff0c\u53c2\u6570\u90fd\u4e3a\u5177\u4f53\u7684\u503c\uff0c\u4f8b\u5982 2, 7, 4 \uff0c\u90a3\u4e48\u53d8\u91cf\u53d6\u503c\u7684\u8bed\u6cd5 ${} \u4f5c\u7528\u4e8e\u53c2\u6570\uff0c\u83b7\u53d6\u5230\u7684\u5c31\u662f\u5177\u4f53\u7684\u503c\u3002\u5982\u679c\u53c2\u6570\u4e3a\u53d8\u91cf\u7684\u8bdd\uff0c\u90a3\u4e48 ${} \u83b7\u53d6\u5230\u7684\u53c2\u6570\u5185\u5bb9\u5c31\u662f\u53d8\u91cf\u8fd9\u4e2a\u5b57\u7b26\u4e32\uff0c\u8981\u60f3\u83b7\u53d6\u503c\u7684\u8bdd\u5c31\u8981\u4f7f\u7528 ${${}} \u3002 set(a1 10) function(foo val) message(STATUS \"val, ${val}, ${${val}}\") endfunction() foo(a1) # \u663e\u793a\u7ed3\u679c # -- val, a1, 10 2.2 \u5b8f\u7684\u57fa\u672c\u7528\u6cd5 \u5b8f\u4e0e\u51fd\u6570\u6700\u5927\u7684\u533a\u522b\u5c31\u662f\uff0c\u5b8f\u4e0d\u4f1a\u521b\u5efa\u65b0\u7684\u4f5c\u7528\u57df\uff0c\u800c\u662f\u5355\u7eaf\u7684\u53d1\u751f\u4e86\u6587\u672c\u66ff\u6362\uff0c\u8fd9\u4e0eC/C++\u5b8c\u5168\u4e00\u81f4 2.2.1 \u5b9a\u4e49 macro(myFun) # macro endmacro() 2.2.2 \u8c03\u7528 \u4e0e\u51fd\u6570\u4e00\u6837\uff0c\u5b8f\u5728\u8c03\u7528\u65f6\u4e5f\u53ef\u4ee5\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u4f46\u540c\u6837\u5efa\u8bae\u4f7f\u7528\u5c0f\u5199\u3002 CMake 3.18 \u8d77\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 cmake_language(CALL ...) \u5b50\u547d\u4ee4\u6765\u8c03\u7528\u5b8f\uff1a cmake macro(my_foo x1 x2) message(STATUS \"x1 = ${x1}, x2 = ${x2}\") endmacro() cmake_language(CALL my_foo 2 7) 2.2.3 \u53c2\u6570 \u4e0e\u51fd\u6570\u4e00\u6837\uff0c\u540c\u6837\u53ef\u4ee5\u8bbe\u7f6e\u53c2\u6570\uff0c\u4e5f\u540c\u65f6\u5177\u5907 ARGC \u3001 ARGV \u3001 ARGVx \u3001 ARGN \u7684\u53c2\u6570\uff0c\u5982\u679c\u8fd9\u4e9b\u53c2\u6570\u5728\u5b8f\u5185\u90e8 \u8fdb\u884c\u5f15\u7528 \uff0c\u8c03\u7528\u8be5\u5b8f\u7684\u65f6\u5019\uff0c\u8fd9\u4e9b\u5185\u5bb9\u4f1a\u53d1\u751f\u66ff\u6362\uff0c\u4f8b\u5982 macro(my_macro xx) message(STATUS \"xx = ${xx}\") # \u8fd9\u91cc\u7684 ${xx} \u4f1a\u88ab\u76f4\u63a5\u66ff\u6362\u4e3a aa message(STATUS \"ARGC = ${ARGC}\") # \u8fd9\u91cc\u7684 ${ARGC} \u4f1a\u88ab\u76f4\u63a5\u66ff\u6362\u4e3a 3 message(STATUS \"ARGV = ${ARGV}\") # \u8fd9\u91cc\u7684 ${ARGV} \u4f1a\u88ab\u76f4\u63a5\u66ff\u6362\u4e3a aa;bb;cc endmacro() my_macro(aa bb cc) # \u6253\u5370\u7ed3\u679c # -- xx = aa # -- ARGC = 3 # -- ARGV = aa;bb;cc 2.3 \u51fd\u6570\u4e0e\u5b8f\u7684\u533a\u522b \u5b8f\u4e0d\u4f1a\u5f00\u8f9f\u65b0\u7684\u4f5c\u7528\u57df\uff0c\u56e0\u6b64\u5728\u5b8f\u5185\u90e8\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u5c06\u5728\u5916\u90e8\u7ee7\u7eed\u751f\u6548 ```cmake macro(test) set(val \"666\") endmacro() set(val \"123\") message(\"val = ${val}\") test() message(\"val = ${val}\") # \u6253\u5370\u7ed3\u679c # -- val = 123 # -- val = 666 ``` \u8fd9\u4e00\u70b9\u5728\u51fd\u6570\u5c31\u4e0d\u4f1a\u51fa\u73b0\uff0c\u5185\u90e8\u8bbe\u7f6e\u7684\u53d8\u91cf\u4e00\u822c\u65e0\u6cd5\u8986\u76d6\u5916\u90e8\u7684\u53d8\u91cf\uff0c\u4f46\u5982\u679c\u9700\u8981\u8986\u76d6\uff0c\u53ef\u4ee5\u4f7f\u7528 PARENT_SCOPE \u63d0\u5347\u4f5c\u7528\u57df\u3002 \u5b8f\u5728\u88ab\u8c03\u7528\u7684\u8303\u56f4\u5185\u6709\u4e00\u4e2a\u540c\u540d\u7684\u53d8\u91cf\uff0c\u5c06\u4f7f\u7528\u73b0\u6709\u53d8\u91cf\u800c\u4e0d\u662f\u53c2\u6570\u3002 ```cmake macro(aaa) # \u8fd9\u91cc\u7684 ${ARGN} \u5728\u8c03\u7528\u65f6\u4f1a\u53d1\u751f\u66ff\u6362\uff0c\u66ff\u6362\u4e3a x;y;z foreach(m ${ARGN}) message(STATUS \"m = ${m}\") endforeach() message(STATUS \"================\") # \u8fd9\u91cc\u7684 ARGN \u6ca1\u6709\u5f15\u7528\uff0c\u5728\u8c03\u7528\u65f6\u4e0d\u4f1a\u53d1\u751f\u66ff\u6362 foreach(m IN LISTS ARGN) message(STATUS \"m = ${m}\") endforeach() endmacro() function(bbb) aaa(x y z) endfunction() bbb(a b c) # \u6253\u5370\u7ed3\u679c # -- m = x # -- m = y # -- m = z # -- ================ # -- m = a # -- m = b # -- m = c ``` \u8fd9\u91cc\u7684 ARGN \u5176\u5b9e\u6307\u4ee3\u7684\u662f\u51fd\u6570\u4e2d\u7684 ARGN 3. \u53c2\u6570\u89e3\u6790 \u7ecf\u5e38\u89c1\u5230\u4ee5\u4e0b\u547d\u4ee4\uff1a # \u6848\u4f8b 1 target_include_directories( MyLib PUBLIC include PRIVATE _deps ) # \u6848\u4f8b 2 execute_process( COMMAND ls ${current_dir} OUTPUT_VARIABLE subs ) \u8fd9\u4e9b\u5185\u7f6e\u7684\u51fd\u6570\u548c\u5b8f\u53ef\u4ee5\u5bf9\u4ee5\u4e0a\u7684 include \u3001 _deps \u548c ls ${current_dir} \u7b49\u5185\u5bb9\u8fdb\u884c\u89e3\u6790\uff0c\u5982\u679c\u6211\u4eec\u81ea\u5df1\u5199\u7684\u51fd\u6570\u6216\u5b8f\uff0c\u8981\u5982\u4f55\u5b9e\u73b0\u8fd9\u79cd\u53c2\u6570\u89e3\u6790\u7684\u529f\u80fd\uff1f\u8fd9\u91cc\u8981\u4ecb\u7ecd\u4e00\u4e2a CMake \u5185\u7f6e\u7684\u547d\u4ee4\uff1a cmake_parse_arguments() 3.1 \u7528\u6cd5 \u6709\u4e24\u4e2a\u5177\u4f53\u7684\u7528\u6cd5\uff1a cmake_parse_arguments(<prefix> <options> <one_value_keywords> <multi_value_keywords> <args>...) cmake_parse_arguments(PARSE_ARGV <N> <prefix> <options> <one_value_keywords> <multi_value_keywords>) \u901a\u5e38\u4f7f\u7528\u7b2c\u4e00\u4e2a\u7528\u6cd5\uff0c\u7b2c\u4e8c\u4e2a\u7528\u6cd5\u6574\u4f53\u4e0e\u7b2c\u4e00\u4e2a\u7c7b\u4f3c\uff0c\u6709\u5174\u8da3\u8005\u53ef\u4ee5\u53c2\u8003CMake\u5b98\u7f51\u3002\u4e0b\u9762\u4e3b\u8981\u5bf9\u7b2c\u4e00\u4e2a\u7528\u6cd5\u505a\u8bb2\u89e3\u3002 <options> \uff1a\u8868\u793a\u53ef\u9009\u5173\u952e\u8bcd\u5217\u8868\uff0c\u5982\u679c\u4f20\u5165\u53c2\u6570\u5305\u542b\u6b64\u53d8\u91cf\u540d\uff0c\u5219\u4e3a TRUE \uff0c\u53cd\u4e4b\u4e3a FALSE \u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u5e38\u89c1\u7684 INTERFACE \uff0c PUBLIC \uff0c PRIVATE \u90fd\u662f target_include_directories \u51fd\u6570\u4e2d\u53ef\u9009\u5173\u952e\u5b57\u5217\u8868\u4e2d\u7684\u5143\u7d20\u3002 cmake set(options INTERFACE PUBLIC PRIVATE) cmake_parse_arguments(xxx \"${options}\" \"\" \"\" ${ARGN}) <one_value_keywords> \uff1a\u8868\u793a\u5355\u503c\u5173\u952e\u8bcd\u5217\u8868\uff0c\u6bcf\u4e2a\u5173\u952e\u8bcd\u4ec5\u5bf9\u5e94\u4e00\u4e2a\u503c\u3002 <multi_value_keywords> \uff1a\u8868\u793a\u591a\u503c\u5173\u952e\u8bcd\u5217\u8868\uff0c\u6bcf\u4e2a\u5173\u952e\u8bcd\u53ef\u5bf9\u5e94\u591a\u4e2a\u503c\u3002 ::: tip 1. \u5b9e\u9645\u4e0a\uff0c\u80fd\u7528 <one_value_keywords> \u7684\u90fd\u80fd\u7528 <multi_value_keywords> \u3002 2. \u8981\u89e3\u6790\u7684\u53c2\u6570 <args>... \uff0c\u6211\u4eec\u4e00\u822c\u4f20\u5165\u4e3a ${ARGN} \u5373\u53ef\uff0c\u4e00\u822c\u5b9a\u4e49\u7684\u51fd\u6570\u6216\u5b8f\u662f\u65e0\u53c2\u7684\uff0c\u9664\u975e\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e0d\u662f\u5173\u952e\u8bcd\uff0c\u90a3\u4e48\u6709\u591a\u5c11\u975e\u5173\u952e\u8bcd\u53d8\u91cf\uff0c\u5b9a\u4e49\u591a\u5c11\u5f62\u53c2\u3002 ::: \u4e3e\u4e2a\u4f8b\u5b50 ```cmake function(my_function) set(multi_args YYY ZZZ) cmake_parse_arguments(\"ABC\" \"\" \"\" \"${multi_args}\" ${ARGN}) message(STATUS \"YYY: ${ABC_YYY}\") message(STATUS \"ZZZ: ${ABC_ZZZ}\") endfunction() my_function( YYY 123 456 789 ZZZ abc ) # \u6253\u5370\u7ed3\u679c # -- YYY: 123;456;789 # -- ZZZ: abc ``` prefix \uff1a\u6211\u4eec\u5c06\u53c2\u6570 ${ARGN} \u6839\u636e <options> \uff0c <one_value_keywords> \uff0c <multi_value_keywords> \u89c4\u5219\u8fdb\u884c\u89e3\u6790\uff0c\u89e3\u6790\u51fa\u6765\u7684\u65b0\u53d8\u91cf\u540d\u6839\u636e <prefix> \u524d\u7f00\uff0c\u6309\u7167 prefix_\u53c2\u6570\u540d \u7684\u5f62\u5f0f\u8fdb\u884c\u8bbe\u7f6e\uff0c\u4f8b\u5982\uff1a cmake set(options INTERFACE PUBLIC PRIVATE) set(multy_args DEPENDS) cmake_parse_arguments(ABC \"${options}\" \"\" \"${multy_args}\" ${ARGN}) # \u8bbf\u95ee options \u7684\u5185\u5bb9\u662f\u5426\u4e3a ON if(${ABC_INTERFACE}) # ABC_ \u524d\u7f00 elseif(${ABC_PUBLIC}) # ABC_ \u524d\u7f00 elseif(${ABC_PRIVATE}) # ABC_ \u524d\u7f00 endif() # \u8bbf\u95ee multy_args \u7684\u5185\u5bb9 message(STATUS \"${ABC_DEPENDS}\") # ABC_ \u524d\u7f00 3.2 \u6848\u4f8b \u6700\u540e\uff0c\u6765\u770b RMVL \u4e2d\u4f7f\u7528\u6709\u5173\u6dfb\u52a0\u6d4b\u8bd5\u7528\u4f8b\u7684\u5b8f\u6765\u505a\u5de9\u56fa\uff1a # \u5728\u5f53\u524d\u76ee\u5f55\u4e2d\u6dfb\u52a0\u65b0\u7684\u6d4b\u8bd5\u7528\u4f8b # \u7528\u6cd5: # rmvl_add_test( # <name> # [DEPENDS <rmvl_target>] # [DEPEND_TESTS <test_target>] # ) # \u793a\u4f8b: # rmvl_add_test( # detector # \u6d4b\u8bd5\u540d # DEPENDS armor_detector # \u9700\u8981\u4f9d\u8d56\u7684 RMVL \u76ee\u6807\u5e93 # DEPEND_TESTS GTest::gtest_main # \u9700\u8981\u4f9d\u8d56\u7684\u7b2c\u4e09\u65b9\u6d4b\u8bd5\u5de5\u5177\u76ee\u6807\u5e93 # ) macro(rmvl_add_test _name) # add arguments variable set(multy_args DEPENDS DEPEND_TESTS) cmake_parse_arguments(TEST \"\" \"\" \"${multy_args}\" ${ARGN}) # add testing executable set(test_dir) aux_source_directory(test test_dir) add_executable(rmvl_${_name}_test ${test_dir}) # depends foreach(_dep ${TEST_DEPENDS}) target_link_libraries( rmvl_${_name}_test PRIVATE rmvl_${_dep} ) endforeach(_dep ${TEST_DEPENDS}) # test depends target_link_libraries( rmvl_${_name}_test PRIVATE ${TEST_DEPEND_TESTS} ) gtest_discover_tests(rmvl_${_name}_test) endmacro(rmvl_add_test _name)","title":"\u301007\u3011\u5b8f\u4e0e\u51fd\u6570"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#07","text":"","title":"\u301007\u3011\u5b8f\u4e0e\u51fd\u6570"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#_1","text":"::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#1","text":"\u6211\u4eec\u5047\u8bbe\u6709\u4ee5\u4e0b\u6587\u4ef6\u67b6\u6784\uff1a . \u251c\u2500\u2500 core1 \u2502 \u251c\u2500\u2500 CMakeLists.txt \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2514\u2500\u2500 core1.hpp \u2502 \u2514\u2500\u2500 src \u2502 \u251c\u2500\u2500 core1.cpp \u2502 \u251c\u2500\u2500 core_cal.cpp \u2502 \u2514\u2500\u2500 util.cpp \u2514\u2500\u2500 core2 \u251c\u2500\u2500 CMakeLists.txt \u251c\u2500\u2500 include \u2502 \u2514\u2500\u2500 core2.hpp \u2514\u2500\u2500 src \u251c\u2500\u2500 core2.cpp \u251c\u2500\u2500 core_cal.cpp \u2514\u2500\u2500 util.cpp \u4e24\u4e2a\u6a21\u5757\uff0c\u540c\u6837\u7684\u67b6\u6784\uff0c\u56e0\u6b64\u9700\u8981\u540c\u6837\u7684\u6784\u5efa\u65b9\u5f0f\uff0c\u5047\u8bbe core1 \u4f9d\u8d56 OpenCV\uff0c\u5047\u8bbe core2 \u4f9d\u8d56 core1 \uff1a # core1/CMakeLists.txt \u90e8\u5206\u5185\u5bb9 find_package(OpenCV REQUIRED) aux_source_directory(src core1_dir) add_library( core1 SHARED ${core1_dir} ) target_include_directories( core1 PUBLIC include ) target_link_libraries( core1 PUBLIC ${OpenCV_LIBS} ) # core2/CMakeLists.txt \u90e8\u5206\u5185\u5bb9 aux_source_directory(src core2_dir) add_library( core2 SHARED ${core2_dir} ) target_include_directories( core2 PUBLIC include ) target_link_libraries( core2 PUBLIC core1 ) \u53ef\u4ee5\u770b\u51fa\uff0c\u4e0a\u9762\u4e00\u6bb5 CMakeLists.txt \u7684\u4ee3\u7801\u91cd\u590d\u7387\u6bd4\u8f83\u9ad8\uff0c\u6bcf\u6b21\u521b\u5efa\u5e93\u76ee\u6807\u90fd\u662f\u51e0\u4e4e\u4e00\u6837\u7684\u64cd\u4f5c\uff0c\u4e3a\u6b64\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b8f\u3001\u51fd\u6570\u64cd\u4f5c\u3002\u8fd9\u6837\u53ef\u4ee5\u4f7f\u5f97\u6784\u5efa\u64cd\u4f5c\u7f29\u77ed\u81f3\u51e0\u884c\uff0c\u4f8b\u5982 OpenCV \u7684 core \u6a21\u5757\uff1a ocv_add_module(core OPTIONAL opencv_cudev WRAP java objc python js) \u5176\u4e2d\uff0c ocv_add_module \u5c31\u662f OpenCV \u5b9a\u4e49\u4e8e OpenCVModule.cmake \u6587\u4ef6\u4e2d\u7684\u5b8f\u3002 \u5bf9\u4e8e\u4e0a\u8ff0\u4f8b\u5b50\u6211\u4eec\u5148\u7ed9\u51fa\u7ed3\u679c\uff0c\u5982\u679c\u6211\u4eec\u521b\u5efa\u4e86\u8fd9\u6837\u4e00\u4e2a\u5b8f macro(add_module name) # \u53c2\u6570\u89e3\u6790 set(multy_args DEP_LIBS) cmake_parse_arguments(MOD \"\" \"\" \"${multy_args}\" ${ARGN}) # \u521b\u5efa target aux_source_directory(src _src_dir) add_library(${name} SHARED ${_src_dir}) # \u8bbe\u7f6e target \u5c5e\u6027 target_include_directories(${name} PUBLIC include) target_link_libraries(${name} PUBLIC ${MOD_DEP_LIBS}) unset(_src_dir) endmacro() \u6211\u4eec\u5c31\u53ef\u4ee5\u6539\u5199\u6210\u4ee5\u4e0b\u5f62\u5f0f # core1/CMakeLists.txt \u90e8\u5206\u5185\u5bb9 find_package(OpenCV REQUIRED) add_module( core1 DEP_LIBS ${OpenCV_LIBS} ) # core2/CMakeLists.txt \u90e8\u5206\u5185\u5bb9 add_module( core2 DEP_LIBS core1 ) \u8fd9\u79cd\u60c5\u51b5\u4e0d\u4ec5\u51cf\u5c11\u4e86\u4e66\u5199\u96be\u5ea6\uff0c\u8fd8\u63d0\u9ad8\u4e86\u53ef\u8bfb\u6027\u3002","title":"1. \u524d\u8a00"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#2","text":"","title":"2. \u5b8f\u3001\u51fd\u6570"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#21","text":"","title":"2.1 \u51fd\u6570\u57fa\u672c\u7528\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#211","text":"function(my_func) # function endfunction()","title":"2.1.1 \u5b9a\u4e49"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#212","text":"\u51fd\u6570\u8c03\u7528\u7684\u51fd\u6570\u540d\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u4e0d\u8fc7\u901a\u5e38\u5728 CMake \u4e2d\u51fd\u6570\u540d\u5efa\u8bae\u5199\u5c0f\u5199\u3002 my_func() # \u53ef\u4ee5 MY_FUNC() # \u53ef\u4ee5 mY_fUnC() # \u6709\u4e9b\u9006\u5929\uff0c\u4f46\u4e5f\u53ef\u4ee5 \u9664\u6b64\u4e4b\u5916\uff0c\u4e00\u4e2a\u51fd\u6570\u8fd8\u6253\u5f00\u4e00\u4e2a\u65b0\u7684\u4f5c\u7528\u57df\uff0c\u8fd9\u70b9\u4e0eC/C++\u4e00\u81f4\u3002\u540c\u6837\uff0c\u4f7f\u7528 set(xxx PARENT_SCOPE) \u53ef\u4ee5\u63d0\u5347\u53d8\u91cf\u4f5c\u7528\u57df\u3002 CMake 3.18 \u8d77\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 cmake_language(CALL ...) \u5b50\u547d\u4ee4\u6765\u8c03\u7528\u51fd\u6570\uff0c\u53ef\u4ee5\u53c2\u8003 \u5b98\u65b9\u624b\u518c \uff1a function(my_foo x1 x2) message(STATUS \"x1 = ${x1}, x2 = ${x2}\") endfunction() cmake_language(CALL my_foo 2 7)","title":"2.1.2 \u8c03\u7528"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#213","text":"\u4f7f\u7528\u5f62\u53c2 \u5f53\u51fd\u6570\u88ab\u8c03\u7528\u65f6\uff0c\u9996\u5148\u901a\u8fc7\u5b9e\u53c2\u66ff\u6362\u5f62\u53c2 \uff0c\u7136\u540e\u4f5c\u4e3a\u666e\u901a\u547d\u4ee4\u8c03\u7528\u3002 function(my_foo x1 x2 x3) message(STATUS \"x1 = ${x1}, x2 = ${x2}, x3 = ${x3}\") endfunction() my_foo(2 7 4) # \u663e\u793a\u7ed3\u679c # -- x1 = 2, x2 = 7, x3 = 4 \u4f7f\u7528 ARGC\u3001ARGVn \u9664\u4e86\u5f15\u7528\u5f62\u53c2\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u5f15\u7528 ARGC \u53d8\u91cf \u548c ARGVn \u53d8\u91cf\u6765\u5f15\u7528\u53c2\u6570\uff0c ARGC \u8868\u793a\u53c2\u6570\u6570\u91cf\uff0c\u4ee5\u53ca ARGV0, ARGV1, ARGV2, ... \u5c06\u5177\u6709\u4f20\u5165\u53c2\u6570\u7684\u503c\uff0c\u6709\u52a9\u4e8e\u521b\u5efa\u5e26\u6709\u53ef\u9009\u53c2\u6570\u7684\u51fd\u6570\u3002\u540c\u65f6 ARGV \u4fdd\u5b58\u4e86\u6240\u6709\u7684\u53c2\u6570\u5217\u8868 function(my_foo) message(STATUS \"ARGC = ${ARGC}\") message(STATUS \"x1 = ${ARGV0}, x2 = ${ARGV1}, x3 = ${ARGV2}\") endfunction() my_foo(2 7 4) # \u663e\u793a\u7ed3\u679c # -- ARGC = 3 # -- x1 = 2, x2 = 7, x3 = 4 \u4f7f\u7528 ARGN \u6b64\u5916\uff0c ARGN \u53d8\u91cf\u4fdd\u5b58\u8d85\u8fc7\u5f62\u53c2\u5217\u8868\u4e4b\u540e\u7684\u53c2\u6570\u3002\u5982\u679c\u5b9e\u53c2\u6570\u91cf\u5927\u4e8e\u5f62\u53c2\u6570\u91cf\uff0c\u7528 ARGN \u53d8\u91cf\u5f15\u7528\u9884\u671f\u4e4b\u5916\u7684\u53c2\u6570\u3002 function(my_foo x1) message(STATUS \"x1 = ${x1}\") message(STATUS \"ARGN = ${ARGN}\") endfunction() # \u8c03\u7528\uff0c\u6267\u884c\u4e86 set(x1 2)... \u7684\u64cd\u4f5c my_foo(2 7 4) # \u663e\u793a\u7ed3\u679c # -- x1 = 2 # -- ARGN = 7;4 \u5f62\u53c2\u4e3a\u53d8\u91cf \u4ee5\u4e0a\u7684\u4f8b\u5b50\u4e2d\uff0c\u53c2\u6570\u90fd\u4e3a\u5177\u4f53\u7684\u503c\uff0c\u4f8b\u5982 2, 7, 4 \uff0c\u90a3\u4e48\u53d8\u91cf\u53d6\u503c\u7684\u8bed\u6cd5 ${} \u4f5c\u7528\u4e8e\u53c2\u6570\uff0c\u83b7\u53d6\u5230\u7684\u5c31\u662f\u5177\u4f53\u7684\u503c\u3002\u5982\u679c\u53c2\u6570\u4e3a\u53d8\u91cf\u7684\u8bdd\uff0c\u90a3\u4e48 ${} \u83b7\u53d6\u5230\u7684\u53c2\u6570\u5185\u5bb9\u5c31\u662f\u53d8\u91cf\u8fd9\u4e2a\u5b57\u7b26\u4e32\uff0c\u8981\u60f3\u83b7\u53d6\u503c\u7684\u8bdd\u5c31\u8981\u4f7f\u7528 ${${}} \u3002 set(a1 10) function(foo val) message(STATUS \"val, ${val}, ${${val}}\") endfunction() foo(a1) # \u663e\u793a\u7ed3\u679c # -- val, a1, 10","title":"2.1.3 \u53c2\u6570"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#22","text":"\u5b8f\u4e0e\u51fd\u6570\u6700\u5927\u7684\u533a\u522b\u5c31\u662f\uff0c\u5b8f\u4e0d\u4f1a\u521b\u5efa\u65b0\u7684\u4f5c\u7528\u57df\uff0c\u800c\u662f\u5355\u7eaf\u7684\u53d1\u751f\u4e86\u6587\u672c\u66ff\u6362\uff0c\u8fd9\u4e0eC/C++\u5b8c\u5168\u4e00\u81f4","title":"2.2 \u5b8f\u7684\u57fa\u672c\u7528\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#221","text":"macro(myFun) # macro endmacro()","title":"2.2.1 \u5b9a\u4e49"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#222","text":"\u4e0e\u51fd\u6570\u4e00\u6837\uff0c\u5b8f\u5728\u8c03\u7528\u65f6\u4e5f\u53ef\u4ee5\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0c\u4f46\u540c\u6837\u5efa\u8bae\u4f7f\u7528\u5c0f\u5199\u3002 CMake 3.18 \u8d77\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 cmake_language(CALL ...) \u5b50\u547d\u4ee4\u6765\u8c03\u7528\u5b8f\uff1a cmake macro(my_foo x1 x2) message(STATUS \"x1 = ${x1}, x2 = ${x2}\") endmacro() cmake_language(CALL my_foo 2 7)","title":"2.2.2 \u8c03\u7528"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#223","text":"\u4e0e\u51fd\u6570\u4e00\u6837\uff0c\u540c\u6837\u53ef\u4ee5\u8bbe\u7f6e\u53c2\u6570\uff0c\u4e5f\u540c\u65f6\u5177\u5907 ARGC \u3001 ARGV \u3001 ARGVx \u3001 ARGN \u7684\u53c2\u6570\uff0c\u5982\u679c\u8fd9\u4e9b\u53c2\u6570\u5728\u5b8f\u5185\u90e8 \u8fdb\u884c\u5f15\u7528 \uff0c\u8c03\u7528\u8be5\u5b8f\u7684\u65f6\u5019\uff0c\u8fd9\u4e9b\u5185\u5bb9\u4f1a\u53d1\u751f\u66ff\u6362\uff0c\u4f8b\u5982 macro(my_macro xx) message(STATUS \"xx = ${xx}\") # \u8fd9\u91cc\u7684 ${xx} \u4f1a\u88ab\u76f4\u63a5\u66ff\u6362\u4e3a aa message(STATUS \"ARGC = ${ARGC}\") # \u8fd9\u91cc\u7684 ${ARGC} \u4f1a\u88ab\u76f4\u63a5\u66ff\u6362\u4e3a 3 message(STATUS \"ARGV = ${ARGV}\") # \u8fd9\u91cc\u7684 ${ARGV} \u4f1a\u88ab\u76f4\u63a5\u66ff\u6362\u4e3a aa;bb;cc endmacro() my_macro(aa bb cc) # \u6253\u5370\u7ed3\u679c # -- xx = aa # -- ARGC = 3 # -- ARGV = aa;bb;cc","title":"2.2.3 \u53c2\u6570"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#23","text":"\u5b8f\u4e0d\u4f1a\u5f00\u8f9f\u65b0\u7684\u4f5c\u7528\u57df\uff0c\u56e0\u6b64\u5728\u5b8f\u5185\u90e8\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u5c06\u5728\u5916\u90e8\u7ee7\u7eed\u751f\u6548 ```cmake macro(test) set(val \"666\") endmacro() set(val \"123\") message(\"val = ${val}\") test() message(\"val = ${val}\") # \u6253\u5370\u7ed3\u679c # -- val = 123 # -- val = 666 ``` \u8fd9\u4e00\u70b9\u5728\u51fd\u6570\u5c31\u4e0d\u4f1a\u51fa\u73b0\uff0c\u5185\u90e8\u8bbe\u7f6e\u7684\u53d8\u91cf\u4e00\u822c\u65e0\u6cd5\u8986\u76d6\u5916\u90e8\u7684\u53d8\u91cf\uff0c\u4f46\u5982\u679c\u9700\u8981\u8986\u76d6\uff0c\u53ef\u4ee5\u4f7f\u7528 PARENT_SCOPE \u63d0\u5347\u4f5c\u7528\u57df\u3002 \u5b8f\u5728\u88ab\u8c03\u7528\u7684\u8303\u56f4\u5185\u6709\u4e00\u4e2a\u540c\u540d\u7684\u53d8\u91cf\uff0c\u5c06\u4f7f\u7528\u73b0\u6709\u53d8\u91cf\u800c\u4e0d\u662f\u53c2\u6570\u3002 ```cmake macro(aaa) # \u8fd9\u91cc\u7684 ${ARGN} \u5728\u8c03\u7528\u65f6\u4f1a\u53d1\u751f\u66ff\u6362\uff0c\u66ff\u6362\u4e3a x;y;z foreach(m ${ARGN}) message(STATUS \"m = ${m}\") endforeach() message(STATUS \"================\") # \u8fd9\u91cc\u7684 ARGN \u6ca1\u6709\u5f15\u7528\uff0c\u5728\u8c03\u7528\u65f6\u4e0d\u4f1a\u53d1\u751f\u66ff\u6362 foreach(m IN LISTS ARGN) message(STATUS \"m = ${m}\") endforeach() endmacro() function(bbb) aaa(x y z) endfunction() bbb(a b c) # \u6253\u5370\u7ed3\u679c # -- m = x # -- m = y # -- m = z # -- ================ # -- m = a # -- m = b # -- m = c ``` \u8fd9\u91cc\u7684 ARGN \u5176\u5b9e\u6307\u4ee3\u7684\u662f\u51fd\u6570\u4e2d\u7684 ARGN","title":"2.3 \u51fd\u6570\u4e0e\u5b8f\u7684\u533a\u522b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#3","text":"\u7ecf\u5e38\u89c1\u5230\u4ee5\u4e0b\u547d\u4ee4\uff1a # \u6848\u4f8b 1 target_include_directories( MyLib PUBLIC include PRIVATE _deps ) # \u6848\u4f8b 2 execute_process( COMMAND ls ${current_dir} OUTPUT_VARIABLE subs ) \u8fd9\u4e9b\u5185\u7f6e\u7684\u51fd\u6570\u548c\u5b8f\u53ef\u4ee5\u5bf9\u4ee5\u4e0a\u7684 include \u3001 _deps \u548c ls ${current_dir} \u7b49\u5185\u5bb9\u8fdb\u884c\u89e3\u6790\uff0c\u5982\u679c\u6211\u4eec\u81ea\u5df1\u5199\u7684\u51fd\u6570\u6216\u5b8f\uff0c\u8981\u5982\u4f55\u5b9e\u73b0\u8fd9\u79cd\u53c2\u6570\u89e3\u6790\u7684\u529f\u80fd\uff1f\u8fd9\u91cc\u8981\u4ecb\u7ecd\u4e00\u4e2a CMake \u5185\u7f6e\u7684\u547d\u4ee4\uff1a cmake_parse_arguments()","title":"3. \u53c2\u6570\u89e3\u6790"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#31","text":"\u6709\u4e24\u4e2a\u5177\u4f53\u7684\u7528\u6cd5\uff1a cmake_parse_arguments(<prefix> <options> <one_value_keywords> <multi_value_keywords> <args>...) cmake_parse_arguments(PARSE_ARGV <N> <prefix> <options> <one_value_keywords> <multi_value_keywords>) \u901a\u5e38\u4f7f\u7528\u7b2c\u4e00\u4e2a\u7528\u6cd5\uff0c\u7b2c\u4e8c\u4e2a\u7528\u6cd5\u6574\u4f53\u4e0e\u7b2c\u4e00\u4e2a\u7c7b\u4f3c\uff0c\u6709\u5174\u8da3\u8005\u53ef\u4ee5\u53c2\u8003CMake\u5b98\u7f51\u3002\u4e0b\u9762\u4e3b\u8981\u5bf9\u7b2c\u4e00\u4e2a\u7528\u6cd5\u505a\u8bb2\u89e3\u3002 <options> \uff1a\u8868\u793a\u53ef\u9009\u5173\u952e\u8bcd\u5217\u8868\uff0c\u5982\u679c\u4f20\u5165\u53c2\u6570\u5305\u542b\u6b64\u53d8\u91cf\u540d\uff0c\u5219\u4e3a TRUE \uff0c\u53cd\u4e4b\u4e3a FALSE \u3002 \u4f8b\u5982\uff0c\u6211\u4eec\u5e38\u89c1\u7684 INTERFACE \uff0c PUBLIC \uff0c PRIVATE \u90fd\u662f target_include_directories \u51fd\u6570\u4e2d\u53ef\u9009\u5173\u952e\u5b57\u5217\u8868\u4e2d\u7684\u5143\u7d20\u3002 cmake set(options INTERFACE PUBLIC PRIVATE) cmake_parse_arguments(xxx \"${options}\" \"\" \"\" ${ARGN}) <one_value_keywords> \uff1a\u8868\u793a\u5355\u503c\u5173\u952e\u8bcd\u5217\u8868\uff0c\u6bcf\u4e2a\u5173\u952e\u8bcd\u4ec5\u5bf9\u5e94\u4e00\u4e2a\u503c\u3002 <multi_value_keywords> \uff1a\u8868\u793a\u591a\u503c\u5173\u952e\u8bcd\u5217\u8868\uff0c\u6bcf\u4e2a\u5173\u952e\u8bcd\u53ef\u5bf9\u5e94\u591a\u4e2a\u503c\u3002 ::: tip 1. \u5b9e\u9645\u4e0a\uff0c\u80fd\u7528 <one_value_keywords> \u7684\u90fd\u80fd\u7528 <multi_value_keywords> \u3002 2. \u8981\u89e3\u6790\u7684\u53c2\u6570 <args>... \uff0c\u6211\u4eec\u4e00\u822c\u4f20\u5165\u4e3a ${ARGN} \u5373\u53ef\uff0c\u4e00\u822c\u5b9a\u4e49\u7684\u51fd\u6570\u6216\u5b8f\u662f\u65e0\u53c2\u7684\uff0c\u9664\u975e\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e0d\u662f\u5173\u952e\u8bcd\uff0c\u90a3\u4e48\u6709\u591a\u5c11\u975e\u5173\u952e\u8bcd\u53d8\u91cf\uff0c\u5b9a\u4e49\u591a\u5c11\u5f62\u53c2\u3002 ::: \u4e3e\u4e2a\u4f8b\u5b50 ```cmake function(my_function) set(multi_args YYY ZZZ) cmake_parse_arguments(\"ABC\" \"\" \"\" \"${multi_args}\" ${ARGN}) message(STATUS \"YYY: ${ABC_YYY}\") message(STATUS \"ZZZ: ${ABC_ZZZ}\") endfunction() my_function( YYY 123 456 789 ZZZ abc ) # \u6253\u5370\u7ed3\u679c # -- YYY: 123;456;789 # -- ZZZ: abc ``` prefix \uff1a\u6211\u4eec\u5c06\u53c2\u6570 ${ARGN} \u6839\u636e <options> \uff0c <one_value_keywords> \uff0c <multi_value_keywords> \u89c4\u5219\u8fdb\u884c\u89e3\u6790\uff0c\u89e3\u6790\u51fa\u6765\u7684\u65b0\u53d8\u91cf\u540d\u6839\u636e <prefix> \u524d\u7f00\uff0c\u6309\u7167 prefix_\u53c2\u6570\u540d \u7684\u5f62\u5f0f\u8fdb\u884c\u8bbe\u7f6e\uff0c\u4f8b\u5982\uff1a cmake set(options INTERFACE PUBLIC PRIVATE) set(multy_args DEPENDS) cmake_parse_arguments(ABC \"${options}\" \"\" \"${multy_args}\" ${ARGN}) # \u8bbf\u95ee options \u7684\u5185\u5bb9\u662f\u5426\u4e3a ON if(${ABC_INTERFACE}) # ABC_ \u524d\u7f00 elseif(${ABC_PUBLIC}) # ABC_ \u524d\u7f00 elseif(${ABC_PRIVATE}) # ABC_ \u524d\u7f00 endif() # \u8bbf\u95ee multy_args \u7684\u5185\u5bb9 message(STATUS \"${ABC_DEPENDS}\") # ABC_ \u524d\u7f00","title":"3.1 \u7528\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/07/#32","text":"\u6700\u540e\uff0c\u6765\u770b RMVL \u4e2d\u4f7f\u7528\u6709\u5173\u6dfb\u52a0\u6d4b\u8bd5\u7528\u4f8b\u7684\u5b8f\u6765\u505a\u5de9\u56fa\uff1a # \u5728\u5f53\u524d\u76ee\u5f55\u4e2d\u6dfb\u52a0\u65b0\u7684\u6d4b\u8bd5\u7528\u4f8b # \u7528\u6cd5: # rmvl_add_test( # <name> # [DEPENDS <rmvl_target>] # [DEPEND_TESTS <test_target>] # ) # \u793a\u4f8b: # rmvl_add_test( # detector # \u6d4b\u8bd5\u540d # DEPENDS armor_detector # \u9700\u8981\u4f9d\u8d56\u7684 RMVL \u76ee\u6807\u5e93 # DEPEND_TESTS GTest::gtest_main # \u9700\u8981\u4f9d\u8d56\u7684\u7b2c\u4e09\u65b9\u6d4b\u8bd5\u5de5\u5177\u76ee\u6807\u5e93 # ) macro(rmvl_add_test _name) # add arguments variable set(multy_args DEPENDS DEPEND_TESTS) cmake_parse_arguments(TEST \"\" \"\" \"${multy_args}\" ${ARGN}) # add testing executable set(test_dir) aux_source_directory(test test_dir) add_executable(rmvl_${_name}_test ${test_dir}) # depends foreach(_dep ${TEST_DEPENDS}) target_link_libraries( rmvl_${_name}_test PRIVATE rmvl_${_dep} ) endforeach(_dep ${TEST_DEPENDS}) # test depends target_link_libraries( rmvl_${_name}_test PRIVATE ${TEST_DEPEND_TESTS} ) gtest_discover_tests(rmvl_${_name}_test) endmacro(rmvl_add_test _name)","title":"3.2 \u6848\u4f8b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/","text":"\u301008\u3011find_package \u8be6\u89e3 \u6559\u5b66\u89c6\u9891 ::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili 1. \u524d\u8a00 \u5148\u770b\u4ee5\u4e0b\u5bfb\u627e\u5e76\u5305\u542b OpenCV \u7684 CMakeLists.txt \u793a\u4f8b cmake_minimum_required(VERSION 3.10) project(Demo) find_package(OpenCV REQUIRED) add_executable(demo main.cpp) target_link_libraries( demo PRIVATE ${OpenCV_LIBS} ) \u8fd9\u662f\u4e00\u6bb5\u518d\u719f\u6089\u4e0d\u8fc7\u7684 CMakeLists.txt \u4ee3\u7801\uff0c\u6211\u4eec\u901a\u8fc7 find_package \u547d\u4ee4\u5bfb\u627e\u5230\u4e86OpenCV\u5e93\uff0c\u5e76\u83b7\u5f97\u4e86\u5176\u4e2d\u7684\u5bfc\u5165\u76ee\u6807\u5217\u8868\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 message \u9a8c\u8bc1\u4e00\u4e0b OpenCV_LIBS \u5305\u542b\u7684\u5185\u5bb9 foreach(m ${OpenCV_LIBS}) message(STATUS ${m}) endforeach() # \u8f93\u51fa\u7ed3\u679c # opencv_core;opencv_imgproc;opencv_highgui;opencv_imgcodecs; ... \u90a3\u4e48CMake\u662f\u5982\u4f55\u901a\u8fc7 find_package \u547d\u4ee4\u627e\u5230OpenCV\u5e76\u4e14\u5b8c\u6210\u914d\u7f6e\u7684\u5462? 2. find_package \u89e3\u6790\u8fc7\u7a0b Module \u6a21\u5f0f \u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c find_package \u9700\u8981\u89e3\u6790 Findxxx.cmake \u6587\u4ef6\uff0c\u8fd9\u4e5f\u662f find_package \u9ed8\u8ba4\u5de5\u4f5c\u7684\u6a21\u5f0f Config \u6a21\u5f0f \u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c find_package \u9700\u8981\u89e3\u6790 xxxConfig.cmake \u6587\u4ef6\u6216\u8005 xxx-config.cmake \u6587\u4ef6\u3002\u5b9e\u9645\u4e0a\u53ea\u6709 Findxxx.cmake \u6587\u4ef6\u65e0\u6cd5\u627e\u5230\uff0c\u5373 Module \u6a21\u5f0f\u6267\u884c\u4e0d\u6210\u529f\uff0c\u624d\u4f1a\u8fdb\u5165 Config \u6a21\u5f0f\u3002 3. Module \u6a21\u5f0f 3.1 \u7528\u6cd5 Module \u6a21\u5f0f\u4e0b find_package \u7684\u53c2\u6570\u4e3a\uff1a find_package(<package> [VERSION] [EXACT] [QUIET] [MODULE] [REQUIRED] [[COMPONENTS] [components...]] [OPTIONAL_COMPONENTS components...] [NO_POLICY_SCOPE]) \u8fd9\u91cc\u5bf9\u4e0a\u8ff0\u63d0\u53ca\u5230\u7684\u53c2\u6570\u505a\u4e2a\u7b80\u5355\u7684\u89e3\u91ca\uff1a \u53c2\u6570\u540d\u79f0 \u53ef\u9009\u6027 \u540d\u79f0 \u5907\u6ce8 package \u5fc5\u586b \u9700\u8981\u67e5\u627e\u7684\u5305\u540d \u6ce8\u610f\u5927\u5c0f\u5199 VERSION \u53ef\u9009 \u6307\u5b9a\u7248\u672c\uff0c\u5982\u679c\u6307\u5b9a\u5c31\u5fc5\u987b\u68c0\u67e5\u627e\u5230\u7684 \u5305\u7684\u7248\u672c\u662f\u5426\u548c VERSION \u517c\u5bb9 EXACT \u53ef\u9009 \u5982\u679c\u6307\u5b9a\u8be5\u53c2\u6570\uff0c\u5219\u8868\u793a\u9700\u8981\u5bfb\u627e\u5fc5\u987b \u5b8c\u5168\u5339\u914d\u7684\u7248\u672c\u800c\u4e0d\u662f\u517c\u5bb9\u7248\u672c \u914d\u5408 VERSION \u4f7f\u7528 REQUIRED \u53ef\u9009 \u8868\u793a\u4e00\u5b9a\u8981\u627e\u5230\u5305\uff0c\u627e\u4e0d\u5230\u7684\u8bdd\u5c31\u7acb\u5373 \u505c\u6389\u6574\u4e2a CMake \u89e3\u6790\u8fc7\u7a0b QUIET \u53ef\u9009 \u8868\u793a\u5982\u679c\u67e5\u627e\u5931\u8d25\uff0c\u4e0d\u4f1a\u5728\u5c4f\u5e55\u8fdb\u884c\u8f93\u51fa \u4e0d\u5f97\u4e0e REQUIRED \u642d\u914d MODULE \u53ef\u9009 \u524d\u9762\u63d0\u5230\u8bf4 \u201c Module \u6a21\u5f0f\u6267\u884c\u5931\u8d25\uff0c \u624d\u4f1a\u8fdb\u5165 Config \u6a21\u5f0f\u201d\uff0c\u4f46\u662f\u5047\u5982\u52a0\u5165\u4e86 MODULE \u9009\u9879\uff0c\u90a3\u4e48\u5c31\u53ea\u5728 Module \u6a21\u5f0f \u67e5\u627e\uff0c\u5982\u679c Module \u6a21\u5f0f\u4e0b\u67e5\u627e\u5931\u8d25\u5e76\u4e0d \u5207\u6362\u5230 Config \u6a21\u5f0f\u67e5\u627e\u3002 COMPONENTS \u53ef\u9009 \u8868\u793a\u67e5\u627e\u7684\u5305\u4e2d\u5fc5\u987b\u8981\u627e\u5230\u7684\u7ec4\u4ef6 (components)\uff0c\u5982\u679c\u6709\u4efb\u4f55\u4e00\u4e2a\u627e\u4e0d\u5230 \u5c31\u7b97\u5931\u8d25\uff0c\u7c7b\u4f3c\u4e8e REQUIRED \uff0c\u5bfc\u81f4 CMake \u505c\u6b62\u6267\u884c\u3002 3.2 \u6587\u4ef6\u641c\u7d22\u8fc7\u7a0b #2 \u63d0\u5230\u8fc7\uff0cModule \u6a21\u5f0f\u4e0b\u9700\u8981\u67e5\u627e\u5230\u540d\u4e3a Find<PackageName>.cmake \u7684\u914d\u7f6e\u6587\u4ef6\u3002\u8be5\u6587\u4ef6\u7684\u67e5\u627e\u8fc7\u7a0b\u53ea\u6d89\u53ca\u5230\u4e24\u4e2a\u8def\u5f84\uff1a CMAKE_MODULE_PATH \u548c CMake \u5b89\u88c5\u8def\u5f84\u4e0b\u7684 Modules \u76ee\u5f55\u3002\u5373\uff0c\u641c\u7d22\u8def\u5f84\u4f9d\u6b21\u4e3a\uff1a \u5148\u5728 CMAKE_MODULE_PATH \u53d8\u91cf\u5bf9\u5e94\u7684\u8def\u5f84\u4e2d\u67e5\u627e\u3002\u5982\u679c\u8def\u5f84\u4e3a\u7a7a\uff0c\u6216\u8005\u8def\u5f84\u4e2d\u67e5\u627e\u5931\u8d25\uff0c\u5219\u5728 CMake \u5b89\u88c5\u76ee\u5f55\uff08\u5373 CMAKE_ROOT \u53d8\u91cf\uff09\u4e0b\u7684 Modules \u76ee\u5f55\u4e2d\u67e5\u627e\u3002\u8fd9\u4e2a\u76ee\u5f55\u901a\u5e38\u4e3a /usr/share/cmake-x.xx/Modules \u3002\u8fd9\u4e24\u4e2a\u53d8\u91cf\u53ef\u4ee5\u5728 CMakeLists.txt \u6587\u4ef6\u4e2d\u6253\u5370\u67e5\u770b\u5177\u4f53\u5185\u5bb9\uff1a \u5176\u4e2d CMAKE_MODULE_PATH \u9ed8\u8ba4\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u5229\u7528 set \u547d\u4ee4\u5bf9\u8be5\u53d8\u91cf\u8fdb\u884c\u8bbe\u7f6e\u3002 \u5728\u5b89\u88c5 CMake \u65f6\uff0cCMake \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u5f88\u591a\u5f00\u53d1\u5e93\u7684 FindXXX.cmake \u6a21\u5757\u6587\u4ef6\uff0c\u8fd9\u4e9b\u6587\u4ef6\u90fd\u5b9a\u4e49\u5728 CMAKE_ROOT \u6307\u4ee3\u8def\u5f84\u7684\u6587\u4ef6\u5939\u91cc\u9762\u3002\u53ef\u4ee5\u5728\u7ec8\u7aef\u901a\u8fc7\u952e\u5165\u4ee5\u4e0b\u547d\u4ee4\u8fdb\u884c\u67e5\u8be2 4. Config \u6a21\u5f0f 4.1 \u7528\u6cd5 Config \u6a21\u5f0f\u4e0b find_package \u7684\u5b8c\u6574\u547d\u4ee4\u53c2\u6570\u5982\u4e0b\uff0c\u4e0d\u5fc5\u5168\u90e8\u4e86\u89e3\u3002 \u76f8\u6bd4\u4e8e Module \u6a21\u5f0f\uff0c Config \u6a21\u5f0f\u7684\u53c2\u6570\u66f4\u591a\uff0c\u4e5f\u66f4\u590d\u6742\uff0c\u4f46\u5b9e\u9645\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u6211\u4eec\u5e76\u4e0d\u4f1a\u7528\u5230\u6240\u6709\u53c2\u6570\uff0c\u5927\u90e8\u5206\u53c2\u6570\u90fd\u662f\u53ef\u9009\u7684\uff0c\u6211\u4eec\u53ea\u9700\u8981\u638c\u63e1\u57fa\u672c\u7684\u53c2\u6570\u7528\u6cd5\u5373\u53ef\u3002 \u5176\u4e2d\u5177\u4f53\u67e5\u627e\u5e93\u5e76\u7ed9 XXX_INCLUDE_DIRS \u548c XXX_LIBS \u4e24\u4e2a\u53d8\u91cf\u8d4b\u503c\u7684\u64cd\u4f5c\u7531 XXXConfig.cmake \u6a21\u5757\u5b8c\u6210\u3002 \u4e24\u79cd\u6a21\u5f0f\u770b\u8d77\u6765\u4f3c\u4e4e\u5dee\u4e0d\u591a\uff0c\u4e0d\u8fc7 CMake \u9ed8\u8ba4\u91c7\u53d6 Module \u6a21\u5f0f\uff0c\u5982\u679c Module \u6a21\u5f0f\u672a\u627e\u5230\u5e93\uff0c\u624d\u4f1a\u91c7\u53d6 Config \u6a21\u5f0f\u3002\u603b\u4e4b\uff0c Config \u6a21\u5f0f\u662f\u4e00\u4e2a\u5907\u9009\u7b56\u7565\u3002\u901a\u5e38\uff0c\u5e93\u5b89\u88c5\u65f6\u4f1a\u62f7\u8d1d\u4e00\u4efd XXXConfig.cmake \u5230\u7cfb\u7edf\u76ee\u5f55\u4e2d\uff0c\u56e0\u6b64\u5728\u6ca1\u6709\u663e\u5f0f\u6307\u5b9a\u641c\u7d22\u8def\u5f84\u65f6\u4e5f\u53ef\u4ee5\u987a\u5229\u627e\u5230\u3002 4.2 \u6587\u4ef6\u641c\u7d22\u8fc7\u7a0b \u4e0e Module \u6a21\u5f0f\u4e0d\u540c\uff0c Config \u6a21\u5f0f\u9700\u8981\u67e5\u627e\u7684\u8def\u5f84\u975e\u5e38\u975e\u5e38\u975e\u5e38\u591a\uff0c\u4e5f\u8981\u5339\u914d\u5f88\u591a\u7684\u53ef\u80fd\u6027\uff0c\u56e0\u6b64\u6709\u4e9b\u8def\u5f84\u662f\u9996\u5148\u4f5c\u4e3a\u6839\u76ee\u5f55\uff0c\u7136\u540e\u8fdb\u884c\u5b50\u76ee\u5f55\u7684\u5339\u914d\uff0c\u800c\u6709\u4e9b\u5219\u662f\u76f4\u63a5\u6307\u5b9a\u5230\u5177\u4f53\u7684 XXXConfig.cmake \u6587\u4ef6\u3002\u5177\u4f53\u5c06\u4f1a\u6309\u7167\u5982\u4e0b\u987a\u5e8f\u8fdb\u884c\u67e5\u627e\uff1a <PackageName>_DIR CMAKE_PREFIX_PATH \u3001 CMAKE_FRAMEWORK_PATH \u3001 CMAKE_APPBUNDLE_PATH PATH \u73af\u5883\u53d8\u91cf\u8def\u5f84 CMAKE_SYSTEM_PREFIX_PATH \u7b49\u7cfb\u7edf\u53d8\u91cf\u8def\u5f84 \\<PackageName>_DIR \u9996\u5148\u641c\u7d22\u540d\u4e3a <PackageName>_DIR \u7684 CMake \u53d8\u91cf\u6216\u73af\u5883\u53d8\u91cf\u8def\u5f84\uff0c\u8fd9\u4e2a\u53d8\u91cf\u9ed8\u8ba4\u4e3a\u7a7a\u3002\u8fd9\u4e2a\u8def\u5f84\u9700\u8981\u76f4\u63a5\u6307\u5b9a\u5230 <PackageName>Config.cmake \u6216 <lower-case-package-name>-config.cmake \u6587\u4ef6\u6240\u5728\u76ee\u5f55\u624d\u80fd\u627e\u5230\uff0c\u53ef\u53c2\u8003\u4ee5\u4e0b\u793a\u4f8b\uff1a CMAKE_PREFIX_PATH \u7b49\u53d8\u91cf \u5982\u679c\u6309\u7167 <PackageName>_DIR \u641c\u7d22\u4e0d\u5230\u76f8\u5e94\u7684 XXXConfig.cmake \u6587\u4ef6\u7684\u8bdd\uff0c\u5219\u4f1a\u67e5\u627e\u540d\u4e3a CMAKE_PREFIX_PATH \u3001 CMAKE_FRAMEWORK_PATH \u3001 CMAKE_APPBUNDLE_PATH \u7684 CMake \u53d8\u91cf\u6216\u73af\u5883\u53d8\u91cf\u8def\u5f84\u3002\u8fd9\u4e9b\u53d8\u91cf\u6307\u5b9a\u7684\u8def\u5f84\u5c06\u4f5c\u4e3a\u67e5\u627e\u65f6\u7684\u6839\u76ee\u5f55\uff0c \u5b83\u4eec\u9ed8\u8ba4\u90fd\u4e3a\u7a7a \u3002\u6839\u76ee\u5f55\u7684\u76f8\u5173\u5185\u5bb9\u5728\u540e\u6587\u4f1a\u63d0\u53ca\u3002 ::: tip \u5982\u679c\u4f60\u7535\u8111\u4e2d\u5b89\u88c5\u4e86 ROS \u5e76\u914d\u7f6e\u597d\u4e4b\u540e\uff0c\u4f60\u5728\u7ec8\u7aef\u6267\u884c echo $CMAKE_PREFIX_PATH \u4f1a\u53d1\u73b0 ROS \u4f1a\u5c06 CMAKE_PREFIX_PATH \u8fd9\u4e2a\u53d8\u91cf\u8bbe\u7f6e\u4e3a ROS \u4e2d\u7684\u5e93\u7684\u8def\u5f84\uff0c\u610f\u601d\u662f\u4f1a\u9996\u5148\u67e5\u627e ROS \u5b89\u88c5\u7684\u5e93\uff0c\u5982\u679c\u6070\u597d\u4f60\u5728 ROS \u4e2d\u5b89\u88c5\u4e86 OpenCV \u5e93\uff0c\u5c31\u4f1a\u53d1\u73b0\u9996\u5148\u627e\u5230\u7684\u662f ROS \u4e2d\u7684 OpenCV \uff0c\u800c\u4e0d\u662f\u4f60\u81ea\u5df1\u5b89\u88c5\u5230\u7cfb\u7edf\u4e2d\u7684 OpenCV \u3002 ::: PATH \u73af\u5883\u53d8\u91cf\u8def\u5f84 \u82e5\u8fd8\u627e\u4e0d\u5230\uff0c\u5219\u662f\u641c\u7d22 PATH \u73af\u5883\u53d8\u91cf\u8def\u5f84\uff0c\u8fd9\u4e2a\u8def\u5f84\u4e5f\u662f\u6839\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4e3a\u7cfb\u7edf\u73af\u5883 PATH \u73af\u5883\u53d8\u91cf\u503c\u3002 \u5176\u5b9e\u8fd9\u4e2a\u8def\u5f84\u624d\u662f Config \u6a21\u5f0f\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u80fd\u591f\u67e5\u627e\u5230\u5b89\u88c5\u5230\u7cfb\u7edf\u4e2d\u5404\u79cd\u5e93\u7684\u539f\u56e0\u3002\u8fd9\u4e2a\u8def\u5f84\u7684\u67e5\u627e\u89c4\u5219\u4e3a\uff1a\u904d\u5386 PATH \u73af\u5883\u53d8\u91cf\u4e2d\u7684\u5404\u8def\u5f84\uff0c\u5982\u679c\u8be5\u8def\u5f84\u5982\u679c\u4ee5 bin \u6216 sbin \u7ed3\u5c3e\uff0c\u5219\u81ea\u52a8\u56de\u9000\u5230\u4e0a\u4e00\u7ea7\u76ee\u5f55\u5f97\u5230\u6839\u76ee\u5f55\u3002\u5728\u7ec8\u7aef\u952e\u5165\u4ee5\u4e0b\u5185\u5bb9\u4ee5\u67e5\u770b\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u8def\u5f84\uff1a bash echo $PATH \u4e00\u822c\u60c5\u51b5\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u8fd9\u91cc\u5bf9\u6bcf\u4e2a\u8def\u5f84\u90fd\u505a\u4e86\u6362\u884c\u5904\u7406\uff0c\u5e76\u4e14\u52a0\u4e86\u4e9b\u7b80\u5355\u7684\u6ce8\u91ca\u3002 bash /home/<user-name>/.local/bin: # \u56de\u9000\u5230 /home/<user-name>/.local \u540e\u518d\u8fdb\u884c\u641c\u7d22 /usr/local/sbin: # \u56de\u9000\u5230 /usr/local \u540e\u518d\u8fdb\u884c\u641c\u7d22 /usr/local/bin: # \u540c\u4e0a /usr/sbin: # \u56de\u9000\u5230 /usr \u540e\u518d\u8fdb\u884c\u641c\u7d22 /usr/bin: # \u540c\u4e0a /sbin: # \u56de\u9000\u5230 / \u540e\u518d\u8fdb\u884c\u641c\u7d22 /bin: # \u540c\u4e0a /usr/games: /usr/local/games: /snap/bin # \u56de\u9000\u5230 /snap \u540e\u518d\u8fdb\u884c\u641c\u7d22 \u8bf4\u660e\u8fd9\u4e9b\u8def\u5f84\u4f1a\u88ab\u9ed8\u8ba4\u6dfb\u52a0\u5728 Config \u6a21\u5f0f\u7684\u641c\u7d22\u8def\u5f84\u4e2d\u3002 CMAKE_SYSTEM_PREFIX_PATH \u7b49\u53d8\u91cf \u6211\u4eec\u5728\u5b89\u88c5 OpenCV \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5728 cmake-gui \u4e2d\u4fee\u6539 CMAKE_INSTALL_PREFIX \u53d8\u91cf\u7684\u5185\u5bb9\uff0c\u628a OpenCV \u5b89\u88c5\u5728 /opt/opencv \u4e0b\uff0c\u6211\u4eec\u5728\u4f7f\u7528 find_package \u65f6\u4e5f\u4e0d\u9700\u8981\u6307\u540d\u8def\u5f84\uff0c\u8bf4\u660e\u9664\u4e86\u4e0a\u9762\u7684\u4e00\u4e9b\u53d8\u91cf\u4e4b\u5916\uff0c\u8fd8\u5b58\u5728\u53e6\u5916\u4e00\u7cfb\u5217\u8def\u5f84\u3002\u8fd9\u91cc\u5217\u51fa\u6700\u91cd\u8981\u7684\u4e00\u4e2a\u53d8\u91cf\uff1a CMAKE_SYSTEM_PREFIX_PATH \u6211\u4eec\u53ef\u4ee5\u5728\u4e00\u4e2a CMakeLists.txt \u6587\u4ef6\u4e0b\uff0c\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9\uff1a cmake foreach(path ${CMAKE_SYSTEM_PREFIX_PATH}) message(STATUS \"${path}\") endforeach() \u4f1a\u6253\u5370\u51fa\u4ee5\u4e0b\u5185\u5bb9 txt -- /usr/local -- /usr -- / -- /usr/local -- /usr/local -- /usr/X11R6 -- /usr/pkg -- /opt \u7559\u610f\u8be5\u53d8\u91cf\u6700\u540e\u4e00\u70b9\u5305\u542b\u7684\u5185\u5bb9\uff0c\u8fd9\u6b63\u662f\u6211\u4eec\u53ef\u4ee5\u628a\u7b2c\u4e09\u65b9\u5e93\u5b89\u88c5\u5728 /opt \u7684\u539f\u56e0\u3002\u4e8b\u5b9e\u4e0a\uff0c\u5f88\u591a\u8f6f\u4ef6\u5305\u90fd\u662f\u9ed8\u8ba4\u5b89\u88c5\u5728 /opt \u4e0b\u7684\uff0c\u8b6c\u5982 ROS\u3002 ::: tip \u8865\u5145 \u76f8\u5173\u5305\u542b\u7684\u5185\u5bb9\u8fd8\u6709\u975e\u5e38\u4e4b\u591a\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u9605\u8bfb\u5b98\u7f51\u548c\u6e90\u7801\uff0c\u8fd9\u91cc\u7ed9\u51fa\u5b98\u7f51\u548c\u6e90\u7801 GitLab \u5730\u5740\uff1a - find_package \u5bfb\u627e\u5305\u542b\u8def\u5f84\u7684\u6e90\u7801 GitLab\uff1a \u6e90\u7801 GitLab \u5730\u5740 - find_package \u5bfb\u627e\u5305\u542b\u8def\u5f84\u7684\u5b98\u7f51\uff1a \u5b98\u7f51\u7f51\u5740 ::: 4.3 \u6839\u76ee\u5f55\u8def\u5f84\u8be6\u89e3 \u4e0a\u8ff0\u63d0\u53ca\u5230\u7684\u6839\u76ee\u5f55\u8def\u5f84\uff0c\u5728\u6307\u660e\u8fd9\u4e9b\u5185\u5bb9\u65f6\uff0cCMake \u4f1a\u9996\u5148\u68c0\u67e5\u8fd9\u4e9b\u6839\u76ee\u5f55\u8def\u5f84\u4e0b\u662f\u5426\u6709\u540d\u4e3a <PackageName>Config.cmake \u6216 <lower-case-package-name>-config.cmake \u7684\u6a21\u5757\u6587\u4ef6\uff0c\u5982\u679c\u6ca1\u6709\uff0cCMake \u4f1a\u7ee7\u7eed\u68c0\u67e5\u6216\u5339\u914d\u8fd9\u4e9b\u6839\u76ee\u5f55\u4e0b\u7684\u4ee5\u4e0b\u8def\u5f84\uff1a <prefix>/(lib/<arch>|lib|share)/cmake/<name>*/ <prefix>/(lib/<arch>|lib|share)/<name>*/ <prefix>/(lib/<arch>|lib|share)/<name>*/(cmake|CMake)/ \u5176\u4e2d\u4e3a arch \u7cfb\u7edf\u67b6\u6784\u540d\uff0c\u5982 Ubuntu \u4e0b\u4e00\u822c\u4e3a\uff1a x86_64-linux-gnu \uff0c\u6574\u4e2a (lib/<arch>|lib|share) \u4e3a\u53ef\u9009\u8def\u5f84\uff0c\u4f8b\u5982 OpenCV \u5e93\u800c\u8a00\u4f1a\u68c0\u67e5\u6216\u5339\u914d\u4ee5\u4e0b\u5185\u5bb9\uff1a <prefix>/lib/x86_64-linux-gnu/opencv4/ <prefix>/lib/cmake/opencv4/ <prefix>/share/opencv4/ \u2026\u2026 ::: warning \u4e0a\u6587\u63d0\u53ca\u8fc7\u7684 <PackageName>_DIR \u8def\u5f84\u4e0d\u662f\u6839\u76ee\u5f55\u8def\u5f84 ::: 5. FindXXX.cmake \u7b80\u5355\u5199\u6cd5 \u6211\u4eec\u4f7f\u7528 Module \u6a21\u5f0f\uff0c\u5199\u4e00\u4e2a FindXXX.cmake \u6587\u4ef6\uff0c\u6765\u4f53\u9a8c\u4e00\u4e0b\u81ea\u5df1\u7684 find_package 5.1 \u6848\u4f8b \u5047\u8bbe\u67d0\u5bb6\u76f8\u673a\u5382\u5546\u7684 SDK \u63d0\u4f9b\u4e86\u4ee5\u4e0b\u5185\u5bb9\uff0c\u5047\u8bbe\u5c06\u5176\u653e\u5728\u4e86 /opt/camera \u6587\u4ef6\u5939\u4e0b\uff0c\u8bf7\u521b\u5efa\u4e00\u4e2a CameraDemo \u9879\u76ee\uff0c\u5e76\u8bbe\u8ba1\u4e00\u4e2a FindCamera.cmake \u6587\u4ef6\u4f9b\u672c\u9879\u76ee\u4e2d\u7684\u5176\u4f59\u76ee\u6807\u5305\u542b\uff0c\u4f7f\u5176\u80fd\u591f\u94fe\u63a5\u81f3\u672c\u76f8\u673a\u7684 SDK\u3002 . \u251c\u2500\u2500 include \u2502 \u251c\u2500\u2500 CameraApi.h \u2502 \u251c\u2500\u2500 CameraDefine.h \u2502 \u2514\u2500\u2500 CameraStatus.h \u2514\u2500\u2500 lib \u2514\u2500\u2500 libMVSDK.so 5.2 \u5206\u6790 \u6211\u4eec\u5728 \u301005\u3011\u76ee\u6807\u6784\u5efa \u7684\u5bfc\u5165\u76ee\u6807\u4e2d\u9047\u5230\u8fc7\u7c7b\u4f3c\u7684\u60c5\u51b5\uff0c\u4f46\u8fd9\u91cc\u7684\u76f8\u673a SDK \u5e76\u6ca1\u6709\u4f4d\u4e8e\u672c\u9879\u76ee\u4e2d\u3002 \u6ce8\u610f\u5230\u76f8\u673a\u5382\u5546\u7684 SDK \u5e76\u65e0\u63d0\u4f9b\u76f8\u5e94\u7684 CameraConfig.cmake \u6216 camera-config.cmake \u6587\u4ef6\uff0c\u56e0\u6b64\u9700\u8981\u81ea\u5df1\u624b\u5199 FindCamera.cmake \u6587\u4ef6\u3002 \u6211\u4eec\u5148\u628a\u76f8\u673a\u9879\u76ee\u7684\u90e8\u7f72\u6846\u67b6\u7ed9\u5927\u6982\u5b9a\u4e49\u597d\uff1a . \u251c\u2500\u2500 cmake \u2502 \u2514\u2500\u2500 FindCamera.cmake \u251c\u2500\u2500 CMakeLists.txt \u2514\u2500\u2500 main.cpp \u6d89\u53ca\u5230\u7684\u4e24\u4e2a CMake \u6587\u4ef6\u5df2\u7ecf\u6807\u7ea2\uff0c\u8fd9\u91cc\u7b80\u5355\u63cf\u8ff0\u4e00\u4e0b FindCamera.cmake \uff1a\u5176\u4ed6\u5e93\u76f4\u63a5\u5305\u542b\u3001\u94fe\u63a5 SDK \u63d0\u4f9b\u7684\u5e93\u80af\u5b9a\u662f\u4e0d\u884c\u7684\uff0c\u9700\u8981\u4e8b\u5148\u627e\u5230 SDK \u7684\u8def\u5f84\uff0c\u6b64\u6587\u4ef6\u5c31\u662f\u4e3a\u4e86\u63d0\u524d\u8ba9\u6574\u4e2a CMake \u5de5\u7a0b\u627e\u5230\u6b64 SDK\u3002 \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMakeLists.txt \uff1a\u6846\u67b6\u6574\u4f53\u914d\u7f6e\uff0c\u5305\u62ec\u9879\u76ee\u3001\u7f16\u8bd1\u5c5e\u6027\u3001\u53ef\u6267\u884c\u7a0b\u5e8f\u7684\u914d\u7f6e\u3002\u8fd9\u91cc main.cpp \u76f4\u63a5\u7528\u5230\u4e86 SDK \u7684\u5185\u5bb9\uff0c\u901a\u8fc7\u4ee5\u4e0b\u8bed\u53e5\u8fdb\u884c\u94fe\u63a5 cmake target_link_libraries( demo PRIVATE camera ) 5.3 \u914d\u7f6e 5.3.1 \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMakeLists.txt \u2460 \u4e3b\u8981\u76ee\u7684 \u8bbe\u7f6e CMAKE_MODULE_PATH \u6a21\u5757\u6a21\u5f0f\u7684\u5de5\u4f5c\u8def\u5f84 \u89e3\u6790 FindCamera.cmake \uff0c\u5e76\u627e\u5230 camera \u5bf9\u5e94\u7684\u5e93 \u521b\u5efa\u53ef\u6267\u884c\u7a0b\u5e8f\u76ee\u6807\u5e76\u94fe\u63a5 \u2461 \u793a\u4f8b\u4ee3\u7801 cmake_minimum_required(VERSION 3.10) project(CameraDemo) # \u672c\u7bc7 2.2.2 \u8282\u63d0\u53ca\u8fc7\uff0c\u4e0b\u4e00\u53e5\u662f\u8ba9 CMake \u5de5\u7a0b\u80fd\u591f\u627e\u5230 FindCamera.cmake list(CMAKE_MODULE_PATH APPEND \"${CMAKE_SOURCE_DIR}/cmake\") # \u627e\u5230 SDK find_package(Camera) # \u6dfb\u52a0\u53ef\u6267\u884c\u6587\u4ef6\u5e76\u94fe\u63a5 add_executable(demo main.cpp) target_link_libraries( demo PRIVATE camera ) 5.3.2 FindCamera.cmake \u2460 \u4e3b\u8981\u4efb\u52a1 \u63d0\u4f9b\u4e00\u4e2a CMake \u76ee\u6807\u53d8\u91cf\uff08\u4e00\u822c\u662f\u5bfc\u5165\u76ee\u6807\uff09 \u627e\u5230 SDK \u7684\u5934\u6587\u4ef6 \u627e\u5230 SDK \u7684\u5e93\u6587\u4ef6 \u63d0\u4f9b\u6709\u65e0\u627e\u5230\u7684\u72b6\u6001\u4fe1\u606f \u2461 \u8be6\u7ec6\u6ce8\u91ca\u7684\u793a\u4f8b\u4ee3\u7801 # \u8bbe\u7f6e mvsdk \u7684\u8def\u5f84\uff08\u53ef\u81ea\u884c\u8bbe\u7f6e\uff09 set(mvsdk_root \"/opt/camera\") # \u53d1\u73b0\u5934\u6587\u4ef6\u8def\u5f84\uff0c\u5e76\u8bbe\u7f6e Camera_INCLUDE_DIRS find_path( Camera_INCLUDE_DIR NAMES CameraApi.h CameraDefine.h CameraStatus.h PATHS \"${mvsdk_root}/include\" NO_DEFAULT_PATH # \u9ed8\u8ba4\u8def\u5f84\u4e0b\u4f1a\u5305\u542b /usr/local \u7b49\u5185\u5bb9\uff0c\u8fd9\u53e5\u8bdd\u8868\u660e\u4e0d\u5305\u542b\u9ed8\u8ba4\u8def\u5f84 ) # \u53d1\u73b0\u5e93\u6587\u4ef6\u8def\u5f84 find_library( Camera_LIB NAMES \"libMVSDK.so\" PATHS \"${mvsdk_root}/lib\" NO_DEFAULT_PATH # \u540c find_path ) # \u8bbe\u7f6e\u5bfc\u5165\u76ee\u6807\uff0c\u79f0\u4e3a mvsdk if(NOT TARGET mvsdk) # \u5c06\u76ee\u6807\u8bbe\u7f6e\u4e3a\u5728\u9879\u76ee\u4e2d\u5168\u5c40\u53ef\u89c1 GLOBAL add_library(mvsdk SHARED IMPORTED GLOBAL) # \u4e3a\u5bfc\u5165\u76ee\u6807\u6dfb\u52a0\u76f8\u5173\u5c5e\u6027 set_target_properties(mvsdk PROPERTIES INTERFACE_INCLUDE_DIRECTORIES \"${Camera_INCLUDE_DIR}\" IMPORTED_LOCATION \"${Camera_LIB}\" ) endif() set(Camera_INCLUDE_DIRS ${Camera_INCLUDE_DIR}) set(Camera_LIBS mvsdk) # \u8fd9\u91cc\u7528\u5230\u4e86\u4e00\u4e2a CMake \u81ea\u5e26\u7684\u51fd\u6570\uff0c\u4f1a\u6839\u636e\u6307\u5b9a\u5185\u5bb9\u8bbe\u7f6e Camera_FOUND \u53d8\u91cf include(FindPackageHandleStandardArgs) # \u610f\u4e3a\u5fc5\u9700\u7684\u53c2\u6570\u662f Camera_LIBS\uff0c\u5982\u679c Camera_LIBS \u4e3a\u7a7a\uff0c\u5219 Camera_FOUND # \u5c06\u88ab\u8bbe\u7f6e\u4e3a FALSE\uff0c\u5e76\u5728\u4f7f\u7528 find_package(Camera REQUIRED) \u65f6\u4e5f\u4f1a\u62a5\u9519 find_package_handle_standard_args( Camera REQUIRED_VARS Camera_LIBS Camera_INCLUDE_DIRS ) \u2462 FindPackageHandleStandardArgs\u8be6\u89e3 6. XXXConfig.cmake \u5173\u4e8e XXXConfig.cmake \u6216 xxx-config.cmake \u7684\u5199\u6cd5\u4f1a\u5728\u540e\u7eed\u6587\u7ae0\u4e2d\u8be6\u7ec6\u8bf4\u660e\uff1a \u301009\u3011\u751f\u6210\u5668\u8868\u8fbe\u5f0f \u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5","title":"\u301008\u3011find_package \u8be6\u89e3"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#08find_package","text":"","title":"\u301008\u3011find_package \u8be6\u89e3"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#_1","text":"::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#1","text":"\u5148\u770b\u4ee5\u4e0b\u5bfb\u627e\u5e76\u5305\u542b OpenCV \u7684 CMakeLists.txt \u793a\u4f8b cmake_minimum_required(VERSION 3.10) project(Demo) find_package(OpenCV REQUIRED) add_executable(demo main.cpp) target_link_libraries( demo PRIVATE ${OpenCV_LIBS} ) \u8fd9\u662f\u4e00\u6bb5\u518d\u719f\u6089\u4e0d\u8fc7\u7684 CMakeLists.txt \u4ee3\u7801\uff0c\u6211\u4eec\u901a\u8fc7 find_package \u547d\u4ee4\u5bfb\u627e\u5230\u4e86OpenCV\u5e93\uff0c\u5e76\u83b7\u5f97\u4e86\u5176\u4e2d\u7684\u5bfc\u5165\u76ee\u6807\u5217\u8868\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 message \u9a8c\u8bc1\u4e00\u4e0b OpenCV_LIBS \u5305\u542b\u7684\u5185\u5bb9 foreach(m ${OpenCV_LIBS}) message(STATUS ${m}) endforeach() # \u8f93\u51fa\u7ed3\u679c # opencv_core;opencv_imgproc;opencv_highgui;opencv_imgcodecs; ... \u90a3\u4e48CMake\u662f\u5982\u4f55\u901a\u8fc7 find_package \u547d\u4ee4\u627e\u5230OpenCV\u5e76\u4e14\u5b8c\u6210\u914d\u7f6e\u7684\u5462?","title":"1. \u524d\u8a00"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#2-find_package","text":"Module \u6a21\u5f0f \u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c find_package \u9700\u8981\u89e3\u6790 Findxxx.cmake \u6587\u4ef6\uff0c\u8fd9\u4e5f\u662f find_package \u9ed8\u8ba4\u5de5\u4f5c\u7684\u6a21\u5f0f Config \u6a21\u5f0f \u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c find_package \u9700\u8981\u89e3\u6790 xxxConfig.cmake \u6587\u4ef6\u6216\u8005 xxx-config.cmake \u6587\u4ef6\u3002\u5b9e\u9645\u4e0a\u53ea\u6709 Findxxx.cmake \u6587\u4ef6\u65e0\u6cd5\u627e\u5230\uff0c\u5373 Module \u6a21\u5f0f\u6267\u884c\u4e0d\u6210\u529f\uff0c\u624d\u4f1a\u8fdb\u5165 Config \u6a21\u5f0f\u3002","title":"2. find_package \u89e3\u6790\u8fc7\u7a0b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#3-module","text":"","title":"3. Module \u6a21\u5f0f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#31","text":"Module \u6a21\u5f0f\u4e0b find_package \u7684\u53c2\u6570\u4e3a\uff1a find_package(<package> [VERSION] [EXACT] [QUIET] [MODULE] [REQUIRED] [[COMPONENTS] [components...]] [OPTIONAL_COMPONENTS components...] [NO_POLICY_SCOPE]) \u8fd9\u91cc\u5bf9\u4e0a\u8ff0\u63d0\u53ca\u5230\u7684\u53c2\u6570\u505a\u4e2a\u7b80\u5355\u7684\u89e3\u91ca\uff1a \u53c2\u6570\u540d\u79f0 \u53ef\u9009\u6027 \u540d\u79f0 \u5907\u6ce8 package \u5fc5\u586b \u9700\u8981\u67e5\u627e\u7684\u5305\u540d \u6ce8\u610f\u5927\u5c0f\u5199 VERSION \u53ef\u9009 \u6307\u5b9a\u7248\u672c\uff0c\u5982\u679c\u6307\u5b9a\u5c31\u5fc5\u987b\u68c0\u67e5\u627e\u5230\u7684 \u5305\u7684\u7248\u672c\u662f\u5426\u548c VERSION \u517c\u5bb9 EXACT \u53ef\u9009 \u5982\u679c\u6307\u5b9a\u8be5\u53c2\u6570\uff0c\u5219\u8868\u793a\u9700\u8981\u5bfb\u627e\u5fc5\u987b \u5b8c\u5168\u5339\u914d\u7684\u7248\u672c\u800c\u4e0d\u662f\u517c\u5bb9\u7248\u672c \u914d\u5408 VERSION \u4f7f\u7528 REQUIRED \u53ef\u9009 \u8868\u793a\u4e00\u5b9a\u8981\u627e\u5230\u5305\uff0c\u627e\u4e0d\u5230\u7684\u8bdd\u5c31\u7acb\u5373 \u505c\u6389\u6574\u4e2a CMake \u89e3\u6790\u8fc7\u7a0b QUIET \u53ef\u9009 \u8868\u793a\u5982\u679c\u67e5\u627e\u5931\u8d25\uff0c\u4e0d\u4f1a\u5728\u5c4f\u5e55\u8fdb\u884c\u8f93\u51fa \u4e0d\u5f97\u4e0e REQUIRED \u642d\u914d MODULE \u53ef\u9009 \u524d\u9762\u63d0\u5230\u8bf4 \u201c Module \u6a21\u5f0f\u6267\u884c\u5931\u8d25\uff0c \u624d\u4f1a\u8fdb\u5165 Config \u6a21\u5f0f\u201d\uff0c\u4f46\u662f\u5047\u5982\u52a0\u5165\u4e86 MODULE \u9009\u9879\uff0c\u90a3\u4e48\u5c31\u53ea\u5728 Module \u6a21\u5f0f \u67e5\u627e\uff0c\u5982\u679c Module \u6a21\u5f0f\u4e0b\u67e5\u627e\u5931\u8d25\u5e76\u4e0d \u5207\u6362\u5230 Config \u6a21\u5f0f\u67e5\u627e\u3002 COMPONENTS \u53ef\u9009 \u8868\u793a\u67e5\u627e\u7684\u5305\u4e2d\u5fc5\u987b\u8981\u627e\u5230\u7684\u7ec4\u4ef6 (components)\uff0c\u5982\u679c\u6709\u4efb\u4f55\u4e00\u4e2a\u627e\u4e0d\u5230 \u5c31\u7b97\u5931\u8d25\uff0c\u7c7b\u4f3c\u4e8e REQUIRED \uff0c\u5bfc\u81f4 CMake \u505c\u6b62\u6267\u884c\u3002","title":"3.1 \u7528\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#32","text":"#2 \u63d0\u5230\u8fc7\uff0cModule \u6a21\u5f0f\u4e0b\u9700\u8981\u67e5\u627e\u5230\u540d\u4e3a Find<PackageName>.cmake \u7684\u914d\u7f6e\u6587\u4ef6\u3002\u8be5\u6587\u4ef6\u7684\u67e5\u627e\u8fc7\u7a0b\u53ea\u6d89\u53ca\u5230\u4e24\u4e2a\u8def\u5f84\uff1a CMAKE_MODULE_PATH \u548c CMake \u5b89\u88c5\u8def\u5f84\u4e0b\u7684 Modules \u76ee\u5f55\u3002\u5373\uff0c\u641c\u7d22\u8def\u5f84\u4f9d\u6b21\u4e3a\uff1a \u5148\u5728 CMAKE_MODULE_PATH \u53d8\u91cf\u5bf9\u5e94\u7684\u8def\u5f84\u4e2d\u67e5\u627e\u3002\u5982\u679c\u8def\u5f84\u4e3a\u7a7a\uff0c\u6216\u8005\u8def\u5f84\u4e2d\u67e5\u627e\u5931\u8d25\uff0c\u5219\u5728 CMake \u5b89\u88c5\u76ee\u5f55\uff08\u5373 CMAKE_ROOT \u53d8\u91cf\uff09\u4e0b\u7684 Modules \u76ee\u5f55\u4e2d\u67e5\u627e\u3002\u8fd9\u4e2a\u76ee\u5f55\u901a\u5e38\u4e3a /usr/share/cmake-x.xx/Modules \u3002\u8fd9\u4e24\u4e2a\u53d8\u91cf\u53ef\u4ee5\u5728 CMakeLists.txt \u6587\u4ef6\u4e2d\u6253\u5370\u67e5\u770b\u5177\u4f53\u5185\u5bb9\uff1a \u5176\u4e2d CMAKE_MODULE_PATH \u9ed8\u8ba4\u4e3a\u7a7a\uff0c\u53ef\u4ee5\u5229\u7528 set \u547d\u4ee4\u5bf9\u8be5\u53d8\u91cf\u8fdb\u884c\u8bbe\u7f6e\u3002 \u5728\u5b89\u88c5 CMake \u65f6\uff0cCMake \u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u5f88\u591a\u5f00\u53d1\u5e93\u7684 FindXXX.cmake \u6a21\u5757\u6587\u4ef6\uff0c\u8fd9\u4e9b\u6587\u4ef6\u90fd\u5b9a\u4e49\u5728 CMAKE_ROOT \u6307\u4ee3\u8def\u5f84\u7684\u6587\u4ef6\u5939\u91cc\u9762\u3002\u53ef\u4ee5\u5728\u7ec8\u7aef\u901a\u8fc7\u952e\u5165\u4ee5\u4e0b\u547d\u4ee4\u8fdb\u884c\u67e5\u8be2","title":"3.2 \u6587\u4ef6\u641c\u7d22\u8fc7\u7a0b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#4-config","text":"","title":"4. Config \u6a21\u5f0f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#41","text":"Config \u6a21\u5f0f\u4e0b find_package \u7684\u5b8c\u6574\u547d\u4ee4\u53c2\u6570\u5982\u4e0b\uff0c\u4e0d\u5fc5\u5168\u90e8\u4e86\u89e3\u3002 \u76f8\u6bd4\u4e8e Module \u6a21\u5f0f\uff0c Config \u6a21\u5f0f\u7684\u53c2\u6570\u66f4\u591a\uff0c\u4e5f\u66f4\u590d\u6742\uff0c\u4f46\u5b9e\u9645\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u6211\u4eec\u5e76\u4e0d\u4f1a\u7528\u5230\u6240\u6709\u53c2\u6570\uff0c\u5927\u90e8\u5206\u53c2\u6570\u90fd\u662f\u53ef\u9009\u7684\uff0c\u6211\u4eec\u53ea\u9700\u8981\u638c\u63e1\u57fa\u672c\u7684\u53c2\u6570\u7528\u6cd5\u5373\u53ef\u3002 \u5176\u4e2d\u5177\u4f53\u67e5\u627e\u5e93\u5e76\u7ed9 XXX_INCLUDE_DIRS \u548c XXX_LIBS \u4e24\u4e2a\u53d8\u91cf\u8d4b\u503c\u7684\u64cd\u4f5c\u7531 XXXConfig.cmake \u6a21\u5757\u5b8c\u6210\u3002 \u4e24\u79cd\u6a21\u5f0f\u770b\u8d77\u6765\u4f3c\u4e4e\u5dee\u4e0d\u591a\uff0c\u4e0d\u8fc7 CMake \u9ed8\u8ba4\u91c7\u53d6 Module \u6a21\u5f0f\uff0c\u5982\u679c Module \u6a21\u5f0f\u672a\u627e\u5230\u5e93\uff0c\u624d\u4f1a\u91c7\u53d6 Config \u6a21\u5f0f\u3002\u603b\u4e4b\uff0c Config \u6a21\u5f0f\u662f\u4e00\u4e2a\u5907\u9009\u7b56\u7565\u3002\u901a\u5e38\uff0c\u5e93\u5b89\u88c5\u65f6\u4f1a\u62f7\u8d1d\u4e00\u4efd XXXConfig.cmake \u5230\u7cfb\u7edf\u76ee\u5f55\u4e2d\uff0c\u56e0\u6b64\u5728\u6ca1\u6709\u663e\u5f0f\u6307\u5b9a\u641c\u7d22\u8def\u5f84\u65f6\u4e5f\u53ef\u4ee5\u987a\u5229\u627e\u5230\u3002","title":"4.1 \u7528\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#42","text":"\u4e0e Module \u6a21\u5f0f\u4e0d\u540c\uff0c Config \u6a21\u5f0f\u9700\u8981\u67e5\u627e\u7684\u8def\u5f84\u975e\u5e38\u975e\u5e38\u975e\u5e38\u591a\uff0c\u4e5f\u8981\u5339\u914d\u5f88\u591a\u7684\u53ef\u80fd\u6027\uff0c\u56e0\u6b64\u6709\u4e9b\u8def\u5f84\u662f\u9996\u5148\u4f5c\u4e3a\u6839\u76ee\u5f55\uff0c\u7136\u540e\u8fdb\u884c\u5b50\u76ee\u5f55\u7684\u5339\u914d\uff0c\u800c\u6709\u4e9b\u5219\u662f\u76f4\u63a5\u6307\u5b9a\u5230\u5177\u4f53\u7684 XXXConfig.cmake \u6587\u4ef6\u3002\u5177\u4f53\u5c06\u4f1a\u6309\u7167\u5982\u4e0b\u987a\u5e8f\u8fdb\u884c\u67e5\u627e\uff1a <PackageName>_DIR CMAKE_PREFIX_PATH \u3001 CMAKE_FRAMEWORK_PATH \u3001 CMAKE_APPBUNDLE_PATH PATH \u73af\u5883\u53d8\u91cf\u8def\u5f84 CMAKE_SYSTEM_PREFIX_PATH \u7b49\u7cfb\u7edf\u53d8\u91cf\u8def\u5f84 \\<PackageName>_DIR \u9996\u5148\u641c\u7d22\u540d\u4e3a <PackageName>_DIR \u7684 CMake \u53d8\u91cf\u6216\u73af\u5883\u53d8\u91cf\u8def\u5f84\uff0c\u8fd9\u4e2a\u53d8\u91cf\u9ed8\u8ba4\u4e3a\u7a7a\u3002\u8fd9\u4e2a\u8def\u5f84\u9700\u8981\u76f4\u63a5\u6307\u5b9a\u5230 <PackageName>Config.cmake \u6216 <lower-case-package-name>-config.cmake \u6587\u4ef6\u6240\u5728\u76ee\u5f55\u624d\u80fd\u627e\u5230\uff0c\u53ef\u53c2\u8003\u4ee5\u4e0b\u793a\u4f8b\uff1a CMAKE_PREFIX_PATH \u7b49\u53d8\u91cf \u5982\u679c\u6309\u7167 <PackageName>_DIR \u641c\u7d22\u4e0d\u5230\u76f8\u5e94\u7684 XXXConfig.cmake \u6587\u4ef6\u7684\u8bdd\uff0c\u5219\u4f1a\u67e5\u627e\u540d\u4e3a CMAKE_PREFIX_PATH \u3001 CMAKE_FRAMEWORK_PATH \u3001 CMAKE_APPBUNDLE_PATH \u7684 CMake \u53d8\u91cf\u6216\u73af\u5883\u53d8\u91cf\u8def\u5f84\u3002\u8fd9\u4e9b\u53d8\u91cf\u6307\u5b9a\u7684\u8def\u5f84\u5c06\u4f5c\u4e3a\u67e5\u627e\u65f6\u7684\u6839\u76ee\u5f55\uff0c \u5b83\u4eec\u9ed8\u8ba4\u90fd\u4e3a\u7a7a \u3002\u6839\u76ee\u5f55\u7684\u76f8\u5173\u5185\u5bb9\u5728\u540e\u6587\u4f1a\u63d0\u53ca\u3002 ::: tip \u5982\u679c\u4f60\u7535\u8111\u4e2d\u5b89\u88c5\u4e86 ROS \u5e76\u914d\u7f6e\u597d\u4e4b\u540e\uff0c\u4f60\u5728\u7ec8\u7aef\u6267\u884c echo $CMAKE_PREFIX_PATH \u4f1a\u53d1\u73b0 ROS \u4f1a\u5c06 CMAKE_PREFIX_PATH \u8fd9\u4e2a\u53d8\u91cf\u8bbe\u7f6e\u4e3a ROS \u4e2d\u7684\u5e93\u7684\u8def\u5f84\uff0c\u610f\u601d\u662f\u4f1a\u9996\u5148\u67e5\u627e ROS \u5b89\u88c5\u7684\u5e93\uff0c\u5982\u679c\u6070\u597d\u4f60\u5728 ROS \u4e2d\u5b89\u88c5\u4e86 OpenCV \u5e93\uff0c\u5c31\u4f1a\u53d1\u73b0\u9996\u5148\u627e\u5230\u7684\u662f ROS \u4e2d\u7684 OpenCV \uff0c\u800c\u4e0d\u662f\u4f60\u81ea\u5df1\u5b89\u88c5\u5230\u7cfb\u7edf\u4e2d\u7684 OpenCV \u3002 ::: PATH \u73af\u5883\u53d8\u91cf\u8def\u5f84 \u82e5\u8fd8\u627e\u4e0d\u5230\uff0c\u5219\u662f\u641c\u7d22 PATH \u73af\u5883\u53d8\u91cf\u8def\u5f84\uff0c\u8fd9\u4e2a\u8def\u5f84\u4e5f\u662f\u6839\u76ee\u5f55\uff0c\u9ed8\u8ba4\u4e3a\u7cfb\u7edf\u73af\u5883 PATH \u73af\u5883\u53d8\u91cf\u503c\u3002 \u5176\u5b9e\u8fd9\u4e2a\u8def\u5f84\u624d\u662f Config \u6a21\u5f0f\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\u80fd\u591f\u67e5\u627e\u5230\u5b89\u88c5\u5230\u7cfb\u7edf\u4e2d\u5404\u79cd\u5e93\u7684\u539f\u56e0\u3002\u8fd9\u4e2a\u8def\u5f84\u7684\u67e5\u627e\u89c4\u5219\u4e3a\uff1a\u904d\u5386 PATH \u73af\u5883\u53d8\u91cf\u4e2d\u7684\u5404\u8def\u5f84\uff0c\u5982\u679c\u8be5\u8def\u5f84\u5982\u679c\u4ee5 bin \u6216 sbin \u7ed3\u5c3e\uff0c\u5219\u81ea\u52a8\u56de\u9000\u5230\u4e0a\u4e00\u7ea7\u76ee\u5f55\u5f97\u5230\u6839\u76ee\u5f55\u3002\u5728\u7ec8\u7aef\u952e\u5165\u4ee5\u4e0b\u5185\u5bb9\u4ee5\u67e5\u770b\u7cfb\u7edf\u73af\u5883\u53d8\u91cf\u8def\u5f84\uff1a bash echo $PATH \u4e00\u822c\u60c5\u51b5\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u8fd9\u91cc\u5bf9\u6bcf\u4e2a\u8def\u5f84\u90fd\u505a\u4e86\u6362\u884c\u5904\u7406\uff0c\u5e76\u4e14\u52a0\u4e86\u4e9b\u7b80\u5355\u7684\u6ce8\u91ca\u3002 bash /home/<user-name>/.local/bin: # \u56de\u9000\u5230 /home/<user-name>/.local \u540e\u518d\u8fdb\u884c\u641c\u7d22 /usr/local/sbin: # \u56de\u9000\u5230 /usr/local \u540e\u518d\u8fdb\u884c\u641c\u7d22 /usr/local/bin: # \u540c\u4e0a /usr/sbin: # \u56de\u9000\u5230 /usr \u540e\u518d\u8fdb\u884c\u641c\u7d22 /usr/bin: # \u540c\u4e0a /sbin: # \u56de\u9000\u5230 / \u540e\u518d\u8fdb\u884c\u641c\u7d22 /bin: # \u540c\u4e0a /usr/games: /usr/local/games: /snap/bin # \u56de\u9000\u5230 /snap \u540e\u518d\u8fdb\u884c\u641c\u7d22 \u8bf4\u660e\u8fd9\u4e9b\u8def\u5f84\u4f1a\u88ab\u9ed8\u8ba4\u6dfb\u52a0\u5728 Config \u6a21\u5f0f\u7684\u641c\u7d22\u8def\u5f84\u4e2d\u3002 CMAKE_SYSTEM_PREFIX_PATH \u7b49\u53d8\u91cf \u6211\u4eec\u5728\u5b89\u88c5 OpenCV \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5728 cmake-gui \u4e2d\u4fee\u6539 CMAKE_INSTALL_PREFIX \u53d8\u91cf\u7684\u5185\u5bb9\uff0c\u628a OpenCV \u5b89\u88c5\u5728 /opt/opencv \u4e0b\uff0c\u6211\u4eec\u5728\u4f7f\u7528 find_package \u65f6\u4e5f\u4e0d\u9700\u8981\u6307\u540d\u8def\u5f84\uff0c\u8bf4\u660e\u9664\u4e86\u4e0a\u9762\u7684\u4e00\u4e9b\u53d8\u91cf\u4e4b\u5916\uff0c\u8fd8\u5b58\u5728\u53e6\u5916\u4e00\u7cfb\u5217\u8def\u5f84\u3002\u8fd9\u91cc\u5217\u51fa\u6700\u91cd\u8981\u7684\u4e00\u4e2a\u53d8\u91cf\uff1a CMAKE_SYSTEM_PREFIX_PATH \u6211\u4eec\u53ef\u4ee5\u5728\u4e00\u4e2a CMakeLists.txt \u6587\u4ef6\u4e0b\uff0c\u8f93\u5165\u4ee5\u4e0b\u5185\u5bb9\uff1a cmake foreach(path ${CMAKE_SYSTEM_PREFIX_PATH}) message(STATUS \"${path}\") endforeach() \u4f1a\u6253\u5370\u51fa\u4ee5\u4e0b\u5185\u5bb9 txt -- /usr/local -- /usr -- / -- /usr/local -- /usr/local -- /usr/X11R6 -- /usr/pkg -- /opt \u7559\u610f\u8be5\u53d8\u91cf\u6700\u540e\u4e00\u70b9\u5305\u542b\u7684\u5185\u5bb9\uff0c\u8fd9\u6b63\u662f\u6211\u4eec\u53ef\u4ee5\u628a\u7b2c\u4e09\u65b9\u5e93\u5b89\u88c5\u5728 /opt \u7684\u539f\u56e0\u3002\u4e8b\u5b9e\u4e0a\uff0c\u5f88\u591a\u8f6f\u4ef6\u5305\u90fd\u662f\u9ed8\u8ba4\u5b89\u88c5\u5728 /opt \u4e0b\u7684\uff0c\u8b6c\u5982 ROS\u3002 ::: tip \u8865\u5145 \u76f8\u5173\u5305\u542b\u7684\u5185\u5bb9\u8fd8\u6709\u975e\u5e38\u4e4b\u591a\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u9605\u8bfb\u5b98\u7f51\u548c\u6e90\u7801\uff0c\u8fd9\u91cc\u7ed9\u51fa\u5b98\u7f51\u548c\u6e90\u7801 GitLab \u5730\u5740\uff1a - find_package \u5bfb\u627e\u5305\u542b\u8def\u5f84\u7684\u6e90\u7801 GitLab\uff1a \u6e90\u7801 GitLab \u5730\u5740 - find_package \u5bfb\u627e\u5305\u542b\u8def\u5f84\u7684\u5b98\u7f51\uff1a \u5b98\u7f51\u7f51\u5740 :::","title":"4.2 \u6587\u4ef6\u641c\u7d22\u8fc7\u7a0b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#43","text":"\u4e0a\u8ff0\u63d0\u53ca\u5230\u7684\u6839\u76ee\u5f55\u8def\u5f84\uff0c\u5728\u6307\u660e\u8fd9\u4e9b\u5185\u5bb9\u65f6\uff0cCMake \u4f1a\u9996\u5148\u68c0\u67e5\u8fd9\u4e9b\u6839\u76ee\u5f55\u8def\u5f84\u4e0b\u662f\u5426\u6709\u540d\u4e3a <PackageName>Config.cmake \u6216 <lower-case-package-name>-config.cmake \u7684\u6a21\u5757\u6587\u4ef6\uff0c\u5982\u679c\u6ca1\u6709\uff0cCMake \u4f1a\u7ee7\u7eed\u68c0\u67e5\u6216\u5339\u914d\u8fd9\u4e9b\u6839\u76ee\u5f55\u4e0b\u7684\u4ee5\u4e0b\u8def\u5f84\uff1a <prefix>/(lib/<arch>|lib|share)/cmake/<name>*/ <prefix>/(lib/<arch>|lib|share)/<name>*/ <prefix>/(lib/<arch>|lib|share)/<name>*/(cmake|CMake)/ \u5176\u4e2d\u4e3a arch \u7cfb\u7edf\u67b6\u6784\u540d\uff0c\u5982 Ubuntu \u4e0b\u4e00\u822c\u4e3a\uff1a x86_64-linux-gnu \uff0c\u6574\u4e2a (lib/<arch>|lib|share) \u4e3a\u53ef\u9009\u8def\u5f84\uff0c\u4f8b\u5982 OpenCV \u5e93\u800c\u8a00\u4f1a\u68c0\u67e5\u6216\u5339\u914d\u4ee5\u4e0b\u5185\u5bb9\uff1a <prefix>/lib/x86_64-linux-gnu/opencv4/ <prefix>/lib/cmake/opencv4/ <prefix>/share/opencv4/ \u2026\u2026 ::: warning \u4e0a\u6587\u63d0\u53ca\u8fc7\u7684 <PackageName>_DIR \u8def\u5f84\u4e0d\u662f\u6839\u76ee\u5f55\u8def\u5f84 :::","title":"4.3 \u6839\u76ee\u5f55\u8def\u5f84\u8be6\u89e3"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#5-findxxxcmake","text":"\u6211\u4eec\u4f7f\u7528 Module \u6a21\u5f0f\uff0c\u5199\u4e00\u4e2a FindXXX.cmake \u6587\u4ef6\uff0c\u6765\u4f53\u9a8c\u4e00\u4e0b\u81ea\u5df1\u7684 find_package","title":"5. FindXXX.cmake \u7b80\u5355\u5199\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#51","text":"\u5047\u8bbe\u67d0\u5bb6\u76f8\u673a\u5382\u5546\u7684 SDK \u63d0\u4f9b\u4e86\u4ee5\u4e0b\u5185\u5bb9\uff0c\u5047\u8bbe\u5c06\u5176\u653e\u5728\u4e86 /opt/camera \u6587\u4ef6\u5939\u4e0b\uff0c\u8bf7\u521b\u5efa\u4e00\u4e2a CameraDemo \u9879\u76ee\uff0c\u5e76\u8bbe\u8ba1\u4e00\u4e2a FindCamera.cmake \u6587\u4ef6\u4f9b\u672c\u9879\u76ee\u4e2d\u7684\u5176\u4f59\u76ee\u6807\u5305\u542b\uff0c\u4f7f\u5176\u80fd\u591f\u94fe\u63a5\u81f3\u672c\u76f8\u673a\u7684 SDK\u3002 . \u251c\u2500\u2500 include \u2502 \u251c\u2500\u2500 CameraApi.h \u2502 \u251c\u2500\u2500 CameraDefine.h \u2502 \u2514\u2500\u2500 CameraStatus.h \u2514\u2500\u2500 lib \u2514\u2500\u2500 libMVSDK.so","title":"5.1 \u6848\u4f8b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#52","text":"\u6211\u4eec\u5728 \u301005\u3011\u76ee\u6807\u6784\u5efa \u7684\u5bfc\u5165\u76ee\u6807\u4e2d\u9047\u5230\u8fc7\u7c7b\u4f3c\u7684\u60c5\u51b5\uff0c\u4f46\u8fd9\u91cc\u7684\u76f8\u673a SDK \u5e76\u6ca1\u6709\u4f4d\u4e8e\u672c\u9879\u76ee\u4e2d\u3002 \u6ce8\u610f\u5230\u76f8\u673a\u5382\u5546\u7684 SDK \u5e76\u65e0\u63d0\u4f9b\u76f8\u5e94\u7684 CameraConfig.cmake \u6216 camera-config.cmake \u6587\u4ef6\uff0c\u56e0\u6b64\u9700\u8981\u81ea\u5df1\u624b\u5199 FindCamera.cmake \u6587\u4ef6\u3002 \u6211\u4eec\u5148\u628a\u76f8\u673a\u9879\u76ee\u7684\u90e8\u7f72\u6846\u67b6\u7ed9\u5927\u6982\u5b9a\u4e49\u597d\uff1a . \u251c\u2500\u2500 cmake \u2502 \u2514\u2500\u2500 FindCamera.cmake \u251c\u2500\u2500 CMakeLists.txt \u2514\u2500\u2500 main.cpp \u6d89\u53ca\u5230\u7684\u4e24\u4e2a CMake \u6587\u4ef6\u5df2\u7ecf\u6807\u7ea2\uff0c\u8fd9\u91cc\u7b80\u5355\u63cf\u8ff0\u4e00\u4e0b FindCamera.cmake \uff1a\u5176\u4ed6\u5e93\u76f4\u63a5\u5305\u542b\u3001\u94fe\u63a5 SDK \u63d0\u4f9b\u7684\u5e93\u80af\u5b9a\u662f\u4e0d\u884c\u7684\uff0c\u9700\u8981\u4e8b\u5148\u627e\u5230 SDK \u7684\u8def\u5f84\uff0c\u6b64\u6587\u4ef6\u5c31\u662f\u4e3a\u4e86\u63d0\u524d\u8ba9\u6574\u4e2a CMake \u5de5\u7a0b\u627e\u5230\u6b64 SDK\u3002 \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMakeLists.txt \uff1a\u6846\u67b6\u6574\u4f53\u914d\u7f6e\uff0c\u5305\u62ec\u9879\u76ee\u3001\u7f16\u8bd1\u5c5e\u6027\u3001\u53ef\u6267\u884c\u7a0b\u5e8f\u7684\u914d\u7f6e\u3002\u8fd9\u91cc main.cpp \u76f4\u63a5\u7528\u5230\u4e86 SDK \u7684\u5185\u5bb9\uff0c\u901a\u8fc7\u4ee5\u4e0b\u8bed\u53e5\u8fdb\u884c\u94fe\u63a5 cmake target_link_libraries( demo PRIVATE camera )","title":"5.2 \u5206\u6790"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#53","text":"","title":"5.3 \u914d\u7f6e"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#531-cmakeliststxt","text":"\u2460 \u4e3b\u8981\u76ee\u7684 \u8bbe\u7f6e CMAKE_MODULE_PATH \u6a21\u5757\u6a21\u5f0f\u7684\u5de5\u4f5c\u8def\u5f84 \u89e3\u6790 FindCamera.cmake \uff0c\u5e76\u627e\u5230 camera \u5bf9\u5e94\u7684\u5e93 \u521b\u5efa\u53ef\u6267\u884c\u7a0b\u5e8f\u76ee\u6807\u5e76\u94fe\u63a5 \u2461 \u793a\u4f8b\u4ee3\u7801 cmake_minimum_required(VERSION 3.10) project(CameraDemo) # \u672c\u7bc7 2.2.2 \u8282\u63d0\u53ca\u8fc7\uff0c\u4e0b\u4e00\u53e5\u662f\u8ba9 CMake \u5de5\u7a0b\u80fd\u591f\u627e\u5230 FindCamera.cmake list(CMAKE_MODULE_PATH APPEND \"${CMAKE_SOURCE_DIR}/cmake\") # \u627e\u5230 SDK find_package(Camera) # \u6dfb\u52a0\u53ef\u6267\u884c\u6587\u4ef6\u5e76\u94fe\u63a5 add_executable(demo main.cpp) target_link_libraries( demo PRIVATE camera )","title":"5.3.1 \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMakeLists.txt"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#532-findcameracmake","text":"\u2460 \u4e3b\u8981\u4efb\u52a1 \u63d0\u4f9b\u4e00\u4e2a CMake \u76ee\u6807\u53d8\u91cf\uff08\u4e00\u822c\u662f\u5bfc\u5165\u76ee\u6807\uff09 \u627e\u5230 SDK \u7684\u5934\u6587\u4ef6 \u627e\u5230 SDK \u7684\u5e93\u6587\u4ef6 \u63d0\u4f9b\u6709\u65e0\u627e\u5230\u7684\u72b6\u6001\u4fe1\u606f \u2461 \u8be6\u7ec6\u6ce8\u91ca\u7684\u793a\u4f8b\u4ee3\u7801 # \u8bbe\u7f6e mvsdk \u7684\u8def\u5f84\uff08\u53ef\u81ea\u884c\u8bbe\u7f6e\uff09 set(mvsdk_root \"/opt/camera\") # \u53d1\u73b0\u5934\u6587\u4ef6\u8def\u5f84\uff0c\u5e76\u8bbe\u7f6e Camera_INCLUDE_DIRS find_path( Camera_INCLUDE_DIR NAMES CameraApi.h CameraDefine.h CameraStatus.h PATHS \"${mvsdk_root}/include\" NO_DEFAULT_PATH # \u9ed8\u8ba4\u8def\u5f84\u4e0b\u4f1a\u5305\u542b /usr/local \u7b49\u5185\u5bb9\uff0c\u8fd9\u53e5\u8bdd\u8868\u660e\u4e0d\u5305\u542b\u9ed8\u8ba4\u8def\u5f84 ) # \u53d1\u73b0\u5e93\u6587\u4ef6\u8def\u5f84 find_library( Camera_LIB NAMES \"libMVSDK.so\" PATHS \"${mvsdk_root}/lib\" NO_DEFAULT_PATH # \u540c find_path ) # \u8bbe\u7f6e\u5bfc\u5165\u76ee\u6807\uff0c\u79f0\u4e3a mvsdk if(NOT TARGET mvsdk) # \u5c06\u76ee\u6807\u8bbe\u7f6e\u4e3a\u5728\u9879\u76ee\u4e2d\u5168\u5c40\u53ef\u89c1 GLOBAL add_library(mvsdk SHARED IMPORTED GLOBAL) # \u4e3a\u5bfc\u5165\u76ee\u6807\u6dfb\u52a0\u76f8\u5173\u5c5e\u6027 set_target_properties(mvsdk PROPERTIES INTERFACE_INCLUDE_DIRECTORIES \"${Camera_INCLUDE_DIR}\" IMPORTED_LOCATION \"${Camera_LIB}\" ) endif() set(Camera_INCLUDE_DIRS ${Camera_INCLUDE_DIR}) set(Camera_LIBS mvsdk) # \u8fd9\u91cc\u7528\u5230\u4e86\u4e00\u4e2a CMake \u81ea\u5e26\u7684\u51fd\u6570\uff0c\u4f1a\u6839\u636e\u6307\u5b9a\u5185\u5bb9\u8bbe\u7f6e Camera_FOUND \u53d8\u91cf include(FindPackageHandleStandardArgs) # \u610f\u4e3a\u5fc5\u9700\u7684\u53c2\u6570\u662f Camera_LIBS\uff0c\u5982\u679c Camera_LIBS \u4e3a\u7a7a\uff0c\u5219 Camera_FOUND # \u5c06\u88ab\u8bbe\u7f6e\u4e3a FALSE\uff0c\u5e76\u5728\u4f7f\u7528 find_package(Camera REQUIRED) \u65f6\u4e5f\u4f1a\u62a5\u9519 find_package_handle_standard_args( Camera REQUIRED_VARS Camera_LIBS Camera_INCLUDE_DIRS ) \u2462 FindPackageHandleStandardArgs\u8be6\u89e3","title":"5.3.2 FindCamera.cmake"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/08/#6-xxxconfigcmake","text":"\u5173\u4e8e XXXConfig.cmake \u6216 xxx-config.cmake \u7684\u5199\u6cd5\u4f1a\u5728\u540e\u7eed\u6587\u7ae0\u4e2d\u8be6\u7ec6\u8bf4\u660e\uff1a \u301009\u3011\u751f\u6210\u5668\u8868\u8fbe\u5f0f \u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5","title":"6. XXXConfig.cmake"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/","text":"\u301009\u3011\u751f\u6210\u5668\u8868\u8fbe\u5f0f \u6559\u5b66\u89c6\u9891 ::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili 1. \u524d\u8a00 1.1 CMake \u5de5\u4f5c\u6d41\u7a0b CMake \u5de5\u4f5c\u6d41\u7a0b\u5206\u4e3a\u4e24\u6b65\uff0c==\u914d\u7f6e\u9636\u6bb5==\u548c==\u751f\u6210\u9636\u6bb5==\u3002\u6211\u4eec\u5728\u547d\u4ee4\u884c\u4e2d\u8f93\u5165 cmake .. \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5728\u8f93\u51fa\u5185\u5bb9\u7684\u6700\u540e\u770b\u5230\u8fd9\u6837\u7684\u4e24\u884c\u8bdd -- Configuring done -- Generating done \u5206\u522b\u6307\u4ee3\u4e86\u8fd9\u4e24\u4e2a\u9636\u6bb5 1.1.1 Configure \u9636\u6bb5 \u5728\u8fd9\u4e2a\u9636\u6bb5\uff0cCMake \u4f1a\u8bfb\u53d6\u4f60\u7684 CMakeLists.txt \u6587\u4ef6\uff0c\u5e76\u6267\u884c\u5176\u4e2d\u7684\u547d\u4ee4\u3002\u8fd9\u4e9b\u547d\u4ee4\u53ef\u80fd\u4f1a\u68c0\u67e5\u7cfb\u7edf\u7684\u7279\u6027\uff08\u4f8b\u5982\uff0c\u67e5\u627e\u5e93\u6216\u8005\u7f16\u8bd1\u5668\u7279\u6027\uff09\uff0c\u8bbe\u7f6e\u53d8\u91cf\uff0c\u6216\u8005\u5b9a\u4e49\u6784\u5efa\u76ee\u6807\uff08\u4f8b\u5982\u5e93\u3001\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u6216\u8005\u5176\u4ed6\u4f2a\u76ee\u6807\uff09\u3002\u8fd9\u4e2a\u9636\u6bb5\u7684\u4e3b\u8981\u76ee\u7684\u662f\u786e\u5b9a\u6784\u5efa\u8fc7\u7a0b\u9700\u8981\u7684\u6240\u6709\u4fe1\u606f\u3002 1.1.2 Generate \u9636\u6bb5 \u5728\u6b64\u9636\u6bb5 CMake \u4f1a\u751f\u6210\u5b9e\u9645\u7684\u5efa\u6784\u6863\u3002\u8fd9\u4e9b\u6587\u4ef6\u5305\u542b\u4e86\u5b9e\u9645\u7f16\u8bd1\u548c\u94fe\u63a5\u4f60\u7684\u4ee3\u7801\u6240\u9700\u8981\u7684\u547d\u4ee4\uff0c\u5305\u62ec \u5404\u79cd\u7f16\u8bd1\u9009\u9879 \u4e0e\u76ee\u6807\u76f8\u5173\u7684\u64cd\u4f5c \u7684\u547d\u4ee4\u90fd\u662f\u5728\u751f\u6210\u9636\u6bb5\u6dfb\u52a0\u81f3\u5efa\u6784\u6863\u4e2d\u7684\u3002\u6bd4\u65b9\u8bf4 target_include_directories( demo PUBLIC include ) target_link_libraries( demo PRIVATE core ) \u8fd9\u4e24\u4e2a\u547d\u4ee4\u5747\u751f\u6548\u4e8e==\u751f\u6210\u9636\u6bb5==\u3002\u800c\u540e\u6587\u51c6\u5907\u4ecb\u7ecd\u7684\u751f\u6210\u5668\u8868\u8fbe\u5f0f\uff0c\u5c31\u4f5c\u7528\u4e8e\u751f\u6210\u9636\u6bb5\u3002\u4e5f\u6b63\u56e0\u5982\u6b64\uff0c\u53ea\u6709\u80fd\u591f\u5728\u751f\u6210\u9636\u6bb5\u751f\u6548\u7684\u547d\u4ee4\u624d\u80fd\u4f7f\u7528\u751f\u6210\u5668\u8868\u8fbe\u5f0f\uff0c\u800c\u5728\u914d\u7f6e\u9636\u6bb5\u751f\u6548\u7684\u547d\u4ee4\uff0c\u4f8b\u5982\u7528\u4e8e\u8bbe\u7f6e\u53d8\u91cf\u7684 set \u547d\u4ee4\u5e76\u4e0d\u652f\u6301\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u3002 1.2 CMake \u7684\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u662f\u4ec0\u4e48 \u751f\u6210\u5668\u8868\u8fbe\u5f0f\u5728\u751f\u6210\u6784\u5efa\u7cfb\u7edf\u671f\u95f4\u8fdb\u884c\u8ba1\u7b97\uff0c\u4ee5\u751f\u6210\u7279\u5b9a\u4e8e\u6bcf\u4e2a\u751f\u6210\u914d\u7f6e\u7684\u4fe1\u606f\u3002\u4ed6\u4eec\u6709\u5982\u4e0b\u5f62\u5f0f\uff1a $<...> \u3002\u53ef\u53c2\u8003 Generator Expression \u3002 1.3 \u4e3a\u4ec0\u4e48\u8981\u5f15\u5165\u751f\u6210\u5668\u8868\u8fbe\u5f0f \u5728\u8bbe\u7f6e\u67d0\u4e9b\u7f16\u8bd1\u9009\u9879\u7684\u65f6\u5019\uff0c\u5982\u679c\u5f53\u6761\u4ef6\u8f83\u591a\uff0c\u8981\u5236\u4f5c\u7684\u7f16\u8bd1\u9009\u9879\u7248\u672c\u4e5f\u76f8\u5e94\u589e\u591a\u3002\u8fd9\u65f6\u53ef\u4ee5\u4f7f\u7528\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u8bed\u6cd5\uff0c\u8ba9\u4e00\u90e8\u5206\u7f16\u8bd1\u4fe1\u606f\u5728\u751f\u6210\u9636\u6bb5\u81ea\u52a8\u5b8c\u6210\uff0c\u65e0\u9700\u5728\u914d\u7f6e\u9636\u6bb5\u8bbe\u7f6e\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a # \u73b0\u8ba1\u5212\u7ed9 Debug \u548c Release \u4e24\u79cd\u6784\u5efa\u7c7b\u578b\u6dfb\u52a0\u4e0d\u540c\u7684\u7f16\u8bd1\u9009\u9879 set(CMAKE_C_FLAGS_DEBUG \"${CMAKE_C_FLAGS_DEBUG} -g -O0\") set(CMAKE_CXX_FLAGS_DEBUG \"${CMAKE_CXX_FLAGS_DEBUG} -g -O0\") set(CMAKE_C_FLAGS_RELEASE \"${CMAKE_C_FLAGS_RELEASE} -O2\") set(CMAKE_CXX_FLAGS_RELEASE \"${CMAKE_CXX_FLAGS_RELEASE} -O2\") # \u4f7f\u7528\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u53ef\u4ee5\u7b80\u5316\u6210 add_compile_options( $<$<CONFIG:Debug>:-g -O0> $<$<CONFIG:Release>:-O2> ) \u8fd9\u91cc\u7684 add_compile_options \u5c31\u5c5e\u4e8e\u5728\u751f\u6210\u9636\u6bb5\u751f\u6548\u7684\u547d\u4ee4\u3002\u4ee5\u4e0a\u4ee3\u7801\u5c5e\u4e8e==\u6761\u4ef6\u5b9a\u4e49==\uff0c\u5373\u5728\u4e0d\u540c\u7684\u6761\u4ef6\u4e0b\u751f\u6210\u4e0d\u540c\u7684\u53d8\u91cf\u3001\u5b8f\u7b49\u5185\u5bb9\u3002\u5176\u4e2d\u8fd9\u6bb5\u4ee3\u7801\u4f7f\u7528\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u7684\u6548\u679c\u662f\uff0c\u5728\u4e0d\u540c\u7684\u6784\u5efa\u7c7b\u578b\u4e0b\uff08Debug\u3001Release\uff09\uff0c\u4f1a\u751f\u6210\u4e0d\u540c\u7684\u88ab\u6dfb\u52a0\u8fdb\u7f16\u8bd1\u9009\u9879\u7684\u5b57\u7b26\u4e32\u3002 2. \u5e38\u7528\u751f\u6210\u5668\u8868\u8fbe\u5f0f 2.1 \u5e03\u5c14\u751f\u6210\u5668\u8868\u8fbe\u5f0f 2.1.1 \u903b\u8f91\u8fd0\u7b97\u7b26 $<BOOL:string> \u5982\u679c\u5b57\u7b26\u4e32\u4e3a\u7a7a\u3001 0 \u3001\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684 FALSE \u3001 OFF \u3001 N \u3001 NO \u3001 IGNORE \u3001 NOTFOUND \uff0c\u6216\u8005\u533a\u5206\u5927\u5c0f\u5199\u7684\u4ee5 -NOTFOUND \u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\uff0c\u5219\u8868\u8fbe\u5f0f\u7684\u503c\u4e3a 0 \uff0c\u5426\u5219\u4e3a 1 ```cmake add_library(mylib ${SOURCES}) target_compile_definitions(mylib PUBLIC $<$ :USE_OTHERLIB> ) ``` \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c $<BOOL:${USE_OTHERLIB}> \u4f1a\u68c0\u67e5\u53d8\u91cf USE_OTHERLIB \u662f\u5426\u4e3a\u5047\u3002\u5982\u679c USE_OTHERLIB \u4e3a\u5047\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u5c31\u4f1a\u8fd4\u56de 0 \uff0c\u5426\u5219\u8fd4\u56de 1 \u3002\u7136\u540e\uff0c $<1:USE_OTHERLIB> \u4f1a\u5728\u524d\u9762\u7684\u8868\u8fbe\u5f0f\u4e3a\u771f\u65f6\u6dfb\u52a0\u4e00\u4e2a\u7f16\u8bd1\u5b9a\u4e49 USE_OTHERLIB \u3002 $<AND:conditions> \uff1a\u903b\u8f91\u4e0e conditons \u662f\u4ee5\u9017\u53f7\u5206\u5272\u7684==\u6761\u4ef6\u5217\u8868==\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u6761\u4ef6\u662f\u5217\u8868\u7684\uff0c\u90fd\u662f\u4f7f\u7528\u9017\u53f7\u8fdb\u884c\u5206\u5272\uff0c\u540e\u6587\u4e0d\u518d\u8d58\u8ff0\u3002\u903b\u8f91\u8fd0\u7b97\u6761\u4ef6\u6210\u7acb\uff0c\u8868\u8fbe\u5f0f\u7684\u503c\u4e3a 0 \uff0c\u5426\u5219\u4e3a 1 \uff0c\u540e\u6587\u4e0d\u518d\u8d58\u8ff0\u3002 ```cmake add_library(mylib ${SOURCES}) target_compile_definitions(mylib PUBLIC $<$ ,$\\ >:USE_OTHERLIB> ) ``` \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c $<AND:$<CONFIG:Debug>,$<TARGET_EXISTS:otherlib>> \u4f1a\u5728\u5f53\u524d\u914d\u7f6e\u4e3a Debug \u5e76\u4e14\u76ee\u6807 otherlib \u5b58\u5728\u65f6\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 \u3002\u7136\u540e\uff0c $<1:USE_OTHERLIB> \u4f1a\u5728\u524d\u9762\u7684\u8868\u8fbe\u5f0f\u4e3a\u771f\u65f6\u6dfb\u52a0\u4e00\u4e2a\u7f16\u8bd1\u5b9a\u4e49 USE_OTHERLIB \u3002 $<OR:conditions> \uff1a\u903b\u8f91\u6216 \u5728\u7ed9\u5b9a\u7684\u4efb\u4f55\u6761\u4ef6\u4e3a\u771f\u65f6\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 ```cmake add_library(mylib ${SOURCES}) target_compile_definitions(mylib PUBLIC $<$ ,$\\ >:USE_OTHERLIB> ) ``` \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c $<OR:$<CONFIG:Debug>,$<TARGET_EXISTS:otherlib>> \u4f1a\u5728\u5f53\u524d\u914d\u7f6e\u4e3a Debug \u6216\u8005\u76ee\u6807 otherlib \u5b58\u5728\u65f6\u8fd4\u56de 1\uff0c\u5426\u5219\u8fd4\u56de 0\u3002\u7136\u540e\uff0c $<1:USE_OTHERLIB> \u4f1a\u5728\u524d\u9762\u7684\u8868\u8fbe\u5f0f\u4e3a\u771f\u65f6\u6dfb\u52a0\u4e00\u4e2a\u7f16\u8bd1\u5b9a\u4e49 USE_OTHERLIB \u3002 $<NOT:condition> \uff1a\u903b\u8f91\u975e \u5728\u7ed9\u5b9a\u7684\u6761\u4ef6\u4e3a\u5047\u65f6\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 ```cmake add_library(mylib ${SOURCES}) target_compile_definitions(mylib PUBLIC $<$ >:USE_OTHERLIB> ) ``` \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c $<NOT:$<TARGET_EXISTS:otherlib>> \u4f1a\u5728\u76ee\u6807 otherlib \u4e0d\u5b58\u5728\u65f6\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 \u3002\u7136\u540e\uff0c $<1:USE_OTHERLIB> \u4f1a\u5728\u524d\u9762\u7684\u8868\u8fbe\u5f0f\u4e3a\u771f\u65f6\u6dfb\u52a0\u4e00\u4e2a\u7f16\u8bd1\u5b9a\u4e49 USE_OTHERLIB \u3002 2.1.2 \u5b57\u7b26\u4e32\u6bd4\u8f83 $<STREQUAL:string1,string2> \u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49 $<EQUAL:value1,value2> \u5224\u65ad\u6570\u503c\u662f\u5426\u76f8\u7b49 $<IN_LIST:string,list> \u5224\u65ad string \u662f\u5426\u5305\u542b\u5728 list \u4e2d\uff0c list \u4f7f\u7528\u5206\u53f7\u5206\u5272 ::: warning \u8fd9\u91cc\u7684 list \u662f\u5728\u9017\u53f7\u540e\u9762\u7684\u5217\u8868\uff0c\u5373 ${...} \u6240\u8868\u793a\u7684\u5185\u5bb9\uff0c\u56e0\u6b64\u5176\u5185\u5bb9\u9700\u8981\u4f7f\u7528\u5206\u53f7\u5206\u5272\u3002 ::: 2.1.3 \u53d8\u91cf\u67e5\u8be2 $<TARGET_EXISTS:target> \u5224\u65ad\u76ee\u6807\u662f\u5426\u5b58\u5728 $<CONFIG:cfgs> \u5224\u65ad\u7f16\u8bd1\u7c7b\u578b\u914d\u7f6e\u662f\u5426\u5305\u542b\u5728 cfgs \u5217\u8868\uff08\u6bd4\u5982\"Release\uff0cDebug\"\uff09\u4e2d\uff1b\u4e0d\u533a\u5206\u5927\u5c0f\u5199 $<PLATFORM_ID:platform_ids> \u5224\u65adCMake\u5b9a\u4e49\u7684\u5e73\u53f0ID\u662f\u5426\u5305\u542b\u5728 platform_ids \u5217\u8868\u4e2d $<COMPILE_LANGUAGE:languages> \u5224\u65ad\u7f16\u8bd1\u8bed\u8a00\u662f\u5426\u5305\u542b\u5728 languages \u5217\u8868\u4e2d 2.2 \u5b57\u7b26\u4e32\u751f\u6210\u5668\u8868\u8fbe\u5f0f \u4f7f\u7528\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u7684\u4e3b\u8981\u76ee\u7684\u53ef\u80fd\u5c31\u662f\u56e0\u4e3a\u6b64\u529f\u80fd\u4e86\u3002\u6bd4\u5982 CMake \u5b98\u65b9\u7684\u4f8b\u5b50\uff1a\u57fa\u4e8e\u7f16\u8bd1\u5668 ID \u6307\u5b9ainclude\u76ee\u5f55\uff1a include_directories(\"/usr/include/$<CXX_COMPILER_ID>/\") \u6839\u636e\u7f16\u8bd1\u5668\u7684\u7c7b\u578b\uff0c $<CXX_COMPILER_ID> \u4f1a\u88ab\u66ff\u6362\u6210\u5bf9\u5e94\u7684ID\uff08\u6bd4\u5982\u201cGNU\u201d\u3001\u201cClang\u201d\uff09\u3002 2.2.1 \u6761\u4ef6\u8868\u8fbe\u5f0f $<condition:true_string> \u5982\u679c\u6761\u4ef6\u4e3a\u771f\uff0c\u5219\u7ed3\u679c\u4e3a true_string \uff0c\u5426\u5219\u4e3a\u7a7a $<IF:condition,str1,str2> \u5982\u679c\u6761\u4ef6\u4e3a\u771f\uff0c\u5219\u7ed3\u679c\u4e3a str1 \uff0c\u5426\u5219\u4e3a str2 2.2.2 \u5b57\u7b26\u4e32\u8f6c\u6362 $<LOWER_CASE:string> \u5c06\u5b57\u7b26\u4e32\u8f6c\u4e3a\u5c0f\u5199 ```cmake add_library(mylib ${SOURCES}) set(TARGET_NAME \"MYLIB\") target_compile_definitions(mylib PUBLIC TARGET_NAME=$ ) ``` \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c $<LOWER_CASE:${TARGET_NAME}> \u4f1a\u5c06 TARGET_NAME \u53d8\u91cf\u7684\u503c\u8f6c\u6362\u4e3a\u5c0f\u5199\u3002\u7136\u540e\uff0c\u8fd9\u4e2a\u5c0f\u5199\u7684\u503c\u4f1a\u88ab\u8d4b\u7ed9\u7f16\u8bd1\u5b9a\u4e49 TARGET_NAME \u3002 \u6240\u4ee5\uff0c mylib \u4f1a\u88ab\u7f16\u8bd1\u65f6\u5b9a\u4e49 TARGET_NAME \u4e3a mylib \u3002 $<UPPER_CASE:string> \uff0c\u5c06\u5b57\u7b26\u4e32\u8f6c\u4e3a\u5927\u5199 \u751f\u6210\u5668\u8868\u8fbe\u5f0f\u79cd\u7c7b\u7e41\u591a\uff0c\u8fd9\u91cc\u4e0d\u518d\u4e00\u4e00\u5217\u4e3e 3. \u6784\u5efa\u5b89\u88c5\u8868\u8fbe\u5f0f \u8be5\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u5c5e\u4e8e \u5b57\u7b26\u4e32\u751f\u6210\u5668\u8868\u8fbe\u5f0f \u7684\u4e00\u79cd\u3002\u8fd9\u4e2a\u95ee\u9898\u6765\u81ea\u4e8e \u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5 \uff0c\u4f46\u4e0d\u770b\u5e76\u4e0d\u5f71\u54cd\u77e5\u8bc6\u70b9\u7684\u8bb2\u89e3\uff0c\u4e0b\u9762\u7ed9\u51fa\u8fd9\u4e2a\u95ee\u9898\u7684\u4ea7\u751f\u539f\u56e0\u3002 3.1 \u95ee\u9898\u5f15\u51fa \u5728\u5b89\u88c5\u5bfc\u51fa\u76ee\u6807\u7684\u65f6\u5019\uff0c\u5982\u679c\u5bfc\u51fa\u76ee\u6807\u4e2d\u5305\u542b\u7684\u76ee\u6807\u4f7f\u7528\u4e86 target_include_directories \u547d\u4ee4\uff0c\u4f8b\u5982 target_include_directories( my_target PUBLIC include ) \u5219\u6267\u884c cmake .. \u7684\u64cd\u4f5c\u540e\u4f1a\u51fa\u73b0\u5f62\u5982 -- CMake Error in xxx/xxx/CMakeLists.txt: -- Target \"my_target\" INTERFACE_INCLUDE_DIRECTORIES property contains -- path: -- -- \"/xxx/xxx/include\" -- -- which is prefixed in the source directory. \u7684\u95ee\u9898\uff0c\u8fd9\u8868\u793a\u5305\u542b\u76ee\u5f55\u5177\u6709\u7edd\u5bf9\u8def\u5f84\uff0c\u8fd9\u5176\u5b9e\u662f install \u6307\u5b9a\u7684\u5934\u6587\u4ef6\u5b89\u88c5\u8def\u5f84\uff08\u9ed8\u8ba4\u662f /usr/local/include \uff09\u4e0e target_include_directories \u6307\u5b9a\u7684\u8def\u5f84\uff08\u8fd9\u91cc\u662f\u90a3\u4e32\u7edd\u5bf9\u8def\u5f84 /xxx/xxx/include \uff09\u4e92\u76f8\u51b2\u7a81\u4e86 3.2 \u89e3\u51b3\u65b9\u6cd5 \u6700\u4e3a\u6709\u6548\u4e14\u901a\u7528\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u4f7f\u7528\u5bfc\u51fa\u5b89\u88c5\u7684\u751f\u6210\u5668\u8868\u8fbe\u5f0f\uff0c\u6709 $<BUILD_INTERFACE>:xxx \u548c $<INSTALL_INTERFACE:xxx \uff0c\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u6bd4\u8f83\u5e38\u89c1\u7684\u793a\u4f8b\u3002 target_include_directories( my_target PUBLIC $<BUILD_INTERFACE:${CMAKE_CURRENT_LIST_DIRS}/include> $<INSTALL_INTERFACE:include/MyLibrary> ) \u8fd9\u4e2a\u547d\u4ee4\u8868\u793a\uff0c\u5c06\u4e00\u7cfb\u5217\u5185\u5bb9\u4ee5\u516c\u5f00\u4f20\u64ad\u65b9\u5f0f\u5305\u542b\u4e8e\u76ee\u6807 my_target \u4e2d\uff0c\u8fd9\u91cc\u7684\u4e00\u7cfb\u5217\u5185\u5bb9\u5219\u662f\u4f1a\u6839\u636e\u5f53\u524d\u5904\u4e8e\u4f55\u79cd\u65b9\u5f0f\uff08==\u6784\u5efa==\u6216\u662f==\u5b89\u88c5==\uff09\u8fdb\u884c\u9009\u62e9\u3002 BUILD_INTERFACE \u8868\u793a\u5728\u6784\u5efa\u65f6\u542f\u7528\uff0c INSTALL_INTERFACE \u8868\u793a\u5728\u5b89\u88c5\u65f6\u542f\u7528\u3002 \u5047\u8bbe\u5bfc\u51fa\u76ee\u6807\u540d\u4e3a MyModules \uff0c\u53ef\u4ee5\u5728\u5b89\u88c5\u8def\u5f84 <path-to-install>/cmake/MyModules.cmake \u4e0b\u627e\u5230\u5982\u4e0b\u7c7b\u4f3c\u7684\u8bed\u53e5 set_target_properties(my_target PROPERTIES INTERFACE_INCLUDE_DIRECTORIES \"${_IMPORT_PREFIX}/include/MyLibrary\" ) \u8fd9\u662f INSTALL_INTERFACE \u751f\u6210\u5668\u8868\u8fbe\u5f0f\u751f\u6548\u7684\u4ea7\u7269\u3002 ::: tip \u8865\u5145\u8bf4\u660e \u8fd9\u91cc\u5bf9\u4e0a\u6587\u51fa\u73b0\u7684\u4e09\u4e2a\u6807\u8bc6\u7b26\u505a\u4e2a\u7b80\u77ed\u7684\u4ecb\u7ecd - my_target \uff0c\u76ee\u6807\uff0c\u5305\u62ec\u4e8c\u8fdb\u5236\u76ee\u6807\u548c\u4f2a\u76ee\u6807\uff0c\u53ef\u53c2\u8003 \u301005\u3011\u76ee\u6807\u6784\u5efa - MyModules \uff0c\u5bfc\u51fa\u76ee\u6807\uff0c\u53ef\u53c2\u8003 \u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5 - MyLibrary \uff0c\u5305\u540d\uff0c\u4e00\u822c\u7528\u4e8e find_package \u3002\u53ef\u53c2\u8003 \u301008\u3011find_package \u8be6\u89e3 :::","title":"\u301009\u3011\u751f\u6210\u5668\u8868\u8fbe\u5f0f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#09","text":"","title":"\u301009\u3011\u751f\u6210\u5668\u8868\u8fbe\u5f0f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#_1","text":"::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#1","text":"","title":"1. \u524d\u8a00"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#11-cmake","text":"CMake \u5de5\u4f5c\u6d41\u7a0b\u5206\u4e3a\u4e24\u6b65\uff0c==\u914d\u7f6e\u9636\u6bb5==\u548c==\u751f\u6210\u9636\u6bb5==\u3002\u6211\u4eec\u5728\u547d\u4ee4\u884c\u4e2d\u8f93\u5165 cmake .. \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5728\u8f93\u51fa\u5185\u5bb9\u7684\u6700\u540e\u770b\u5230\u8fd9\u6837\u7684\u4e24\u884c\u8bdd -- Configuring done -- Generating done \u5206\u522b\u6307\u4ee3\u4e86\u8fd9\u4e24\u4e2a\u9636\u6bb5","title":"1.1 CMake \u5de5\u4f5c\u6d41\u7a0b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#111-configure","text":"\u5728\u8fd9\u4e2a\u9636\u6bb5\uff0cCMake \u4f1a\u8bfb\u53d6\u4f60\u7684 CMakeLists.txt \u6587\u4ef6\uff0c\u5e76\u6267\u884c\u5176\u4e2d\u7684\u547d\u4ee4\u3002\u8fd9\u4e9b\u547d\u4ee4\u53ef\u80fd\u4f1a\u68c0\u67e5\u7cfb\u7edf\u7684\u7279\u6027\uff08\u4f8b\u5982\uff0c\u67e5\u627e\u5e93\u6216\u8005\u7f16\u8bd1\u5668\u7279\u6027\uff09\uff0c\u8bbe\u7f6e\u53d8\u91cf\uff0c\u6216\u8005\u5b9a\u4e49\u6784\u5efa\u76ee\u6807\uff08\u4f8b\u5982\u5e93\u3001\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u6216\u8005\u5176\u4ed6\u4f2a\u76ee\u6807\uff09\u3002\u8fd9\u4e2a\u9636\u6bb5\u7684\u4e3b\u8981\u76ee\u7684\u662f\u786e\u5b9a\u6784\u5efa\u8fc7\u7a0b\u9700\u8981\u7684\u6240\u6709\u4fe1\u606f\u3002","title":"1.1.1 Configure \u9636\u6bb5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#112-generate","text":"\u5728\u6b64\u9636\u6bb5 CMake \u4f1a\u751f\u6210\u5b9e\u9645\u7684\u5efa\u6784\u6863\u3002\u8fd9\u4e9b\u6587\u4ef6\u5305\u542b\u4e86\u5b9e\u9645\u7f16\u8bd1\u548c\u94fe\u63a5\u4f60\u7684\u4ee3\u7801\u6240\u9700\u8981\u7684\u547d\u4ee4\uff0c\u5305\u62ec \u5404\u79cd\u7f16\u8bd1\u9009\u9879 \u4e0e\u76ee\u6807\u76f8\u5173\u7684\u64cd\u4f5c \u7684\u547d\u4ee4\u90fd\u662f\u5728\u751f\u6210\u9636\u6bb5\u6dfb\u52a0\u81f3\u5efa\u6784\u6863\u4e2d\u7684\u3002\u6bd4\u65b9\u8bf4 target_include_directories( demo PUBLIC include ) target_link_libraries( demo PRIVATE core ) \u8fd9\u4e24\u4e2a\u547d\u4ee4\u5747\u751f\u6548\u4e8e==\u751f\u6210\u9636\u6bb5==\u3002\u800c\u540e\u6587\u51c6\u5907\u4ecb\u7ecd\u7684\u751f\u6210\u5668\u8868\u8fbe\u5f0f\uff0c\u5c31\u4f5c\u7528\u4e8e\u751f\u6210\u9636\u6bb5\u3002\u4e5f\u6b63\u56e0\u5982\u6b64\uff0c\u53ea\u6709\u80fd\u591f\u5728\u751f\u6210\u9636\u6bb5\u751f\u6548\u7684\u547d\u4ee4\u624d\u80fd\u4f7f\u7528\u751f\u6210\u5668\u8868\u8fbe\u5f0f\uff0c\u800c\u5728\u914d\u7f6e\u9636\u6bb5\u751f\u6548\u7684\u547d\u4ee4\uff0c\u4f8b\u5982\u7528\u4e8e\u8bbe\u7f6e\u53d8\u91cf\u7684 set \u547d\u4ee4\u5e76\u4e0d\u652f\u6301\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u3002","title":"1.1.2 Generate \u9636\u6bb5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#12-cmake","text":"\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u5728\u751f\u6210\u6784\u5efa\u7cfb\u7edf\u671f\u95f4\u8fdb\u884c\u8ba1\u7b97\uff0c\u4ee5\u751f\u6210\u7279\u5b9a\u4e8e\u6bcf\u4e2a\u751f\u6210\u914d\u7f6e\u7684\u4fe1\u606f\u3002\u4ed6\u4eec\u6709\u5982\u4e0b\u5f62\u5f0f\uff1a $<...> \u3002\u53ef\u53c2\u8003 Generator Expression \u3002","title":"1.2 CMake \u7684\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u662f\u4ec0\u4e48"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#13","text":"\u5728\u8bbe\u7f6e\u67d0\u4e9b\u7f16\u8bd1\u9009\u9879\u7684\u65f6\u5019\uff0c\u5982\u679c\u5f53\u6761\u4ef6\u8f83\u591a\uff0c\u8981\u5236\u4f5c\u7684\u7f16\u8bd1\u9009\u9879\u7248\u672c\u4e5f\u76f8\u5e94\u589e\u591a\u3002\u8fd9\u65f6\u53ef\u4ee5\u4f7f\u7528\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u8bed\u6cd5\uff0c\u8ba9\u4e00\u90e8\u5206\u7f16\u8bd1\u4fe1\u606f\u5728\u751f\u6210\u9636\u6bb5\u81ea\u52a8\u5b8c\u6210\uff0c\u65e0\u9700\u5728\u914d\u7f6e\u9636\u6bb5\u8bbe\u7f6e\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a # \u73b0\u8ba1\u5212\u7ed9 Debug \u548c Release \u4e24\u79cd\u6784\u5efa\u7c7b\u578b\u6dfb\u52a0\u4e0d\u540c\u7684\u7f16\u8bd1\u9009\u9879 set(CMAKE_C_FLAGS_DEBUG \"${CMAKE_C_FLAGS_DEBUG} -g -O0\") set(CMAKE_CXX_FLAGS_DEBUG \"${CMAKE_CXX_FLAGS_DEBUG} -g -O0\") set(CMAKE_C_FLAGS_RELEASE \"${CMAKE_C_FLAGS_RELEASE} -O2\") set(CMAKE_CXX_FLAGS_RELEASE \"${CMAKE_CXX_FLAGS_RELEASE} -O2\") # \u4f7f\u7528\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u53ef\u4ee5\u7b80\u5316\u6210 add_compile_options( $<$<CONFIG:Debug>:-g -O0> $<$<CONFIG:Release>:-O2> ) \u8fd9\u91cc\u7684 add_compile_options \u5c31\u5c5e\u4e8e\u5728\u751f\u6210\u9636\u6bb5\u751f\u6548\u7684\u547d\u4ee4\u3002\u4ee5\u4e0a\u4ee3\u7801\u5c5e\u4e8e==\u6761\u4ef6\u5b9a\u4e49==\uff0c\u5373\u5728\u4e0d\u540c\u7684\u6761\u4ef6\u4e0b\u751f\u6210\u4e0d\u540c\u7684\u53d8\u91cf\u3001\u5b8f\u7b49\u5185\u5bb9\u3002\u5176\u4e2d\u8fd9\u6bb5\u4ee3\u7801\u4f7f\u7528\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u7684\u6548\u679c\u662f\uff0c\u5728\u4e0d\u540c\u7684\u6784\u5efa\u7c7b\u578b\u4e0b\uff08Debug\u3001Release\uff09\uff0c\u4f1a\u751f\u6210\u4e0d\u540c\u7684\u88ab\u6dfb\u52a0\u8fdb\u7f16\u8bd1\u9009\u9879\u7684\u5b57\u7b26\u4e32\u3002","title":"1.3 \u4e3a\u4ec0\u4e48\u8981\u5f15\u5165\u751f\u6210\u5668\u8868\u8fbe\u5f0f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#2","text":"","title":"2. \u5e38\u7528\u751f\u6210\u5668\u8868\u8fbe\u5f0f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#21","text":"","title":"2.1 \u5e03\u5c14\u751f\u6210\u5668\u8868\u8fbe\u5f0f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#211","text":"$<BOOL:string> \u5982\u679c\u5b57\u7b26\u4e32\u4e3a\u7a7a\u3001 0 \u3001\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684 FALSE \u3001 OFF \u3001 N \u3001 NO \u3001 IGNORE \u3001 NOTFOUND \uff0c\u6216\u8005\u533a\u5206\u5927\u5c0f\u5199\u7684\u4ee5 -NOTFOUND \u7ed3\u5c3e\u7684\u5b57\u7b26\u4e32\uff0c\u5219\u8868\u8fbe\u5f0f\u7684\u503c\u4e3a 0 \uff0c\u5426\u5219\u4e3a 1 ```cmake add_library(mylib ${SOURCES}) target_compile_definitions(mylib PUBLIC $<$ :USE_OTHERLIB> ) ``` \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c $<BOOL:${USE_OTHERLIB}> \u4f1a\u68c0\u67e5\u53d8\u91cf USE_OTHERLIB \u662f\u5426\u4e3a\u5047\u3002\u5982\u679c USE_OTHERLIB \u4e3a\u5047\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u5c31\u4f1a\u8fd4\u56de 0 \uff0c\u5426\u5219\u8fd4\u56de 1 \u3002\u7136\u540e\uff0c $<1:USE_OTHERLIB> \u4f1a\u5728\u524d\u9762\u7684\u8868\u8fbe\u5f0f\u4e3a\u771f\u65f6\u6dfb\u52a0\u4e00\u4e2a\u7f16\u8bd1\u5b9a\u4e49 USE_OTHERLIB \u3002 $<AND:conditions> \uff1a\u903b\u8f91\u4e0e conditons \u662f\u4ee5\u9017\u53f7\u5206\u5272\u7684==\u6761\u4ef6\u5217\u8868==\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u6761\u4ef6\u662f\u5217\u8868\u7684\uff0c\u90fd\u662f\u4f7f\u7528\u9017\u53f7\u8fdb\u884c\u5206\u5272\uff0c\u540e\u6587\u4e0d\u518d\u8d58\u8ff0\u3002\u903b\u8f91\u8fd0\u7b97\u6761\u4ef6\u6210\u7acb\uff0c\u8868\u8fbe\u5f0f\u7684\u503c\u4e3a 0 \uff0c\u5426\u5219\u4e3a 1 \uff0c\u540e\u6587\u4e0d\u518d\u8d58\u8ff0\u3002 ```cmake add_library(mylib ${SOURCES}) target_compile_definitions(mylib PUBLIC $<$ ,$\\ >:USE_OTHERLIB> ) ``` \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c $<AND:$<CONFIG:Debug>,$<TARGET_EXISTS:otherlib>> \u4f1a\u5728\u5f53\u524d\u914d\u7f6e\u4e3a Debug \u5e76\u4e14\u76ee\u6807 otherlib \u5b58\u5728\u65f6\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 \u3002\u7136\u540e\uff0c $<1:USE_OTHERLIB> \u4f1a\u5728\u524d\u9762\u7684\u8868\u8fbe\u5f0f\u4e3a\u771f\u65f6\u6dfb\u52a0\u4e00\u4e2a\u7f16\u8bd1\u5b9a\u4e49 USE_OTHERLIB \u3002 $<OR:conditions> \uff1a\u903b\u8f91\u6216 \u5728\u7ed9\u5b9a\u7684\u4efb\u4f55\u6761\u4ef6\u4e3a\u771f\u65f6\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 ```cmake add_library(mylib ${SOURCES}) target_compile_definitions(mylib PUBLIC $<$ ,$\\ >:USE_OTHERLIB> ) ``` \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c $<OR:$<CONFIG:Debug>,$<TARGET_EXISTS:otherlib>> \u4f1a\u5728\u5f53\u524d\u914d\u7f6e\u4e3a Debug \u6216\u8005\u76ee\u6807 otherlib \u5b58\u5728\u65f6\u8fd4\u56de 1\uff0c\u5426\u5219\u8fd4\u56de 0\u3002\u7136\u540e\uff0c $<1:USE_OTHERLIB> \u4f1a\u5728\u524d\u9762\u7684\u8868\u8fbe\u5f0f\u4e3a\u771f\u65f6\u6dfb\u52a0\u4e00\u4e2a\u7f16\u8bd1\u5b9a\u4e49 USE_OTHERLIB \u3002 $<NOT:condition> \uff1a\u903b\u8f91\u975e \u5728\u7ed9\u5b9a\u7684\u6761\u4ef6\u4e3a\u5047\u65f6\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 ```cmake add_library(mylib ${SOURCES}) target_compile_definitions(mylib PUBLIC $<$ >:USE_OTHERLIB> ) ``` \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c $<NOT:$<TARGET_EXISTS:otherlib>> \u4f1a\u5728\u76ee\u6807 otherlib \u4e0d\u5b58\u5728\u65f6\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 \u3002\u7136\u540e\uff0c $<1:USE_OTHERLIB> \u4f1a\u5728\u524d\u9762\u7684\u8868\u8fbe\u5f0f\u4e3a\u771f\u65f6\u6dfb\u52a0\u4e00\u4e2a\u7f16\u8bd1\u5b9a\u4e49 USE_OTHERLIB \u3002","title":"2.1.1 \u903b\u8f91\u8fd0\u7b97\u7b26"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#212","text":"$<STREQUAL:string1,string2> \u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u76f8\u7b49 $<EQUAL:value1,value2> \u5224\u65ad\u6570\u503c\u662f\u5426\u76f8\u7b49 $<IN_LIST:string,list> \u5224\u65ad string \u662f\u5426\u5305\u542b\u5728 list \u4e2d\uff0c list \u4f7f\u7528\u5206\u53f7\u5206\u5272 ::: warning \u8fd9\u91cc\u7684 list \u662f\u5728\u9017\u53f7\u540e\u9762\u7684\u5217\u8868\uff0c\u5373 ${...} \u6240\u8868\u793a\u7684\u5185\u5bb9\uff0c\u56e0\u6b64\u5176\u5185\u5bb9\u9700\u8981\u4f7f\u7528\u5206\u53f7\u5206\u5272\u3002 :::","title":"2.1.2 \u5b57\u7b26\u4e32\u6bd4\u8f83"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#213","text":"$<TARGET_EXISTS:target> \u5224\u65ad\u76ee\u6807\u662f\u5426\u5b58\u5728 $<CONFIG:cfgs> \u5224\u65ad\u7f16\u8bd1\u7c7b\u578b\u914d\u7f6e\u662f\u5426\u5305\u542b\u5728 cfgs \u5217\u8868\uff08\u6bd4\u5982\"Release\uff0cDebug\"\uff09\u4e2d\uff1b\u4e0d\u533a\u5206\u5927\u5c0f\u5199 $<PLATFORM_ID:platform_ids> \u5224\u65adCMake\u5b9a\u4e49\u7684\u5e73\u53f0ID\u662f\u5426\u5305\u542b\u5728 platform_ids \u5217\u8868\u4e2d $<COMPILE_LANGUAGE:languages> \u5224\u65ad\u7f16\u8bd1\u8bed\u8a00\u662f\u5426\u5305\u542b\u5728 languages \u5217\u8868\u4e2d","title":"2.1.3 \u53d8\u91cf\u67e5\u8be2"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#22","text":"\u4f7f\u7528\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u7684\u4e3b\u8981\u76ee\u7684\u53ef\u80fd\u5c31\u662f\u56e0\u4e3a\u6b64\u529f\u80fd\u4e86\u3002\u6bd4\u5982 CMake \u5b98\u65b9\u7684\u4f8b\u5b50\uff1a\u57fa\u4e8e\u7f16\u8bd1\u5668 ID \u6307\u5b9ainclude\u76ee\u5f55\uff1a include_directories(\"/usr/include/$<CXX_COMPILER_ID>/\") \u6839\u636e\u7f16\u8bd1\u5668\u7684\u7c7b\u578b\uff0c $<CXX_COMPILER_ID> \u4f1a\u88ab\u66ff\u6362\u6210\u5bf9\u5e94\u7684ID\uff08\u6bd4\u5982\u201cGNU\u201d\u3001\u201cClang\u201d\uff09\u3002","title":"2.2 \u5b57\u7b26\u4e32\u751f\u6210\u5668\u8868\u8fbe\u5f0f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#221","text":"$<condition:true_string> \u5982\u679c\u6761\u4ef6\u4e3a\u771f\uff0c\u5219\u7ed3\u679c\u4e3a true_string \uff0c\u5426\u5219\u4e3a\u7a7a $<IF:condition,str1,str2> \u5982\u679c\u6761\u4ef6\u4e3a\u771f\uff0c\u5219\u7ed3\u679c\u4e3a str1 \uff0c\u5426\u5219\u4e3a str2","title":"2.2.1 \u6761\u4ef6\u8868\u8fbe\u5f0f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#222","text":"$<LOWER_CASE:string> \u5c06\u5b57\u7b26\u4e32\u8f6c\u4e3a\u5c0f\u5199 ```cmake add_library(mylib ${SOURCES}) set(TARGET_NAME \"MYLIB\") target_compile_definitions(mylib PUBLIC TARGET_NAME=$ ) ``` \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c $<LOWER_CASE:${TARGET_NAME}> \u4f1a\u5c06 TARGET_NAME \u53d8\u91cf\u7684\u503c\u8f6c\u6362\u4e3a\u5c0f\u5199\u3002\u7136\u540e\uff0c\u8fd9\u4e2a\u5c0f\u5199\u7684\u503c\u4f1a\u88ab\u8d4b\u7ed9\u7f16\u8bd1\u5b9a\u4e49 TARGET_NAME \u3002 \u6240\u4ee5\uff0c mylib \u4f1a\u88ab\u7f16\u8bd1\u65f6\u5b9a\u4e49 TARGET_NAME \u4e3a mylib \u3002 $<UPPER_CASE:string> \uff0c\u5c06\u5b57\u7b26\u4e32\u8f6c\u4e3a\u5927\u5199 \u751f\u6210\u5668\u8868\u8fbe\u5f0f\u79cd\u7c7b\u7e41\u591a\uff0c\u8fd9\u91cc\u4e0d\u518d\u4e00\u4e00\u5217\u4e3e","title":"2.2.2 \u5b57\u7b26\u4e32\u8f6c\u6362"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#3","text":"\u8be5\u751f\u6210\u5668\u8868\u8fbe\u5f0f\u5c5e\u4e8e \u5b57\u7b26\u4e32\u751f\u6210\u5668\u8868\u8fbe\u5f0f \u7684\u4e00\u79cd\u3002\u8fd9\u4e2a\u95ee\u9898\u6765\u81ea\u4e8e \u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5 \uff0c\u4f46\u4e0d\u770b\u5e76\u4e0d\u5f71\u54cd\u77e5\u8bc6\u70b9\u7684\u8bb2\u89e3\uff0c\u4e0b\u9762\u7ed9\u51fa\u8fd9\u4e2a\u95ee\u9898\u7684\u4ea7\u751f\u539f\u56e0\u3002","title":"3. \u6784\u5efa\u5b89\u88c5\u8868\u8fbe\u5f0f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#31","text":"\u5728\u5b89\u88c5\u5bfc\u51fa\u76ee\u6807\u7684\u65f6\u5019\uff0c\u5982\u679c\u5bfc\u51fa\u76ee\u6807\u4e2d\u5305\u542b\u7684\u76ee\u6807\u4f7f\u7528\u4e86 target_include_directories \u547d\u4ee4\uff0c\u4f8b\u5982 target_include_directories( my_target PUBLIC include ) \u5219\u6267\u884c cmake .. \u7684\u64cd\u4f5c\u540e\u4f1a\u51fa\u73b0\u5f62\u5982 -- CMake Error in xxx/xxx/CMakeLists.txt: -- Target \"my_target\" INTERFACE_INCLUDE_DIRECTORIES property contains -- path: -- -- \"/xxx/xxx/include\" -- -- which is prefixed in the source directory. \u7684\u95ee\u9898\uff0c\u8fd9\u8868\u793a\u5305\u542b\u76ee\u5f55\u5177\u6709\u7edd\u5bf9\u8def\u5f84\uff0c\u8fd9\u5176\u5b9e\u662f install \u6307\u5b9a\u7684\u5934\u6587\u4ef6\u5b89\u88c5\u8def\u5f84\uff08\u9ed8\u8ba4\u662f /usr/local/include \uff09\u4e0e target_include_directories \u6307\u5b9a\u7684\u8def\u5f84\uff08\u8fd9\u91cc\u662f\u90a3\u4e32\u7edd\u5bf9\u8def\u5f84 /xxx/xxx/include \uff09\u4e92\u76f8\u51b2\u7a81\u4e86","title":"3.1 \u95ee\u9898\u5f15\u51fa"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/09/#32","text":"\u6700\u4e3a\u6709\u6548\u4e14\u901a\u7528\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u4f7f\u7528\u5bfc\u51fa\u5b89\u88c5\u7684\u751f\u6210\u5668\u8868\u8fbe\u5f0f\uff0c\u6709 $<BUILD_INTERFACE>:xxx \u548c $<INSTALL_INTERFACE:xxx \uff0c\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u6bd4\u8f83\u5e38\u89c1\u7684\u793a\u4f8b\u3002 target_include_directories( my_target PUBLIC $<BUILD_INTERFACE:${CMAKE_CURRENT_LIST_DIRS}/include> $<INSTALL_INTERFACE:include/MyLibrary> ) \u8fd9\u4e2a\u547d\u4ee4\u8868\u793a\uff0c\u5c06\u4e00\u7cfb\u5217\u5185\u5bb9\u4ee5\u516c\u5f00\u4f20\u64ad\u65b9\u5f0f\u5305\u542b\u4e8e\u76ee\u6807 my_target \u4e2d\uff0c\u8fd9\u91cc\u7684\u4e00\u7cfb\u5217\u5185\u5bb9\u5219\u662f\u4f1a\u6839\u636e\u5f53\u524d\u5904\u4e8e\u4f55\u79cd\u65b9\u5f0f\uff08==\u6784\u5efa==\u6216\u662f==\u5b89\u88c5==\uff09\u8fdb\u884c\u9009\u62e9\u3002 BUILD_INTERFACE \u8868\u793a\u5728\u6784\u5efa\u65f6\u542f\u7528\uff0c INSTALL_INTERFACE \u8868\u793a\u5728\u5b89\u88c5\u65f6\u542f\u7528\u3002 \u5047\u8bbe\u5bfc\u51fa\u76ee\u6807\u540d\u4e3a MyModules \uff0c\u53ef\u4ee5\u5728\u5b89\u88c5\u8def\u5f84 <path-to-install>/cmake/MyModules.cmake \u4e0b\u627e\u5230\u5982\u4e0b\u7c7b\u4f3c\u7684\u8bed\u53e5 set_target_properties(my_target PROPERTIES INTERFACE_INCLUDE_DIRECTORIES \"${_IMPORT_PREFIX}/include/MyLibrary\" ) \u8fd9\u662f INSTALL_INTERFACE \u751f\u6210\u5668\u8868\u8fbe\u5f0f\u751f\u6548\u7684\u4ea7\u7269\u3002 ::: tip \u8865\u5145\u8bf4\u660e \u8fd9\u91cc\u5bf9\u4e0a\u6587\u51fa\u73b0\u7684\u4e09\u4e2a\u6807\u8bc6\u7b26\u505a\u4e2a\u7b80\u77ed\u7684\u4ecb\u7ecd - my_target \uff0c\u76ee\u6807\uff0c\u5305\u62ec\u4e8c\u8fdb\u5236\u76ee\u6807\u548c\u4f2a\u76ee\u6807\uff0c\u53ef\u53c2\u8003 \u301005\u3011\u76ee\u6807\u6784\u5efa - MyModules \uff0c\u5bfc\u51fa\u76ee\u6807\uff0c\u53ef\u53c2\u8003 \u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5 - MyLibrary \uff0c\u5305\u540d\uff0c\u4e00\u822c\u7528\u4e8e find_package \u3002\u53ef\u53c2\u8003 \u301008\u3011find_package \u8be6\u89e3 :::","title":"3.2 \u89e3\u51b3\u65b9\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/","text":"\u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5 \u6559\u5b66\u89c6\u9891 ::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili 1. \u524d\u8a00 \u5728 \u301008\u3011find_package \u8be6\u89e3 \u4e00\u6587\u4e2d\u6211\u4eec\u4e86\u89e3\u5230 find_package \u7684\u4e24\u79cd\u5de5\u4f5c\u65b9\u5f0f\uff0c\u7b2c\u4e00\u79cd\u7684 Module \u6a21\u5f0f\u9700\u8981\u6211\u4eec\u4e3a\u73b0\u6210\u7684\u7b2c\u4e09\u65b9\u5934\u6587\u4ef6\u5e93\u6587\u4ef6\u7f16\u5199 FindXxx.cmake \u4ece\u800c\u80fd\u591f\u4f7f\u7528 find_package \uff0c\u7b2c\u4e8c\u79cd\u7684 Config \u6a21\u5f0f\u5219\u662f\u6253\u5305\u9879\u76ee\u65f6\u91c7\u7528\u7684\u4e3b\u6d41\u65b9\u5f0f\uff0c\u5373\u901a\u8fc7\u7f16\u5199 XxxConfig.cmake \u6587\u4ef6\u6765\u4f7f\u7528 find_package \u3002\u5927\u591a\u6570\u5f00\u6e90\u9879\u76ee\uff0c\u82e5\u662f\u4f7f\u7528CMake\u63d0\u4f9b\u4e86\u7f16\u8bd1\u5b89\u88c5\u65b9\u5f0f\uff0c\u4e00\u5b9a\u4f1a\u6d89\u53ca\u5230\u8fd9\u4e00\u6587\u4ef6\uff0c\u4f8b\u5982 OpenCV \u7684 cmake/templates \u6587\u4ef6\u5939\u4e2d\u5c31\u6709 OpenCVConfig.cmake.in \u7684\u6a21\u677f\u6587\u4ef6\uff0c\u8fd9\u4e00\u6587\u4ef6\u5728CMake\u7684\u914d\u7f6e\u9636\u6bb5\u4f1a\u751f\u6210\u5bf9\u5e94\u7684 OpenCVConfig.cmake \u6587\u4ef6\u3002 \u5bf9\u4e8e XxxConfig.cmake \u6587\u4ef6\u7684\u5199\u6cd5\u4f1a\u5728\u6700\u540e\u8fdb\u884c\u4ecb\u7ecd\uff0c\u5728\u4e00\u5f00\u59cb\u8ba9\u6211\u4eec\u5148\u4e86\u89e3\u4e00\u4e0b\u5b89\u88c5\u7684\u57fa\u672c\u547d\u4ee4\u3002 2. \u6587\u4ef6\u3001\u76ee\u6807\u7684\u5b89\u88c5\u89c4\u5219 \u2014\u2014 install \u547d\u4ee4 \u5728\u73b0\u4ee3 CMake \u4e2d\uff0c\u6240\u6709\u5185\u5bb9\u7684\u5b89\u88c5\uff0c\u5747\u6765\u81ea install \u547d\u4ee4\uff0c\u5305\u62ec\u6587\u4ef6\uff08\u5939\uff09\u3001\u4e8c\u8fdb\u5236\u76ee\u6807\u3001\u4f2a\u76ee\u6807\u4ee5\u53ca\u540e\u6587\u7684\u5bfc\u51fa\u76ee\u6807\u3002\u5728 CMakeLists.txt \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e86 install \u547d\u4ee4\u5e76\u4e0d\u4f1a\u76f4\u63a5\u6267\u884c\u5b89\u88c5\u64cd\u4f5c\uff0c\u5b9e\u9645\u4e0a install \u53ea\u662f\u7ed9\u51fa\u4e86\u5b89\u88c5\u7684\u89c4\u5219\uff0c\u5e76\u53d1\u751f\u5728\u751f\u6210\u9636\u6bb5\u3002\u53ef\u4ee5\u56de\u987e \u301001\u3011\u5b89\u88c5\u4e0e\u57fa\u672c\u4ecb\u7ecd \u7684\u5185\u5bb9\uff0cCMake \u7684\u4f5c\u7528\u662f\u751f\u6210\u5efa\u6784\u6863\uff0c\u800c\u9700\u8981\u5b89\u88c5\u7684\u5177\u4f53\u5185\u5bb9\u5c06\u4f1a\u751f\u6210\u5728\u8be5\u5efa\u6784\u6863\u4e2d\uff0c\u5982 Unix Makefile\u3002 \u6211\u4eec\u53ef\u4ee5\u6267\u884c cmake --install . \u547d\u4ee4\uff0c\u5b8c\u6210\u5b9e\u9645\u7684\u5b89\u88c5\u64cd\u4f5c\u3002 ::: tip \u6b64\u5904\u53ea\u4ecb\u7ecd\u5177\u6709\u57fa\u672c\u6587\u4ef6\u7ed3\u6784\u7684\u5b89\u88c5\uff0c\u5bfc\u51fa\u76ee\u6807\u7684\u5b89\u88c5\u5728\u4e0b\u4e00\u8282\u8fdb\u884c\u4ecb\u7ecd\u3002 ::: 2.1 \u6587\u4ef6\u5b89\u88c5 \u5373\uff1a install(FILES) \u8fd9\u91cc\u5148\u76f4\u63a5\u7ed9\u51fa\u6587\u4ef6\u5b89\u88c5\u7684 install \u547d\u4ee4\u7528\u6cd5\uff0c\u4e0b\u9762\u5217\u4e3e\u4e00\u4e9b\u5e38\u89c1\u7684\u53ef\u9009\u5185\u5bb9\u3002 DESTINATION \uff1a\u6307\u5b9a\u8981\u5b89\u88c5\u5230\u7684\u76ee\u6807\u76ee\u5f55\u3002 PERMISSIONS \uff1a\u6307\u5b9a\u8981\u5b89\u88c5\u6587\u4ef6\u7684\u6743\u9650\uff0c\u6743\u9650\u53c2\u6570\u8981\u6c42\u662f\u4e00\u7cfb\u5217 OWNER_* \u3001 GROUP_* \u548c WORLD_* \u6743\u9650\u503c\u7684\u7ec4\u5408\uff0c\u4f8b\u5982 OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ \u3002 CONFIGURATIONS \uff1a\u6307\u5b9a\u8981\u5728\u54ea\u4e9b\u6784\u5efa\u914d\u7f6e\u4e0b\u5b89\u88c5\u6587\u4ef6\u3002\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6216\u591a\u4e2a\u6784\u5efa\u914d\u7f6e\u7684\u540d\u79f0\u6765\u9650\u5b9a\u3002 COMPONENT \uff1a\u6307\u5b9a\u8981\u5c06\u6587\u4ef6\u5f52\u7c7b\u5230\u7684\u7ec4\u4ef6\u540d\u79f0\uff0c\u4ee5\u4fbf\u4e8e\u540e\u7eed\u8fdb\u884c\u7ba1\u7406\u548c\u6253\u5305\uff08\u89c1 \u301013\u3011CPack \uff09\u3002 RENAME \uff1a\u6307\u5b9a\u5728\u5b89\u88c5\u65f6\u91cd\u547d\u540d\u6587\u4ef6\u6216\u76ee\u5f55\u7684\u540d\u79f0\u3002 OPTIONAL \uff1a\u8868\u793a\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\u5219\u4e0d\u4f1a\u629b\u51fa\u9519\u8bef\u3002 # \u5b9a\u4e49\u4e8e <path-to-opencv>/include/CMakeLists.txt \u4e2d install(FILES \"opencv2/opencv.hpp\" DESTINATION ${OPENCV_INCLUDE_INSTALL_PATH}/opencv2 COMPONENT dev) \u8fd9\u53e5\u547d\u4ee4\u6dfb\u52a0\u4e86\u5c06\u5355\u4e00\u6587\u4ef6 opencv2/opencv.hpp \u5b89\u88c5\u5230\u6307\u5b9a\u76ee\u5f55\u7684\u5b89\u88c5\u89c4\u5219\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f /usr/local/include/opencv4/opencv2 \u4e2d\uff0c\u5e76\u5f52\u7c7b\u5230 dev \u7ec4\u4ef6\u7684\u5b89\u88c5\u89c4\u5219\u4e2d\uff0c\u5728\u6267\u884c cmake --install . \u547d\u4ee4\u7684\u65f6\u5019\u4f1a\u6267\u884c\u8be5\u5b89\u88c5\u64cd\u4f5c\u3002 \u5176\u4f59\u53ef\u9009\u5185\u5bb9\u5982 RENAME \u7528\u6cd5\u4e0e\u4e0a\u6587\u7ed9\u51fa\u7684\u4f8b\u5b50\u7c7b\u4f3c\u3002 2.2 \u76ee\u5f55\uff08\u6587\u4ef6\u5939\uff09\u5b89\u88c5 \u5373 install(DIRECTORY) \u4f7f\u7528\u65b9\u5f0f\u4e0e\u6587\u4ef6\u5b89\u88c5\u57fa\u672c\u4e00\u81f4\uff0c\u4f46\u76f8\u6bd4\u4e8e\u6587\u4ef6\u5b89\u88c5\uff0c\u4e3b\u8981\u591a\u51fa\u4e86 PATTERN \u3001 EXCLUDE_PATTERN \u548c RECURSE \u5173\u952e\u5b57\uff0c\u901a\u8fc7 PATTERN \u548c EXCLUDE_PATTERN \u53c2\u6570\u6307\u5b9a\u8981\u5305\u542b\u548c\u6392\u9664\u7684\u6587\u4ef6\uff0c\u4f7f\u7528 RECURSE \u53c2\u6570\u8fdb\u884c\u9012\u5f52\u5b89\u88c5\u3002\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u7b80\u5355\u7684\uff0cOpenCV \u4e2d\u5b89\u88c5\u6587\u6863\u6240\u5728\u6587\u4ef6\u5939\u7684\u4f8b\u5b50\u3002 # \u5b9a\u4e49\u4e8e <path-to-opencv>/doc/CMakeLists.txt \u4e2d install(DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/doxygen/html DESTINATION \"${OPENCV_DOC_INSTALL_PATH}\" COMPONENT \"docs\" OPTIONAL ${compatible_MESSAGE_NEVER} # \u53ef\u4ee5\u4e0d\u7528\u7ba1\u8fd9\u53e5\u8bdd ) \u8fd9\u53e5\u547d\u4ee4\u5c06\u5f53\u524d\u4e8c\u8fdb\u5236\u751f\u6210\u76ee\u5f55\u4e2d\u7684 doxygen/html \u6587\u4ef6\u5939\u5b89\u88c5\u5230 ${OPENCV_DOC_INSTALL_PATH} \u4e2d\uff0c\u5e76\u5f52\u7c7b\u5230 docs \u4e2d\uff0c OPTIONAL \u8bf4\u660e\u4e86\u5373\u4f7f\u8fd9\u4e2a\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u4e5f\u4e0d\u4f1a\u629b\u51fa\u5b89\u88c5\u7684\u9519\u8bef\u3002\u540c\u6837\uff0c\u9700\u8981\u5728\u7ec8\u7aef\u6267\u884c cmake --install . \u547d\u4ee4\u4ee5\u5b8c\u6210\u5b89\u88c5\u3002 2.3 \u76ee\u6807\u5b89\u88c5 \u5373 install(TARGETS) \uff0c\u5148\u7ed9\u51fa\u76ee\u6807\u5b89\u88c5\u7684\u7b7e\u540d install(TARGETS <target>... [EXPORT <export-name>] [RUNTIME_DEPENDENCIES <arg>...|RUNTIME_DEPENDENCY_SET <set-name>] [<artifact-option>...] [<artifact-kind> <artifact-option>...]... [INCLUDES DESTINATION [<dir> ...]] ) \u7528\u6cd5\u4e0e\u6587\u4ef6\u3001\u6587\u4ef6\u5939\u5b89\u88c5\u57fa\u672c\u4e00\u81f4\uff0c\u4f46\u7531\u4e8e CMake \u4e2d\u7684\u76ee\u6807\u4e0d\u4ec5\u4ec5\u5305\u542b\u52a8\u6001\u3001\u9759\u6001\u5e93\uff0c\u4e5f\u6709\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4e5f\u6709\u63a5\u53e3\u5e93\u3001\u5bfc\u5165\u5e93\u7b49\u4f2a\u76ee\u6807\uff0c\u56e0\u6b64 CMake \u76ee\u6807\u5b89\u88c5\u662f\u4e2a\u5e7f\u6cdb\u7684\u6982\u5ff5\uff0c\u63a5\u53e3\u4e0a\u4e5f\u80fd\u9002\u914d\u591a\u79cd\u76ee\u6807\u7684\u5b89\u88c5\uff0c\u4f8b\u5982\u4ee5\u4e0b\u547d\u4ee4 install( TARGETS my_target LIBRARY DESTINATION lib ARCHIVE DESTINATION lib RUNTIME DESTINATION bin ) \u5148\u6765\u8003\u8651\u4e8c\u8fdb\u5236\u76ee\u6807\u7684\u60c5\u51b5 LIBRARY \u6307\u4ee3\u7684\u662f Unix \u6587\u4ef6\u7cfb\u7edf\u7684\u5171\u4eab\u5e93 ARCHIVE \u6307\u4ee3\u7684\u662f Unix \u6587\u4ef6\u7cfb\u7edf\u7684\u9759\u6001\u5e93\uff0c\u4ee5\u53ca Windows \u4e0b\u7684\u9759\u6001\u94fe\u63a5\u5e93\u548c\u5bfc\u5165\u5e93 RUNTIME \u6307\u4ee3\u7684\u662f\u53ef\u6267\u884c\u6587\u4ef6\u4ee5\u53ca Windows \u4e0b\u7684\u52a8\u6001\u94fe\u63a5\u5e93 \u5f53 my_target \u662f\u666e\u901a\u5e93\u76ee\u6807\u65f6\uff0c\u5728 Linux \u4e0b\uff0c\u5bf9\u5e94\u7684 *.so \u6216 *.a \u76ee\u6807\u4f1a\u88ab\u5b89\u88c5\u81f3 <prefix>/lib \u4e0b\uff0c\u540c\u6837\uff0c\u5728 Windows \u4e0b\uff0c\u5bf9\u5e94\u7684 *.dll \u548cDLL\u5bfc\u5165\u5e93 *.lib \u4e5f\u4f1a\u88ab\u5b89\u88c5\u5230 <prefix>/lib \u4e0b\u3002\u5f53 my_target \u662f\u53ef\u6267\u884c\u6587\u4ef6\u65f6\uff0c\u4f1a\u88ab\u5b89\u88c5\u5230 <prefix>/bin \u4e0b 3. \u5bfc\u51fa\u76ee\u6807\u7684\u5b89\u88c5\u89c4\u5219 3.1 \u4f55\u4e3a\u5bfc\u51fa\u76ee\u6807\u3001\u5bfc\u51fa\u914d\u7f6e \u5728 \u301005\u3011\u76ee\u6807\u6784\u5efa #2.4 \u6211\u4eec\u4ecb\u7ecd\u8fc7 IMPORTED \u5bfc\u5165\u76ee\u6807\u7684\u6982\u5ff5\uff0c\u867d\u7136 IMPORTED \u76ee\u6807\u672c\u8eab\u5f88\u6709\u7528\uff0c\u4f46\u6211\u4eec\u4ecd\u7136\u9700\u8981\u77e5\u9053\u8fd9\u4e9b IMPORTED \u76ee\u6807\u6240\u6307\u4ee3\u6216\u8005\u5305\u542b\u7684\u6587\u4ef6\u5728\u78c1\u76d8\u4e0a\u7684\u4f4d\u7f6e\u3002 IMPORTED \u76ee\u6807\u7684\u771f\u6b63\u5f3a\u5927\u4e4b\u5904\u5728\u4e8e\uff0c\u5f53\u63d0\u4f9b\u76ee\u6807\u6587\u4ef6\u7684\u9879\u76ee\u8ba1\u5212\u63d0\u4f9b\u4e00\u4e2a CMake \u6587\u4ef6\u6765\u5e2e\u52a9\u5bfc\u5165\u5b83\u4eec\u65f6\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u9879\u76ee\u4ee5\u751f\u6210 \u5fc5\u8981\u7684\u4fe1\u606f \uff0c\u4ee5\u4fbf\u5176\u4ed6 CMake \u9879\u76ee\u53ef\u4ee5\u8f7b\u677e\u5730\u4f7f\u7528\u5b83\uff0c\u8fd9\u4e00\u5fc5\u8981\u7684\u4fe1\u606f\u5c31\u662f\u6240\u8c13\u7684\u5bfc\u51fa\u76ee\u6807\u3002 \u5728\u5f00\u53d1\u5b8c\u4e00\u4e2a\u5e93\u7684\u65f6\u5019\uff0c\u9700\u8981\u5c06\u5176\u6253\u5305\u7ed9\u4ed6\u4eba\u4f7f\u7528\uff08\u6ce8\u610f\u4e0d\u662f\u6253\u5305\u8ba9\u4ed6\u4eba\u6e90\u7801\u7f16\u8bd1\uff0c\u800c\u662f\u76f4\u63a5\u62ff\u6765\u7528\uff09\uff0c\u6211\u4eec\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u5305\u542b\u8fd9\u4e2a\u5e93\u91cc\u9762\u6240\u6709\u5f85\u5bfc\u51fa\u76ee\u6807\u4fe1\u606f\u7684 *.cmake \u6587\u4ef6\uff0c\u79f0\u4e3a\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u3002\u8be5\u6587\u4ef6\u6b63\u662f\u5728 CMake \u7684\u751f\u6210\u9636\u6bb5\u7531\u5bfc\u51fa\u76ee\u6807\u751f\u6210\u7684\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e00\u6587\u4ef6\u6211\u4eec\u5e76\u4e0d\u4f1a\u76f4\u63a5\u4f7f\u7528\uff0c\u800c\u662f\u95f4\u63a5\u7684\u901a\u8fc7\u4f7f\u7528 XxxConfig.cmake \u7684\u65b9\u5f0f\u4f7f\u7528\u8be5\u5bfc\u51fa\u76ee\u6807\u5bf9\u5e94\u7684 *.cmake \u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u3002\u6211\u4eec\u5148\u56de\u5230\u6700\u57fa\u672c\u7684\uff0c\u5982\u4f55\u6dfb\u52a0\u5bfc\u51fa\u76ee\u6807\u548c\u751f\u6210\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u3002 3.2 \u57fa\u672c\u8bed\u6cd5 \u9996\u5148\u6211\u4eec\u9700\u8981\u6307\u5b9a\u54ea\u4e9b\u76ee\u6807\u9700\u8981\u5bfc\u51fa\uff0c\u5e76\u4e14\u8bbe\u7f6e\u5bfc\u51fa\u76ee\u6807\u7684\u540d\u79f0\uff0c\u5047\u8bbe\u8fd8\u662f\u4e0a\u6587\u7684 my_target \u76ee\u6807\uff0c\u6211\u4eec\u5728\u4f7f\u7528 install \u547d\u4ee4\u65f6\u53ef\u4ee5\u6307\u5b9a EXPORT \uff0c\u5373 install( TARGETS my_target EXPORT MyModules LIBRARY DESTINATION lib ARCHIVE DESTINATION lib RUNTIME DESTINATION bin ) ::: warning EXPORT \u5fc5\u987b\u5728 TARGETS \u4e4b\u540e\uff0c [<artifact-option>...] \u4e4b\u524d\uff0c\u5982 \u7b7e\u540d \u7684\u8981\u6c42\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u5199\u6210 install( EXPORT MyModules TARGETS my_target ) \u6216\u8005 install( TARGETS my_target LIBRARY DESTINATION lib EXPORT MyModules ) \u90fd\u662f\u9519\u8bef\u7684\u5199\u6cd5\uff0c\u5728 CMake \u914d\u7f6e\u671f\u95f4\u4f1a\u62a5\u9519\u3002 ::: \u8fd9\u91cc\u7684 MyModules \u5c31\u662f\u5bfc\u51fa\u76ee\u6807\u540d\uff0c\u5e76\u4e14\u8be5\u5bfc\u51fa\u76ee\u6807\u5305\u542b\u4e86\u5173\u4e8e my_target \u7684\u6240\u6709\u4fe1\u606f\uff0c\u5305\u62ec\u5934\u6587\u4ef6\u8def\u5f84\u3001\u5e93\u6587\u4ef6\u8def\u5f84\u7b49\u5185\u5bb9\u3002\u5982\u679c\u6211\u5728\u6b64\u4e4b\u4e0a\u7ee7\u7eed\u5199\u5165 install( TARGETS my_target_2 EXPORT MyModules LIBRARY DESTINATION lib ARCHIVE DESTINATION lib ) \u5219\u6b64\u65f6\u5bfc\u51fa\u76ee\u6807 MyModules \u5305\u542b\u4e86\u4e24\u4e2a\u76ee\u6807\u7684\u5185\u5bb9\uff0c\u5373 my_target \u548c my_target_2 \u3002 \u6700\u540e\u9700\u8981\u5c06\u8be5\u5bfc\u51fa\u76ee\u6807\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684 *.cmake \u6587\u4ef6\uff0c\u5373\u6307\u5b9a\u5bfc\u51fa\u76ee\u6807\u7684\u5b89\u88c5\u7b56\u7565\uff0c\u8bed\u6cd5\u91c7\u7528 install(EXPORTS) install( EXPORT MyModules FILE MyModules.cmake DESTINATION \"lib/cmake/${PROJECT_NAME}\" # \u4e00\u822c\u5b89\u88c5\u8def\u5f84\u4f1a\u8bbe\u7f6e\u5728\u6b64\u5904 ) \u5982\u679c\u4e0d\u989d\u5916\u6307\u5b9a OpenCV \u7684\u5b89\u88c5\u8def\u5f84\uff0c\u53ef\u4ee5\u5728 /usr/local/lib/cmake/opencv4 \u4e0b\u627e\u5230 OpenCVModules.cmake \u4ee5\u53ca OpenCVModules-release.cmake \u8fd9\u4e24\u4e2a\u6587\u4ef6\uff0c\u8fd9\u4e2a\u5c31\u662f OpenCV \u7684\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u3002 3.3 \u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u7684\u57fa\u672c\u5185\u5bb9 \u6211\u4eec\u5c31\u4ee5 OpenCV 4.8.0 \u5728\u6267\u884c\u5b8c\u5b89\u88c5\u547d\u4ee4\u4e4b\u540e\u751f\u6210\u7684\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6 OpenCVModules.cmake \uff0c\u70b9\u51fb \u6b64\u5904 \u8df3\u8f6c\u81f3\u8be5\u6587\u4ef6 OpenCVModules-release.cmake \uff0c\u70b9\u51fb \u6b64\u5904 \u8df3\u8f6c\u81f3\u8be5\u6587\u4ef6 \u4e24\u4e2a\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u8fdb\u884c\u4ecb\u7ecd\uff0c\u56e0\u4e3a\u8fd9\u7c7b\u6587\u4ef6\u662f\u7531\u5bfc\u51fa\u76ee\u6807\u5728\u5b89\u88c5\u540e\u81ea\u52a8\u751f\u6210\u7684\uff0c\u6240\u4ee5\u4e0d\u8bba\u662f\u4ec0\u4e48\u9879\u76ee\uff0c\u5728\u5185\u5bb9\u4e0a\u90fd\u5177\u6709\u76f8\u4f3c\u6027 \u4e0a\u6587\u4e2d\u7684 OpenCVModules.cmake \u6587\u4ef6\uff0c\u5177\u6709\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206 \u9632\u6b62\u91cd\u590d\u5305\u542b\uff0c\u6765\u81ea\u5982\u4e0b\u6ce8\u91ca\uff1a # Protect against multiple inclusion, which would fail when already imported targets are added once more. \u4f7f\u7528 foreach \u904d\u5386\u6240\u6709\u5f85\u5bfc\u5165\u76ee\u6807\u7684\u540d\u5b57\uff08\u5373\u5df2\u88ab\u5b89\u88c5\u7684\u76ee\u6807\u7684\u540d\u5b57\uff09\uff0c\u5224\u65ad\u8fd9\u4e9b\u53d8\u91cf\u662f\u5426\u5df2\u7ecf\u662f\u76ee\u6807\uff0c\u5982\u679c\u662f\u8bf4\u660e\u5df2\u7ecf\u91cd\u590d\u5305\u542b\u3002 \u83b7\u53d6\u8be5\u9879\u76ee\u7684\u5b89\u88c5\u8def\u5f84\uff0c\u5e76\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u53d8\u91cf _IMPORT_PREFIX \uff0c\u8be5\u53d8\u91cf\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6267\u884c\u4e86\u597d\u51e0\u6b21\u91cd\u590d\u7684\u547d\u4ee4 cmake get_filename_component(_IMPORT_PREFIX \"${CMAKE_CURRENT_LIST_FILE}\" PATH) get_filename_component(_IMPORT_PREFIX \"${_IMPORT_PREFIX}\" PATH) get_filename_component(_IMPORT_PREFIX \"${_IMPORT_PREFIX}\" PATH) get_filename_component(_IMPORT_PREFIX \"${_IMPORT_PREFIX}\" PATH) \u5982\u679c\u5f53\u524d\u6587\u4ef6\u8def\u5f84\u662f /usr/local/lib/cmake/opencv4 \uff0c\u90a3\u4e48\u56db\u6b21\u8bbe\u7f6e get_filename_component \u5206\u522b\u8868\u793a \u5f97\u5230 /usr/local/lib/cmake/opencv4 \u5f97\u5230 /usr/local/lib/cmake \u5f97\u5230 /usr/local/lib \u5f97\u5230 /usr/local \u6700\u7ec8\u7684 _IMPORT_PREFIX \u6b63\u662f\u9879\u76ee\u7684\u5b89\u88c5\u8def\u5f84 /usr/local \u521b\u5efa\u5bfc\u5165\u76ee\u6807\uff0c\u5e76\u521d\u6b65\u8bbe\u7f6e\u5c5e\u6027 \u8fd9\u662f\u8be5\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u7684\u6838\u5fc3\u6240\u5728\uff0c\u5305\u542b\u4e86\u7c7b\u4f3c\u5982\u4e0b\u7684\u4e00\u7cfb\u5217\u8bed\u53e5 ```cmake # Create imported target opencv_core add_library(opencv_core SHARED IMPORTED) # Create imported target opencv_flann add_library(opencv_flann SHARED IMPORTED) set_target_properties(opencv_flann PROPERTIES INTERFACE_LINK_LIBRARIES \"opencv_core;opencv_core\" ) ``` \u53ef\u80fd\u6709\u8bfb\u8005\u4f1a\u6ce8\u610f\u5230\uff0c\u8fd9\u91cc\u5e76\u6ca1\u6709\u4e3a\u5bfc\u5165\u76ee\u6807\u8bbe\u7f6e IMPORTED_LOCATION \u5c5e\u6027\u3002\u6ca1\u9519\uff0c\u6240\u4ee5\u8bf4\u8fd9\u91cc\u662f==\u521d\u6b65==\u8bbe\u7f6e\u5c5e\u6027\u3002 \u5305\u542b OpenCVModules-<config>.cmake \u6587\u4ef6\uff0c\u5728\u6b64\u6587\u4ef6\u4e2d==\u8fdb\u4e00\u6b65==\u8bbe\u7f6e\u5c5e\u6027\u3002\u5982\u679c\u8be5\u9879\u76ee\u662f Release \u6a21\u5f0f\u7f16\u8bd1\u7684\uff0c\u90a3\u4e48\u4f1a\u5305\u542b OpenCVModules-release.cmake \u6587\u4ef6 Debug \u6a21\u5f0f\u7f16\u8bd1\u7684\uff0c\u90a3\u4e48\u4f1a\u5305\u542b OpenCVModules-debug.cmake \u6587\u4ef6 \u4e0d\u6307\u5b9a\u914d\u7f6e\u6a21\u5f0f\u7684\uff0c\u90a3\u4e48\u4f1a\u5305\u542b OpenCVModules-noconfig.cmake \u6587\u4ef6 \u5728 OpenCVModules-<config>.cmake \u6587\u4ef6\u4e2d\u4f1a\u4e3a\u5bfc\u5165\u76ee\u6807\u8bbe\u7f6e IMPORTED_LOCATION_<config> \u7684\u76f8\u5173\u5c5e\u6027\uff0c\u4f8b\u5982 ```cmake # Import target \"opencv_core\" for configuration \"Release\" set_property(TARGET opencv_core APPEND PROPERTY IMPORTED_CONFIGURATIONS RELEASE) set_target_properties(opencv_core PROPERTIES IMPORTED_LOCATION_RELEASE \"${_IMPORT_PREFIX}/lib/libopencv_core.so.4.8.0\" IMPORTED_SONAME_RELEASE \"libopencv_core.so.408\" ) list(APPEND _IMPORT_CHECK_TARGETS opencv_core ) ``` \u65e0\u8bba\u662f\u8fd9\u91cc\u7684 IMPORTED_LOCATION_RELEASE \u8fd8\u662f\u81ea\u5df1\u8bbe\u7f6e\u5bfc\u5165\u76ee\u6807\u4e2d\u7684 IMPORTED_LOCATION \uff0c\u90fd\u4f1a\u4e3a\u76ee\u6807\u8bbe\u7f6e LOCATION \u5c5e\u6027\uff0c\u8fd9\u6b63\u662f\u76ee\u6807\u80fd\u591f\u88ab\u6b63\u786e\u94fe\u63a5\u7684\u5173\u952e\u3002 \u68c0\u67e5\u6240\u6709\u5bfc\u5165\u76ee\u6807\u6240\u6307\u5b9a\u7684\u5e93\u6587\u4ef6\uff08 *.a \u6216\u8005 *.so \uff09\u662f\u5426\u5b58\u5728\u3002 OpenCVModules-<config>.cmake \u6587\u4ef6\u4e2d\u4e3a\u6240\u6709\u7684\u5bfc\u5165\u76ee\u6807\u90fd\u8bbe\u7f6e\u4e86\u5e93\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u8fd9\u4e2a\u8def\u5f84\u7684\u5b58\u5728\u4e0e\u5426\u5c06\u5728\u6b64\u8fdb\u884c\u5224\u65ad\uff0c\u4e0d\u5b58\u5728\u5c06\u4f1a\u7acb\u523b\u7ec8\u6b62 CMake \u7a0b\u5e8f\u3002 3.4 \u56de\u987e\uff1a\u4e3a\u4f55\u8981\u4f7f\u7528 target_xxx ::: tip \u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e2a\u7ecf\u5e38\u88ab\u63d0\u53ca\u7684\u8bdd\u9898\uff0c\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528 target_xxx ::: \u5728 \u301005\u3011\u76ee\u6807\u6784\u5efa #2 \u4e00\u6587\u4e2d\u4ecb\u7ecd\u4e86 target_include_directories \u548c target_link_libraries \u7684\u7528\u6cd5\uff0c\u5e76\u6307\u51fa\u5c3d\u91cf\u4e0d\u8981\u4f7f\u7528 include_directories \u548c link_libraries \u4e24\u79cd\uff0c\u4e0b\u9762\u5c06\u6839\u636e\u672c\u6587\u5bfc\u51fa\u914d\u7f6e\u7684\u5185\u5bb9\u4ecb\u7ecd\u4e3a\u4f55\u8981\u4f7f\u7528 target_xxx \u3002 \u4e00\u822c\u4f7f\u7528 target_include_directories \u7684\u65f6\u5019\uff0c\u9700\u8981\u5305\u542b\u7684\u76ee\u5f55\u4f1a\u4e0e\u6307\u5b9a\u7684 CMake \u76ee\u6807\u7ed1\u5b9a\u8d77\u6765\uff08\u8fd9\u91cc\u7684\u76ee\u6807\u540c\u6837\u53ef\u4ee5\u662f\u5e93\u3001\u53ef\u6267\u884c\u6587\u4ef6\u3001\u63a5\u53e3\u5e93\u7b49\u5185\u5bb9\uff09\uff0c\u6bd4\u65b9\u8bf4\u4ee5\u4e0b\u547d\u4ee4 add_library(aa aaa.cpp) target_include_directories( aa PUBLIC $<BUILD_INTERFACE:${CMAKE_CURRENT_LIST_DIR}/include> $<INSTALL_INTERFACE:include/MyLibrary> ) #################### ### other code ### #################### add_library(bb bbb.cpp) target_link_libraries( bb PUBLIC aa ) \u6839\u636e\u4ee5\u524d\u7684\u77e5\u8bc6 \u4f1a\u628a include \u76ee\u5f55\u6dfb\u52a0\u5230 aa \u76ee\u6807\u4e0b aa \u4f1a\u88ab bb \u6240\u94fe\u63a5 \u6b64\u5916\uff0c\u5982\u679c aa \u548c bb \u76ee\u6807\u88ab\u5b89\u88c5\u81f3\u5bfc\u51fa\u76ee\u6807 MyModules \u4e0a\uff0c\u5e76\u4e14\u5b89\u88c5\uff0c\u5373\u4f7f\u7528\u4ee5\u4e0b\u4ee3\u7801 install( TARGETS aa bb EXPORT MyModules ) install( EXPORT MyModules FILE MyModules.cmake DESTINATION \"${CMAKE_INSTALL_LIBDIR}/cmake/MyLibrary\" ) \u8fd0\u884c cmake --install . \u540e\u53ef\u4ee5\u5728\u5b89\u88c5\u8def\u5f84 <path-to-install>/cmake/MyLibrary/MyModules.cmake \u4e0b\u627e\u5230\u5982\u4e0b\u7c7b\u4f3c\u7684\u8bed\u53e5 # Create imported target aa add_library(aa STATIC IMPORTED) set_target_properties(aa PROPERTIES INTERFACE_INCLUDE_DIRECTORIES \"${_IMPORT_PREFIX}/include/MyLibrary\" ) ## Create imported target bb add_library(bb STATIC IMPORTED) set_target_properties(bb PROPERTIES INTERFACE_LINK_LIBRARIES \"aa\" ) \u8fd9\u4fbf\u662f\u4f7f\u7528 target_xxx \u547d\u4ee4\u7684\u4f5c\u7528\uff0c\u5728\u5bfc\u51fa\u5e76\u5b89\u88c5\u65f6\uff0c\u4f1a\u5c06\u8fd9\u4e9b\u94fe\u63a5\u3001\u5305\u542b\u5173\u7cfb\u7ee7\u7eed\u7ed1\u5b9a\u5728\u8be5\u76ee\u6807\u4e0a\uff0c\u800c\u4f7f\u7528 include_directories \u548c link_libraries \u5219\u6ca1\u6709\u8fd9\u4e9b\u6548\u679c\u3002\u5f53\u7136\uff0c\u5728\u4e0d\u9700\u8981\u8fdb\u884c\u5bfc\u51fa\u5b89\u88c5\u7684\u9879\u76ee\u4e2d\uff0c\u5b8c\u5168\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u4e0d\u5e26 target_ \u524d\u7f00\u7684\u8fd9\u4e9b\u547d\u4ee4\u3002\u4e0d\u8fc7\u8fd9\u4e9b\u4e0d\u5e26 target_ \u4e3a\u524d\u7f00\u7684\u547d\u4ee4\u4f1a\u4f5c\u4e3a\u5168\u5c40\u5305\u542b\u7684\u5f62\u5f0f\u7ed9\u5176\u4ed6\u76ee\u6807\u4f7f\u7528\uff0c\u6709\u4e00\u5b9a\u7684 \u201c\u6c61\u67d3\u201d \u5acc\u7591\u3002 4. XxxConfig.cmake \u6587\u4ef6\u7684\u4e00\u822c\u5199\u6cd5 4.1 \u5199\u6cd5 \u5728\u4f7f\u7528 find_package(OpenCV REQUIRED) \u7684\u65f6\u5019\uff0c\u5c31\u662f\u6309\u7167\u641c\u7d22\u539f\u5219\uff0c\u5728\u7cfb\u7edf\u8def\u5f84\u4e0b\u5bfb\u627e OpenCVConfig.cmake \u6587\u4ef6\uff0c\u82e5\u6211\u4eec\u60f3\u901a\u8fc7\u4f7f\u7528 Config \u6a21\u5f0f\uff0c\u4f7f\u7528 find_package(MyLibrary REQUIRED) \u6765\u53d1\u73b0\u5305\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u5728\u5408\u9002\u7684\u4f4d\u7f6e\u521b\u5efa MyLibraryConfig.cmake \u6587\u4ef6\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4e00\u822c\u662f\u901a\u8fc7\u4f7f\u7528\u6587\u4ef6\u5b89\u88c5\uff08\u5373 install(FILES) \u7684\u65b9\u5f0f\u5b89\u88c5\u5230\u6307\u5b9a\u4f4d\u7f6e\u7684\uff09\u3002\u4e00\u4e2a XxxConfig.cmake \u6587\u4ef6\u4e0e FindXxx.cmake \u5305\u542b\u7684\u5185\u5bb9\u57fa\u672c\u4e00\u81f4\uff0c\u5305\u542b \u641c\u7d22\u5934\u6587\u4ef6 \u641c\u7d22\u5e93\u6587\u4ef6 \u63d0\u4f9b CMake \u76ee\u6807\u53d8\u91cf \u641c\u5bfb\u7684\u7ed3\u679c\u3001\u72b6\u6001 \u8fd9\u91cc\u76f4\u63a5\u7ed9\u51fa\u5185\u5bb9 # ====================================================== # MyLibrary CMake \u914d\u7f6e\u6587\u4ef6 # ====================================================== # ====================================================== # \u5934\u6587\u4ef6\u641c\u7d22 # ====================================================== # \u83b7\u53d6\u6ca1\u6709 ../.. \u76f8\u5bf9\u8def\u5f84\u6807\u8bb0\u7684\u7edd\u5bf9\u8def\u5f84 get_filename_component(ML_CONFIG_PATH \"${CMAKE_CURRENT_LIST_DIR}\" REALPATH) get_filename_component(ML_INSTALL_PATH \"${ML_CONFIG_PATH}/../../../\" REALPATH) # \u641c\u7d22\uff0c\u6dfb\u52a0\u81f3\u5168\u5c40\u53d8\u91cf MyLibrary_INCLUDE_DIRS set(ML_INCLUDE_COMPONENTS \"${ML_INSTALL_PATH}/include/MyLibrary\") set(MyLibrary_INCLUDE_DIRS \"\") foreach(d ${ML_INCLUDE_COMPONENTS}) get_filename_component(_d \"${d}\" REALPATH) if(NOT EXISTS \"${_d}\") message(WARNING \"MyLibrary: Include directory doesn't exist: '${d}'. MyLibrary installation may be broken. Skip...\") else() list(APPEND MyLibrary_INCLUDE_DIRS \"${_d}\") endif() endforeach() unset(_d) # ====================================================== # \u5e93\u6587\u4ef6\u641c\u7d22 # ====================================================== # \u5305\u542b\u5bfc\u51fa\u914d\u7f6e\u7684 *.cmake \u6587\u4ef6 include(${CMAKE_CURRENT_LIST_DIR}/MyModules.cmake) # \u6dfb\u52a0\u81f3\u5168\u5c40\u53d8\u91cf MyLibrary_LIBS set(ML_LIB_COMPONENTS my_target;my_target_2) foreach(_mlcomponent ${ML_LIB_COMPONENTS}) set(MyLibrary_LIBS ${MyLibrary_LIBS} \"${_mlcomponent}\") endforeach() # ====================================================== # \u641c\u5bfb\u7684\u7ed3\u679c\u3001\u72b6\u6001 # ====================================================== include(FindPackageHandleStandardArgs) find_package_handle_standard_args( MyLibrary REQUIRED_VARS ML_INSTALL_PATH ) \u53ef\u4ee5\u7559\u610f\u5230\u8fd9\u91cc\u7684\u5e93\u6587\u4ef6\u641c\u7d22\u4e0d\u518d\u50cf FindXxx.cmake \u90a3\u6837\u9700\u8981\u81ea\u5df1\u6307\u5b9a\u52a8\u6001\u5e93\u6216\u9759\u6001\u5e93\u7684\u8def\u5f84\uff0c\u8fd9\u91cc\u662f\u5426\u662f\u52a8\u6001\u5e93\u6216\u8005\u9759\u6001\u5e93\u5b8c\u5168\u4e0d\u9700\u8981\u7531\u5bfc\u51fa\u8005\u6307\u5b9a\uff0c\u5bfc\u51fa\u8005\u53ea\u9700\u8981\u5305\u542b\u5bfc\u51fa\u914d\u7f6e\u7684\u6587\u4ef6\u5373\u53ef\uff0c\u56e0\u4e3a\u4e0e\u5e93\u76ee\u6807\u76f8\u5173\u7684\u8bbe\u7f6e\u6b63\u662f\u7531\u5bfc\u51fa\u914d\u7f6e\u5b8c\u6210\u3002\u7406\u8bba\u4e0a\uff0c\u5982\u679c\u4e0d\u9700\u8981\u5168\u5c40\u53d8\u91cf xxx_INLCUDE_DIRS \u6216\u8005 xxx_LIBS \u4ee5\u53ca\u641c\u5bfb\u7684\u72b6\u6001\u7684\u8bdd\uff0c XxxConfig.cmake \u6587\u4ef6\u53ef\u4ee5\u77ed\u5230\u53ea\u6709\u51e0\u884c\uff08\u6ce8\u91ca\u5220\u6389\u5c31\u662f 1 \u884c\uff09\uff1a # ====================================================== # MyLibrary CMake \u914d\u7f6e\u6587\u4ef6 # ====================================================== include(${CMAKE_CURRENT_LIST_DIR}/MyModules.cmake) \u56e0\u4e3a\u5728 MyLibrary \u4e2d\uff0c\u76ee\u6807\u53ea\u6709 my_target \u548c my_target_2 \uff0c\u5e76\u4e14\u4e0e\u5176\u76f8\u5173\u7684\u914d\u7f6e\u5168\u90e8\u8bbe\u7f6e\u5728\u4e86\u5bfc\u51fa\u76ee\u6807\u7684\u6587\u4ef6 MyModules.cmake \u4e2d\u3002 4.2 \u5256\u6790 OpenCVConfig.cmake \u4ee5\u4e0b\u5c55\u793a\u4e86 OpenCV 4.8.0 \u7684\u7528\u4e8e find_package \u7684 Config \u6587\u4ef6\uff0c\u70b9\u51fb \u6b64\u5904 \u8df3\u8f6c\u81f3\u8be5\u6587\u4ef6\u3002 \u6309\u7167\u6587\u4ef6\u4e2d\u7684\u987a\u5e8f\uff0c\u4e3b\u8981\u5305\u542b \u63d0\u4f9b\u6ce8\u91ca OpenCVConfig.cmake \u6587\u4ef6\u63d0\u4f9b\u4e86\u5f88\u957f\u7684\u6ce8\u91ca\u5185\u5bb9\uff0c\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u5bf9\u7167\u6b64\u6ce8\u91ca\u5185\u5bb9\u8fdb\u884c\u4f7f\u7528 \u63d0\u4f9b\u7248\u672c\u4fe1\u606f \u5728\u6b64\u6587\u4ef6\u7684\u4e00\u5f00\u5934\uff0cOpenCV \u5c31\u8bbe\u7f6e\u4e86\u7248\u672c\u53f7\u4fe1\u606f \u641c\u7d22\u5934\u6587\u4ef6 \u5e38\u89c4\u64cd\u4f5c\uff0c\u4e0e\u4e0a\u6587\u7684 \u4e00\u822c\u5199\u6cd5 \u57fa\u672c\u4e00\u81f4 \u641c\u7d22\u5e93\u6587\u4ef6\u3001\u63d0\u4f9b CMake \u76ee\u6807\u53d8\u91cf \u5e38\u89c4\u64cd\u4f5c\uff0c\u540c\u6837\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\u3002\u7b2c\u4e00\u90e8\u5206\u76f4\u63a5\u5305\u542b\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6 OpenCVModules.cmake \uff0c\u7528\u4e8e\u914d\u7f6e\u6240\u6709\u7684\u5bfc\u5165\u76ee\u6807\uff0c\u7b2c\u4e8c\u90e8\u5206\u8bbe\u7f6e OpenCV_LIBS \u53d8\u91cf\uff0c\u7528\u4e8e\u5305\u542b\u6240\u6709\u7684\u5bfc\u5165\u76ee\u6807\u3002 ::: warning - \u4e0e\u4e0a\u6587\u4e00\u822c\u5199\u6cd5\u6709\u6240\u4e0d\u540c\u7684\u662f\uff0cOpenCV \u6ca1\u6709\u5728 OpenCVModules.cmake \u4e2d\u4e3a\u76ee\u6807\u914d\u7f6e\u5305\u542b\u5934\u6587\u4ef6\u7684\u641c\u7d22\u8def\u5f84\uff0c\u56e0\u4e3a OpenCV \u5728\u9879\u76ee\u4e2d\u4f7f\u7528\u7684 ocv_target_include_directories \u547d\u4ee4\u4f7f\u7528\u4e86 PRIVATE \u4f5c\u4e3a\u4f20\u64ad\u5c5e\u6027\uff0c\u90a3\u4e48\u4e5f\u5c31\u4e0d\u4f1a\u5728 OpenCVModules.cmake \u4e2d\u6709\u5305\u542b\u5934\u6587\u4ef6\u8def\u5f84\u7684\u914d\u7f6e\uff1b \u4e0d\u8fc7\u5728 OpenCVConfig.cmake \u4e2d\u662f\u901a\u8fc7\u624b\u52a8 foreach \u6bcf\u4e2a\u5bfc\u5165\u76ee\u6807\u5e76\u8fdb\u884c set_target_properties \u64cd\u4f5c\uff0c\u4e3a\u6bcf\u4e2a\u5bfc\u5165\u76ee\u6807\u914d\u7f6e INTERFACE_INCLUDE_DIRECTORIES \u5c5e\u6027\u7684\u3002 ::: \u641c\u5bfb\u7684\u7ed3\u679c\u3001\u72b6\u6001 \u5e38\u89c4\u64cd\u4f5c\uff0c\u540c\u6837\u662f\u4f7f\u7528 find_package_handle_standard_args \u547d\u4ee4\u83b7\u53d6\u641c\u7d22\u7684\u7ed3\u679c\u4e0e\u72b6\u6001 5. CMake \u9879\u76ee\u5bfc\u51fa\u4e0e\u5b89\u88c5\u7684\u5185\u5bb9\u603b\u7ed3 \u603b\u7684\u6765\u8bf4\u9700\u8981\u5b8c\u6210 \u6dfb\u52a0\u5e38\u89c4\u76ee\u6807\u7684\u5b89\u88c5\u89c4\u5219\uff0c\u5e76\u6307\u5b9a\u5bfc\u51fa\u76ee\u6807 \u6dfb\u52a0\u5bfc\u51fa\u76ee\u6807\u7684\u5b89\u88c5\u89c4\u5219 \u7f16\u5199 XxxConfig.cmake \u6587\u4ef6\uff0c\u5e76\u6dfb\u52a0\u5b89\u88c5\u89c4\u5219 \u7f16\u8bd1\u9879\u76ee\uff0c\u6267\u884c\u5b89\u88c5\u6b65\u9aa4\uff0c\u4f8b\u5982 cmake --install . \u601d\u8003 :thinking: \u5bfc\u5165\u76ee\u6807\u548c\u5bfc\u51fa\u76ee\u6807\u6709\u4ec0\u4e48\u4e0d\u540c\uff1f\u4f7f\u7528\u573a\u666f\u662f\u4ec0\u4e48\uff1f \u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5\u63a5\u53e3\u5e93\uff0c\u4f1a\u6709\u4ec0\u4e48\u6548\u679c\uff1f cmake install( TARGETS my_interface LIBRARY DESTINATION lib ARCHIVE DESTINATION lib RUNTIME DESTINATION bin ) \u7b54\u6848 \u3010\u70b9\u6b64\u67e5\u770b\u3011","title":"\u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#10","text":"","title":"\u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#_1","text":"::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 ::: @ bilibili","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#1","text":"\u5728 \u301008\u3011find_package \u8be6\u89e3 \u4e00\u6587\u4e2d\u6211\u4eec\u4e86\u89e3\u5230 find_package \u7684\u4e24\u79cd\u5de5\u4f5c\u65b9\u5f0f\uff0c\u7b2c\u4e00\u79cd\u7684 Module \u6a21\u5f0f\u9700\u8981\u6211\u4eec\u4e3a\u73b0\u6210\u7684\u7b2c\u4e09\u65b9\u5934\u6587\u4ef6\u5e93\u6587\u4ef6\u7f16\u5199 FindXxx.cmake \u4ece\u800c\u80fd\u591f\u4f7f\u7528 find_package \uff0c\u7b2c\u4e8c\u79cd\u7684 Config \u6a21\u5f0f\u5219\u662f\u6253\u5305\u9879\u76ee\u65f6\u91c7\u7528\u7684\u4e3b\u6d41\u65b9\u5f0f\uff0c\u5373\u901a\u8fc7\u7f16\u5199 XxxConfig.cmake \u6587\u4ef6\u6765\u4f7f\u7528 find_package \u3002\u5927\u591a\u6570\u5f00\u6e90\u9879\u76ee\uff0c\u82e5\u662f\u4f7f\u7528CMake\u63d0\u4f9b\u4e86\u7f16\u8bd1\u5b89\u88c5\u65b9\u5f0f\uff0c\u4e00\u5b9a\u4f1a\u6d89\u53ca\u5230\u8fd9\u4e00\u6587\u4ef6\uff0c\u4f8b\u5982 OpenCV \u7684 cmake/templates \u6587\u4ef6\u5939\u4e2d\u5c31\u6709 OpenCVConfig.cmake.in \u7684\u6a21\u677f\u6587\u4ef6\uff0c\u8fd9\u4e00\u6587\u4ef6\u5728CMake\u7684\u914d\u7f6e\u9636\u6bb5\u4f1a\u751f\u6210\u5bf9\u5e94\u7684 OpenCVConfig.cmake \u6587\u4ef6\u3002 \u5bf9\u4e8e XxxConfig.cmake \u6587\u4ef6\u7684\u5199\u6cd5\u4f1a\u5728\u6700\u540e\u8fdb\u884c\u4ecb\u7ecd\uff0c\u5728\u4e00\u5f00\u59cb\u8ba9\u6211\u4eec\u5148\u4e86\u89e3\u4e00\u4e0b\u5b89\u88c5\u7684\u57fa\u672c\u547d\u4ee4\u3002","title":"1. \u524d\u8a00"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#2","text":"\u2014\u2014 install \u547d\u4ee4 \u5728\u73b0\u4ee3 CMake \u4e2d\uff0c\u6240\u6709\u5185\u5bb9\u7684\u5b89\u88c5\uff0c\u5747\u6765\u81ea install \u547d\u4ee4\uff0c\u5305\u62ec\u6587\u4ef6\uff08\u5939\uff09\u3001\u4e8c\u8fdb\u5236\u76ee\u6807\u3001\u4f2a\u76ee\u6807\u4ee5\u53ca\u540e\u6587\u7684\u5bfc\u51fa\u76ee\u6807\u3002\u5728 CMakeLists.txt \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e86 install \u547d\u4ee4\u5e76\u4e0d\u4f1a\u76f4\u63a5\u6267\u884c\u5b89\u88c5\u64cd\u4f5c\uff0c\u5b9e\u9645\u4e0a install \u53ea\u662f\u7ed9\u51fa\u4e86\u5b89\u88c5\u7684\u89c4\u5219\uff0c\u5e76\u53d1\u751f\u5728\u751f\u6210\u9636\u6bb5\u3002\u53ef\u4ee5\u56de\u987e \u301001\u3011\u5b89\u88c5\u4e0e\u57fa\u672c\u4ecb\u7ecd \u7684\u5185\u5bb9\uff0cCMake \u7684\u4f5c\u7528\u662f\u751f\u6210\u5efa\u6784\u6863\uff0c\u800c\u9700\u8981\u5b89\u88c5\u7684\u5177\u4f53\u5185\u5bb9\u5c06\u4f1a\u751f\u6210\u5728\u8be5\u5efa\u6784\u6863\u4e2d\uff0c\u5982 Unix Makefile\u3002 \u6211\u4eec\u53ef\u4ee5\u6267\u884c cmake --install . \u547d\u4ee4\uff0c\u5b8c\u6210\u5b9e\u9645\u7684\u5b89\u88c5\u64cd\u4f5c\u3002 ::: tip \u6b64\u5904\u53ea\u4ecb\u7ecd\u5177\u6709\u57fa\u672c\u6587\u4ef6\u7ed3\u6784\u7684\u5b89\u88c5\uff0c\u5bfc\u51fa\u76ee\u6807\u7684\u5b89\u88c5\u5728\u4e0b\u4e00\u8282\u8fdb\u884c\u4ecb\u7ecd\u3002 :::","title":"2. \u6587\u4ef6\u3001\u76ee\u6807\u7684\u5b89\u88c5\u89c4\u5219"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#21","text":"\u5373\uff1a install(FILES) \u8fd9\u91cc\u5148\u76f4\u63a5\u7ed9\u51fa\u6587\u4ef6\u5b89\u88c5\u7684 install \u547d\u4ee4\u7528\u6cd5\uff0c\u4e0b\u9762\u5217\u4e3e\u4e00\u4e9b\u5e38\u89c1\u7684\u53ef\u9009\u5185\u5bb9\u3002 DESTINATION \uff1a\u6307\u5b9a\u8981\u5b89\u88c5\u5230\u7684\u76ee\u6807\u76ee\u5f55\u3002 PERMISSIONS \uff1a\u6307\u5b9a\u8981\u5b89\u88c5\u6587\u4ef6\u7684\u6743\u9650\uff0c\u6743\u9650\u53c2\u6570\u8981\u6c42\u662f\u4e00\u7cfb\u5217 OWNER_* \u3001 GROUP_* \u548c WORLD_* \u6743\u9650\u503c\u7684\u7ec4\u5408\uff0c\u4f8b\u5982 OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ \u3002 CONFIGURATIONS \uff1a\u6307\u5b9a\u8981\u5728\u54ea\u4e9b\u6784\u5efa\u914d\u7f6e\u4e0b\u5b89\u88c5\u6587\u4ef6\u3002\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u6216\u591a\u4e2a\u6784\u5efa\u914d\u7f6e\u7684\u540d\u79f0\u6765\u9650\u5b9a\u3002 COMPONENT \uff1a\u6307\u5b9a\u8981\u5c06\u6587\u4ef6\u5f52\u7c7b\u5230\u7684\u7ec4\u4ef6\u540d\u79f0\uff0c\u4ee5\u4fbf\u4e8e\u540e\u7eed\u8fdb\u884c\u7ba1\u7406\u548c\u6253\u5305\uff08\u89c1 \u301013\u3011CPack \uff09\u3002 RENAME \uff1a\u6307\u5b9a\u5728\u5b89\u88c5\u65f6\u91cd\u547d\u540d\u6587\u4ef6\u6216\u76ee\u5f55\u7684\u540d\u79f0\u3002 OPTIONAL \uff1a\u8868\u793a\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\u5219\u4e0d\u4f1a\u629b\u51fa\u9519\u8bef\u3002 # \u5b9a\u4e49\u4e8e <path-to-opencv>/include/CMakeLists.txt \u4e2d install(FILES \"opencv2/opencv.hpp\" DESTINATION ${OPENCV_INCLUDE_INSTALL_PATH}/opencv2 COMPONENT dev) \u8fd9\u53e5\u547d\u4ee4\u6dfb\u52a0\u4e86\u5c06\u5355\u4e00\u6587\u4ef6 opencv2/opencv.hpp \u5b89\u88c5\u5230\u6307\u5b9a\u76ee\u5f55\u7684\u5b89\u88c5\u89c4\u5219\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f /usr/local/include/opencv4/opencv2 \u4e2d\uff0c\u5e76\u5f52\u7c7b\u5230 dev \u7ec4\u4ef6\u7684\u5b89\u88c5\u89c4\u5219\u4e2d\uff0c\u5728\u6267\u884c cmake --install . \u547d\u4ee4\u7684\u65f6\u5019\u4f1a\u6267\u884c\u8be5\u5b89\u88c5\u64cd\u4f5c\u3002 \u5176\u4f59\u53ef\u9009\u5185\u5bb9\u5982 RENAME \u7528\u6cd5\u4e0e\u4e0a\u6587\u7ed9\u51fa\u7684\u4f8b\u5b50\u7c7b\u4f3c\u3002","title":"2.1 \u6587\u4ef6\u5b89\u88c5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#22","text":"\u5373 install(DIRECTORY) \u4f7f\u7528\u65b9\u5f0f\u4e0e\u6587\u4ef6\u5b89\u88c5\u57fa\u672c\u4e00\u81f4\uff0c\u4f46\u76f8\u6bd4\u4e8e\u6587\u4ef6\u5b89\u88c5\uff0c\u4e3b\u8981\u591a\u51fa\u4e86 PATTERN \u3001 EXCLUDE_PATTERN \u548c RECURSE \u5173\u952e\u5b57\uff0c\u901a\u8fc7 PATTERN \u548c EXCLUDE_PATTERN \u53c2\u6570\u6307\u5b9a\u8981\u5305\u542b\u548c\u6392\u9664\u7684\u6587\u4ef6\uff0c\u4f7f\u7528 RECURSE \u53c2\u6570\u8fdb\u884c\u9012\u5f52\u5b89\u88c5\u3002\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u7b80\u5355\u7684\uff0cOpenCV \u4e2d\u5b89\u88c5\u6587\u6863\u6240\u5728\u6587\u4ef6\u5939\u7684\u4f8b\u5b50\u3002 # \u5b9a\u4e49\u4e8e <path-to-opencv>/doc/CMakeLists.txt \u4e2d install(DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/doxygen/html DESTINATION \"${OPENCV_DOC_INSTALL_PATH}\" COMPONENT \"docs\" OPTIONAL ${compatible_MESSAGE_NEVER} # \u53ef\u4ee5\u4e0d\u7528\u7ba1\u8fd9\u53e5\u8bdd ) \u8fd9\u53e5\u547d\u4ee4\u5c06\u5f53\u524d\u4e8c\u8fdb\u5236\u751f\u6210\u76ee\u5f55\u4e2d\u7684 doxygen/html \u6587\u4ef6\u5939\u5b89\u88c5\u5230 ${OPENCV_DOC_INSTALL_PATH} \u4e2d\uff0c\u5e76\u5f52\u7c7b\u5230 docs \u4e2d\uff0c OPTIONAL \u8bf4\u660e\u4e86\u5373\u4f7f\u8fd9\u4e2a\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u4e5f\u4e0d\u4f1a\u629b\u51fa\u5b89\u88c5\u7684\u9519\u8bef\u3002\u540c\u6837\uff0c\u9700\u8981\u5728\u7ec8\u7aef\u6267\u884c cmake --install . \u547d\u4ee4\u4ee5\u5b8c\u6210\u5b89\u88c5\u3002","title":"2.2 \u76ee\u5f55\uff08\u6587\u4ef6\u5939\uff09\u5b89\u88c5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#23","text":"\u5373 install(TARGETS) \uff0c\u5148\u7ed9\u51fa\u76ee\u6807\u5b89\u88c5\u7684\u7b7e\u540d install(TARGETS <target>... [EXPORT <export-name>] [RUNTIME_DEPENDENCIES <arg>...|RUNTIME_DEPENDENCY_SET <set-name>] [<artifact-option>...] [<artifact-kind> <artifact-option>...]... [INCLUDES DESTINATION [<dir> ...]] ) \u7528\u6cd5\u4e0e\u6587\u4ef6\u3001\u6587\u4ef6\u5939\u5b89\u88c5\u57fa\u672c\u4e00\u81f4\uff0c\u4f46\u7531\u4e8e CMake \u4e2d\u7684\u76ee\u6807\u4e0d\u4ec5\u4ec5\u5305\u542b\u52a8\u6001\u3001\u9759\u6001\u5e93\uff0c\u4e5f\u6709\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4e5f\u6709\u63a5\u53e3\u5e93\u3001\u5bfc\u5165\u5e93\u7b49\u4f2a\u76ee\u6807\uff0c\u56e0\u6b64 CMake \u76ee\u6807\u5b89\u88c5\u662f\u4e2a\u5e7f\u6cdb\u7684\u6982\u5ff5\uff0c\u63a5\u53e3\u4e0a\u4e5f\u80fd\u9002\u914d\u591a\u79cd\u76ee\u6807\u7684\u5b89\u88c5\uff0c\u4f8b\u5982\u4ee5\u4e0b\u547d\u4ee4 install( TARGETS my_target LIBRARY DESTINATION lib ARCHIVE DESTINATION lib RUNTIME DESTINATION bin ) \u5148\u6765\u8003\u8651\u4e8c\u8fdb\u5236\u76ee\u6807\u7684\u60c5\u51b5 LIBRARY \u6307\u4ee3\u7684\u662f Unix \u6587\u4ef6\u7cfb\u7edf\u7684\u5171\u4eab\u5e93 ARCHIVE \u6307\u4ee3\u7684\u662f Unix \u6587\u4ef6\u7cfb\u7edf\u7684\u9759\u6001\u5e93\uff0c\u4ee5\u53ca Windows \u4e0b\u7684\u9759\u6001\u94fe\u63a5\u5e93\u548c\u5bfc\u5165\u5e93 RUNTIME \u6307\u4ee3\u7684\u662f\u53ef\u6267\u884c\u6587\u4ef6\u4ee5\u53ca Windows \u4e0b\u7684\u52a8\u6001\u94fe\u63a5\u5e93 \u5f53 my_target \u662f\u666e\u901a\u5e93\u76ee\u6807\u65f6\uff0c\u5728 Linux \u4e0b\uff0c\u5bf9\u5e94\u7684 *.so \u6216 *.a \u76ee\u6807\u4f1a\u88ab\u5b89\u88c5\u81f3 <prefix>/lib \u4e0b\uff0c\u540c\u6837\uff0c\u5728 Windows \u4e0b\uff0c\u5bf9\u5e94\u7684 *.dll \u548cDLL\u5bfc\u5165\u5e93 *.lib \u4e5f\u4f1a\u88ab\u5b89\u88c5\u5230 <prefix>/lib \u4e0b\u3002\u5f53 my_target \u662f\u53ef\u6267\u884c\u6587\u4ef6\u65f6\uff0c\u4f1a\u88ab\u5b89\u88c5\u5230 <prefix>/bin \u4e0b","title":"2.3 \u76ee\u6807\u5b89\u88c5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#3","text":"","title":"3. \u5bfc\u51fa\u76ee\u6807\u7684\u5b89\u88c5\u89c4\u5219"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#31","text":"\u5728 \u301005\u3011\u76ee\u6807\u6784\u5efa #2.4 \u6211\u4eec\u4ecb\u7ecd\u8fc7 IMPORTED \u5bfc\u5165\u76ee\u6807\u7684\u6982\u5ff5\uff0c\u867d\u7136 IMPORTED \u76ee\u6807\u672c\u8eab\u5f88\u6709\u7528\uff0c\u4f46\u6211\u4eec\u4ecd\u7136\u9700\u8981\u77e5\u9053\u8fd9\u4e9b IMPORTED \u76ee\u6807\u6240\u6307\u4ee3\u6216\u8005\u5305\u542b\u7684\u6587\u4ef6\u5728\u78c1\u76d8\u4e0a\u7684\u4f4d\u7f6e\u3002 IMPORTED \u76ee\u6807\u7684\u771f\u6b63\u5f3a\u5927\u4e4b\u5904\u5728\u4e8e\uff0c\u5f53\u63d0\u4f9b\u76ee\u6807\u6587\u4ef6\u7684\u9879\u76ee\u8ba1\u5212\u63d0\u4f9b\u4e00\u4e2a CMake \u6587\u4ef6\u6765\u5e2e\u52a9\u5bfc\u5165\u5b83\u4eec\u65f6\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u9879\u76ee\u4ee5\u751f\u6210 \u5fc5\u8981\u7684\u4fe1\u606f \uff0c\u4ee5\u4fbf\u5176\u4ed6 CMake \u9879\u76ee\u53ef\u4ee5\u8f7b\u677e\u5730\u4f7f\u7528\u5b83\uff0c\u8fd9\u4e00\u5fc5\u8981\u7684\u4fe1\u606f\u5c31\u662f\u6240\u8c13\u7684\u5bfc\u51fa\u76ee\u6807\u3002 \u5728\u5f00\u53d1\u5b8c\u4e00\u4e2a\u5e93\u7684\u65f6\u5019\uff0c\u9700\u8981\u5c06\u5176\u6253\u5305\u7ed9\u4ed6\u4eba\u4f7f\u7528\uff08\u6ce8\u610f\u4e0d\u662f\u6253\u5305\u8ba9\u4ed6\u4eba\u6e90\u7801\u7f16\u8bd1\uff0c\u800c\u662f\u76f4\u63a5\u62ff\u6765\u7528\uff09\uff0c\u6211\u4eec\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a\u5305\u542b\u8fd9\u4e2a\u5e93\u91cc\u9762\u6240\u6709\u5f85\u5bfc\u51fa\u76ee\u6807\u4fe1\u606f\u7684 *.cmake \u6587\u4ef6\uff0c\u79f0\u4e3a\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u3002\u8be5\u6587\u4ef6\u6b63\u662f\u5728 CMake \u7684\u751f\u6210\u9636\u6bb5\u7531\u5bfc\u51fa\u76ee\u6807\u751f\u6210\u7684\u3002\u4e0d\u8fc7\uff0c\u8fd9\u4e00\u6587\u4ef6\u6211\u4eec\u5e76\u4e0d\u4f1a\u76f4\u63a5\u4f7f\u7528\uff0c\u800c\u662f\u95f4\u63a5\u7684\u901a\u8fc7\u4f7f\u7528 XxxConfig.cmake \u7684\u65b9\u5f0f\u4f7f\u7528\u8be5\u5bfc\u51fa\u76ee\u6807\u5bf9\u5e94\u7684 *.cmake \u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u3002\u6211\u4eec\u5148\u56de\u5230\u6700\u57fa\u672c\u7684\uff0c\u5982\u4f55\u6dfb\u52a0\u5bfc\u51fa\u76ee\u6807\u548c\u751f\u6210\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u3002","title":"3.1 \u4f55\u4e3a\u5bfc\u51fa\u76ee\u6807\u3001\u5bfc\u51fa\u914d\u7f6e"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#32","text":"\u9996\u5148\u6211\u4eec\u9700\u8981\u6307\u5b9a\u54ea\u4e9b\u76ee\u6807\u9700\u8981\u5bfc\u51fa\uff0c\u5e76\u4e14\u8bbe\u7f6e\u5bfc\u51fa\u76ee\u6807\u7684\u540d\u79f0\uff0c\u5047\u8bbe\u8fd8\u662f\u4e0a\u6587\u7684 my_target \u76ee\u6807\uff0c\u6211\u4eec\u5728\u4f7f\u7528 install \u547d\u4ee4\u65f6\u53ef\u4ee5\u6307\u5b9a EXPORT \uff0c\u5373 install( TARGETS my_target EXPORT MyModules LIBRARY DESTINATION lib ARCHIVE DESTINATION lib RUNTIME DESTINATION bin ) ::: warning EXPORT \u5fc5\u987b\u5728 TARGETS \u4e4b\u540e\uff0c [<artifact-option>...] \u4e4b\u524d\uff0c\u5982 \u7b7e\u540d \u7684\u8981\u6c42\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u5199\u6210 install( EXPORT MyModules TARGETS my_target ) \u6216\u8005 install( TARGETS my_target LIBRARY DESTINATION lib EXPORT MyModules ) \u90fd\u662f\u9519\u8bef\u7684\u5199\u6cd5\uff0c\u5728 CMake \u914d\u7f6e\u671f\u95f4\u4f1a\u62a5\u9519\u3002 ::: \u8fd9\u91cc\u7684 MyModules \u5c31\u662f\u5bfc\u51fa\u76ee\u6807\u540d\uff0c\u5e76\u4e14\u8be5\u5bfc\u51fa\u76ee\u6807\u5305\u542b\u4e86\u5173\u4e8e my_target \u7684\u6240\u6709\u4fe1\u606f\uff0c\u5305\u62ec\u5934\u6587\u4ef6\u8def\u5f84\u3001\u5e93\u6587\u4ef6\u8def\u5f84\u7b49\u5185\u5bb9\u3002\u5982\u679c\u6211\u5728\u6b64\u4e4b\u4e0a\u7ee7\u7eed\u5199\u5165 install( TARGETS my_target_2 EXPORT MyModules LIBRARY DESTINATION lib ARCHIVE DESTINATION lib ) \u5219\u6b64\u65f6\u5bfc\u51fa\u76ee\u6807 MyModules \u5305\u542b\u4e86\u4e24\u4e2a\u76ee\u6807\u7684\u5185\u5bb9\uff0c\u5373 my_target \u548c my_target_2 \u3002 \u6700\u540e\u9700\u8981\u5c06\u8be5\u5bfc\u51fa\u76ee\u6807\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684 *.cmake \u6587\u4ef6\uff0c\u5373\u6307\u5b9a\u5bfc\u51fa\u76ee\u6807\u7684\u5b89\u88c5\u7b56\u7565\uff0c\u8bed\u6cd5\u91c7\u7528 install(EXPORTS) install( EXPORT MyModules FILE MyModules.cmake DESTINATION \"lib/cmake/${PROJECT_NAME}\" # \u4e00\u822c\u5b89\u88c5\u8def\u5f84\u4f1a\u8bbe\u7f6e\u5728\u6b64\u5904 ) \u5982\u679c\u4e0d\u989d\u5916\u6307\u5b9a OpenCV \u7684\u5b89\u88c5\u8def\u5f84\uff0c\u53ef\u4ee5\u5728 /usr/local/lib/cmake/opencv4 \u4e0b\u627e\u5230 OpenCVModules.cmake \u4ee5\u53ca OpenCVModules-release.cmake \u8fd9\u4e24\u4e2a\u6587\u4ef6\uff0c\u8fd9\u4e2a\u5c31\u662f OpenCV \u7684\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u3002","title":"3.2 \u57fa\u672c\u8bed\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#33","text":"\u6211\u4eec\u5c31\u4ee5 OpenCV 4.8.0 \u5728\u6267\u884c\u5b8c\u5b89\u88c5\u547d\u4ee4\u4e4b\u540e\u751f\u6210\u7684\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6 OpenCVModules.cmake \uff0c\u70b9\u51fb \u6b64\u5904 \u8df3\u8f6c\u81f3\u8be5\u6587\u4ef6 OpenCVModules-release.cmake \uff0c\u70b9\u51fb \u6b64\u5904 \u8df3\u8f6c\u81f3\u8be5\u6587\u4ef6 \u4e24\u4e2a\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\u8fdb\u884c\u4ecb\u7ecd\uff0c\u56e0\u4e3a\u8fd9\u7c7b\u6587\u4ef6\u662f\u7531\u5bfc\u51fa\u76ee\u6807\u5728\u5b89\u88c5\u540e\u81ea\u52a8\u751f\u6210\u7684\uff0c\u6240\u4ee5\u4e0d\u8bba\u662f\u4ec0\u4e48\u9879\u76ee\uff0c\u5728\u5185\u5bb9\u4e0a\u90fd\u5177\u6709\u76f8\u4f3c\u6027 \u4e0a\u6587\u4e2d\u7684 OpenCVModules.cmake \u6587\u4ef6\uff0c\u5177\u6709\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206 \u9632\u6b62\u91cd\u590d\u5305\u542b\uff0c\u6765\u81ea\u5982\u4e0b\u6ce8\u91ca\uff1a # Protect against multiple inclusion, which would fail when already imported targets are added once more. \u4f7f\u7528 foreach \u904d\u5386\u6240\u6709\u5f85\u5bfc\u5165\u76ee\u6807\u7684\u540d\u5b57\uff08\u5373\u5df2\u88ab\u5b89\u88c5\u7684\u76ee\u6807\u7684\u540d\u5b57\uff09\uff0c\u5224\u65ad\u8fd9\u4e9b\u53d8\u91cf\u662f\u5426\u5df2\u7ecf\u662f\u76ee\u6807\uff0c\u5982\u679c\u662f\u8bf4\u660e\u5df2\u7ecf\u91cd\u590d\u5305\u542b\u3002 \u83b7\u53d6\u8be5\u9879\u76ee\u7684\u5b89\u88c5\u8def\u5f84\uff0c\u5e76\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u53d8\u91cf _IMPORT_PREFIX \uff0c\u8be5\u53d8\u91cf\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6267\u884c\u4e86\u597d\u51e0\u6b21\u91cd\u590d\u7684\u547d\u4ee4 cmake get_filename_component(_IMPORT_PREFIX \"${CMAKE_CURRENT_LIST_FILE}\" PATH) get_filename_component(_IMPORT_PREFIX \"${_IMPORT_PREFIX}\" PATH) get_filename_component(_IMPORT_PREFIX \"${_IMPORT_PREFIX}\" PATH) get_filename_component(_IMPORT_PREFIX \"${_IMPORT_PREFIX}\" PATH) \u5982\u679c\u5f53\u524d\u6587\u4ef6\u8def\u5f84\u662f /usr/local/lib/cmake/opencv4 \uff0c\u90a3\u4e48\u56db\u6b21\u8bbe\u7f6e get_filename_component \u5206\u522b\u8868\u793a \u5f97\u5230 /usr/local/lib/cmake/opencv4 \u5f97\u5230 /usr/local/lib/cmake \u5f97\u5230 /usr/local/lib \u5f97\u5230 /usr/local \u6700\u7ec8\u7684 _IMPORT_PREFIX \u6b63\u662f\u9879\u76ee\u7684\u5b89\u88c5\u8def\u5f84 /usr/local \u521b\u5efa\u5bfc\u5165\u76ee\u6807\uff0c\u5e76\u521d\u6b65\u8bbe\u7f6e\u5c5e\u6027 \u8fd9\u662f\u8be5\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u7684\u6838\u5fc3\u6240\u5728\uff0c\u5305\u542b\u4e86\u7c7b\u4f3c\u5982\u4e0b\u7684\u4e00\u7cfb\u5217\u8bed\u53e5 ```cmake # Create imported target opencv_core add_library(opencv_core SHARED IMPORTED) # Create imported target opencv_flann add_library(opencv_flann SHARED IMPORTED) set_target_properties(opencv_flann PROPERTIES INTERFACE_LINK_LIBRARIES \"opencv_core;opencv_core\" ) ``` \u53ef\u80fd\u6709\u8bfb\u8005\u4f1a\u6ce8\u610f\u5230\uff0c\u8fd9\u91cc\u5e76\u6ca1\u6709\u4e3a\u5bfc\u5165\u76ee\u6807\u8bbe\u7f6e IMPORTED_LOCATION \u5c5e\u6027\u3002\u6ca1\u9519\uff0c\u6240\u4ee5\u8bf4\u8fd9\u91cc\u662f==\u521d\u6b65==\u8bbe\u7f6e\u5c5e\u6027\u3002 \u5305\u542b OpenCVModules-<config>.cmake \u6587\u4ef6\uff0c\u5728\u6b64\u6587\u4ef6\u4e2d==\u8fdb\u4e00\u6b65==\u8bbe\u7f6e\u5c5e\u6027\u3002\u5982\u679c\u8be5\u9879\u76ee\u662f Release \u6a21\u5f0f\u7f16\u8bd1\u7684\uff0c\u90a3\u4e48\u4f1a\u5305\u542b OpenCVModules-release.cmake \u6587\u4ef6 Debug \u6a21\u5f0f\u7f16\u8bd1\u7684\uff0c\u90a3\u4e48\u4f1a\u5305\u542b OpenCVModules-debug.cmake \u6587\u4ef6 \u4e0d\u6307\u5b9a\u914d\u7f6e\u6a21\u5f0f\u7684\uff0c\u90a3\u4e48\u4f1a\u5305\u542b OpenCVModules-noconfig.cmake \u6587\u4ef6 \u5728 OpenCVModules-<config>.cmake \u6587\u4ef6\u4e2d\u4f1a\u4e3a\u5bfc\u5165\u76ee\u6807\u8bbe\u7f6e IMPORTED_LOCATION_<config> \u7684\u76f8\u5173\u5c5e\u6027\uff0c\u4f8b\u5982 ```cmake # Import target \"opencv_core\" for configuration \"Release\" set_property(TARGET opencv_core APPEND PROPERTY IMPORTED_CONFIGURATIONS RELEASE) set_target_properties(opencv_core PROPERTIES IMPORTED_LOCATION_RELEASE \"${_IMPORT_PREFIX}/lib/libopencv_core.so.4.8.0\" IMPORTED_SONAME_RELEASE \"libopencv_core.so.408\" ) list(APPEND _IMPORT_CHECK_TARGETS opencv_core ) ``` \u65e0\u8bba\u662f\u8fd9\u91cc\u7684 IMPORTED_LOCATION_RELEASE \u8fd8\u662f\u81ea\u5df1\u8bbe\u7f6e\u5bfc\u5165\u76ee\u6807\u4e2d\u7684 IMPORTED_LOCATION \uff0c\u90fd\u4f1a\u4e3a\u76ee\u6807\u8bbe\u7f6e LOCATION \u5c5e\u6027\uff0c\u8fd9\u6b63\u662f\u76ee\u6807\u80fd\u591f\u88ab\u6b63\u786e\u94fe\u63a5\u7684\u5173\u952e\u3002 \u68c0\u67e5\u6240\u6709\u5bfc\u5165\u76ee\u6807\u6240\u6307\u5b9a\u7684\u5e93\u6587\u4ef6\uff08 *.a \u6216\u8005 *.so \uff09\u662f\u5426\u5b58\u5728\u3002 OpenCVModules-<config>.cmake \u6587\u4ef6\u4e2d\u4e3a\u6240\u6709\u7684\u5bfc\u5165\u76ee\u6807\u90fd\u8bbe\u7f6e\u4e86\u5e93\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u8fd9\u4e2a\u8def\u5f84\u7684\u5b58\u5728\u4e0e\u5426\u5c06\u5728\u6b64\u8fdb\u884c\u5224\u65ad\uff0c\u4e0d\u5b58\u5728\u5c06\u4f1a\u7acb\u523b\u7ec8\u6b62 CMake \u7a0b\u5e8f\u3002","title":"3.3 \u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u7684\u57fa\u672c\u5185\u5bb9"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#34-target_xxx","text":"::: tip \u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e2a\u7ecf\u5e38\u88ab\u63d0\u53ca\u7684\u8bdd\u9898\uff0c\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528 target_xxx ::: \u5728 \u301005\u3011\u76ee\u6807\u6784\u5efa #2 \u4e00\u6587\u4e2d\u4ecb\u7ecd\u4e86 target_include_directories \u548c target_link_libraries \u7684\u7528\u6cd5\uff0c\u5e76\u6307\u51fa\u5c3d\u91cf\u4e0d\u8981\u4f7f\u7528 include_directories \u548c link_libraries \u4e24\u79cd\uff0c\u4e0b\u9762\u5c06\u6839\u636e\u672c\u6587\u5bfc\u51fa\u914d\u7f6e\u7684\u5185\u5bb9\u4ecb\u7ecd\u4e3a\u4f55\u8981\u4f7f\u7528 target_xxx \u3002 \u4e00\u822c\u4f7f\u7528 target_include_directories \u7684\u65f6\u5019\uff0c\u9700\u8981\u5305\u542b\u7684\u76ee\u5f55\u4f1a\u4e0e\u6307\u5b9a\u7684 CMake \u76ee\u6807\u7ed1\u5b9a\u8d77\u6765\uff08\u8fd9\u91cc\u7684\u76ee\u6807\u540c\u6837\u53ef\u4ee5\u662f\u5e93\u3001\u53ef\u6267\u884c\u6587\u4ef6\u3001\u63a5\u53e3\u5e93\u7b49\u5185\u5bb9\uff09\uff0c\u6bd4\u65b9\u8bf4\u4ee5\u4e0b\u547d\u4ee4 add_library(aa aaa.cpp) target_include_directories( aa PUBLIC $<BUILD_INTERFACE:${CMAKE_CURRENT_LIST_DIR}/include> $<INSTALL_INTERFACE:include/MyLibrary> ) #################### ### other code ### #################### add_library(bb bbb.cpp) target_link_libraries( bb PUBLIC aa ) \u6839\u636e\u4ee5\u524d\u7684\u77e5\u8bc6 \u4f1a\u628a include \u76ee\u5f55\u6dfb\u52a0\u5230 aa \u76ee\u6807\u4e0b aa \u4f1a\u88ab bb \u6240\u94fe\u63a5 \u6b64\u5916\uff0c\u5982\u679c aa \u548c bb \u76ee\u6807\u88ab\u5b89\u88c5\u81f3\u5bfc\u51fa\u76ee\u6807 MyModules \u4e0a\uff0c\u5e76\u4e14\u5b89\u88c5\uff0c\u5373\u4f7f\u7528\u4ee5\u4e0b\u4ee3\u7801 install( TARGETS aa bb EXPORT MyModules ) install( EXPORT MyModules FILE MyModules.cmake DESTINATION \"${CMAKE_INSTALL_LIBDIR}/cmake/MyLibrary\" ) \u8fd0\u884c cmake --install . \u540e\u53ef\u4ee5\u5728\u5b89\u88c5\u8def\u5f84 <path-to-install>/cmake/MyLibrary/MyModules.cmake \u4e0b\u627e\u5230\u5982\u4e0b\u7c7b\u4f3c\u7684\u8bed\u53e5 # Create imported target aa add_library(aa STATIC IMPORTED) set_target_properties(aa PROPERTIES INTERFACE_INCLUDE_DIRECTORIES \"${_IMPORT_PREFIX}/include/MyLibrary\" ) ## Create imported target bb add_library(bb STATIC IMPORTED) set_target_properties(bb PROPERTIES INTERFACE_LINK_LIBRARIES \"aa\" ) \u8fd9\u4fbf\u662f\u4f7f\u7528 target_xxx \u547d\u4ee4\u7684\u4f5c\u7528\uff0c\u5728\u5bfc\u51fa\u5e76\u5b89\u88c5\u65f6\uff0c\u4f1a\u5c06\u8fd9\u4e9b\u94fe\u63a5\u3001\u5305\u542b\u5173\u7cfb\u7ee7\u7eed\u7ed1\u5b9a\u5728\u8be5\u76ee\u6807\u4e0a\uff0c\u800c\u4f7f\u7528 include_directories \u548c link_libraries \u5219\u6ca1\u6709\u8fd9\u4e9b\u6548\u679c\u3002\u5f53\u7136\uff0c\u5728\u4e0d\u9700\u8981\u8fdb\u884c\u5bfc\u51fa\u5b89\u88c5\u7684\u9879\u76ee\u4e2d\uff0c\u5b8c\u5168\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e9b\u4e0d\u5e26 target_ \u524d\u7f00\u7684\u8fd9\u4e9b\u547d\u4ee4\u3002\u4e0d\u8fc7\u8fd9\u4e9b\u4e0d\u5e26 target_ \u4e3a\u524d\u7f00\u7684\u547d\u4ee4\u4f1a\u4f5c\u4e3a\u5168\u5c40\u5305\u542b\u7684\u5f62\u5f0f\u7ed9\u5176\u4ed6\u76ee\u6807\u4f7f\u7528\uff0c\u6709\u4e00\u5b9a\u7684 \u201c\u6c61\u67d3\u201d \u5acc\u7591\u3002","title":"3.4 \u56de\u987e\uff1a\u4e3a\u4f55\u8981\u4f7f\u7528 target_xxx"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#4-xxxconfigcmake","text":"","title":"4. XxxConfig.cmake \u6587\u4ef6\u7684\u4e00\u822c\u5199\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#41","text":"\u5728\u4f7f\u7528 find_package(OpenCV REQUIRED) \u7684\u65f6\u5019\uff0c\u5c31\u662f\u6309\u7167\u641c\u7d22\u539f\u5219\uff0c\u5728\u7cfb\u7edf\u8def\u5f84\u4e0b\u5bfb\u627e OpenCVConfig.cmake \u6587\u4ef6\uff0c\u82e5\u6211\u4eec\u60f3\u901a\u8fc7\u4f7f\u7528 Config \u6a21\u5f0f\uff0c\u4f7f\u7528 find_package(MyLibrary REQUIRED) \u6765\u53d1\u73b0\u5305\uff0c\u6211\u4eec\u4e5f\u9700\u8981\u5728\u5408\u9002\u7684\u4f4d\u7f6e\u521b\u5efa MyLibraryConfig.cmake \u6587\u4ef6\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4e00\u822c\u662f\u901a\u8fc7\u4f7f\u7528\u6587\u4ef6\u5b89\u88c5\uff08\u5373 install(FILES) \u7684\u65b9\u5f0f\u5b89\u88c5\u5230\u6307\u5b9a\u4f4d\u7f6e\u7684\uff09\u3002\u4e00\u4e2a XxxConfig.cmake \u6587\u4ef6\u4e0e FindXxx.cmake \u5305\u542b\u7684\u5185\u5bb9\u57fa\u672c\u4e00\u81f4\uff0c\u5305\u542b \u641c\u7d22\u5934\u6587\u4ef6 \u641c\u7d22\u5e93\u6587\u4ef6 \u63d0\u4f9b CMake \u76ee\u6807\u53d8\u91cf \u641c\u5bfb\u7684\u7ed3\u679c\u3001\u72b6\u6001 \u8fd9\u91cc\u76f4\u63a5\u7ed9\u51fa\u5185\u5bb9 # ====================================================== # MyLibrary CMake \u914d\u7f6e\u6587\u4ef6 # ====================================================== # ====================================================== # \u5934\u6587\u4ef6\u641c\u7d22 # ====================================================== # \u83b7\u53d6\u6ca1\u6709 ../.. \u76f8\u5bf9\u8def\u5f84\u6807\u8bb0\u7684\u7edd\u5bf9\u8def\u5f84 get_filename_component(ML_CONFIG_PATH \"${CMAKE_CURRENT_LIST_DIR}\" REALPATH) get_filename_component(ML_INSTALL_PATH \"${ML_CONFIG_PATH}/../../../\" REALPATH) # \u641c\u7d22\uff0c\u6dfb\u52a0\u81f3\u5168\u5c40\u53d8\u91cf MyLibrary_INCLUDE_DIRS set(ML_INCLUDE_COMPONENTS \"${ML_INSTALL_PATH}/include/MyLibrary\") set(MyLibrary_INCLUDE_DIRS \"\") foreach(d ${ML_INCLUDE_COMPONENTS}) get_filename_component(_d \"${d}\" REALPATH) if(NOT EXISTS \"${_d}\") message(WARNING \"MyLibrary: Include directory doesn't exist: '${d}'. MyLibrary installation may be broken. Skip...\") else() list(APPEND MyLibrary_INCLUDE_DIRS \"${_d}\") endif() endforeach() unset(_d) # ====================================================== # \u5e93\u6587\u4ef6\u641c\u7d22 # ====================================================== # \u5305\u542b\u5bfc\u51fa\u914d\u7f6e\u7684 *.cmake \u6587\u4ef6 include(${CMAKE_CURRENT_LIST_DIR}/MyModules.cmake) # \u6dfb\u52a0\u81f3\u5168\u5c40\u53d8\u91cf MyLibrary_LIBS set(ML_LIB_COMPONENTS my_target;my_target_2) foreach(_mlcomponent ${ML_LIB_COMPONENTS}) set(MyLibrary_LIBS ${MyLibrary_LIBS} \"${_mlcomponent}\") endforeach() # ====================================================== # \u641c\u5bfb\u7684\u7ed3\u679c\u3001\u72b6\u6001 # ====================================================== include(FindPackageHandleStandardArgs) find_package_handle_standard_args( MyLibrary REQUIRED_VARS ML_INSTALL_PATH ) \u53ef\u4ee5\u7559\u610f\u5230\u8fd9\u91cc\u7684\u5e93\u6587\u4ef6\u641c\u7d22\u4e0d\u518d\u50cf FindXxx.cmake \u90a3\u6837\u9700\u8981\u81ea\u5df1\u6307\u5b9a\u52a8\u6001\u5e93\u6216\u9759\u6001\u5e93\u7684\u8def\u5f84\uff0c\u8fd9\u91cc\u662f\u5426\u662f\u52a8\u6001\u5e93\u6216\u8005\u9759\u6001\u5e93\u5b8c\u5168\u4e0d\u9700\u8981\u7531\u5bfc\u51fa\u8005\u6307\u5b9a\uff0c\u5bfc\u51fa\u8005\u53ea\u9700\u8981\u5305\u542b\u5bfc\u51fa\u914d\u7f6e\u7684\u6587\u4ef6\u5373\u53ef\uff0c\u56e0\u4e3a\u4e0e\u5e93\u76ee\u6807\u76f8\u5173\u7684\u8bbe\u7f6e\u6b63\u662f\u7531\u5bfc\u51fa\u914d\u7f6e\u5b8c\u6210\u3002\u7406\u8bba\u4e0a\uff0c\u5982\u679c\u4e0d\u9700\u8981\u5168\u5c40\u53d8\u91cf xxx_INLCUDE_DIRS \u6216\u8005 xxx_LIBS \u4ee5\u53ca\u641c\u5bfb\u7684\u72b6\u6001\u7684\u8bdd\uff0c XxxConfig.cmake \u6587\u4ef6\u53ef\u4ee5\u77ed\u5230\u53ea\u6709\u51e0\u884c\uff08\u6ce8\u91ca\u5220\u6389\u5c31\u662f 1 \u884c\uff09\uff1a # ====================================================== # MyLibrary CMake \u914d\u7f6e\u6587\u4ef6 # ====================================================== include(${CMAKE_CURRENT_LIST_DIR}/MyModules.cmake) \u56e0\u4e3a\u5728 MyLibrary \u4e2d\uff0c\u76ee\u6807\u53ea\u6709 my_target \u548c my_target_2 \uff0c\u5e76\u4e14\u4e0e\u5176\u76f8\u5173\u7684\u914d\u7f6e\u5168\u90e8\u8bbe\u7f6e\u5728\u4e86\u5bfc\u51fa\u76ee\u6807\u7684\u6587\u4ef6 MyModules.cmake \u4e2d\u3002","title":"4.1 \u5199\u6cd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#42-opencvconfigcmake","text":"\u4ee5\u4e0b\u5c55\u793a\u4e86 OpenCV 4.8.0 \u7684\u7528\u4e8e find_package \u7684 Config \u6587\u4ef6\uff0c\u70b9\u51fb \u6b64\u5904 \u8df3\u8f6c\u81f3\u8be5\u6587\u4ef6\u3002 \u6309\u7167\u6587\u4ef6\u4e2d\u7684\u987a\u5e8f\uff0c\u4e3b\u8981\u5305\u542b \u63d0\u4f9b\u6ce8\u91ca OpenCVConfig.cmake \u6587\u4ef6\u63d0\u4f9b\u4e86\u5f88\u957f\u7684\u6ce8\u91ca\u5185\u5bb9\uff0c\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u5bf9\u7167\u6b64\u6ce8\u91ca\u5185\u5bb9\u8fdb\u884c\u4f7f\u7528 \u63d0\u4f9b\u7248\u672c\u4fe1\u606f \u5728\u6b64\u6587\u4ef6\u7684\u4e00\u5f00\u5934\uff0cOpenCV \u5c31\u8bbe\u7f6e\u4e86\u7248\u672c\u53f7\u4fe1\u606f \u641c\u7d22\u5934\u6587\u4ef6 \u5e38\u89c4\u64cd\u4f5c\uff0c\u4e0e\u4e0a\u6587\u7684 \u4e00\u822c\u5199\u6cd5 \u57fa\u672c\u4e00\u81f4 \u641c\u7d22\u5e93\u6587\u4ef6\u3001\u63d0\u4f9b CMake \u76ee\u6807\u53d8\u91cf \u5e38\u89c4\u64cd\u4f5c\uff0c\u540c\u6837\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\u3002\u7b2c\u4e00\u90e8\u5206\u76f4\u63a5\u5305\u542b\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6 OpenCVModules.cmake \uff0c\u7528\u4e8e\u914d\u7f6e\u6240\u6709\u7684\u5bfc\u5165\u76ee\u6807\uff0c\u7b2c\u4e8c\u90e8\u5206\u8bbe\u7f6e OpenCV_LIBS \u53d8\u91cf\uff0c\u7528\u4e8e\u5305\u542b\u6240\u6709\u7684\u5bfc\u5165\u76ee\u6807\u3002 ::: warning - \u4e0e\u4e0a\u6587\u4e00\u822c\u5199\u6cd5\u6709\u6240\u4e0d\u540c\u7684\u662f\uff0cOpenCV \u6ca1\u6709\u5728 OpenCVModules.cmake \u4e2d\u4e3a\u76ee\u6807\u914d\u7f6e\u5305\u542b\u5934\u6587\u4ef6\u7684\u641c\u7d22\u8def\u5f84\uff0c\u56e0\u4e3a OpenCV \u5728\u9879\u76ee\u4e2d\u4f7f\u7528\u7684 ocv_target_include_directories \u547d\u4ee4\u4f7f\u7528\u4e86 PRIVATE \u4f5c\u4e3a\u4f20\u64ad\u5c5e\u6027\uff0c\u90a3\u4e48\u4e5f\u5c31\u4e0d\u4f1a\u5728 OpenCVModules.cmake \u4e2d\u6709\u5305\u542b\u5934\u6587\u4ef6\u8def\u5f84\u7684\u914d\u7f6e\uff1b \u4e0d\u8fc7\u5728 OpenCVConfig.cmake \u4e2d\u662f\u901a\u8fc7\u624b\u52a8 foreach \u6bcf\u4e2a\u5bfc\u5165\u76ee\u6807\u5e76\u8fdb\u884c set_target_properties \u64cd\u4f5c\uff0c\u4e3a\u6bcf\u4e2a\u5bfc\u5165\u76ee\u6807\u914d\u7f6e INTERFACE_INCLUDE_DIRECTORIES \u5c5e\u6027\u7684\u3002 ::: \u641c\u5bfb\u7684\u7ed3\u679c\u3001\u72b6\u6001 \u5e38\u89c4\u64cd\u4f5c\uff0c\u540c\u6837\u662f\u4f7f\u7528 find_package_handle_standard_args \u547d\u4ee4\u83b7\u53d6\u641c\u7d22\u7684\u7ed3\u679c\u4e0e\u72b6\u6001","title":"4.2 \u5256\u6790 OpenCVConfig.cmake"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#5-cmake","text":"\u603b\u7684\u6765\u8bf4\u9700\u8981\u5b8c\u6210 \u6dfb\u52a0\u5e38\u89c4\u76ee\u6807\u7684\u5b89\u88c5\u89c4\u5219\uff0c\u5e76\u6307\u5b9a\u5bfc\u51fa\u76ee\u6807 \u6dfb\u52a0\u5bfc\u51fa\u76ee\u6807\u7684\u5b89\u88c5\u89c4\u5219 \u7f16\u5199 XxxConfig.cmake \u6587\u4ef6\uff0c\u5e76\u6dfb\u52a0\u5b89\u88c5\u89c4\u5219 \u7f16\u8bd1\u9879\u76ee\uff0c\u6267\u884c\u5b89\u88c5\u6b65\u9aa4\uff0c\u4f8b\u5982 cmake --install .","title":"5. CMake \u9879\u76ee\u5bfc\u51fa\u4e0e\u5b89\u88c5\u7684\u5185\u5bb9\u603b\u7ed3"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/10/#thinking","text":"\u5bfc\u5165\u76ee\u6807\u548c\u5bfc\u51fa\u76ee\u6807\u6709\u4ec0\u4e48\u4e0d\u540c\uff1f\u4f7f\u7528\u573a\u666f\u662f\u4ec0\u4e48\uff1f \u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5\u63a5\u53e3\u5e93\uff0c\u4f1a\u6709\u4ec0\u4e48\u6548\u679c\uff1f cmake install( TARGETS my_interface LIBRARY DESTINATION lib ARCHIVE DESTINATION lib RUNTIME DESTINATION bin ) \u7b54\u6848 \u3010\u70b9\u6b64\u67e5\u770b\u3011","title":"\u601d\u8003 :thinking:"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/","text":"\u301011\u3011\u9879\u76ee\u5b9e\u6218 \u6559\u5b66\u89c6\u9891 ::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 :tada: \u5373\u5c06\u5230\u6765 ... - \u301011-2\u3011CMake\uff1a\u5b9e\u6218\u7bc7\u2014\u2014\u5916\u90e8\u4f9d\u8d56\u7ba1\u7406 - \u301011-3\u3011CMake\uff1a\u5b9e\u6218\u7bc7\u2014\u2014\u4ea4\u53c9\u7f16\u8bd1 - \u301011-4\u3011CMake\uff1a\u5b9e\u6218\u7bc7\u2014\u2014\u8de8\u5e73\u53f0 ::: @ bilibili 1. \u5e38\u89c4\u975e\u8de8\u5e73\u53f0\u9879\u76ee 1.1 \u9884\u671f\u76ee\u6807 \u73b0\u8ba1\u5212\u5f00\u53d1\u4e00\u4e2a\u4e13\u4e3a Linux \u5e73\u53f0\u8bbe\u8ba1\u7684\u89c6\u89c9\u5904\u7406\u5e93 visionlib \u53ca\u793a\u4f8b\u7a0b\u5e8f vl_demo \uff0c\u5e93\u5728\u4ece\u6e90\u7801\u7f16\u8bd1\u5b89\u88c5\u7684\u8fc7\u7a0b\u4e2d\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u529f\u80fd\uff1a \u9700\u8981\u652f\u6301 C++17 \u6807\u51c6\uff1b \u5f3a\u5236\u4f9d\u8d56 OpenCV 4 \u53ca\u4ee5\u4e0a\u7248\u672c\uff0c\u5e76\u7528\u5230\u5176\u4e2d\u7684 core \u3001 imgproc \u3001 highgui \u6a21\u5757\uff0c\u5206\u522b\u5bf9\u5e94 opencv_core \u3001 opencv_imgproc \u3001 opencv_highgui \u8fd9 3 \u4e2a CMake \u76ee\u6807\uff1b \u9ed8\u8ba4\u4ee5\u9759\u6001\u5e93\u7684\u5f62\u5f0f\u6784\u5efa visionlib \uff0c\u4f46\u5141\u8bb8\u7528\u6237\u901a\u8fc7 CMake \u9009\u9879\u8bbe\u7f6e\u6784\u5efa\u4e3a\u52a8\u6001\u5e93\uff1b \u5e93\u5305\u542b\u4e86 vl_a \u3001 vl_b \u3001 vl_c \u548c vl_d \u5171 4 \u4e2a\u6a21\u5757\uff0c\u5206\u522b\u5bf9\u5e94 a \u3001 b \u3001 c \u548c d 4 \u4e2a\u6587\u4ef6\u5939\uff0c\u5747\u9ed8\u8ba4\u53c2\u4e0e\u6784\u5efa\uff0c\u4f46\u662f\u5141\u8bb8\u7528\u6237\u901a\u8fc7 CMake \u9009\u9879\u8bbe\u7f6e\u4efb\u4e00\u6a21\u5757\u662f\u5426\u53c2\u4e0e\u6784\u5efa\uff1b \u9879\u76ee\u5305\u542b\u4e86\u4e00\u4e2a\u793a\u4f8b\u7a0b\u5e8f vl_demo \uff0c\u9ed8\u8ba4\u53c2\u4e0e\u6784\u5efa\uff0c\u5141\u8bb8\u7528\u6237\u901a\u8fc7 CMake \u9009\u9879\u8bbe\u7f6e\u5176\u662f\u5426\u53c2\u4e0e\u6784\u5efa\uff1b \u8fd9\u51e0\u4e2a\u6a21\u5757\u548c\u793a\u4f8b\u7a0b\u5e8f\u4e4b\u95f4\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\uff0c\u4f7f\u7528 \u2192 \u8868\u793a\u4f9d\u8d56\u5173\u7cfb\uff0c\u5982 \u8868\u793a vl_c \u4f9d\u8d56 vl_a ::: center **\u56fe 1-1\uff1a\u4f9d\u8d56\u5173\u7cfb\u56fe** ::: \u9879\u76ee\u7684\u5b89\u88c5\u76ee\u5f55\u4e3a /usr/local \uff0c\u5176\u4e2d \u793a\u4f8b\u7a0b\u5e8f\u5b89\u88c5\u5230 /usr/local/bin \u5934\u6587\u4ef6\u5b89\u88c5\u5230 /usr/local/include \u5e93\u6587\u4ef6\u5b89\u88c5\u5230 /usr/local/lib CMake \u76f8\u5173\u914d\u7f6e\u6587\u4ef6\u5b89\u88c5\u5230 /usr/local/lib/cmake/VisionLib 1.2 \u8981\u6c42\u4e0e\u6587\u4ef6\u7ed3\u6784 \u8be5\u9879\u76ee\u4e2d\u6240\u6709\u7684 CMake \u76ee\u6807\u5fc5\u987b\u5747\u4ee5 vl_ \u5f00\u5934\uff0c\u4f8b\u5982\u6587\u4ef6\u5939 a \u5bf9\u5e94\u7684\u76ee\u6807\u662f vl_a \uff0c\u8be5\u9879\u76ee\u7684\u6587\u4ef6\u7ed3\u6784\u5982\u4e0b ``` :collapsed-lines . \u251c\u2500\u2500 modules \u2502 \u251c\u2500\u2500 a \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 visionlib \u2502 \u2502 \u2502 \u2514\u2500\u2500 a.hpp \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u251c\u2500\u2500 a1.cpp \u2502 \u2502 \u2514\u2500\u2500 a2.cpp \u2502 \u251c\u2500\u2500 b \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 visionlib \u2502 \u2502 \u2502 \u2514\u2500\u2500 b.hpp \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u251c\u2500\u2500 b1.cpp \u2502 \u2502 \u251c\u2500\u2500 b2.cpp \u2502 \u2502 \u251c\u2500\u2500 b3.cpp \u2502 \u2502 \u2514\u2500\u2500 b4.cpp \u2502 \u251c\u2500\u2500 c \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 visionlib \u2502 \u2502 \u2502 \u2514\u2500\u2500 c.hpp \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 c.cpp \u2502 \u2514\u2500\u2500 d \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2514\u2500\u2500 visionlib \u2502 \u2502 \u2514\u2500\u2500 d.hpp \u2502 \u2514\u2500\u2500 src \u2502 \u251c\u2500\u2500 d1.cpp \u2502 \u2514\u2500\u2500 d2.cpp \u2514\u2500\u2500 samples \u2514\u2500\u2500 demo.cpp 19 directories, 14 files ### 1.3 \u5206\u6790 - \u524d 3 \u4e2a\u9884\u671f\u76ee\u6807\u662f\u5173\u4e8e\u9879\u76ee\u7684\u8981\u6c42\uff0c\u53ef\u76f4\u63a5\u5728\u9879\u76ee\u6839\u76ee\u5f55\u7684 `CMakeLists.txt` \u4e2d\u5b9e\u73b0 - \u7b2c 4 \u5230\u7b2c 6 \u4e2a\u9884\u671f\u76ee\u6807\u662f\u5173\u4e8e\u9879\u76ee\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u53ef\u5728\u6bcf\u4e2a\u6a21\u5757\u7684 `CMakeLists.txt` \u4e2d\u5b9e\u73b0 - \u6bcf\u4e2a\u6a21\u5757\u5747\u6d89\u53ca\u5230\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\u6dfb\u52a0\u3001\u6e90\u6587\u4ef6\u7f16\u8bd1\u3001\u5e93\u6587\u4ef6\u94fe\u63a5\u3001\u4f9d\u8d56\u5e93\u6dfb\u52a0\u3001\u5b89\u88c5\u76ee\u6807\u7b49\u64cd\u4f5c\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u5185\u5bb9\u5c01\u88c5\u5230\u4e00\u4e2a\u51fd\u6570\u4e2d\uff0c\u7136\u540e\u5728\u6bcf\u4e2a\u6a21\u5757\u7684 `CMakeLists.txt` \u4e2d\u8c03\u7528 ### 1.4 \u5b9e\u73b0 \u5728\u9879\u76ee\u4e2d\u6dfb\u52a0 - `CMakeLists.txt` \u2014\u2014 \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `cmake/VisionLibInstall.cmake` \u2014\u2014 \u9879\u76ee\u7684\u5b89\u88c5\u8def\u5f84\u914d\u7f6e\u6587\u4ef6 - `cmake/VisionLibModule.cmake` \u2014\u2014 \u9879\u76ee\u7684 CMake \u51fd\u6570\u5e93\uff0c\u4e3b\u8981\u6d89\u53ca\u5230\u76ee\u6807\u7684\u4fbf\u6377\u521b\u5efa - `cmake/templates/VisionLibConfig.cmake.in` \u2014\u2014 \u9879\u76ee\u5728 `find_package` \u65f6\u9700\u8981\u7684\u914d\u7f6e\u6587\u4ef6\u6a21\u677f - `modules/CMakeLists.txt` \u2014\u2014 \u9879\u76ee\u7684\u6a21\u5757\u5217\u8868 - `modules/a/CMakeLists.txt` \u2014\u2014 \u6a21\u5757 `a` \u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `modules/b/CMakeLists.txt` \u2014\u2014 \u6a21\u5757 `b` \u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `modules/c/CMakeLists.txt` \u2014\u2014 \u6a21\u5757 `c` \u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `modules/d/CMakeLists.txt` \u2014\u2014 \u6a21\u5757 `d` \u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `samples/CMakeLists.txt` \u2014\u2014 \u793a\u4f8b\u7a0b\u5e8f\u7684 CMake \u914d\u7f6e\u6587\u4ef6 \u5171 10 \u4e2a\u6587\u4ef6\u3002 #### 1.4.1 \u9879\u76ee\u914d\u7f6e ::: code-tabs @tab CMakeLists.txt ```cmake :collapsed-lines cmake_minimum_required(VERSION 3.10) project(VisionLib) # ---------------------------------------------------------------------------- # \u914d\u7f6e\u9879\u76ee # ---------------------------------------------------------------------------- set(CMAKE_CXX_STANDARD 17) set(CMAKE_CXX_STANDARD_REQUIRED ON) find_package(OpenCV 4 REQUIRED) option(BUILD_SHARED_LIBS \"Build shared libraries?\" OFF) include(cmake/VisionLibInstall.cmake) include(cmake/VisionLibModule.cmake) # ---------------------------------------------------------------------------- # \u5c06\u5b50\u76ee\u5f55\u6dfb\u52a0\u5230\u6784\u5efa\u7cfb\u7edf\u4e2d # ---------------------------------------------------------------------------- add_subdirectory(modules) add_subdirectory(samples) # ---------------------------------------------------------------------------- # \u5bfc\u51fa\u3001\u5b89\u88c5\u914d\u7f6e # ---------------------------------------------------------------------------- install( EXPORT VisionLibTargets FILE VisionLibTargets.cmake DESTINATION ${VL_CFG_INSTALL_PATH} # VL_CFG_INSTALL_PATH \u5b9a\u4e49\u4e8e VisionLibInstall.cmake \u4e2d ) configure_file( cmake/templates/VisionLibConfig.cmake.in \"${CMAKE_CURRENT_BINARY_DIR}/VisionLibConfig.cmake\" @ONLY ) install( FILES \"${CMAKE_CURRENT_BINARY_DIR}/VisionLibConfig.cmake\" DESTINATION ${VL_CFG_INSTALL_PATH} ) @tab VisionLibInstall.cmake # \u5b89\u88c5\u8def\u5f84\u76f8\u5173\u914d\u7f6e set(CMAKE_INSTALL_PREFIX \"/usr/local\") set(VL_INSTALL_PATH \"${CMAKE_INSTALL_PREFIX}\") set(VL_INC_INSTALL_PATH \"include/VisionLib\") set(VL_LIB_INSTALL_PATH \"lib\") set(VL_CFG_INSTALL_PATH \"${VL_LIB_INSTALL_PATH}/cmake/VisionLib\") @tab VisionLibModule.cmake ```cmake :collapsed-lines \u7528\u4e8e\u6536\u96c6\u6240\u6709\u9700\u8981\u53c2\u4e0e\u6784\u5efa\u7684\u6a21\u5757\uff0c\u7ed9 VisionLibConfig.cmake \u4f7f\u7528 set(VL_LIB_COMPONENTS \"\" CACHE INTERNAL \"VisionLib components\") ---------------------------------------------------------------------------- \u66f4\u65b0 VisionLib \u76ee\u6807\u6784\u5efa\u7684\u6807\u5fd7\u4f4d\uff0c\u7528\u4e8e\u63a7\u5236\u662f\u5426\u6784\u5efa\u6307\u5b9a\u6a21\u5757\uff0c\u4e0d\u5f71\u54cd\u7528\u6237\u7684\u9009\u62e9 - \u4e3b\u8981\u66f4\u65b0 BUILD_xxx_INIT \u53d8\u91cf - \u5728\u6ee1\u8db3\u6761\u4ef6\u65f6\uff0c\u8bbe\u7f6e BUILD_xxx_INIT \u4e3a ON \uff0c\u5426\u5219\u4e3a OFF \u7528\u6cd5: vl_update_build( [CONDITION]) \u793a\u4f8b: vl_update_build(d OFF) ---------------------------------------------------------------------------- macro(vl_update_build name) if(${ARGN}) set(BUILD ${ name}_INIT ON) else() set(BUILD ${_name}_INIT OFF) endif() endmacro() ---------------------------------------------------------------------------- \u6dfb\u52a0\u6a21\u5757 \u7528\u6cd5\uff1a vl_add_module( [DEPENDS ...] # \u4ee5 vl_ \u5f00\u5934\u7684\u6a21\u5757\u540d [EXT_DEPENDS ...] # \u5916\u90e8\u4f9d\u8d56 ) \u793a\u4f8b\uff1a vl_add_module(a DEPENDS b c EXT_DEPENDS opencv_core ) ---------------------------------------------------------------------------- macro(vl_add_module name) # \u5224\u65ad\u662f\u5426\u53c2\u4e0e\u6784\u5efa if(NOT DEFINED BUILD ${ name}_INIT) set(BUILD ${ name}_INIT ON) endif() option(BUILD ${ name} \"Include ${_name} module into the VisionLib build\" ${BUILD ${_name}_INIT} ) # create option to enable/disable this module if(BUILD_${ name}) # \u4ee5 vl \u5f00\u5934\u7684\u6a21\u5757\u540d\uff0c\u4f8b\u5982 vl_add_module(a) \u4f1a\u751f\u6210 vl_a set(module_name vl_${ name}) # \u89e3\u6790\u53c2\u6570 set(multi_args DEPENDS EXT_DEPENDS) cmake_parse_arguments(VLMD \"\" \"\" \"${multi_args}\" ${ARGN}) # \u521b\u5efa\u76ee\u6807 aux_source_directory(src target_src) add_library(${module_name} ${target_src}) # \u6dfb\u52a0\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\uff0c\u53ef\u53c2\u8003\u301009\u3011\u751f\u6210\u5668\u8868\u8fbe\u5f0f target_include_directories(${module_name} PUBLIC $ $ # VL_INC_INSTALL_PATH \u5b9a\u4e49\u4e8e VisionLibInstall.cmake \u4e2d ) # \u6dfb\u52a0\u4f9d\u8d56 target_link_libraries( ${module_name} PUBLIC ${VLMD_EXT_DEPENDS} ) foreach(m ${VLMD_DEPENDS}) target_link_libraries( ${module_name} PUBLIC vl ${m} ) endforeach() # \u5b89\u88c5\u76ee\u6807 install( DIRECTORY include/visionlib DESTINATION ${VL_INC_INSTALL_PATH} ) install( TARGETS ${module_name} EXPORT VisionLibTargets LIBRARY DESTINATION ${VL_LIB_INSTALL_PATH} ARCHIVE DESTINATION ${VL_LIB_INSTALL_PATH} ) set(VL_LIB_COMPONENTS ${VL_LIB_COMPONENTS} \"${module_name}\" CACHE INTERNAL \"VisionLib components\") unset(module_name) endif() endmacro() ---------------------------------------------------------------------------- \u6dfb\u52a0\u793a\u4f8b\u7a0b\u5e8f \u7528\u6cd5\uff1a vl_add_exe( SOURCES ... # \u6e90\u6587\u4ef6 [DEPENDS ...] # \u4ee5 vl_ \u5f00\u5934\u7684\u6a21\u5757\u540d [EXT_DEPENDS ...] # \u5916\u90e8\u4f9d\u8d56 ) \u793a\u4f8b\uff1a vl_add_exe(demo SOURCES demo.cpp DEPENDS a b EXT_DEPENDS opencv_highgui ) ---------------------------------------------------------------------------- macro(vl_add_exe name) # \u5224\u65ad\u662f\u5426\u53c2\u4e0e\u6784\u5efa if(NOT DEFINED BUILD ${ name}_INIT) set(BUILD ${ name}_INIT ON) endif() option(BUILD ${ name} \"Include ${_name} module into the VisionLib build\" ${BUILD ${_name}_INIT} ) # create option to enable/disable this module if(BUILD_${ name}) set(module_name vl ${ name}) set(multi_args SOURCES DEPENDS EXT_DEPENDS) cmake_parse_arguments(VLMD \"\" \"\" \"${multi_args}\" ${ARGN}) if(NOT VLMD_SOURCES) message(FATAL_ERROR \"No sources provided for executable ${module_name}\") endif() add_executable(${module_name} ${VLMD_SOURCES}) target_link_libraries( ${module_name} PRIVATE ${VLMD_EXT_DEPENDS} ) foreach(m ${VLMD_DEPENDS}) target_link_libraries( ${module_name} PRIVATE vl ${m} ) endforeach() install( TARGETS ${module_name} RUNTIME DESTINATION bin ) unset(module_name) endif() endmacro() ::: #### 1.4.2 \u6a21\u5757\u914d\u7f6e ::: code-tabs @tab `modules` ```cmake set(cur_path \"${CMAKE_CURRENT_SOURCE_DIR}\") file(GLOB modules RELATIVE \"${cur_path}\" \"${cur_path}/*\") foreach(m ${modules}) if(IS_DIRECTORY ${cur_path}/${m}) add_subdirectory(${cur_path}/${m}) endif() endforeach() # \u7b80\u5355\u8d77\u89c1\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5199 # add_subdirectory(a) # add_subdirectory(b) # add_subdirectory(c) # add_subdirectory(d) @tab modules/a vl_add_module(a) @tab modules/b vl_add_module(b DEPENDS d EXT_DEPENDS opencv_imgproc ) @tab modules/c vl_add_module(c DEPENDS a EXT_DEPENDS opencv_core ) @tab modules/d vl_add_module(d DEPENDS b c ) ::: 1.4.3 \u793a\u4f8b\u7a0b\u5e8f\u914d\u7f6e ::: code-tabs @tab samples/CMakeLists.txt ```cmake :collapsed-lines vl_add_exe(demo SOURCES demo.cpp DEPENDS d EXT_DEPENDS opencv_highgui ) ::: #### 1.4.4 VisionLibConfig.cmake.in \u914d\u7f6e \u82e5\u5bf9\u8be5\u6587\u4ef6\u6709\u7591\u95ee\uff0c\u8bf7\u53c2\u8003[\u6b64\u5904](10.md#_4-xxxconfig-cmake-\u6587\u4ef6\u7684\u4e00\u822c\u5199\u6cd5)\u3002 ::: code-tabs @tab VisionLibConfig.cmake.in ```cmake :collapsed-lines # ---------------------------------------------------------------------------- # VisionLib CMake \u914d\u7f6e\u6587\u4ef6 # # ** \u8be5\u6587\u4ef6\u7531 CMake \u751f\u6210\uff0c\u8bf7\u52ff\u624b\u52a8\u4fee\u6539 ** # # \u57fa\u672c\u7528\u6cd5\uff1a # find_package(VisionLib REQUIRED) # target_link_libraries(your_target PRIVATE vl_a vl_b ...) # ---------------------------------------------------------------------------- # ---------------------------------------------------------------------------- # \u83b7\u53d6 VisionLib \u5b89\u88c5\u8def\u5f84 # ---------------------------------------------------------------------------- get_filename_component(VL_CONFIG_PATH \"${CMAKE_CURRENT_LIST_FILE}\" PATH ) set(VL_INSTALL_PATH \"@VL_INSTALL_PATH@\") # ---------------------------------------------------------------------------- # \u8bbe\u7f6e\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\u53d8\u91cf # ---------------------------------------------------------------------------- set(VisionLib_INCLUDE_DIRS \"${VL_INSTALL_PATH}/@VL_INC_INSTALL_PATH@\") # ---------------------------------------------------------------------------- # \u8bbe\u7f6e\u5e93\u6587\u4ef6\u8def\u5f84\u53d8\u91cf # ---------------------------------------------------------------------------- set(VisionLib_LIBS @VL_LIB_COMPONENTS@) if(NOT TARGET vl_a) include(\"${VL_CONFIG_PATH}/VisionLibTargets.cmake\") endif() # ---------------------------------------------------------------------------- # \u641c\u5bfb\u7684\u7ed3\u679c\u3001\u72b6\u6001 # ---------------------------------------------------------------------------- include(FindPackageHandleStandardArgs) find_package_handle_standard_args(VisionLib REQUIRED_VARS VL_INSTALL_PATH ) ::: 1.5 \u601d\u8003 :thinking: \u7528\u6237\u5728\u4f7f\u7528 VisionLib \u4e2d\u7684 vl_d \u76ee\u6807\u7684\u65f6\u5019\u4e00\u822c\u5728\u9879\u76ee\u4e2d\u4f1a\u5199\u4e0a add_executable(demo main.cpp) find_package(VisionLib REQUIRED) target_link_libraries(demo PRIVATE vl_d) \u4f46\u662f\u8fd9\u65f6\u5019\u7f16\u8bd1\u4f1a\u51fa\u73b0\u5f62\u5982\u4ee5\u4e0b\u5185\u5bb9\u7684\u62a5\u9519 [ 50%] Building CXX object CMakeFiles/demo.dir/main.cpp.o In file included from /usr/local/include/VisionLib/visionlib/d.hpp:3, from /path/to/vl_deploy_demo/main.cpp:1: /usr/local/include/VisionLib/visionlib/c.hpp:5:10: fatal error: opencv2/core.hpp: No such file or directory 5 | #include <opencv2/core.hpp> | ^~~~~~~~~~~~~~~~~~ compilation terminated. make[2]: *** [CMakeFiles/demo.dir/build.make:76\uff1aCMakeFiles/demo.dir/main.cpp.o] error 1 make[1]: *** [CMakeFiles/Makefile2:83\uff1aCMakeFiles/demo.dir/all] error 2 make: *** [Makefile:91\uff1aall] error 2 \u8bf7\u5206\u6790\u51fa\u73b0\u8be5\u95ee\u9898\u7684\u539f\u56e0\u4ee5\u53ca\u89e3\u51b3\u65b9\u6cd5\u3002 \u7b54\u6848 \u3010\u70b9\u6b64\u67e5\u770b\u3011 2. \u5916\u90e8\u4f9d\u8d56\u7ba1\u7406 C/C++ \u4e00\u4e2a\u9971\u53d7\u8bdf\u75c5\u7684\u8bdd\u9898\u5c31\u662f\u5305\u7ba1\u7406\uff0c\u4e00\u4e9b\u73b0\u4ee3\u7684\u8bed\u8a00\u90fd\u5177\u6709\u6bd4\u8f83\u5b8c\u5584\u7684\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u4f8b\u5982 Python \u7684 pip \u3001Node.js \u7684 npm \u548c yarn \u3001Rust \u7684 cargo \u7b49\uff0c\u800c C/C++ \u6ca1\u6709\u4e00\u4e2a\u7edf\u4e00\u7684\u3001\u5b98\u65b9\u7684\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u5bfc\u81f4\u4e86 C/C++ \u9879\u76ee\u7684\u4f9d\u8d56\u7ba1\u7406\u975e\u5e38\u56f0\u96be\u3002CMake \u63d0\u4f9b\u4e86 FetchContent \u548c ExternalProject \u6a21\u5757\uff0c\u53ef\u4ee5\u7528\u4e8e\u7ba1\u7406\u9879\u76ee\u7684\u5916\u90e8\u4f9d\u8d56\uff0c\u76f8\u6bd4\u4e8e\u624b\u52a8\u4e0b\u8f7d\u3001\u7f16\u8bd1\u3001\u5b89\u88c5\uff0c FetchContent \u548c ExternalProject \u5df2\u7ecf\u5c3d\u53ef\u80fd\u7684\u7b80\u5316\u4e86\u8fd9\u4e2a\u8fc7\u7a0b\u3002 ExternalProject \u7528\u4e8e\u5728\u6784\u5efa\u8fc7\u7a0b\u4e2d\u4e0b\u8f7d\u3001\u914d\u7f6e\u3001\u6784\u5efa\u548c\u5b89\u88c5\u5916\u90e8\u9879\u76ee\u3002\u5b83\u901a\u5e38\u7528\u4e8e\u5904\u7406\u5927\u578b\u7684\u3001\u72ec\u7acb\u7684\u5916\u90e8\u9879\u76ee\u3002\u800c FetchContent \u7528\u4e8e\u5728\u914d\u7f6e\u9636\u6bb5\u4e0b\u8f7d\u548c\u6dfb\u52a0\u5916\u90e8\u9879\u76ee\u7684\u6e90\u4ee3\u7801\u3002\u5b83\u9002\u7528\u4e8e\u9700\u8981\u5c06\u5916\u90e8\u9879\u76ee\u7684\u6e90\u4ee3\u7801\u76f4\u63a5\u96c6\u6210\u5230\u4e3b\u9879\u76ee\u4e2d\u7684\u60c5\u51b5\u3002\u540e\u6587\u5c06\u4e3b\u8981\u4ecb\u7ecd FetchContent \u7684\u4f7f\u7528\uff0c ExternalProject \u7684\u4f7f\u7528\u53ef\u4ee5\u53c2\u8003 \u5b98\u65b9\u6587\u6863 \u3002 2.1 FetchContent FetchContent \u4f9d\u8d56\u7ba1\u7406\u5b9a\u4e49\u4e8e FetchContent CMake \u6a21\u5757\u4e2d\uff0c\u53ef\u4f7f\u7528 include(FetchContent) \u6765\u5f15\u5165\u3002 FetchContent \u6a21\u5757\u63d0\u4f9b\u4e86 FetchContent_Declare \u3001 FetchContent_MakeAvailable \u7b49\u51fd\u6570\uff0c\u7528\u4e8e\u4e0b\u8f7d\u3001\u89e3\u538b\u3001\u914d\u7f6e\u3001\u7f16\u8bd1\u3001\u5b89\u88c5\u5916\u90e8\u9879\u76ee\u3002 2.1.1 FetchContent_Declare \u2014\u2014 \u58f0\u660e\u5916\u90e8\u4f9d\u8d56\u9879 FetchContent_Declare( <name> <contentOptions>... [EXCLUDE_FROM_ALL] # add in CMake 3.28 [SYSTEM] # add in CMake 3.25 [OVERRIDE_FIND_PACKAGE | FIND_PACKAGE_ARGS args...] # add in CMake 3.24 ) \u4e0a\u8ff0\u58f0\u660e\u7684\u53ef\u9009\u9879\u5747\u4e0d\u662f\u5f88\u91cd\u8981\uff0c\u91cd\u8981\u7684\u662f <contentOptions> \u3002\u4ee5\u4e0b\u662f\u4f7f\u7528 FetchContent_Declare \u58f0\u660e googletest \u9879\u76ee\u7684\u793a\u4f8b\uff0c\u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u5f0f\u58f0\u660e\u5916\u90e8\u4f9d\u8d56\u9879\uff0c\u4e00\u79cd\u662f\u4f7f\u7528 Git \u5b58\u50a8\u5e93\u4f5c\u4e3a\u5916\u90e8\u4f9d\u8d56\u9879\uff0c\u53e6\u4e00\u79cd\u662f\u4f7f\u7528 URL \u5730\u5740\u4f5c\u4e3a\u5916\u90e8\u4f9d\u8d56\u9879\u3002 ::: code-tabs @tab \u4f7f\u7528 Git \u5b58\u50a8\u5e93 FetchContent_Declare( googletest GIT_REPOSITORY https://github.com/google/googletest.git GIT_TAG 703bd9caab50b139428cea1aaff9974ebee5742e # release-1.10.0 ) # GIT_REPOSITORY: \u8868\u793a\u5916\u90e8\u4f9d\u8d56\u9879\u7684 Git \u4ed3\u5e93\u5730\u5740\uff1b # GIT_TAG: \u8868\u793a\u5916\u90e8\u4f9d\u8d56\u9879\u7684 Git \u4ed3\u5e93\u7684\u6807\u7b7e\uff0c\u53ef\u4ee5\u662f\u5206\u652f\u540d\u3001\u6807\u7b7e\u540d\u3001\u63d0\u4ea4\u54c8\u5e0c\u7b49\uff0c # \u4f46\u5efa\u8bae\u662f\u7a33\u5b9a\u7684\u6807\u7b7e\u540d\u9632\u6b62\u4e0d\u7a33\u5b9a\u7684\u4ee3\u7801\u8fdb\u5165\u9879\u76ee\u3002 @tab \u4f7f\u7528 URL \u5730\u5740 FetchContent_Declare( googletest URL https://github.com/google/googletest/archive/main.zip ) # URL: \u8868\u793a\u5916\u90e8\u4f9d\u8d56\u9879\u7684 URL \u5730\u5740\u3002 ::: 2.1.2 FetchContent_MakeAvailable \u2014\u2014 \u4f7f\u5916\u90e8\u4f9d\u8d56\u9879\u751f\u6548\uff0c\u5e76\u52a0\u5165\u6784\u5efa\u7cfb\u7edf FetchContent_MakeAvailable(<name1> [<name2>...]) \u8be5\u547d\u4ee4\u4fdd\u8bc1\u5728\u8c03\u7528\u7ed3\u675f\u540e\uff0c\u6bcf\u4e2a\u547d\u540d\u7684\u4f9d\u8d56\u9879\u90fd\u53ef\u4f9b\u9879\u76ee\u4f7f\u7528\u3002\u4f8b\u5982\u4e0a\u6587\u7684 googletest \u9879\u76ee\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u4f7f\u7528\uff1a FetchContent_MakeAvailable(googletest) \u5982\u679c\u6709\u591a\u4e2a\u5916\u90e8\u4f9d\u8d56\u9879\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u4f7f\u7528\uff1a FetchContent_MakeAvailable(ext1 ext2 ext3) \u8be5\u547d\u4ee4\u5c06\u4f9d\u6b21\u914d\u7f6e ext1 \u3001 ext2 \u548c ext3 \u9879\u76ee 2.1.3 FetchContent \u793a\u4f8b \u6765\u81ea \u3010\u590d\u6742\u4f9d\u8d56\u3011 include(FetchContent) FetchContent_Declare( projB GIT_REPOSITORY git@mycompany.com:git/projB.git GIT_TAG 4a89dc7e24ff212a7b5167bef7ab079d ) FetchContent_Declare( projC GIT_REPOSITORY git@mycompany.com:git/projC.git GIT_TAG 4ad4016bd1d8d5412d135cf8ceea1bb9 ) FetchContent_Declare( projD GIT_REPOSITORY git@mycompany.com:git/projD.git GIT_TAG origin/integrationBranch ) # Order is important, see notes in the discussion further below FetchContent_MakeAvailable(projD projB projC) 2.2 \u9884\u671f\u76ee\u6807 \u73b0\u8ba1\u5212\u5f00\u53d1\u4e00\u4e2a Windows \u5e73\u53f0\u4e0b\u7684 OPC UA \u901a\u4fe1\u5e93 opcua \uff0c\u8be5\u5e93\u4f9d\u8d56\u4e8e open62541 [^1]\uff0c open62541 \u662f\u4e00\u4e2a\u5f00\u6e90\u7684 OPC UA \u534f\u8bae\u6808\uff0c\u63d0\u4f9b\u4e86 OPC UA \u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u7684 C \u8bed\u8a00\u5b9e\u73b0\u3002 opcua \u5e93\u7684\u5f00\u53d1\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u529f\u80fd\uff1a \u9700\u8981\u652f\u6301 C++17 \u6807\u51c6\uff1b \u5f3a\u5236\u4f9d\u8d56 open62541 \uff0c\u6ca1\u6709\u8be5\u5e93\u9700\u8981\u81ea\u52a8\u4e0b\u8f7d\u3001\u5e76\u6dfb\u52a0\u81f3\u9879\u76ee\u4e2d\uff0c\u5982\u679c\u662f\u81ea\u52a8\u4e0b\u8f7d\u7684 open62541 \uff0c\u90a3\u4e48 opcua \u5e93\u5728\u5b89\u88c5\u65f6\u9700\u8981\u5c06 open62541 ==\u4e00\u5e76\u5b89\u88c5==\uff1b open62541 \u7684\u914d\u7f6e\u8981\u6c42\u5982\u4e0b ==\u65e0\u9700==\u542f\u7528 UA_ENABLE_AMALGAMATION \u9009\u9879\uff1b \u5176\u4ed6\u9009\u9879\u9ed8\u8ba4\u5373\u53ef\uff1b \u9ed8\u8ba4\u4ee5\u9759\u6001\u5e93\u7684\u5f62\u5f0f\u6784\u5efa opcua \uff0c\u4f46\u5141\u8bb8\u7528\u6237\u901a\u8fc7 CMake \u9009\u9879\u8bbe\u7f6e\u6784\u5efa\u4e3a\u52a8\u6001\u5e93\uff1b opcua \u9879\u76ee\u7684\u5b89\u88c5\u76ee\u5f55\u4e3a D:\\opcua \uff0c\u5176\u4e2d \u5934\u6587\u4ef6\u5b89\u88c5\u5230 D:\\opcua\\include \uff1b \u9759\u6001\u5e93\u3001\u5bfc\u5165\u5e93\u6587\u4ef6\u5b89\u88c5\u5230 D:\\opcua\\x64\\vc16\\lib \uff1b \u52a8\u6001\u5e93\u6587\u4ef6\u5b89\u88c5\u5230 D:\\opcua\\x64\\vc16\\bin \uff08\u5982\u679c\u6784\u5efa\u4e3a\u52a8\u6001\u5e93\uff09\uff1b CMake \u76f8\u5173\u914d\u7f6e\u6587\u4ef6\u5b89\u88c5\u5230 D:\\opcua\\x64\\vc16\\bin \uff1b open62541 \u7684\u5b89\u88c5\u8981\u6c42\u7531 open62541Config.cmake \u6307\u5b9a\u4e86\uff0c\u5177\u4f53\u5b89\u88c5\u8def\u5f84\u4e0d\u505a\u8be6\u7ec6\u8bf4\u660e\uff0c\u53ea\u9700\u4fdd\u8bc1 open62541 \u7684\u5b89\u88c5\u8def\u5f84\u5728 D:\\opcua \u4e0b\u5373\u53ef\u3002 2.3 \u6587\u4ef6\u7ed3\u6784 \u8be5\u9879\u76ee\u7684\u6587\u4ef6\u7ed3\u6784\u5982\u4e0b\uff0c\u53c2\u8003\u81ea rmvl_opcua \u6a21\u5757 \u3002 ``` :collapsed-lines . \u251c\u2500\u2500 include \u2502 \u251c\u2500\u2500 opcua \u2502 \u2502 \u251c\u2500\u2500 client.hpp \u2502 \u2502 \u251c\u2500\u2500 event.hpp \u2502 \u2502 \u251c\u2500\u2500 method.hpp \u2502 \u2502 \u251c\u2500\u2500 object.hpp \u2502 \u2502 \u251c\u2500\u2500 publisher.hpp \u2502 \u2502 \u251c\u2500\u2500 server.hpp \u2502 \u2502 \u251c\u2500\u2500 subscriber.hpp \u2502 \u2502 \u251c\u2500\u2500 utilities.hpp \u2502 \u2502 \u251c\u2500\u2500 variable.hpp \u2502 \u2502 \u2514\u2500\u2500 view.hpp \u2502 \u2514\u2500\u2500 opcua.hpp \u2514\u2500\u2500 src \u251c\u2500\u2500 client.cpp \u251c\u2500\u2500 cvt.hpp \u251c\u2500\u2500 helper.cpp \u251c\u2500\u2500 publisher.cpp \u251c\u2500\u2500 server.cpp \u2514\u2500\u2500 subscriber.cpp 6 directories, 19 files ### 2.4 \u5b9e\u73b0 \u5728\u9879\u76ee\u4e2d\u6dfb\u52a0 - `3rdparty/open62541/CMakeLists.txt` \u2014\u2014 `open62541` \u7684\u914d\u7f6e\u6587\u4ef6 - `CMakeLists.txt` \u2014\u2014 \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `cmake/opcuaInstall.cmake` \u2014\u2014 \u9879\u76ee\u7684\u5b89\u88c5\u8def\u5f84\u914d\u7f6e\u6587\u4ef6 - `cmake/opcuaConfig.cmake` \u2014\u2014 \u63d0\u4f9b\u7ed9\u7528\u6237\u5728 `find_package` \u65f6\u6240\u9700\u8981\u7684\u914d\u7f6e\u6587\u4ef6\uff08\u56e0\u4e3a\u6574\u4e2a\u9879\u76ee\u53ea\u6709\u4e00\u4e2a\u76ee\u6807\uff0c\u8fd9\u91cc\u5c31\u4e0d\u4f7f\u7528\u6a21\u677f\u6587\u4ef6\u4e86\uff09 \u5171 4 \u4e2a\u6587\u4ef6\uff0c\u5982\u4e0b\u6587\u4ef6\u7ed3\u6784\u6240\u793a . \u251c\u2500\u2500 3rdparty \u2502 \u2514\u2500\u2500 open62541 \u2502 \u2514\u2500\u2500 CMakeLists.txt (New) \u251c\u2500\u2500 CMakeLists.txt (New) \u251c\u2500\u2500 cmake \u2502 \u251c\u2500\u2500 opcuaConfig.cmake (New) \u2502 \u2514\u2500\u2500 opcuaInstall.cmake (New) \u251c\u2500\u2500 include \u2502 \u2514\u2500\u2500 ... \u2514\u2500\u2500 src \u2514\u2500\u2500 ... #### 2.4.1 \u9879\u76ee\u914d\u7f6e ::: code-tabs @tab CMakeLists.txt ```cmake :collapsed-lines # -------------------------------------------------------- # \u9879\u76ee\u914d\u7f6e # -------------------------------------------------------- cmake_minimum_required(VERSION 3.16) project(opcua) set(CMAKE_CXX_STANDARD 17) option(BUILD_SHARED_LIBS \"Build shared libraries?\" OFF) include(cmake/opcuaInstall.cmake) # -------------------------------------------------------- # \u5916\u90e8\u4f9d\u8d56\u7ba1\u7406 # -------------------------------------------------------- find_package(open62541 QUIET) if(NOT open62541_FOUND) add_subdirectory(3rdparty/open62541) endif() # -------------------------------------------------------- # \u76ee\u6807\u6784\u5efa # -------------------------------------------------------- aux_source_directory(src target_src) add_library(opcua ${target_src}) target_include_directories(opcua PUBLIC $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include> $<INSTALL_INTERFACE:include> ) target_link_libraries(opcua PUBLIC open62541::open62541 ) install( TARGETS opcua EXPORT opcuaTarget LIBRARY DESTINATION ${OPCUA_BIN_INSTALL_PATH} ARCHIVE DESTINATION ${OPCUA_LIB_INSTALL_PATH} RUNTIME DESTINATION ${OPCUA_BIN_INSTALL_PATH} INCLUDES DESTINATION ${OPCUA_INC_INSTALL_PATH} ) # -------------------------------------------------------- # \u5bfc\u51fa\u3001\u5b89\u88c5 # -------------------------------------------------------- install( EXPORT opcuaTarget FILE opcuaTarget.cmake DESTINATION ${OPCUA_CFG_INSTALL_PATH} ) install( FILES cmake/opcuaConfig.cmake DESTINATION ${OPCUA_CFG_INSTALL_PATH} ) @tab opcuaInstall.cmake set(CMAKE_INSTALL_PREFIX \"D:/opcua\") set(OPCUA_INSTALL_PATH \"${CMAKE_INSTALL_PREFIX}\") set(OPCUA_INC_INSTALL_PATH \"include\") set(OPCUA_LIB_INSTALL_PATH \"x64/vc16/lib\") set(OPCUA_BIN_INSTALL_PATH \"x64/vc16/bin\") # \u7406\u8bba\u4e0a\u8fd9\u4e2a\u8def\u5f84\u8981\u6839\u636e MSVC \u7248\u672c\u548c\u7cfb\u7edf\u67b6\u6784\u6765\u786e\u5b9a\uff0c\u8fd9\u91cc\u53ea\u662f\u4e3e\u4f8b\uff0c\u5c31\u4e0d\u505a\u989d\u5916\u5224\u65ad\u4e86 set(OPCUA_CFG_INSTALL_PATH \"${OPCUA_LIB_INSTALL_PATH}\") ::: 2.4.2 \u5916\u90e8\u4f9d\u8d56\u914d\u7f6e ::: code-tabs @tab 3rdparty/open62541/CMakeLists.txt option(UA_ENABLE_AMALGAMATION \"Enable amalgamation\" OFF) FetchContent_Declare( open62541 GIT_REPOSITORY https://github.com/open62541/open62541.git GIT_TAG v1.4.8 ) FetchContent_MakeAvailable(open62541) ::: 2.4.4 opcuaConfig.cmake \u914d\u7f6e \u7531\u4e8e opcua \u9879\u76ee\u53ea\u6709\u4e00\u4e2a\u76ee\u6807\uff0c\u56e0\u6b64 opcuaConfig.cmake \u6587\u4ef6\u975e\u5e38\u7b80\u5355\uff0c\u65b9\u4fbf\u8d77\u89c1\u4e5f\u4e0d\u9700\u8981\u5411\u7528\u6237\u63d0\u4f9b\u8bf8\u5982 opcua_INCLUDE_DIRS \u548c opcua_LIBS \u8fd9\u6837\u7684\u96c6\u5408\u53d8\u91cf\uff0c\u56e0\u6b64 opcuaConfig.cmake \u53ea\u9700\u8981\u5b8c\u6210\u4ee5\u4e0b\u529f\u80fd\u5373\u53ef \u63d0\u4f9b CMake \u76ee\u6807\u53d8\u91cf\uff08\u5bfc\u5165 opcua \u76ee\u6807\uff09 \u63d0\u4f9b find_package \u641c\u7d22\u7684\u7ed3\u679c\u548c\u72b6\u6001 ::: code-tabs @tab opcuaConfig.cmake # ---------------------------------------------------------------------------- # opcua CMake \u914d\u7f6e\u6587\u4ef6 # # \u57fa\u672c\u7528\u6cd5\uff1a # find_package(opcua REQUIRED) # target_link_libraries(your_target PRIVATE opcua) # ---------------------------------------------------------------------------- if(NOT TARGET opcua) include(${CMAKE_CURRENT_LIST_DIR}/opcuaTarget.cmake) endif() include(FindPackageHandleStandardArgs) find_package_handle_standard_args(opcua) ::: 3. \u4ea4\u53c9\u7f16\u8bd1\u9879\u76ee CPU \u6709\u4e0d\u540c\u7684\u67b6\u6784\u3001\u6307\u4ee4\u96c6\uff0cC/C++ \u5f00\u53d1\u4e2d\u7684\u4ee3\u7801\u7f16\u8bd1\u540e\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5728\u4e0d\u540c\u7684 CPU \u4e0a\u76f4\u63a5\u8fd0\u884c\u65f6\u53ef\u80fd\u4f1a\u51fa\u73b0\u95ee\u9898\u3002\u5bf9\u6b64\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff1a \u5728\u76ee\u6807\u5e73\u53f0\u4e0a\u76f4\u63a5\u7f16\u8bd1\u4ee3\u7801\uff0c\u4f8b\u5982\u4e3a\u4e86\u5728 64 \u4f4d ARM \u5e73\u53f0\u4e0a\u8fd0\u884c\u4ee3\u7801\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728 aarch64 \u5e73\u53f0\u4e0a\u7f16\u8bd1\u4ee3\u7801\u3002\u4f46\u4e00\u822c\u6765\u8bf4\uff0cARM \u5e73\u53f0\u5e38\u89c1\u4e8e\u5d4c\u5165\u5f0f\u8bbe\u5907\uff0c\u8fd9\u7c7b\u8bbe\u5907\u53ef\u80fd\u7f3a\u5c11\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u5728\u6027\u80fd\u4e0a\u4e5f\u975e\u5e38\u6709\u9650\uff0c\u56e0\u6b64\u8fd9\u79cd\u65b9\u5f0f\u5e76\u4e0d\u9002\u7528\u4e8e\u6240\u6709\u60c5\u51b5\u3002 \u76f4\u63a5\u5728 PC \u4e0a\u7f16\u8bd1\u76ee\u6807\u5e73\u53f0\u7684\u4ee3\u7801\uff0c\u7136\u540e\u5c06\u7f16\u8bd1\u597d\u7684\u4ee3\u7801\u79fb\u690d\uff08\u590d\u5236\u7c98\u8d34\uff09\u5230\u76ee\u6807\u5e73\u53f0\u4e0a\u8fd0\u884c\u3002\u8fd9\u79cd\u65b9\u5f0f\u79f0\u4e3a==\u4ea4\u53c9\u7f16\u8bd1==\uff0c\u5728\u5d4c\u5165\u5f0f Linux \u5f00\u53d1\u4e2d\u975e\u5e38\u5e38\u89c1\uff0c\u4f8b\u5982\u5728 amd64 \u5e73\u53f0\u4e0a\u7f16\u8bd1 ARM \u5e73\u53f0\u7684\u4ee3\u7801\u3002 3.1 \u5de5\u5177\u94fe\u6587\u4ef6\u7684\u7f16\u5199 CMake \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u4ea4\u53c9\u7f16\u8bd1\u652f\u6301\uff0c\u800c\u4e14\u4ec5\u9700\u4e00\u4e2a==\u5de5\u5177\u94fe\u6587\u4ef6==\u5373\u53ef\u5b8c\u6210\u4ea4\u53c9\u7f16\u8bd1\u7684\u5de5\u4f5c\u3002\u5de5\u5177\u94fe\u6587\u4ef6\u662f\u4e00\u4e2a CMake \u811a\u672c\uff0c\u7528\u4e8e\u6307\u5b9a\u4ea4\u53c9\u7f16\u8bd1\u7684\u5de5\u5177\u94fe\uff0c\u4f8b\u5982\u7f16\u8bd1\u5668\u3001\u94fe\u63a5\u5668\u3001\u5e93\u6587\u4ef6\u8def\u5f84\u7b49\u3002\u5de5\u5177\u94fe\u6587\u4ef6\u6ca1\u6709\u4e25\u683c\u7684\u547d\u540d\u89c4\u5219\uff0c\u5c31\u5982\u540c\u666e\u901a\u7684 *.cmake \u6587\u4ef6\u4e00\u6837\uff0c\u4e0d\u8fc7\u4e00\u822c\u4e60\u60ef\u4e0a\u4f1a\u5728\u5de5\u5177\u94fe\u6587\u4ef6\u7684\u540d\u5b57\u4e2d\u63d0\u5230\u5e73\u53f0\u6216 toolchain \u5b57\u6837\uff0c\u5728 CMake \u914d\u7f6e\u8fc7\u7a0b\u4e2d\uff0c\u4f7f\u7528 -DCMAKE_TOOLCHAIN_FILE \u9009\u9879\u6307\u5b9a\u5de5\u5177\u94fe\u6587\u4ef6\uff0c\u4f8b\u5982 cmake -DCMAKE_TOOLCHAIN_FILE=toolchain-aarch64.cmake .. \u4e00\u822c\u6765\u8bf4\uff0c\u5de5\u5177\u94fe\u6587\u4ef6\u7684\u5185\u5bb9\u5982\u4e0b\uff1a # \u6307\u5b9a\u76ee\u6807\u7cfb\u7edf set(CMAKE_SYSTEM_NAME Linux) # \u6307\u5b9a\u76ee\u6807\u5904\u7406\u5668\u67b6\u6784 set(CMAKE_SYSTEM_PROCESSOR aarch64) # \u6307\u5b9a\u76ee\u6807\u7cfb\u7edf\u7684\u6839\u76ee\u5f55\uff0c\u5c06\u76f4\u63a5\u5f71\u54cd\u7f16\u8bd1\u5668\u548c\u94fe\u63a5\u5668\u7684\u884c\u4e3a set(CMAKE_SYSROOT \"/path/to/sysroot\") # \u6307\u5b9a C \u4ea4\u53c9\u7f16\u8bd1\u5668 set(CMAKE_C_COMPILER \"/path/to/arm-gcc\") # \u6307\u5b9a C++ \u4ea4\u53c9\u7f16\u8bd1\u5668 set(CMAKE_CXX_COMPILER \"/path/to/arm-g++\") # \u6307\u5b9a CMake \u67e5\u627e\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u4f8b\u5982 find_package set(CMAKE_FIND_ROOT_PATH \"/path/to/sysroot\") # \u4e0d\u67e5\u627e\u7a0b\u5e8f set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER) # \u53ea\u67e5\u627e\u5e93 set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY) # \u53ea\u67e5\u627e\u5934\u6587\u4ef6 set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY) 3.2 \u9884\u671f\u76ee\u6807 \u73b0\u8ba1\u5212\u5f00\u53d1\u4e00\u4e2a EtherCAT \u534f\u8bae\u7684\u673a\u68b0\u81c2\u9a71\u52a8\u7a0b\u5e8f ec_robot \uff0c\u8be5\u7a0b\u5e8f\u9700\u8981\u5728 aarch64 \u67b6\u6784\u7684 Linux \u5e73\u53f0\u4e0b\u8fd0\u884c\uff0c ec_robot \u9879\u76ee\u7684\u5f00\u53d1\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u529f\u80fd\uff1a \u9700\u8981\u4f7f\u7528\u6307\u5b9a\u7684\u5de5\u5177\u94fe\u8fdb\u884c\u4ea4\u53c9\u7f16\u8bd1\uff0c\u76ee\u6807\u7cfb\u7edf\u6839\u76ee\u5f55\u5047\u8bbe\u5728 /home/ecdev/buildroot/host/ \u4e0b C \u4ea4\u53c9\u7f16\u8bd1\u5668\u4e3a aarch64-linux-gnu-gcc \uff0c\u4f4d\u4e8e\u76ee\u6807\u7cfb\u7edf\u6839\u76ee\u5f55\u7684 /usr/bin \u76ee\u5f55\u4e0b\uff1b C++ \u4ea4\u53c9\u7f16\u8bd1\u5668\u4e3a aarch64-linux-gnu-g++ \uff0c\u4f4d\u4e8e\u76ee\u6807\u7cfb\u7edf\u6839\u76ee\u5f55\u7684 /usr/bin \u76ee\u5f55\u4e0b\uff1b \u9700\u8981\u652f\u6301 C++17 \u6807\u51c6\uff1b \u5f3a\u5236\u4f9d\u8d56 IgH \u5b9e\u73b0\u7684 EtherCAT \u4e3b\u7ad9\u9a71\u52a8\u5e93\uff0c\u5bf9\u5e94\u7684\u914d\u7f6e\u6587\u4ef6\u5728 /home/ecdev/buildroot/host/usr/lib/cmake/ethercat \u4e0b\uff0c\u5bf9\u5e94\u7684\u76ee\u6807\u540d\u4e3a EtherLab::EtherCAT \uff1b ec_robot \u9879\u76ee==\u65e0\u9700==\u5b89\u88c5\uff0c\u53ea\u9700\u6784\u5efa\u5373\u53ef\u3002 \u6ca1\u6709\u590d\u6742\u7684\u6587\u4ef6\u7ed3\u6784\uff0c\u672c\u9879\u76ee\u53ea\u6709\u4e00\u4e2a src \u76ee\u5f55\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a . \u2514\u2500\u2500 src \u251c\u2500\u2500 ec_robot.cpp \u251c\u2500\u2500 ec_robot.hpp \u2514\u2500\u2500 main.cpp 3.3 \u5206\u6790 \u9700\u8981\u5b9e\u73b0\u4e00\u4e2a\u5de5\u5177\u94fe\u6587\u4ef6 toolchain-aarch64.cmake \uff0c\u7528\u4e8e\u6307\u5b9a\u4ea4\u53c9\u7f16\u8bd1\u7684\u5de5\u5177\u94fe\uff1b EtherCATConfig.cmake \u6587\u4ef6\u5728 find_package \u7684 Config \u6a21\u5f0f\u80fd\u591f\u76f4\u63a5\u627e\u5230\u7684\u4f4d\u7f6e\uff0c\u524d\u63d0\u662f\u5de5\u5177\u94fe\u6587\u4ef6\u4e2d\u7684 CMAKE_FIND_ROOT_PATH \u8bbe\u7f6e\u6b63\u786e\uff1b \u9879\u76ee\u9664\u4e86\u5de5\u5177\u94fe\u6587\u4ef6\u5916\uff0c\u53ea\u9700\u8981\u4e00\u4e2a CMakeLists.txt \u6587\u4ef6\uff0c\u5e76\u4e14\u6784\u5efa\u65b9\u5f0f\u548c\u666e\u901a\u9879\u76ee\u4e00\u6837\u3002 3.4 \u5b9e\u73b0 \u5728\u9879\u76ee\u4e2d\u6dfb\u52a0 platform/toolchain-aarch64.cmake \u2014\u2014 \u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u6587\u4ef6 CMakeLists.txt \u2014\u2014 \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMake \u914d\u7f6e\u6587\u4ef6 \u5171 2 \u4e2a\u6587\u4ef6\uff0c\u5982\u4e0b\u6587\u4ef6\u7ed3\u6784\u6240\u793a . \u251c\u2500\u2500 CMakeLists.txt (New) \u251c\u2500\u2500 src \u2502 \u251c\u2500\u2500 ec_robot.cpp \u2502 \u251c\u2500\u2500 ec_robot.hpp \u2502 \u2514\u2500\u2500 main.cpp \u2514\u2500\u2500 platform \u2514\u2500\u2500 toolchain-aarch64.cmake (New) ::: code-tabs @tab CMakeLists.txt ```cmake :collapsed-lines cmake_minimum_required(VERSION 3.16) project(ec_robot) set(CMAKE_CXX_STANDARD 17) find_package(EtherCAT REQUIRED) aux_source_directory(src target_src) add_executable(ec_robot ${target_src}) target_link_libraries(ec_robot PRIVATE EtherLab::EtherCAT ) @tab platform/toolchain-aarch64.cmake ```cmake set(CMAKE_SYSTEM_NAME Linux) set(CMAKE_SYSTEM_PROCESSOR aarch64) set(CMAKE_SYSROOT \"/home/ecdev/buildroot/host\") set(CMAKE_C_COMPILER \"/home/ecdev/buildroot/host/usr/bin/aarch64-linux-gnu-gcc\") set(CMAKE_CXX_COMPILER \"/home/ecdev/buildroot/host/usr/bin/aarch64-linux-gnu-g++\") set(CMAKE_FIND_ROOT_PATH \"/home/ecdev/buildroot/host\") set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER) set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY) set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY) ::: \u4e0d\u8981\u60ca\u8bb6\u4e3a\u4ec0\u4e48 CMakeLists.txt \u4e2d\u6ca1\u6709\u5f15\u7528\u5de5\u5177\u94fe\u6587\u4ef6\uff0c\u56e0\u4e3a\u4e60\u60ef\u4e0a\u4f1a\u5728 CMake \u6267\u884c\u914d\u7f6e\u751f\u6210\u8fc7\u7a0b\u65f6\u518d\u6307\u5b9a\u5de5\u5177\u94fe\u6587\u4ef6\u3002 \u6253\u5f00\u9879\u76ee\u6839\u76ee\u5f55\uff0c\u5728\u547d\u4ee4\u884c\u4e2d\u6267\u884c mkdir build cmake -B build -S . -DCMAKE_TOOLCHAIN_FILE=platform/toolchain-aarch64.cmake cmake --build build \u5373\u53ef\u5b8c\u6210\u7f16\u8bd1\u3002\u53ef\u80fd\u6709\u90e8\u5206\u8bfb\u8005\u6ca1\u6709\u89c1\u8fc7 -B \u548c -S \u9009\u9879\uff0c\u8fd9\u662f CMake 3.13 \u7248\u672c\u5f15\u5165\u7684 \u529f\u80fd \u3002 -B \u9009\u9879\u7528\u4e8e\u6307\u5b9a\u6784\u5efa\u76ee\u5f55\uff0c -S \u9009\u9879\u7528\u4e8e\u6307\u5b9a\u6e90\u7801\u76ee\u5f55\uff0c\u8fd9\u6837\u53ef\u4ee5\u5c06\u6784\u5efa\u76ee\u5f55\u548c\u6e90\u7801\u76ee\u5f55\u5206\u5f00\uff0c\u907f\u514d\u5728\u6e90\u7801\u76ee\u5f55\u4e2d\u751f\u6210\u6784\u5efa\u6587\u4ef6\u3002 \u7f16\u8bd1\u540e\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5728 build \u76ee\u5f55\u4e0b\uff0c\u53ef\u4ee5\u76f4\u63a5\u590d\u5236\u5230\u76ee\u6807\u5e73\u53f0\u4e0a\u8fd0\u884c\uff0c\u4f8b\u5982\u53ef\u4ee5\u4f7f\u7528 SSH \u5de5\u5177\u7684 scp \u547d\u4ee4\u5c06\u6587\u4ef6\u590d\u5236\u5230\u76ee\u6807\u5e73\u53f0\u4e0a\uff0c\u4f46\u8981\u786e\u4fdd\u76ee\u6807\u5e73\u53f0\u6709 libethercat.so \u7684\u5e93\u6587\u4ef6\uff0c\u5e76\u4e14\u4fdd\u8bc1\u590d\u5236\u540e\u7684\u53ef\u6267\u884c\u6587\u4ef6\u80fd\u591f\u627e\u5230\u3002 4. \u8de8\u5e73\u53f0\u9879\u76ee \u4ea4\u53c9\u7f16\u8bd1\u9879\u76ee\u867d\u7136\u6d89\u53ca\u5230\u4e0d\u540c\u7684\u5e73\u53f0\uff0c\u4f46\u662f\u53ea\u9700\u8981\u4e00\u4e2a\u5de5\u5177\u94fe\u6587\u4ef6\u5373\u53ef\uff0c\u56e0\u4e3a\u5927\u90e8\u5206\u4ea4\u53c9\u7f16\u8bd1\u9879\u76ee\u90fd\u53ea\u6d89\u53ca Linux \u5185\u6838\uff0c\u53ea\u4e0d\u8fc7\u6d89\u53ca\u5230\u4e0d\u540c\u7684 CPU \u67b6\u6784\u3001OS\u3001\u6587\u4ef6\u7cfb\u7edf\uff0c\u800c\u8de8\u5e73\u53f0\u9879\u76ee\u5219\u9700\u8981\u8003\u8651\u4e0d\u540c\u5e73\u53f0\u7684\u5dee\u5f02\uff0c\u4f8b\u5982 Windows \u548c Linux \u4e24\u4e2a\u5e73\u53f0\u7684\u5dee\u5f02\u5c31\u975e\u5e38\u5927\u3002 \u8de8\u5e73\u53f0\u662f\u9879\u76ee\u5f00\u53d1\u7684\u4e00\u4e2a\u91cd\u8981\u65b9\u5411\uff0c\u6309\u7167 ISO \u6807\u51c6\u7f16\u5199\u7684 C++ \u7a0b\u5e8f\u8de8\u5e73\u53f0\u6027\u8f83\u597d\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u5f80\u5f80\u4f1a\u4f7f\u7528\u4e00\u4e9b\u5e73\u53f0\u76f8\u5173\u6216\u8005\u662f\u7f16\u8bd1\u5668\u76f8\u5173\u7684 API\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e86\u8de8\u5e73\u53f0\u7684\u56f0\u96be\u3002\u4f7f\u7528 CMake \u5b8c\u6210\u8de8\u5e73\u53f0\u9879\u76ee\u7684\u5f00\u53d1\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\uff0cCMake \u63d0\u4f9b\u4e86\u5f88\u591a\u5de5\u5177\u548c\u51fd\u6570\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u8005\u66f4\u597d\u7684\u5b9e\u73b0\u8de8\u5e73\u53f0\u9879\u76ee\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u8de8\u5e73\u53f0\u9879\u76ee\u7684\u5f00\u53d1\u9700\u8981\u8003\u8651\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a \u7f16\u8bd1\u5668\u7684\u7f16\u8bd1\u9009\u9879\u4e0d\u540c\uff0c\u4f8b\u5982\u7528\u4e8e\u63a7\u5236 C++ \u8bed\u8a00\u6807\u51c6\u7684\u9009\u9879\uff0c\u5728 GCC \u4e2d\u662f -std=c++<ver> \uff0c\u5728 MSVC \u4e2d\u662f /std:c++<ver> \uff1b ::: important \u4e0d\u8fc7\u5728 CMake \u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 CMAKE_CXX_STANDARD \u53d8\u91cf\u6765\u6307\u5b9a C++ \u6807\u51c6\uff0cCMake \u4f1a\u6839\u636e\u4e0d\u540c\u7684\u7f16\u8bd1\u5668\u81ea\u52a8\u9009\u62e9\u6b63\u786e\u7684\u7f16\u8bd1\u9009\u9879\uff0c\u8fd9\u91cc\u53ea\u662f\u4e3e\u4e2a\u4f8b\u5b50\u3002 ::: \u4e0d\u540c\u5e73\u53f0\u7684\u5e93\u6587\u4ef6\u540e\u7f00\u540d\u4e0d\u540c\uff0c\u4f8b\u5982 Windows \u4e0b\u7684\u9759\u6001\u5e93\u6587\u4ef6\u540e\u7f00\u540d\u662f *.lib \uff0cLinux \u4e0b\u7684\u9759\u6001\u5e93\u6587\u4ef6\u540e\u7f00\u540d\u662f *.a \uff0c\u5e76\u4e14\u5e93\u6587\u4ef6\u7684\u7ec4\u7ec7\u65b9\u5f0f\u4e5f\u4e0d\u540c\uff0cWindows \u4e0b\u5728\u94fe\u63a5\u52a8\u6001\u5e93\u65f6\u9700\u8981\u4f7f\u7528\u5bfc\u5165\u5e93 *.lib \uff0cLinux \u4e0b\u5728\u94fe\u63a5\u52a8\u6001\u5e93\u65f6\u5219\u76f4\u63a5\u4f7f\u7528\u52a8\u6001\u5e93 *.so \u3002 \u9ed8\u8ba4\u5b89\u88c5\u8def\u5f84\u4e0d\u540c\uff0cWindows \u4e0b\u7684\u9ed8\u8ba4\u5b89\u88c5\u8def\u5f84\u662f C:\\Program Files \uff0cLinux \u4e0b\u7684\u9ed8\u8ba4\u5b89\u88c5\u8def\u5f84\u662f /usr/local \uff0c\u4f46 Windows \u4e0d\u5efa\u8bae\u76f4\u63a5\u5b89\u88c5\u5230 C:\\Program Files \uff0c\u800c Linux \u5219\u6ca1\u6709\u8fc7\u591a\u7684\u9650\u5236\u3002 4.1 \u9884\u671f\u76ee\u6807 \u73b0\u8ba1\u5212\u5f00\u53d1\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u57fa\u7840\u6570\u503c\u7b97\u6cd5\u548c\u6700\u4f18\u5316\u5e93 numopt \uff0c\u8be5\u5e93\u9700\u8981\u652f\u6301 Windows \u548c Linux \u4e24\u4e2a\u5e73\u53f0\uff0c numopt \u9879\u76ee\u7684\u5f00\u53d1\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u529f\u80fd\uff1a \u9700\u8981\u652f\u6301 C++17 \u6807\u51c6\uff1b \u9ed8\u8ba4\u4ee5\u9759\u6001\u5e93\u7684\u5f62\u5f0f\u6784\u5efa numopt \uff0c\u4f46\u5141\u8bb8\u7528\u6237\u901a\u8fc7 CMake \u9009\u9879\u8bbe\u7f6e\u6784\u5efa\u4e3a\u52a8\u6001\u5e93\uff1b \u5e93\u5305\u542b\u4e86 core \u3001 num \u548c opt 3 \u4e2a\u6a21\u5757\u548c numopt_version 1 \u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5176\u4e2d num \u548c opt \u4f9d\u8d56 core \u6a21\u5757\uff0c numopt_version \u4f9d\u8d56 core \u6a21\u5757\uff1b numopt \u9879\u76ee\u7684\u9ed8\u8ba4\u5b89\u88c5\u76ee\u5f55\u5982\u4e0b \u5185\u5bb9 Window \u5b89\u88c5\u8def\u5f84 Linux \u5b89\u88c5\u8def\u5f84 \u9879\u76ee\u6839\u76ee\u5f55 ${CMAKE_BINARY_DIR}/install \u8bb0\u4f5c <prefix> /usr/local \u8bb0\u4f5c <prefix> \u5934\u6587\u4ef6 <prefix>\\include <prefix>/include/numopt \u53ef\u6267\u884c\u6587\u4ef6 <prefix>\\x64\\vc16\\bin <prefix>/bin \u9759\u6001\u5e93\u6587\u4ef6 <prefix>\\x64\\vc16\\lib <prefix>/lib \u52a8\u6001\u5e93\u6587\u4ef6 <prefix>\\x64\\vc16\\bin <prefix>/lib \u5bfc\u5165\u5e93\u6587\u4ef6 <prefix>\\x64\\vc16\\lib \u2014\u2014 CMake \u914d\u7f6e\u6587\u4ef6 <prefix>\\x64\\vc16\\lib <prefix>/lib/cmake/numopt \u9700\u8981\u63d0\u4f9b uninstall \u76ee\u6807\uff0c\u7528\u4e8e\u5378\u8f7d\u5df2\u5b89\u88c5\u7684\u6587\u4ef6\uff0c\u5728\u6267\u884c shell cmake --build . --target uninstall \u540e\uff0c\u5b89\u88c5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u90fd\u4f1a\u88ab\u5220\u9664\u3002 \u6587\u4ef6\u7ed3\u6784\u5982\u4e0b\uff1a ``` :collapsed-lines . \u251c\u2500\u2500 modules \u2502 \u251c\u2500\u2500 core \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u251c\u2500\u2500 num \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2514\u2500\u2500 opt \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2514\u2500\u2500 src \u2502 \u2514\u2500\u2500 ... \u2514\u2500\u2500 samples \u2514\u2500\u2500 version.cpp ### 4.2 \u5b9e\u73b0 \u5728\u9879\u76ee\u6784\u5efa\u90e8\u5206\u548c[\u5e38\u89c4\u975e\u8de8\u5e73\u53f0\u9879\u76ee](#_1-\u5e38\u89c4\u975e\u8de8\u5e73\u53f0\u9879\u76ee)\u4e00\u81f4\uff0c\u53ea\u662f\u5728\u5b89\u88c5\u90e8\u5206\u9700\u8981\u8003\u8651\u4e0d\u540c\u5e73\u53f0\u7684\u5dee\u5f02\uff0c\u56e0\u6b64\u8de8\u5e73\u53f0\u9879\u76ee\u53ea\u662f\u6bd4\u5e38\u89c4\u9879\u76ee\u591a\u4e86\u4e00\u4e9b\u5e73\u53f0\u76f8\u5173\u7684\u914d\u7f6e\u3002 \u548c\u5e38\u89c4\u975e\u8de8\u5e73\u53f0\u9879\u76ee\u4e00\u6837\uff0c\u5728\u9879\u76ee\u4e2d\u6dfb\u52a0 - `modules/core/CMakeLists.txt` \u2014\u2014 `core` \u6a21\u5757\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `modules/num/CMakeLists.txt` \u2014\u2014 `num` \u6a21\u5757\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `modules/opt/CMakeLists.txt` \u2014\u2014 `opt` \u6a21\u5757\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `modules/CMakelists.txt` \u2014\u2014 \u9879\u76ee\u7684\u6a21\u5757\u5217\u8868 - `samples/CMakeLists.txt` \u2014\u2014 \u793a\u4f8b\u7a0b\u5e8f\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `CMakeLists.txt` \u2014\u2014 \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `cmake/numoptInstall.cmake` \u2014\u2014 \u4e0e\u9879\u76ee\u5b89\u88c5\u8def\u5f84\u76f8\u5173\u7684\u914d\u7f6e\u6587\u4ef6 - `cmake/templates/numoptConfig.cmake.in` \u2014\u2014 \u9879\u76ee\u7684 CMake \u914d\u7f6e\u6587\u4ef6\u7684\u6a21\u677f\u6587\u4ef6 - `cmake/templates/cmake_uninstall.cmake.in` \u2014\u2014 \u81ea\u5b9a\u4e49\u5378\u8f7d\u76ee\u6807\u7684\u6a21\u677f\u6587\u4ef6 \u5171 7 \u4e2a\u6587\u4ef6\uff0c\u5982\u4e0b\u6587\u4ef6\u7ed3\u6784\u6240\u793a ``` :collapsed-lines . \u251c\u2500\u2500 CMakeLists.txt (New) \u251c\u2500\u2500 cmake \u2502 \u251c\u2500\u2500 numoptInstall.cmake (New) \u2502 \u2514\u2500\u2500 templates \u2502 \u251c\u2500\u2500 cmake_uninstall.cmake.in (New) \u2502 \u2514\u2500\u2500 numoptConfig.cmake.in (New) \u251c\u2500\u2500 modules \u2502 \u251c\u2500\u2500 core \u2502 \u2502 \u251c\u2500\u2500 CMakeLists.txt (New) \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u251c\u2500\u2500 num \u2502 \u2502 \u251c\u2500\u2500 CMakeLists.txt (New) \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u251c\u2500\u2500 opt \u2502 \u2502 \u251c\u2500\u2500 CMakeLists.txt (New) \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2514\u2500\u2500 CMakeLists.txt (New) \u2514\u2500\u2500 samples \u251c\u2500\u2500 CMakeLists.txt (New) \u2514\u2500\u2500 version.cpp \u65b9\u4fbf\u8d77\u89c1\uff0c\u5c31\u4e0d\u6dfb\u52a0\u7c7b\u4f3c\u4e8e vl_add_module \u548c vl_add_exe \u7684\u5b8f\u4e86\u3002 4.2.1 \u9879\u76ee\u914d\u7f6e ::: code-tabs @tab CMakeLists.txt ```cmake :collapsed-lines ---------------------------------------------------------------------------- \u9879\u76ee\u914d\u7f6e ---------------------------------------------------------------------------- cmake_minimum_required(VERSION 3.16) project( numopt LANGUAGES CXX ) set(CMAKE_CXX_STANDARD 17) option(BUILD_SHARED_LIBS \"Build shared libraries?\" OFF) include(cmake/numoptInstall.cmake) ---------------------------------------------------------------------------- \u76ee\u6807\u6784\u5efa ---------------------------------------------------------------------------- main target add_subdirectory(modules) executable target add_subdirectory(samples) uninstall target if(NOT TARGET uninstall) configure_file( \"${CMAKE_CURRENT_SOURCE_DIR}/cmake/templates/cmake_uninstall.cmake.in\" \"${CMAKE_CURRENT_BINARY_DIR}/cmake_uninstall.cmake\" IMMEDIATE @ONLY ) add_custom_target(uninstall COMMAND ${CMAKE_COMMAND} -P ${CMAKE_CURRENT_BINARY_DIR}/cmake_uninstall.cmake ) endif() ---------------------------------------------------------------------------- \u5bfc\u51fa\u3001\u5b89\u88c5 ---------------------------------------------------------------------------- install( EXPORT numoptModules DESTINATION ${NUMOPT_CFG_INSTALL_PATH} FILE numoptModules.cmake ) file(RELATIVE_PATH NUMOPT_INSTALL_RELATIVE_PATH \"${CMAKE_INSTALL_PREFIX}/${NUMOPT_CFG_INSTALL_PATH}/\" ${CMAKE_INSTALL_PREFIX}) configure_file( cmake/numoptConfig.cmake.in \"${CMAKE_CURRENT_BINARY_DIR}/numoptConfig.cmake\" @ONLY ) install( FILES \"${CMAKE_CURRENT_BINARY_DIR}/numoptConfig.cmake\" DESTINATION ${NUMOPT_CFG_INSTALL_PATH} ) @tab cmake/numoptInstall.cmake ```cmake :collapsed-lines # ---------------------------------------------------------- # \u9879\u76ee\u5b89\u88c5\u8def\u5f84\u7684\u9884\u5148\u914d\u7f6e # ---------------------------------------------------------- if(NOT CMAKE_TOOLCHAIN_FILE) if(WIN32) set(CMAKE_INSTALL_PREFIX \"${CMAKE_BINARY_DIR}/install\") else() set(CMAKE_INSTALL_PREFIX \"/usr/local\") endif() else() # \u4ea4\u53c9\u7f16\u8bd1\u65f6\u7684\u5b89\u88c5\u8def\u5f84 set(CMAKE_INSTALL_PREFIX \"${CMAKE_BINARY_DIR}/install\") endif() # ---------------------------------------------------------- # MSVC \u5b89\u88c5\u8def\u5f84\u7684\u9884\u5148\u914d\u7f6e # ---------------------------------------------------------- if(MSVC) if(\"${CMAKE_GENERATOR}\" MATCHES \"(Win64|IA64)\") set(ARCH_forMSVC \"x64\") elseif(\"${CMAKE_GENERATOR_PLATFORM}\" MATCHES \"ARM64\") set(ARCH_forMSVC \"ARM64\") elseif(\"${CMAKE_GENERATOR}\" MATCHES \"ARM\") set(ARCH_forMSVC \"ARM\") elseif(\"${CMAKE_SIZEOF_VOID_P}\" STREQUAL \"8\") set(ARCH_forMSVC \"x64\") else() set(ARCH_forMSVC x86) endif() if(MSVC_VERSION EQUAL 1400) set(RUNTIME_forMSVC vc8) elseif(MSVC_VERSION EQUAL 1500) set(RUNTIME_forMSVC vc9) elseif(MSVC_VERSION EQUAL 1600) set(RUNTIME_forMSVC vc10) elseif(MSVC_VERSION EQUAL 1700) set(RUNTIME_forMSVC vc11) elseif(MSVC_VERSION EQUAL 1800) set(RUNTIME_forMSVC vc12) elseif(MSVC_VERSION EQUAL 1900) set(RUNTIME_forMSVC vc14) elseif(MSVC_VERSION MATCHES \"^191[0-9]$\") set(RUNTIME_forMSVC vc15) elseif(MSVC_VERSION MATCHES \"^192[0-9]$\") set(RUNTIME_forMSVC vc16) elseif(MSVC_VERSION MATCHES \"^19[34][0-9]$\") set(RUNTIME_forMSVC vc17) endif() endif() # ---------------------------------------------------------- # \u5b89\u88c5\u8def\u5f84\u8bbe\u7f6e # ---------------------------------------------------------- if(MSVC) if(DEFINED ARCH_forMSVC AND DEFINED RUNTIME_forMSVC) set(MSVC_INSTALL_PREFIX \"${ARCH_forMSVC}/${RUNTIME_forMSVC}\") else() set(MSVC_INSTALL_PREFIX \"\") endif() set(NUMOPT_INC_INSTALL_PATH \"include\") set(NUMOPT_LIB_INSTALL_PATH \"${MSVC_INSTALL_PREFIX}/lib\") set(NUMOPT_BIN_INSTALL_PATH \"${MSVC_INSTALL_PREFIX}/bin\") set(NUMOPT_CFG_INSTALL_PATH \"${MSVC_INSTALL_PREFIX}/lib\") elseif() set(NUMOPT_INC_INSTALL_PATH \"include/numopt\") set(NUMOPT_LIB_INSTALL_PATH \"lib\") set(NUMOPT_BIN_INSTALL_PATH \"bin\") set(NUMOPT_CFG_INSTALL_PATH \"lib/cmake/numopt\") endif() ::: 4.2.2 \u6a21\u5757\u914d\u7f6e modules \u76ee\u5f55\u4e0b\u7684 CMakeLists.txt \u548c\u5404\u4e2a\u6a21\u5757\u7684 CMakeLists.txt \u6587\u4ef6\u5982\u4e0b\uff1a ::: code-tabs @tab modules add_subdirectory(core) add_subdirectory(num) add_subdirectory(opt) @tab core \u6a21\u5757 ```cmake :collapsed-lines aux_source_directory(src core_src) add_library(core ${core_src}) target_include_directories(core PUBLIC $ $ ) install(TARGETS core LIBRARY DESTINATION ${NUMOPT_BIN_INSTALL_PATH} ARCHIVE DESTINATION ${NUMOPT_LIB_INSTALL_PATH} RUNTIME DESTINATION ${NUMOPT_BIN_INSTALL_PATH} INCLUDES DESTINATION ${NUMOPT_INC_INSTALL_PATH} ) @tab `num` \u6a21\u5757 ```cmake :collapsed-lines aux_source_directory(src num_src) add_library(num ${num_src}) target_include_directories(num PUBLIC $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include> $<INSTALL_INTERFACE:${NUMOPT_INC_INSTALL_PATH}> ) target_link_libraries(num PUBLIC core) install(TARGETS num LIBRARY DESTINATION ${NUMOPT_BIN_INSTALL_PATH} ARCHIVE DESTINATION ${NUMOPT_LIB_INSTALL_PATH} RUNTIME DESTINATION ${NUMOPT_BIN_INSTALL_PATH} INCLUDES DESTINATION ${NUMOPT_INC_INSTALL_PATH} ) @tab opt \u6a21\u5757 ```cmake :collapsed-lines aux_source_directory(src opt_src) add_library(opt ${opt_src}) target_include_directories(opt PUBLIC $ $ ) target_link_libraries(opt PUBLIC core) install(TARGETS opt LIBRARY DESTINATION ${NUMOPT_BIN_INSTALL_PATH} ARCHIVE DESTINATION ${NUMOPT_LIB_INSTALL_PATH} RUNTIME DESTINATION ${NUMOPT_BIN_INSTALL_PATH} INCLUDES DESTINATION ${NUMOPT_INC_INSTALL_PATH} ) ::: ::: tip \u7531\u4e8e\u6ca1\u6709\u4f7f\u7528\u5b8f\uff0c`core` \u6a21\u5757\u3001`num` \u6a21\u5757\u548c `opt` \u6a21\u5757\u7684\u914d\u7f6e\u5199\u4e86\u5927\u91cf\u7684\u91cd\u590d\u4ee3\u7801\uff0c\u53ef\u8bfb\u6027\u964d\u4f4e\u3002\u56e0\u6b64\u5728\u5fc5\u8981\u65f6\u5019\u4f7f\u7528\u5b8f\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002\u8fd9\u91cc\u5c31\u4e0d\u518d\u5c55\u793a\u5b8f\u7684\u4f7f\u7528\uff0c\u8bfb\u8005\u53ef\u4ee5\u6309\u7167[\u5e38\u89c4\u975e\u8de8\u5e73\u53f0\u9879\u76ee\u914d\u7f6e](#_1-4-1-\u9879\u76ee\u914d\u7f6e)\u4e2d\u7684\u5185\u5bb9\u81ea\u884c\u6dfb\u52a0\u5b8f\u3002 ::: #### 4.2.3 \u793a\u4f8b\u7a0b\u5e8f\u914d\u7f6e ::: code-tabs @tab samples/CMakeLists.txt ```cmake :collapsed-lines add_executable(numopt_version version.cpp) target_link_libraries(numopt_version PRIVATE core) ::: 4.2.4 CMake \u914d\u7f6e\u6587\u4ef6\u6a21\u677f cmake_uninstall.cmake.in \u6587\u4ef6\u53c2\u8003\u81ea \u6b64\u5904 \uff0c\u7528\u6237\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u6700\u597d\u52a0\u4e0a\u51fa\u5904\u3002 ::: code-tabs @tab numoptConfig.cmake.in ```cmake :collapsed-lines ---------------------------------------------------------------------------- numopt CMake \u914d\u7f6e\u6587\u4ef6 ** \u8be5\u6587\u4ef6\u7531 CMake \u751f\u6210\uff0c\u8bf7\u52ff\u624b\u52a8\u4fee\u6539 ** \u57fa\u672c\u7528\u6cd5\uff1a find_package(numopt REQUIRED) target_link_libraries(your_target PRIVATE ${numopt_LIBS}) ---------------------------------------------------------------------------- ---------------------------------------------------------------------------- \u83b7\u53d6 numopt \u5b89\u88c5\u8def\u5f84 ---------------------------------------------------------------------------- get_filename_component(NUMOPT_CONFIG_PATH \"${CMAKE_CURRENT_LIST_FILE}\" PATH) get_filename_component(NUMOPT_INSTALL_PATH \"${NUMOPT_CONFIG_PATH}/@NUMOPT_INSTALL_RELATIVE_PATH@\" REALPATH ) ---------------------------------------------------------------------------- \u8bbe\u7f6e\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\u53d8\u91cf ---------------------------------------------------------------------------- set(numopt_INCLUDE_DIRS \"${NUMOPT_INSTALL_PATH}/@NUMOPT_INC_INSTALL_PATH@\") ---------------------------------------------------------------------------- \u8bbe\u7f6e\u5e93\u6587\u4ef6\u8def\u5f84\u53d8\u91cf ---------------------------------------------------------------------------- set(numopt_LIBS @NUMOPT_LIB_COMPONENTS@) if(NOT TARGET core) include(\"${NUMOPT_CONFIG_PATH}/numoptModules.cmake\") endif() ---------------------------------------------------------------------------- \u641c\u5bfb\u7684\u7ed3\u679c\u3001\u72b6\u6001 ---------------------------------------------------------------------------- include(FindPackageHandleStandardArgs) find_package_handle_standard_args(numopt REQUIRED_VARS numopt_INSTALL_PATH ) @tab cmake_uninstall.cmake.in ```cmake :collapsed-lines # ----------------------------------------------- # File that provides \"make uninstall\" target # We use the file 'install_manifest.txt' # # Details: # https://gitlab.kitware.com/cmake/community/-/wikis/FAQ#can-i-do-make-uninstall-with-cmake # ----------------------------------------------- if(NOT EXISTS \"@CMAKE_BINARY_DIR@/install_manifest.txt\") message(FATAL_ERROR \"Cannot find install manifest: \\\"@CMAKE_BINARY_DIR@/install_manifest.txt\\\"\" ) endif() file(READ \"@CMAKE_BINARY_DIR@/install_manifest.txt\" files) string(REGEX REPLACE \"\\n\" \";\" files \"${files}\") foreach(file ${files}) message(STATUS \"Uninstalling: $ENV{DESTDIR}${file}\") if(IS_SYMLINK \"$ENV{DESTDIR}${file}\" OR EXISTS \"$ENV{DESTDIR}${file}\") execute_process( COMMAND \"@CMAKE_COMMAND@\" \"-E\" \"remove\" \"$ENV{DESTDIR}${file}\" OUTPUT_VARIABLE rm_out RESULT_VARIABLE rm_retval ) if(NOT \"${rm_retval}\" STREQUAL 0) message(FATAL_ERROR \"Problem when removing $ENV{DESTDIR}${file}\") endif() else(IS_SYMLINK \"$ENV{DESTDIR}${file}\" OR EXISTS \"$ENV{DESTDIR}${file}\") message(STATUS \"File $ENV{DESTDIR}${file} does not exist.\") endif() endforeach() ::: 4.3 \u9488\u5bf9 Visual Studio \u7684\u7279\u6b8a\u8bbe\u8ba1 \u5bf9\u4e8e\u591a\u4e2a\u76ee\u6807\u7684\u9879\u76ee\uff0c\u4f1a\u751f\u6210\u591a\u4e2a\u5e93\u6587\u4ef6\uff0c\u4f8b\u5982\u672c numopt \u9879\u76ee\uff0c\u5728 Windows \u4e0b\u4f1a\u751f\u6210 core.lib \u3001 num.lib \u548c opt.lib 3 \u4e2a\u5e93\u6587\u4ef6\uff0c\u5728 Visual Studio \u4e2d\uff0c\u5229\u7528\u8fd9 3 \u4e2a\u5e93\u6587\u4ef6\u8fdb\u884c\u5f00\u53d1\uff0c\u9700\u8981\u518d\u9879\u76ee\u4e2d\u624b\u52a8\u6dfb\u52a0\uff0c\u8fd9\u6837\u4f1a\u589e\u52a0\u5f00\u53d1\u8005\u7684\u5de5\u4f5c\u91cf\u3002\u4e3a\u4e86\u7b80\u5316\u5f00\u53d1\u8005\u7684\u5de5\u4f5c\uff0c\u53ef\u4ee5\u5c06\u8fd9 3 \u4e2a\u5e93\u6587\u4ef6\u6253\u5305\u6210\u4e00\u4e2a numopt_world.lib \u6587\u4ef6\uff0c\u8fd9\u6837\u5f00\u53d1\u8005\u53ea\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a\u5e93\u6587\u4ef6\u5373\u53ef\u3002 \u4f8b\u5982 OpenCV \u539f\u5148\u4f1a\u751f\u6210 opencv_core.lib \u3001 opencv_imgproc.lib \u4ee5\u53ca opencv_highgui.lib \u7b49\u5bfc\u5165\u5e93\u6587\u4ef6\uff0c\u5728\u542f\u7528 BUILD_opencv_world \u9009\u9879\u540e\uff0c\u5219\u4e0d\u518d\u751f\u6210\u539f\u5148\u7684\u5e93\u6587\u4ef6\uff0c\u800c\u662f\u751f\u6210\u4e00\u4e2a opencv_world.lib \u5bfc\u5165\u5e93\u6587\u4ef6\u3002\u8fd9\u65f6\u5f00\u53d1\u8005\u5728\u4f7f\u7528 Visual Studio \u5bf9\u9879\u76ee\u7684\u5bfc\u5165\u5e93\u8fdb\u884c\u914d\u7f6e\u7684\u65f6\u5019\uff0c\u53ea\u9700\u6dfb\u52a0 opencv_world.lib \u8be5\u5bfc\u5165\u5e93\u6587\u4ef6\u7684\u8def\u5f84\u548c\u540d\u5b57\u5373\u53ef\u3002 \u4e00\u4e2a\u7b80\u5355\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u5728 core \u3001 num \u548c opt \u6a21\u5757\u7684 CMakeLists.txt \u6587\u4ef6\u4e2d\u6dfb\u52a0\u5224\u65ad\uff0c\u4e0b\u9762\u4ee5 core \u6a21\u5757\u4e3a\u4f8b\uff1a if(NOT BUILD_WORLD) # \u539f\u5148\u7684\u914d\u7f6e else() aux source_directory(src core_src) set(NUMOPT_SRC \"${NUMOPT_SRCS} ${core_src}\" CACHE INTERNAL \"\") set(NUMOPT_INC \"${NUMOPT_INC} ${CMAKE_CURRENT_SOURCE_DIR}/include\" CACHE INTERNAL \"\") # \u7531\u4e8e\u6ca1\u6709\u5916\u90e8\u4f9d\u8d56\u5e93\uff0c\u6240\u4ee5\u5c31\u4e0d\u5199 NUMOPT_LIB \u4e86 endif() \u4fee\u6539\u9879\u76ee\u7684\u6839\u76ee\u5f55\u7684 CMakeLists.txt \u6587\u4ef6 ```cmake :collapsed-lines ... ---------------------------------------------------------------------------- \u76ee\u6807\u6784\u5efa ---------------------------------------------------------------------------- if(BUILD_WORLD) set(NUMOPT_SRC \"\" CACHE INTERNAL \"\") set(NUMOPT_INC \"\" CACHE INTERNAL \"\") # \u7531\u4e8e\u6ca1\u6709\u5916\u90e8\u4f9d\u8d56\u5e93\uff0c\u6240\u4ee5\u5c31\u4e0d\u5199 NUMOPT_LIB \u4e86 endif() add_subdirectory(modules) add_subdirectory(samples) if(BUILD_WORLD) add_library(numopt_world ${NUMOPT_SRC}) target_include_directories(numopt_world PUBLIC $ $ ) endif() ... \u8fd8\u6709\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\u662f\u4f7f\u7528[\u5bf9\u8c61\u5e93](05.md#_3-1-1-\u5bf9\u8c61\u5e93)\uff0c\u5c06 `core`\u3001`num` \u548c `opt` \u6a21\u5757\u7684\u6e90\u6587\u4ef6\u7f16\u8bd1\u6210\u5bf9\u8c61\u6587\u4ef6\uff0c\u7136\u540e\u518d\u5c06\u8fd9\u4e9b\u5bf9\u8c61\u6587\u4ef6\u94fe\u63a5\u6210\u4e00\u4e2a\u5e93\u6587\u4ef6\u3002\u4f8b\u5982 ```cmake add_library(core_obj OBJECT ${core_src}) \u5f00\u53d1\u8005\u53ef\u4ee5\u81ea\u884c\u589e\u52a0 if \u5224\u65ad\uff0c\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u6765\u9009\u62e9\u5408\u9002\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002 \u4f7f\u7528\u5f62\u5982\u4ee5\u4e0b\u7684\u4ee3\u7801\u6765\u5b89\u88c5\uff1a ::: code-tabs @tab core \u6a21\u5757 add_library(core_obj OBJECT ${core_src}) install(TARGETS core_obj EXPORT numoptModules ) @tab num \u6a21\u5757 add_library(num_obj OBJECT ${num_src}) install(TARGETS num_obj EXPORT numoptModules ) @tab opt \u6a21\u5757 add_library(opt_obj OBJECT ${opt_src}) install(TARGETS opt_obj EXPORT numoptModules ) ::: \u4e0d\u8fc7\uff0c\u5bf9\u8c61\u5e93\u7b49\u6548\u4e8e\u5b89\u88c5\u4e00\u4e2a\u63a5\u53e3\u5e93\uff0c\u5b89\u88c5\u63a5\u53e3\u5e93\u7684\u6548\u679c\u53ef\u4ee5\u53c2\u8003 \u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5 - \u601d\u8003 \u4e2d\u7684\u7b2c 2 \u4e2a\u95ee\u9898\uff0c\u56e0\u6b64\u5728\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u4e2d\u4e5f\u5177\u6709\u76f8\u5e94\u7684\u4fe1\u606f\uff0c\u4f8b\u5982 numoptModules.cmake \u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f1a\u5305\u542b\u5927\u81f4\u5982\u4e0b\u5185\u5bb9 # Create imported target core_obj add_library(core_obj INTERFACE IMPORTED) # Create imported target num_obj add_library(num_obj INTERFACE IMPORTED) # Create imported target opt_obj add_library(opt_obj INTERFACE IMPORTED) ::: warning \u5982\u679c\u5e0c\u671b\u5728 numoptModules.cmake \u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u4e2d\u53ea\u5305\u542b\u4e00\u4e2a numopt_world \u76ee\u6807\u800c\u4e0d\u5305\u542b core_obj \u7b49\u7531\u5bf9\u8c61\u5e93\u5bfc\u51fa\u751f\u6210\u7684\u63a5\u53e3\u5e93\uff0c\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e00\u79cd\u65b9\u6848\u3002 ::: \u5199\u5728\u540e\u9762 \u6709\u5173 CMake \u9879\u76ee\u5b9e\u6218\u7684\u5185\u5bb9\u53ef\u4ee5\u53c2\u8003 RMVL [^2] \u9879\u76ee\u7684 CMake \u6846\u67b6\uff0c\u672c\u6587\u6d89\u53ca\u5230\u7684 \u5e38\u89c4\u76ee\u6807\u6784\u5efa\u7684\u5185\u5bb9 \u5916\u90e8\u4f9d\u8d56\u7ba1\u7406\u7684\u5185\u5bb9 \u4ea4\u53c9\u7f16\u8bd1\u7684\u5185\u5bb9 \u8de8\u5e73\u53f0\u7684\u5185\u5bb9 \u5bf9\u5e94\u7684 CMake \u914d\u7f6e\uff0c\u90fd\u80fd\u5728 RMVL \u9879\u76ee\u4e2d\u627e\u5230\u3002 [^1]: open62541 developers. open62541 , September 2014. [^2]: zhaoxi and other RMVL developers. rmvl , September 2023.","title":"\u301011\u3011\u9879\u76ee\u5b9e\u6218"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#11","text":"","title":"\u301011\u3011\u9879\u76ee\u5b9e\u6218"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_1","text":"::: tip \u5199\u5728\u524d\u9762 \u5982\u679c\u4f60\u89c9\u5f97\u672c\u6559\u7a0b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce\u4e00\u952e\u4e09\u8fde\uff0c\u4f60\u7684\u652f\u6301\u662f\u6211\u4e0d\u65ad\u66f4\u65b0\u7684\u52a8\u529b\uff01 :tada: \u5373\u5c06\u5230\u6765 ... - \u301011-2\u3011CMake\uff1a\u5b9e\u6218\u7bc7\u2014\u2014\u5916\u90e8\u4f9d\u8d56\u7ba1\u7406 - \u301011-3\u3011CMake\uff1a\u5b9e\u6218\u7bc7\u2014\u2014\u4ea4\u53c9\u7f16\u8bd1 - \u301011-4\u3011CMake\uff1a\u5b9e\u6218\u7bc7\u2014\u2014\u8de8\u5e73\u53f0 ::: @ bilibili","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#1","text":"","title":"1. \u5e38\u89c4\u975e\u8de8\u5e73\u53f0\u9879\u76ee"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#11_1","text":"\u73b0\u8ba1\u5212\u5f00\u53d1\u4e00\u4e2a\u4e13\u4e3a Linux \u5e73\u53f0\u8bbe\u8ba1\u7684\u89c6\u89c9\u5904\u7406\u5e93 visionlib \u53ca\u793a\u4f8b\u7a0b\u5e8f vl_demo \uff0c\u5e93\u5728\u4ece\u6e90\u7801\u7f16\u8bd1\u5b89\u88c5\u7684\u8fc7\u7a0b\u4e2d\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u529f\u80fd\uff1a \u9700\u8981\u652f\u6301 C++17 \u6807\u51c6\uff1b \u5f3a\u5236\u4f9d\u8d56 OpenCV 4 \u53ca\u4ee5\u4e0a\u7248\u672c\uff0c\u5e76\u7528\u5230\u5176\u4e2d\u7684 core \u3001 imgproc \u3001 highgui \u6a21\u5757\uff0c\u5206\u522b\u5bf9\u5e94 opencv_core \u3001 opencv_imgproc \u3001 opencv_highgui \u8fd9 3 \u4e2a CMake \u76ee\u6807\uff1b \u9ed8\u8ba4\u4ee5\u9759\u6001\u5e93\u7684\u5f62\u5f0f\u6784\u5efa visionlib \uff0c\u4f46\u5141\u8bb8\u7528\u6237\u901a\u8fc7 CMake \u9009\u9879\u8bbe\u7f6e\u6784\u5efa\u4e3a\u52a8\u6001\u5e93\uff1b \u5e93\u5305\u542b\u4e86 vl_a \u3001 vl_b \u3001 vl_c \u548c vl_d \u5171 4 \u4e2a\u6a21\u5757\uff0c\u5206\u522b\u5bf9\u5e94 a \u3001 b \u3001 c \u548c d 4 \u4e2a\u6587\u4ef6\u5939\uff0c\u5747\u9ed8\u8ba4\u53c2\u4e0e\u6784\u5efa\uff0c\u4f46\u662f\u5141\u8bb8\u7528\u6237\u901a\u8fc7 CMake \u9009\u9879\u8bbe\u7f6e\u4efb\u4e00\u6a21\u5757\u662f\u5426\u53c2\u4e0e\u6784\u5efa\uff1b \u9879\u76ee\u5305\u542b\u4e86\u4e00\u4e2a\u793a\u4f8b\u7a0b\u5e8f vl_demo \uff0c\u9ed8\u8ba4\u53c2\u4e0e\u6784\u5efa\uff0c\u5141\u8bb8\u7528\u6237\u901a\u8fc7 CMake \u9009\u9879\u8bbe\u7f6e\u5176\u662f\u5426\u53c2\u4e0e\u6784\u5efa\uff1b \u8fd9\u51e0\u4e2a\u6a21\u5757\u548c\u793a\u4f8b\u7a0b\u5e8f\u4e4b\u95f4\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\uff0c\u4f7f\u7528 \u2192 \u8868\u793a\u4f9d\u8d56\u5173\u7cfb\uff0c\u5982 \u8868\u793a vl_c \u4f9d\u8d56 vl_a ::: center **\u56fe 1-1\uff1a\u4f9d\u8d56\u5173\u7cfb\u56fe** ::: \u9879\u76ee\u7684\u5b89\u88c5\u76ee\u5f55\u4e3a /usr/local \uff0c\u5176\u4e2d \u793a\u4f8b\u7a0b\u5e8f\u5b89\u88c5\u5230 /usr/local/bin \u5934\u6587\u4ef6\u5b89\u88c5\u5230 /usr/local/include \u5e93\u6587\u4ef6\u5b89\u88c5\u5230 /usr/local/lib CMake \u76f8\u5173\u914d\u7f6e\u6587\u4ef6\u5b89\u88c5\u5230 /usr/local/lib/cmake/VisionLib","title":"1.1 \u9884\u671f\u76ee\u6807"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#12","text":"\u8be5\u9879\u76ee\u4e2d\u6240\u6709\u7684 CMake \u76ee\u6807\u5fc5\u987b\u5747\u4ee5 vl_ \u5f00\u5934\uff0c\u4f8b\u5982\u6587\u4ef6\u5939 a \u5bf9\u5e94\u7684\u76ee\u6807\u662f vl_a \uff0c\u8be5\u9879\u76ee\u7684\u6587\u4ef6\u7ed3\u6784\u5982\u4e0b ``` :collapsed-lines . \u251c\u2500\u2500 modules \u2502 \u251c\u2500\u2500 a \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 visionlib \u2502 \u2502 \u2502 \u2514\u2500\u2500 a.hpp \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u251c\u2500\u2500 a1.cpp \u2502 \u2502 \u2514\u2500\u2500 a2.cpp \u2502 \u251c\u2500\u2500 b \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 visionlib \u2502 \u2502 \u2502 \u2514\u2500\u2500 b.hpp \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u251c\u2500\u2500 b1.cpp \u2502 \u2502 \u251c\u2500\u2500 b2.cpp \u2502 \u2502 \u251c\u2500\u2500 b3.cpp \u2502 \u2502 \u2514\u2500\u2500 b4.cpp \u2502 \u251c\u2500\u2500 c \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 visionlib \u2502 \u2502 \u2502 \u2514\u2500\u2500 c.hpp \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 c.cpp \u2502 \u2514\u2500\u2500 d \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2514\u2500\u2500 visionlib \u2502 \u2502 \u2514\u2500\u2500 d.hpp \u2502 \u2514\u2500\u2500 src \u2502 \u251c\u2500\u2500 d1.cpp \u2502 \u2514\u2500\u2500 d2.cpp \u2514\u2500\u2500 samples \u2514\u2500\u2500 demo.cpp 19 directories, 14 files ### 1.3 \u5206\u6790 - \u524d 3 \u4e2a\u9884\u671f\u76ee\u6807\u662f\u5173\u4e8e\u9879\u76ee\u7684\u8981\u6c42\uff0c\u53ef\u76f4\u63a5\u5728\u9879\u76ee\u6839\u76ee\u5f55\u7684 `CMakeLists.txt` \u4e2d\u5b9e\u73b0 - \u7b2c 4 \u5230\u7b2c 6 \u4e2a\u9884\u671f\u76ee\u6807\u662f\u5173\u4e8e\u9879\u76ee\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u53ef\u5728\u6bcf\u4e2a\u6a21\u5757\u7684 `CMakeLists.txt` \u4e2d\u5b9e\u73b0 - \u6bcf\u4e2a\u6a21\u5757\u5747\u6d89\u53ca\u5230\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\u6dfb\u52a0\u3001\u6e90\u6587\u4ef6\u7f16\u8bd1\u3001\u5e93\u6587\u4ef6\u94fe\u63a5\u3001\u4f9d\u8d56\u5e93\u6dfb\u52a0\u3001\u5b89\u88c5\u76ee\u6807\u7b49\u64cd\u4f5c\uff0c\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u5185\u5bb9\u5c01\u88c5\u5230\u4e00\u4e2a\u51fd\u6570\u4e2d\uff0c\u7136\u540e\u5728\u6bcf\u4e2a\u6a21\u5757\u7684 `CMakeLists.txt` \u4e2d\u8c03\u7528 ### 1.4 \u5b9e\u73b0 \u5728\u9879\u76ee\u4e2d\u6dfb\u52a0 - `CMakeLists.txt` \u2014\u2014 \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `cmake/VisionLibInstall.cmake` \u2014\u2014 \u9879\u76ee\u7684\u5b89\u88c5\u8def\u5f84\u914d\u7f6e\u6587\u4ef6 - `cmake/VisionLibModule.cmake` \u2014\u2014 \u9879\u76ee\u7684 CMake \u51fd\u6570\u5e93\uff0c\u4e3b\u8981\u6d89\u53ca\u5230\u76ee\u6807\u7684\u4fbf\u6377\u521b\u5efa - `cmake/templates/VisionLibConfig.cmake.in` \u2014\u2014 \u9879\u76ee\u5728 `find_package` \u65f6\u9700\u8981\u7684\u914d\u7f6e\u6587\u4ef6\u6a21\u677f - `modules/CMakeLists.txt` \u2014\u2014 \u9879\u76ee\u7684\u6a21\u5757\u5217\u8868 - `modules/a/CMakeLists.txt` \u2014\u2014 \u6a21\u5757 `a` \u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `modules/b/CMakeLists.txt` \u2014\u2014 \u6a21\u5757 `b` \u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `modules/c/CMakeLists.txt` \u2014\u2014 \u6a21\u5757 `c` \u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `modules/d/CMakeLists.txt` \u2014\u2014 \u6a21\u5757 `d` \u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `samples/CMakeLists.txt` \u2014\u2014 \u793a\u4f8b\u7a0b\u5e8f\u7684 CMake \u914d\u7f6e\u6587\u4ef6 \u5171 10 \u4e2a\u6587\u4ef6\u3002 #### 1.4.1 \u9879\u76ee\u914d\u7f6e ::: code-tabs @tab CMakeLists.txt ```cmake :collapsed-lines cmake_minimum_required(VERSION 3.10) project(VisionLib) # ---------------------------------------------------------------------------- # \u914d\u7f6e\u9879\u76ee # ---------------------------------------------------------------------------- set(CMAKE_CXX_STANDARD 17) set(CMAKE_CXX_STANDARD_REQUIRED ON) find_package(OpenCV 4 REQUIRED) option(BUILD_SHARED_LIBS \"Build shared libraries?\" OFF) include(cmake/VisionLibInstall.cmake) include(cmake/VisionLibModule.cmake) # ---------------------------------------------------------------------------- # \u5c06\u5b50\u76ee\u5f55\u6dfb\u52a0\u5230\u6784\u5efa\u7cfb\u7edf\u4e2d # ---------------------------------------------------------------------------- add_subdirectory(modules) add_subdirectory(samples) # ---------------------------------------------------------------------------- # \u5bfc\u51fa\u3001\u5b89\u88c5\u914d\u7f6e # ---------------------------------------------------------------------------- install( EXPORT VisionLibTargets FILE VisionLibTargets.cmake DESTINATION ${VL_CFG_INSTALL_PATH} # VL_CFG_INSTALL_PATH \u5b9a\u4e49\u4e8e VisionLibInstall.cmake \u4e2d ) configure_file( cmake/templates/VisionLibConfig.cmake.in \"${CMAKE_CURRENT_BINARY_DIR}/VisionLibConfig.cmake\" @ONLY ) install( FILES \"${CMAKE_CURRENT_BINARY_DIR}/VisionLibConfig.cmake\" DESTINATION ${VL_CFG_INSTALL_PATH} ) @tab VisionLibInstall.cmake # \u5b89\u88c5\u8def\u5f84\u76f8\u5173\u914d\u7f6e set(CMAKE_INSTALL_PREFIX \"/usr/local\") set(VL_INSTALL_PATH \"${CMAKE_INSTALL_PREFIX}\") set(VL_INC_INSTALL_PATH \"include/VisionLib\") set(VL_LIB_INSTALL_PATH \"lib\") set(VL_CFG_INSTALL_PATH \"${VL_LIB_INSTALL_PATH}/cmake/VisionLib\") @tab VisionLibModule.cmake ```cmake :collapsed-lines","title":"1.2 \u8981\u6c42\u4e0e\u6587\u4ef6\u7ed3\u6784"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#visionlibconfigcmake","text":"set(VL_LIB_COMPONENTS \"\" CACHE INTERNAL \"VisionLib components\")","title":"\u7528\u4e8e\u6536\u96c6\u6240\u6709\u9700\u8981\u53c2\u4e0e\u6784\u5efa\u7684\u6a21\u5757\uff0c\u7ed9 VisionLibConfig.cmake \u4f7f\u7528"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#visionlib","text":"","title":"\u66f4\u65b0 VisionLib \u76ee\u6807\u6784\u5efa\u7684\u6807\u5fd7\u4f4d\uff0c\u7528\u4e8e\u63a7\u5236\u662f\u5426\u6784\u5efa\u6307\u5b9a\u6a21\u5757\uff0c\u4e0d\u5f71\u54cd\u7528\u6237\u7684\u9009\u62e9"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-build_xxx_init","text":"","title":"- \u4e3b\u8981\u66f4\u65b0 BUILD_xxx_INIT \u53d8\u91cf"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-build_xxx_init-on-off","text":"","title":"- \u5728\u6ee1\u8db3\u6761\u4ef6\u65f6\uff0c\u8bbe\u7f6e BUILD_xxx_INIT \u4e3a ON\uff0c\u5426\u5219\u4e3a OFF"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_2","text":"","title":"\u7528\u6cd5:"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#vl_update_build-condition","text":"","title":"vl_update_build( [CONDITION])"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_3","text":"","title":"\u793a\u4f8b:"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#vl_update_buildd-off","text":"","title":"vl_update_build(d OFF)"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_1","text":"macro(vl_update_build name) if(${ARGN}) set(BUILD ${ name}_INIT ON) else() set(BUILD ${_name}_INIT OFF) endif() endmacro()","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_2","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_4","text":"","title":"\u6dfb\u52a0\u6a21\u5757"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_5","text":"","title":"\u7528\u6cd5\uff1a"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#vl_add_module","text":"","title":"vl_add_module("},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#depends-vl_","text":"","title":"[DEPENDS ...] # \u4ee5 vl_ \u5f00\u5934\u7684\u6a21\u5757\u540d"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#ext_depends","text":"","title":"[EXT_DEPENDS ...] # \u5916\u90e8\u4f9d\u8d56"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_6","text":"","title":")"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_7","text":"","title":"\u793a\u4f8b\uff1a"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#vl_add_modulea","text":"","title":"vl_add_module(a"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#depends-b-c","text":"","title":"DEPENDS b c"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#ext_depends-opencv_core","text":"","title":"EXT_DEPENDS opencv_core"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_8","text":"","title":")"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_3","text":"macro(vl_add_module name) # \u5224\u65ad\u662f\u5426\u53c2\u4e0e\u6784\u5efa if(NOT DEFINED BUILD ${ name}_INIT) set(BUILD ${ name}_INIT ON) endif() option(BUILD ${ name} \"Include ${_name} module into the VisionLib build\" ${BUILD ${_name}_INIT} ) # create option to enable/disable this module if(BUILD_${ name}) # \u4ee5 vl \u5f00\u5934\u7684\u6a21\u5757\u540d\uff0c\u4f8b\u5982 vl_add_module(a) \u4f1a\u751f\u6210 vl_a set(module_name vl_${ name}) # \u89e3\u6790\u53c2\u6570 set(multi_args DEPENDS EXT_DEPENDS) cmake_parse_arguments(VLMD \"\" \"\" \"${multi_args}\" ${ARGN}) # \u521b\u5efa\u76ee\u6807 aux_source_directory(src target_src) add_library(${module_name} ${target_src}) # \u6dfb\u52a0\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\uff0c\u53ef\u53c2\u8003\u301009\u3011\u751f\u6210\u5668\u8868\u8fbe\u5f0f target_include_directories(${module_name} PUBLIC $ $ # VL_INC_INSTALL_PATH \u5b9a\u4e49\u4e8e VisionLibInstall.cmake \u4e2d ) # \u6dfb\u52a0\u4f9d\u8d56 target_link_libraries( ${module_name} PUBLIC ${VLMD_EXT_DEPENDS} ) foreach(m ${VLMD_DEPENDS}) target_link_libraries( ${module_name} PUBLIC vl ${m} ) endforeach() # \u5b89\u88c5\u76ee\u6807 install( DIRECTORY include/visionlib DESTINATION ${VL_INC_INSTALL_PATH} ) install( TARGETS ${module_name} EXPORT VisionLibTargets LIBRARY DESTINATION ${VL_LIB_INSTALL_PATH} ARCHIVE DESTINATION ${VL_LIB_INSTALL_PATH} ) set(VL_LIB_COMPONENTS ${VL_LIB_COMPONENTS} \"${module_name}\" CACHE INTERNAL \"VisionLib components\") unset(module_name) endif() endmacro()","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_4","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_9","text":"","title":"\u6dfb\u52a0\u793a\u4f8b\u7a0b\u5e8f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_10","text":"","title":"\u7528\u6cd5\uff1a"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#vl_add_exe","text":"","title":"vl_add_exe("},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#sources","text":"","title":"SOURCES ... # \u6e90\u6587\u4ef6"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#depends-vl__1","text":"","title":"[DEPENDS ...] # \u4ee5 vl_ \u5f00\u5934\u7684\u6a21\u5757\u540d"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#ext_depends_1","text":"","title":"[EXT_DEPENDS ...] # \u5916\u90e8\u4f9d\u8d56"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_11","text":"","title":")"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_12","text":"","title":"\u793a\u4f8b\uff1a"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#vl_add_exedemo","text":"","title":"vl_add_exe(demo"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#sources-democpp","text":"","title":"SOURCES demo.cpp"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#depends-a-b","text":"","title":"DEPENDS a b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#ext_depends-opencv_highgui","text":"","title":"EXT_DEPENDS opencv_highgui"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_13","text":"","title":")"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_5","text":"macro(vl_add_exe name) # \u5224\u65ad\u662f\u5426\u53c2\u4e0e\u6784\u5efa if(NOT DEFINED BUILD ${ name}_INIT) set(BUILD ${ name}_INIT ON) endif() option(BUILD ${ name} \"Include ${_name} module into the VisionLib build\" ${BUILD ${_name}_INIT} ) # create option to enable/disable this module if(BUILD_${ name}) set(module_name vl ${ name}) set(multi_args SOURCES DEPENDS EXT_DEPENDS) cmake_parse_arguments(VLMD \"\" \"\" \"${multi_args}\" ${ARGN}) if(NOT VLMD_SOURCES) message(FATAL_ERROR \"No sources provided for executable ${module_name}\") endif() add_executable(${module_name} ${VLMD_SOURCES}) target_link_libraries( ${module_name} PRIVATE ${VLMD_EXT_DEPENDS} ) foreach(m ${VLMD_DEPENDS}) target_link_libraries( ${module_name} PRIVATE vl ${m} ) endforeach() install( TARGETS ${module_name} RUNTIME DESTINATION bin ) unset(module_name) endif() endmacro() ::: #### 1.4.2 \u6a21\u5757\u914d\u7f6e ::: code-tabs @tab `modules` ```cmake set(cur_path \"${CMAKE_CURRENT_SOURCE_DIR}\") file(GLOB modules RELATIVE \"${cur_path}\" \"${cur_path}/*\") foreach(m ${modules}) if(IS_DIRECTORY ${cur_path}/${m}) add_subdirectory(${cur_path}/${m}) endif() endforeach() # \u7b80\u5355\u8d77\u89c1\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5199 # add_subdirectory(a) # add_subdirectory(b) # add_subdirectory(c) # add_subdirectory(d) @tab modules/a vl_add_module(a) @tab modules/b vl_add_module(b DEPENDS d EXT_DEPENDS opencv_imgproc ) @tab modules/c vl_add_module(c DEPENDS a EXT_DEPENDS opencv_core ) @tab modules/d vl_add_module(d DEPENDS b c ) :::","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#143","text":"::: code-tabs @tab samples/CMakeLists.txt ```cmake :collapsed-lines vl_add_exe(demo SOURCES demo.cpp DEPENDS d EXT_DEPENDS opencv_highgui ) ::: #### 1.4.4 VisionLibConfig.cmake.in \u914d\u7f6e \u82e5\u5bf9\u8be5\u6587\u4ef6\u6709\u7591\u95ee\uff0c\u8bf7\u53c2\u8003[\u6b64\u5904](10.md#_4-xxxconfig-cmake-\u6587\u4ef6\u7684\u4e00\u822c\u5199\u6cd5)\u3002 ::: code-tabs @tab VisionLibConfig.cmake.in ```cmake :collapsed-lines # ---------------------------------------------------------------------------- # VisionLib CMake \u914d\u7f6e\u6587\u4ef6 # # ** \u8be5\u6587\u4ef6\u7531 CMake \u751f\u6210\uff0c\u8bf7\u52ff\u624b\u52a8\u4fee\u6539 ** # # \u57fa\u672c\u7528\u6cd5\uff1a # find_package(VisionLib REQUIRED) # target_link_libraries(your_target PRIVATE vl_a vl_b ...) # ---------------------------------------------------------------------------- # ---------------------------------------------------------------------------- # \u83b7\u53d6 VisionLib \u5b89\u88c5\u8def\u5f84 # ---------------------------------------------------------------------------- get_filename_component(VL_CONFIG_PATH \"${CMAKE_CURRENT_LIST_FILE}\" PATH ) set(VL_INSTALL_PATH \"@VL_INSTALL_PATH@\") # ---------------------------------------------------------------------------- # \u8bbe\u7f6e\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\u53d8\u91cf # ---------------------------------------------------------------------------- set(VisionLib_INCLUDE_DIRS \"${VL_INSTALL_PATH}/@VL_INC_INSTALL_PATH@\") # ---------------------------------------------------------------------------- # \u8bbe\u7f6e\u5e93\u6587\u4ef6\u8def\u5f84\u53d8\u91cf # ---------------------------------------------------------------------------- set(VisionLib_LIBS @VL_LIB_COMPONENTS@) if(NOT TARGET vl_a) include(\"${VL_CONFIG_PATH}/VisionLibTargets.cmake\") endif() # ---------------------------------------------------------------------------- # \u641c\u5bfb\u7684\u7ed3\u679c\u3001\u72b6\u6001 # ---------------------------------------------------------------------------- include(FindPackageHandleStandardArgs) find_package_handle_standard_args(VisionLib REQUIRED_VARS VL_INSTALL_PATH ) :::","title":"1.4.3 \u793a\u4f8b\u7a0b\u5e8f\u914d\u7f6e"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#15-thinking","text":"\u7528\u6237\u5728\u4f7f\u7528 VisionLib \u4e2d\u7684 vl_d \u76ee\u6807\u7684\u65f6\u5019\u4e00\u822c\u5728\u9879\u76ee\u4e2d\u4f1a\u5199\u4e0a add_executable(demo main.cpp) find_package(VisionLib REQUIRED) target_link_libraries(demo PRIVATE vl_d) \u4f46\u662f\u8fd9\u65f6\u5019\u7f16\u8bd1\u4f1a\u51fa\u73b0\u5f62\u5982\u4ee5\u4e0b\u5185\u5bb9\u7684\u62a5\u9519 [ 50%] Building CXX object CMakeFiles/demo.dir/main.cpp.o In file included from /usr/local/include/VisionLib/visionlib/d.hpp:3, from /path/to/vl_deploy_demo/main.cpp:1: /usr/local/include/VisionLib/visionlib/c.hpp:5:10: fatal error: opencv2/core.hpp: No such file or directory 5 | #include <opencv2/core.hpp> | ^~~~~~~~~~~~~~~~~~ compilation terminated. make[2]: *** [CMakeFiles/demo.dir/build.make:76\uff1aCMakeFiles/demo.dir/main.cpp.o] error 1 make[1]: *** [CMakeFiles/Makefile2:83\uff1aCMakeFiles/demo.dir/all] error 2 make: *** [Makefile:91\uff1aall] error 2 \u8bf7\u5206\u6790\u51fa\u73b0\u8be5\u95ee\u9898\u7684\u539f\u56e0\u4ee5\u53ca\u89e3\u51b3\u65b9\u6cd5\u3002 \u7b54\u6848 \u3010\u70b9\u6b64\u67e5\u770b\u3011","title":"1.5 \u601d\u8003 :thinking:"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#2","text":"C/C++ \u4e00\u4e2a\u9971\u53d7\u8bdf\u75c5\u7684\u8bdd\u9898\u5c31\u662f\u5305\u7ba1\u7406\uff0c\u4e00\u4e9b\u73b0\u4ee3\u7684\u8bed\u8a00\u90fd\u5177\u6709\u6bd4\u8f83\u5b8c\u5584\u7684\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u4f8b\u5982 Python \u7684 pip \u3001Node.js \u7684 npm \u548c yarn \u3001Rust \u7684 cargo \u7b49\uff0c\u800c C/C++ \u6ca1\u6709\u4e00\u4e2a\u7edf\u4e00\u7684\u3001\u5b98\u65b9\u7684\u5305\u7ba1\u7406\u5de5\u5177\uff0c\u5bfc\u81f4\u4e86 C/C++ \u9879\u76ee\u7684\u4f9d\u8d56\u7ba1\u7406\u975e\u5e38\u56f0\u96be\u3002CMake \u63d0\u4f9b\u4e86 FetchContent \u548c ExternalProject \u6a21\u5757\uff0c\u53ef\u4ee5\u7528\u4e8e\u7ba1\u7406\u9879\u76ee\u7684\u5916\u90e8\u4f9d\u8d56\uff0c\u76f8\u6bd4\u4e8e\u624b\u52a8\u4e0b\u8f7d\u3001\u7f16\u8bd1\u3001\u5b89\u88c5\uff0c FetchContent \u548c ExternalProject \u5df2\u7ecf\u5c3d\u53ef\u80fd\u7684\u7b80\u5316\u4e86\u8fd9\u4e2a\u8fc7\u7a0b\u3002 ExternalProject \u7528\u4e8e\u5728\u6784\u5efa\u8fc7\u7a0b\u4e2d\u4e0b\u8f7d\u3001\u914d\u7f6e\u3001\u6784\u5efa\u548c\u5b89\u88c5\u5916\u90e8\u9879\u76ee\u3002\u5b83\u901a\u5e38\u7528\u4e8e\u5904\u7406\u5927\u578b\u7684\u3001\u72ec\u7acb\u7684\u5916\u90e8\u9879\u76ee\u3002\u800c FetchContent \u7528\u4e8e\u5728\u914d\u7f6e\u9636\u6bb5\u4e0b\u8f7d\u548c\u6dfb\u52a0\u5916\u90e8\u9879\u76ee\u7684\u6e90\u4ee3\u7801\u3002\u5b83\u9002\u7528\u4e8e\u9700\u8981\u5c06\u5916\u90e8\u9879\u76ee\u7684\u6e90\u4ee3\u7801\u76f4\u63a5\u96c6\u6210\u5230\u4e3b\u9879\u76ee\u4e2d\u7684\u60c5\u51b5\u3002\u540e\u6587\u5c06\u4e3b\u8981\u4ecb\u7ecd FetchContent \u7684\u4f7f\u7528\uff0c ExternalProject \u7684\u4f7f\u7528\u53ef\u4ee5\u53c2\u8003 \u5b98\u65b9\u6587\u6863 \u3002","title":"2. \u5916\u90e8\u4f9d\u8d56\u7ba1\u7406"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#21-fetchcontent","text":"FetchContent \u4f9d\u8d56\u7ba1\u7406\u5b9a\u4e49\u4e8e FetchContent CMake \u6a21\u5757\u4e2d\uff0c\u53ef\u4f7f\u7528 include(FetchContent) \u6765\u5f15\u5165\u3002 FetchContent \u6a21\u5757\u63d0\u4f9b\u4e86 FetchContent_Declare \u3001 FetchContent_MakeAvailable \u7b49\u51fd\u6570\uff0c\u7528\u4e8e\u4e0b\u8f7d\u3001\u89e3\u538b\u3001\u914d\u7f6e\u3001\u7f16\u8bd1\u3001\u5b89\u88c5\u5916\u90e8\u9879\u76ee\u3002","title":"2.1 FetchContent"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#211-fetchcontent_declare","text":"\u2014\u2014 \u58f0\u660e\u5916\u90e8\u4f9d\u8d56\u9879 FetchContent_Declare( <name> <contentOptions>... [EXCLUDE_FROM_ALL] # add in CMake 3.28 [SYSTEM] # add in CMake 3.25 [OVERRIDE_FIND_PACKAGE | FIND_PACKAGE_ARGS args...] # add in CMake 3.24 ) \u4e0a\u8ff0\u58f0\u660e\u7684\u53ef\u9009\u9879\u5747\u4e0d\u662f\u5f88\u91cd\u8981\uff0c\u91cd\u8981\u7684\u662f <contentOptions> \u3002\u4ee5\u4e0b\u662f\u4f7f\u7528 FetchContent_Declare \u58f0\u660e googletest \u9879\u76ee\u7684\u793a\u4f8b\uff0c\u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u5f0f\u58f0\u660e\u5916\u90e8\u4f9d\u8d56\u9879\uff0c\u4e00\u79cd\u662f\u4f7f\u7528 Git \u5b58\u50a8\u5e93\u4f5c\u4e3a\u5916\u90e8\u4f9d\u8d56\u9879\uff0c\u53e6\u4e00\u79cd\u662f\u4f7f\u7528 URL \u5730\u5740\u4f5c\u4e3a\u5916\u90e8\u4f9d\u8d56\u9879\u3002 ::: code-tabs @tab \u4f7f\u7528 Git \u5b58\u50a8\u5e93 FetchContent_Declare( googletest GIT_REPOSITORY https://github.com/google/googletest.git GIT_TAG 703bd9caab50b139428cea1aaff9974ebee5742e # release-1.10.0 ) # GIT_REPOSITORY: \u8868\u793a\u5916\u90e8\u4f9d\u8d56\u9879\u7684 Git \u4ed3\u5e93\u5730\u5740\uff1b # GIT_TAG: \u8868\u793a\u5916\u90e8\u4f9d\u8d56\u9879\u7684 Git \u4ed3\u5e93\u7684\u6807\u7b7e\uff0c\u53ef\u4ee5\u662f\u5206\u652f\u540d\u3001\u6807\u7b7e\u540d\u3001\u63d0\u4ea4\u54c8\u5e0c\u7b49\uff0c # \u4f46\u5efa\u8bae\u662f\u7a33\u5b9a\u7684\u6807\u7b7e\u540d\u9632\u6b62\u4e0d\u7a33\u5b9a\u7684\u4ee3\u7801\u8fdb\u5165\u9879\u76ee\u3002 @tab \u4f7f\u7528 URL \u5730\u5740 FetchContent_Declare( googletest URL https://github.com/google/googletest/archive/main.zip ) # URL: \u8868\u793a\u5916\u90e8\u4f9d\u8d56\u9879\u7684 URL \u5730\u5740\u3002 :::","title":"2.1.1 FetchContent_Declare"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#212-fetchcontent_makeavailable","text":"\u2014\u2014 \u4f7f\u5916\u90e8\u4f9d\u8d56\u9879\u751f\u6548\uff0c\u5e76\u52a0\u5165\u6784\u5efa\u7cfb\u7edf FetchContent_MakeAvailable(<name1> [<name2>...]) \u8be5\u547d\u4ee4\u4fdd\u8bc1\u5728\u8c03\u7528\u7ed3\u675f\u540e\uff0c\u6bcf\u4e2a\u547d\u540d\u7684\u4f9d\u8d56\u9879\u90fd\u53ef\u4f9b\u9879\u76ee\u4f7f\u7528\u3002\u4f8b\u5982\u4e0a\u6587\u7684 googletest \u9879\u76ee\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u4f7f\u7528\uff1a FetchContent_MakeAvailable(googletest) \u5982\u679c\u6709\u591a\u4e2a\u5916\u90e8\u4f9d\u8d56\u9879\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u4f7f\u7528\uff1a FetchContent_MakeAvailable(ext1 ext2 ext3) \u8be5\u547d\u4ee4\u5c06\u4f9d\u6b21\u914d\u7f6e ext1 \u3001 ext2 \u548c ext3 \u9879\u76ee","title":"2.1.2 FetchContent_MakeAvailable"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#213-fetchcontent","text":"\u6765\u81ea \u3010\u590d\u6742\u4f9d\u8d56\u3011 include(FetchContent) FetchContent_Declare( projB GIT_REPOSITORY git@mycompany.com:git/projB.git GIT_TAG 4a89dc7e24ff212a7b5167bef7ab079d ) FetchContent_Declare( projC GIT_REPOSITORY git@mycompany.com:git/projC.git GIT_TAG 4ad4016bd1d8d5412d135cf8ceea1bb9 ) FetchContent_Declare( projD GIT_REPOSITORY git@mycompany.com:git/projD.git GIT_TAG origin/integrationBranch ) # Order is important, see notes in the discussion further below FetchContent_MakeAvailable(projD projB projC)","title":"2.1.3 FetchContent \u793a\u4f8b"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#22","text":"\u73b0\u8ba1\u5212\u5f00\u53d1\u4e00\u4e2a Windows \u5e73\u53f0\u4e0b\u7684 OPC UA \u901a\u4fe1\u5e93 opcua \uff0c\u8be5\u5e93\u4f9d\u8d56\u4e8e open62541 [^1]\uff0c open62541 \u662f\u4e00\u4e2a\u5f00\u6e90\u7684 OPC UA \u534f\u8bae\u6808\uff0c\u63d0\u4f9b\u4e86 OPC UA \u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u7684 C \u8bed\u8a00\u5b9e\u73b0\u3002 opcua \u5e93\u7684\u5f00\u53d1\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u529f\u80fd\uff1a \u9700\u8981\u652f\u6301 C++17 \u6807\u51c6\uff1b \u5f3a\u5236\u4f9d\u8d56 open62541 \uff0c\u6ca1\u6709\u8be5\u5e93\u9700\u8981\u81ea\u52a8\u4e0b\u8f7d\u3001\u5e76\u6dfb\u52a0\u81f3\u9879\u76ee\u4e2d\uff0c\u5982\u679c\u662f\u81ea\u52a8\u4e0b\u8f7d\u7684 open62541 \uff0c\u90a3\u4e48 opcua \u5e93\u5728\u5b89\u88c5\u65f6\u9700\u8981\u5c06 open62541 ==\u4e00\u5e76\u5b89\u88c5==\uff1b open62541 \u7684\u914d\u7f6e\u8981\u6c42\u5982\u4e0b ==\u65e0\u9700==\u542f\u7528 UA_ENABLE_AMALGAMATION \u9009\u9879\uff1b \u5176\u4ed6\u9009\u9879\u9ed8\u8ba4\u5373\u53ef\uff1b \u9ed8\u8ba4\u4ee5\u9759\u6001\u5e93\u7684\u5f62\u5f0f\u6784\u5efa opcua \uff0c\u4f46\u5141\u8bb8\u7528\u6237\u901a\u8fc7 CMake \u9009\u9879\u8bbe\u7f6e\u6784\u5efa\u4e3a\u52a8\u6001\u5e93\uff1b opcua \u9879\u76ee\u7684\u5b89\u88c5\u76ee\u5f55\u4e3a D:\\opcua \uff0c\u5176\u4e2d \u5934\u6587\u4ef6\u5b89\u88c5\u5230 D:\\opcua\\include \uff1b \u9759\u6001\u5e93\u3001\u5bfc\u5165\u5e93\u6587\u4ef6\u5b89\u88c5\u5230 D:\\opcua\\x64\\vc16\\lib \uff1b \u52a8\u6001\u5e93\u6587\u4ef6\u5b89\u88c5\u5230 D:\\opcua\\x64\\vc16\\bin \uff08\u5982\u679c\u6784\u5efa\u4e3a\u52a8\u6001\u5e93\uff09\uff1b CMake \u76f8\u5173\u914d\u7f6e\u6587\u4ef6\u5b89\u88c5\u5230 D:\\opcua\\x64\\vc16\\bin \uff1b open62541 \u7684\u5b89\u88c5\u8981\u6c42\u7531 open62541Config.cmake \u6307\u5b9a\u4e86\uff0c\u5177\u4f53\u5b89\u88c5\u8def\u5f84\u4e0d\u505a\u8be6\u7ec6\u8bf4\u660e\uff0c\u53ea\u9700\u4fdd\u8bc1 open62541 \u7684\u5b89\u88c5\u8def\u5f84\u5728 D:\\opcua \u4e0b\u5373\u53ef\u3002","title":"2.2 \u9884\u671f\u76ee\u6807"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#23","text":"\u8be5\u9879\u76ee\u7684\u6587\u4ef6\u7ed3\u6784\u5982\u4e0b\uff0c\u53c2\u8003\u81ea rmvl_opcua \u6a21\u5757 \u3002 ``` :collapsed-lines . \u251c\u2500\u2500 include \u2502 \u251c\u2500\u2500 opcua \u2502 \u2502 \u251c\u2500\u2500 client.hpp \u2502 \u2502 \u251c\u2500\u2500 event.hpp \u2502 \u2502 \u251c\u2500\u2500 method.hpp \u2502 \u2502 \u251c\u2500\u2500 object.hpp \u2502 \u2502 \u251c\u2500\u2500 publisher.hpp \u2502 \u2502 \u251c\u2500\u2500 server.hpp \u2502 \u2502 \u251c\u2500\u2500 subscriber.hpp \u2502 \u2502 \u251c\u2500\u2500 utilities.hpp \u2502 \u2502 \u251c\u2500\u2500 variable.hpp \u2502 \u2502 \u2514\u2500\u2500 view.hpp \u2502 \u2514\u2500\u2500 opcua.hpp \u2514\u2500\u2500 src \u251c\u2500\u2500 client.cpp \u251c\u2500\u2500 cvt.hpp \u251c\u2500\u2500 helper.cpp \u251c\u2500\u2500 publisher.cpp \u251c\u2500\u2500 server.cpp \u2514\u2500\u2500 subscriber.cpp 6 directories, 19 files ### 2.4 \u5b9e\u73b0 \u5728\u9879\u76ee\u4e2d\u6dfb\u52a0 - `3rdparty/open62541/CMakeLists.txt` \u2014\u2014 `open62541` \u7684\u914d\u7f6e\u6587\u4ef6 - `CMakeLists.txt` \u2014\u2014 \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `cmake/opcuaInstall.cmake` \u2014\u2014 \u9879\u76ee\u7684\u5b89\u88c5\u8def\u5f84\u914d\u7f6e\u6587\u4ef6 - `cmake/opcuaConfig.cmake` \u2014\u2014 \u63d0\u4f9b\u7ed9\u7528\u6237\u5728 `find_package` \u65f6\u6240\u9700\u8981\u7684\u914d\u7f6e\u6587\u4ef6\uff08\u56e0\u4e3a\u6574\u4e2a\u9879\u76ee\u53ea\u6709\u4e00\u4e2a\u76ee\u6807\uff0c\u8fd9\u91cc\u5c31\u4e0d\u4f7f\u7528\u6a21\u677f\u6587\u4ef6\u4e86\uff09 \u5171 4 \u4e2a\u6587\u4ef6\uff0c\u5982\u4e0b\u6587\u4ef6\u7ed3\u6784\u6240\u793a . \u251c\u2500\u2500 3rdparty \u2502 \u2514\u2500\u2500 open62541 \u2502 \u2514\u2500\u2500 CMakeLists.txt (New) \u251c\u2500\u2500 CMakeLists.txt (New) \u251c\u2500\u2500 cmake \u2502 \u251c\u2500\u2500 opcuaConfig.cmake (New) \u2502 \u2514\u2500\u2500 opcuaInstall.cmake (New) \u251c\u2500\u2500 include \u2502 \u2514\u2500\u2500 ... \u2514\u2500\u2500 src \u2514\u2500\u2500 ... #### 2.4.1 \u9879\u76ee\u914d\u7f6e ::: code-tabs @tab CMakeLists.txt ```cmake :collapsed-lines # -------------------------------------------------------- # \u9879\u76ee\u914d\u7f6e # -------------------------------------------------------- cmake_minimum_required(VERSION 3.16) project(opcua) set(CMAKE_CXX_STANDARD 17) option(BUILD_SHARED_LIBS \"Build shared libraries?\" OFF) include(cmake/opcuaInstall.cmake) # -------------------------------------------------------- # \u5916\u90e8\u4f9d\u8d56\u7ba1\u7406 # -------------------------------------------------------- find_package(open62541 QUIET) if(NOT open62541_FOUND) add_subdirectory(3rdparty/open62541) endif() # -------------------------------------------------------- # \u76ee\u6807\u6784\u5efa # -------------------------------------------------------- aux_source_directory(src target_src) add_library(opcua ${target_src}) target_include_directories(opcua PUBLIC $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include> $<INSTALL_INTERFACE:include> ) target_link_libraries(opcua PUBLIC open62541::open62541 ) install( TARGETS opcua EXPORT opcuaTarget LIBRARY DESTINATION ${OPCUA_BIN_INSTALL_PATH} ARCHIVE DESTINATION ${OPCUA_LIB_INSTALL_PATH} RUNTIME DESTINATION ${OPCUA_BIN_INSTALL_PATH} INCLUDES DESTINATION ${OPCUA_INC_INSTALL_PATH} ) # -------------------------------------------------------- # \u5bfc\u51fa\u3001\u5b89\u88c5 # -------------------------------------------------------- install( EXPORT opcuaTarget FILE opcuaTarget.cmake DESTINATION ${OPCUA_CFG_INSTALL_PATH} ) install( FILES cmake/opcuaConfig.cmake DESTINATION ${OPCUA_CFG_INSTALL_PATH} ) @tab opcuaInstall.cmake set(CMAKE_INSTALL_PREFIX \"D:/opcua\") set(OPCUA_INSTALL_PATH \"${CMAKE_INSTALL_PREFIX}\") set(OPCUA_INC_INSTALL_PATH \"include\") set(OPCUA_LIB_INSTALL_PATH \"x64/vc16/lib\") set(OPCUA_BIN_INSTALL_PATH \"x64/vc16/bin\") # \u7406\u8bba\u4e0a\u8fd9\u4e2a\u8def\u5f84\u8981\u6839\u636e MSVC \u7248\u672c\u548c\u7cfb\u7edf\u67b6\u6784\u6765\u786e\u5b9a\uff0c\u8fd9\u91cc\u53ea\u662f\u4e3e\u4f8b\uff0c\u5c31\u4e0d\u505a\u989d\u5916\u5224\u65ad\u4e86 set(OPCUA_CFG_INSTALL_PATH \"${OPCUA_LIB_INSTALL_PATH}\") :::","title":"2.3 \u6587\u4ef6\u7ed3\u6784"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#242","text":"::: code-tabs @tab 3rdparty/open62541/CMakeLists.txt option(UA_ENABLE_AMALGAMATION \"Enable amalgamation\" OFF) FetchContent_Declare( open62541 GIT_REPOSITORY https://github.com/open62541/open62541.git GIT_TAG v1.4.8 ) FetchContent_MakeAvailable(open62541) :::","title":"2.4.2 \u5916\u90e8\u4f9d\u8d56\u914d\u7f6e"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#244-opcuaconfigcmake","text":"\u7531\u4e8e opcua \u9879\u76ee\u53ea\u6709\u4e00\u4e2a\u76ee\u6807\uff0c\u56e0\u6b64 opcuaConfig.cmake \u6587\u4ef6\u975e\u5e38\u7b80\u5355\uff0c\u65b9\u4fbf\u8d77\u89c1\u4e5f\u4e0d\u9700\u8981\u5411\u7528\u6237\u63d0\u4f9b\u8bf8\u5982 opcua_INCLUDE_DIRS \u548c opcua_LIBS \u8fd9\u6837\u7684\u96c6\u5408\u53d8\u91cf\uff0c\u56e0\u6b64 opcuaConfig.cmake \u53ea\u9700\u8981\u5b8c\u6210\u4ee5\u4e0b\u529f\u80fd\u5373\u53ef \u63d0\u4f9b CMake \u76ee\u6807\u53d8\u91cf\uff08\u5bfc\u5165 opcua \u76ee\u6807\uff09 \u63d0\u4f9b find_package \u641c\u7d22\u7684\u7ed3\u679c\u548c\u72b6\u6001 ::: code-tabs @tab opcuaConfig.cmake # ---------------------------------------------------------------------------- # opcua CMake \u914d\u7f6e\u6587\u4ef6 # # \u57fa\u672c\u7528\u6cd5\uff1a # find_package(opcua REQUIRED) # target_link_libraries(your_target PRIVATE opcua) # ---------------------------------------------------------------------------- if(NOT TARGET opcua) include(${CMAKE_CURRENT_LIST_DIR}/opcuaTarget.cmake) endif() include(FindPackageHandleStandardArgs) find_package_handle_standard_args(opcua) :::","title":"2.4.4 opcuaConfig.cmake \u914d\u7f6e"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#3","text":"CPU \u6709\u4e0d\u540c\u7684\u67b6\u6784\u3001\u6307\u4ee4\u96c6\uff0cC/C++ \u5f00\u53d1\u4e2d\u7684\u4ee3\u7801\u7f16\u8bd1\u540e\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5728\u4e0d\u540c\u7684 CPU \u4e0a\u76f4\u63a5\u8fd0\u884c\u65f6\u53ef\u80fd\u4f1a\u51fa\u73b0\u95ee\u9898\u3002\u5bf9\u6b64\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff1a \u5728\u76ee\u6807\u5e73\u53f0\u4e0a\u76f4\u63a5\u7f16\u8bd1\u4ee3\u7801\uff0c\u4f8b\u5982\u4e3a\u4e86\u5728 64 \u4f4d ARM \u5e73\u53f0\u4e0a\u8fd0\u884c\u4ee3\u7801\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728 aarch64 \u5e73\u53f0\u4e0a\u7f16\u8bd1\u4ee3\u7801\u3002\u4f46\u4e00\u822c\u6765\u8bf4\uff0cARM \u5e73\u53f0\u5e38\u89c1\u4e8e\u5d4c\u5165\u5f0f\u8bbe\u5907\uff0c\u8fd9\u7c7b\u8bbe\u5907\u53ef\u80fd\u7f3a\u5c11\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u5728\u6027\u80fd\u4e0a\u4e5f\u975e\u5e38\u6709\u9650\uff0c\u56e0\u6b64\u8fd9\u79cd\u65b9\u5f0f\u5e76\u4e0d\u9002\u7528\u4e8e\u6240\u6709\u60c5\u51b5\u3002 \u76f4\u63a5\u5728 PC \u4e0a\u7f16\u8bd1\u76ee\u6807\u5e73\u53f0\u7684\u4ee3\u7801\uff0c\u7136\u540e\u5c06\u7f16\u8bd1\u597d\u7684\u4ee3\u7801\u79fb\u690d\uff08\u590d\u5236\u7c98\u8d34\uff09\u5230\u76ee\u6807\u5e73\u53f0\u4e0a\u8fd0\u884c\u3002\u8fd9\u79cd\u65b9\u5f0f\u79f0\u4e3a==\u4ea4\u53c9\u7f16\u8bd1==\uff0c\u5728\u5d4c\u5165\u5f0f Linux \u5f00\u53d1\u4e2d\u975e\u5e38\u5e38\u89c1\uff0c\u4f8b\u5982\u5728 amd64 \u5e73\u53f0\u4e0a\u7f16\u8bd1 ARM \u5e73\u53f0\u7684\u4ee3\u7801\u3002","title":"3. \u4ea4\u53c9\u7f16\u8bd1\u9879\u76ee"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#31","text":"CMake \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u4ea4\u53c9\u7f16\u8bd1\u652f\u6301\uff0c\u800c\u4e14\u4ec5\u9700\u4e00\u4e2a==\u5de5\u5177\u94fe\u6587\u4ef6==\u5373\u53ef\u5b8c\u6210\u4ea4\u53c9\u7f16\u8bd1\u7684\u5de5\u4f5c\u3002\u5de5\u5177\u94fe\u6587\u4ef6\u662f\u4e00\u4e2a CMake \u811a\u672c\uff0c\u7528\u4e8e\u6307\u5b9a\u4ea4\u53c9\u7f16\u8bd1\u7684\u5de5\u5177\u94fe\uff0c\u4f8b\u5982\u7f16\u8bd1\u5668\u3001\u94fe\u63a5\u5668\u3001\u5e93\u6587\u4ef6\u8def\u5f84\u7b49\u3002\u5de5\u5177\u94fe\u6587\u4ef6\u6ca1\u6709\u4e25\u683c\u7684\u547d\u540d\u89c4\u5219\uff0c\u5c31\u5982\u540c\u666e\u901a\u7684 *.cmake \u6587\u4ef6\u4e00\u6837\uff0c\u4e0d\u8fc7\u4e00\u822c\u4e60\u60ef\u4e0a\u4f1a\u5728\u5de5\u5177\u94fe\u6587\u4ef6\u7684\u540d\u5b57\u4e2d\u63d0\u5230\u5e73\u53f0\u6216 toolchain \u5b57\u6837\uff0c\u5728 CMake \u914d\u7f6e\u8fc7\u7a0b\u4e2d\uff0c\u4f7f\u7528 -DCMAKE_TOOLCHAIN_FILE \u9009\u9879\u6307\u5b9a\u5de5\u5177\u94fe\u6587\u4ef6\uff0c\u4f8b\u5982 cmake -DCMAKE_TOOLCHAIN_FILE=toolchain-aarch64.cmake .. \u4e00\u822c\u6765\u8bf4\uff0c\u5de5\u5177\u94fe\u6587\u4ef6\u7684\u5185\u5bb9\u5982\u4e0b\uff1a # \u6307\u5b9a\u76ee\u6807\u7cfb\u7edf set(CMAKE_SYSTEM_NAME Linux) # \u6307\u5b9a\u76ee\u6807\u5904\u7406\u5668\u67b6\u6784 set(CMAKE_SYSTEM_PROCESSOR aarch64) # \u6307\u5b9a\u76ee\u6807\u7cfb\u7edf\u7684\u6839\u76ee\u5f55\uff0c\u5c06\u76f4\u63a5\u5f71\u54cd\u7f16\u8bd1\u5668\u548c\u94fe\u63a5\u5668\u7684\u884c\u4e3a set(CMAKE_SYSROOT \"/path/to/sysroot\") # \u6307\u5b9a C \u4ea4\u53c9\u7f16\u8bd1\u5668 set(CMAKE_C_COMPILER \"/path/to/arm-gcc\") # \u6307\u5b9a C++ \u4ea4\u53c9\u7f16\u8bd1\u5668 set(CMAKE_CXX_COMPILER \"/path/to/arm-g++\") # \u6307\u5b9a CMake \u67e5\u627e\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u4f8b\u5982 find_package set(CMAKE_FIND_ROOT_PATH \"/path/to/sysroot\") # \u4e0d\u67e5\u627e\u7a0b\u5e8f set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER) # \u53ea\u67e5\u627e\u5e93 set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY) # \u53ea\u67e5\u627e\u5934\u6587\u4ef6 set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)","title":"3.1 \u5de5\u5177\u94fe\u6587\u4ef6\u7684\u7f16\u5199"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#32","text":"\u73b0\u8ba1\u5212\u5f00\u53d1\u4e00\u4e2a EtherCAT \u534f\u8bae\u7684\u673a\u68b0\u81c2\u9a71\u52a8\u7a0b\u5e8f ec_robot \uff0c\u8be5\u7a0b\u5e8f\u9700\u8981\u5728 aarch64 \u67b6\u6784\u7684 Linux \u5e73\u53f0\u4e0b\u8fd0\u884c\uff0c ec_robot \u9879\u76ee\u7684\u5f00\u53d1\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u529f\u80fd\uff1a \u9700\u8981\u4f7f\u7528\u6307\u5b9a\u7684\u5de5\u5177\u94fe\u8fdb\u884c\u4ea4\u53c9\u7f16\u8bd1\uff0c\u76ee\u6807\u7cfb\u7edf\u6839\u76ee\u5f55\u5047\u8bbe\u5728 /home/ecdev/buildroot/host/ \u4e0b C \u4ea4\u53c9\u7f16\u8bd1\u5668\u4e3a aarch64-linux-gnu-gcc \uff0c\u4f4d\u4e8e\u76ee\u6807\u7cfb\u7edf\u6839\u76ee\u5f55\u7684 /usr/bin \u76ee\u5f55\u4e0b\uff1b C++ \u4ea4\u53c9\u7f16\u8bd1\u5668\u4e3a aarch64-linux-gnu-g++ \uff0c\u4f4d\u4e8e\u76ee\u6807\u7cfb\u7edf\u6839\u76ee\u5f55\u7684 /usr/bin \u76ee\u5f55\u4e0b\uff1b \u9700\u8981\u652f\u6301 C++17 \u6807\u51c6\uff1b \u5f3a\u5236\u4f9d\u8d56 IgH \u5b9e\u73b0\u7684 EtherCAT \u4e3b\u7ad9\u9a71\u52a8\u5e93\uff0c\u5bf9\u5e94\u7684\u914d\u7f6e\u6587\u4ef6\u5728 /home/ecdev/buildroot/host/usr/lib/cmake/ethercat \u4e0b\uff0c\u5bf9\u5e94\u7684\u76ee\u6807\u540d\u4e3a EtherLab::EtherCAT \uff1b ec_robot \u9879\u76ee==\u65e0\u9700==\u5b89\u88c5\uff0c\u53ea\u9700\u6784\u5efa\u5373\u53ef\u3002 \u6ca1\u6709\u590d\u6742\u7684\u6587\u4ef6\u7ed3\u6784\uff0c\u672c\u9879\u76ee\u53ea\u6709\u4e00\u4e2a src \u76ee\u5f55\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a . \u2514\u2500\u2500 src \u251c\u2500\u2500 ec_robot.cpp \u251c\u2500\u2500 ec_robot.hpp \u2514\u2500\u2500 main.cpp","title":"3.2 \u9884\u671f\u76ee\u6807"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#33","text":"\u9700\u8981\u5b9e\u73b0\u4e00\u4e2a\u5de5\u5177\u94fe\u6587\u4ef6 toolchain-aarch64.cmake \uff0c\u7528\u4e8e\u6307\u5b9a\u4ea4\u53c9\u7f16\u8bd1\u7684\u5de5\u5177\u94fe\uff1b EtherCATConfig.cmake \u6587\u4ef6\u5728 find_package \u7684 Config \u6a21\u5f0f\u80fd\u591f\u76f4\u63a5\u627e\u5230\u7684\u4f4d\u7f6e\uff0c\u524d\u63d0\u662f\u5de5\u5177\u94fe\u6587\u4ef6\u4e2d\u7684 CMAKE_FIND_ROOT_PATH \u8bbe\u7f6e\u6b63\u786e\uff1b \u9879\u76ee\u9664\u4e86\u5de5\u5177\u94fe\u6587\u4ef6\u5916\uff0c\u53ea\u9700\u8981\u4e00\u4e2a CMakeLists.txt \u6587\u4ef6\uff0c\u5e76\u4e14\u6784\u5efa\u65b9\u5f0f\u548c\u666e\u901a\u9879\u76ee\u4e00\u6837\u3002","title":"3.3 \u5206\u6790"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#34","text":"\u5728\u9879\u76ee\u4e2d\u6dfb\u52a0 platform/toolchain-aarch64.cmake \u2014\u2014 \u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u6587\u4ef6 CMakeLists.txt \u2014\u2014 \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMake \u914d\u7f6e\u6587\u4ef6 \u5171 2 \u4e2a\u6587\u4ef6\uff0c\u5982\u4e0b\u6587\u4ef6\u7ed3\u6784\u6240\u793a . \u251c\u2500\u2500 CMakeLists.txt (New) \u251c\u2500\u2500 src \u2502 \u251c\u2500\u2500 ec_robot.cpp \u2502 \u251c\u2500\u2500 ec_robot.hpp \u2502 \u2514\u2500\u2500 main.cpp \u2514\u2500\u2500 platform \u2514\u2500\u2500 toolchain-aarch64.cmake (New) ::: code-tabs @tab CMakeLists.txt ```cmake :collapsed-lines cmake_minimum_required(VERSION 3.16) project(ec_robot) set(CMAKE_CXX_STANDARD 17) find_package(EtherCAT REQUIRED) aux_source_directory(src target_src) add_executable(ec_robot ${target_src}) target_link_libraries(ec_robot PRIVATE EtherLab::EtherCAT ) @tab platform/toolchain-aarch64.cmake ```cmake set(CMAKE_SYSTEM_NAME Linux) set(CMAKE_SYSTEM_PROCESSOR aarch64) set(CMAKE_SYSROOT \"/home/ecdev/buildroot/host\") set(CMAKE_C_COMPILER \"/home/ecdev/buildroot/host/usr/bin/aarch64-linux-gnu-gcc\") set(CMAKE_CXX_COMPILER \"/home/ecdev/buildroot/host/usr/bin/aarch64-linux-gnu-g++\") set(CMAKE_FIND_ROOT_PATH \"/home/ecdev/buildroot/host\") set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER) set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY) set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY) ::: \u4e0d\u8981\u60ca\u8bb6\u4e3a\u4ec0\u4e48 CMakeLists.txt \u4e2d\u6ca1\u6709\u5f15\u7528\u5de5\u5177\u94fe\u6587\u4ef6\uff0c\u56e0\u4e3a\u4e60\u60ef\u4e0a\u4f1a\u5728 CMake \u6267\u884c\u914d\u7f6e\u751f\u6210\u8fc7\u7a0b\u65f6\u518d\u6307\u5b9a\u5de5\u5177\u94fe\u6587\u4ef6\u3002 \u6253\u5f00\u9879\u76ee\u6839\u76ee\u5f55\uff0c\u5728\u547d\u4ee4\u884c\u4e2d\u6267\u884c mkdir build cmake -B build -S . -DCMAKE_TOOLCHAIN_FILE=platform/toolchain-aarch64.cmake cmake --build build \u5373\u53ef\u5b8c\u6210\u7f16\u8bd1\u3002\u53ef\u80fd\u6709\u90e8\u5206\u8bfb\u8005\u6ca1\u6709\u89c1\u8fc7 -B \u548c -S \u9009\u9879\uff0c\u8fd9\u662f CMake 3.13 \u7248\u672c\u5f15\u5165\u7684 \u529f\u80fd \u3002 -B \u9009\u9879\u7528\u4e8e\u6307\u5b9a\u6784\u5efa\u76ee\u5f55\uff0c -S \u9009\u9879\u7528\u4e8e\u6307\u5b9a\u6e90\u7801\u76ee\u5f55\uff0c\u8fd9\u6837\u53ef\u4ee5\u5c06\u6784\u5efa\u76ee\u5f55\u548c\u6e90\u7801\u76ee\u5f55\u5206\u5f00\uff0c\u907f\u514d\u5728\u6e90\u7801\u76ee\u5f55\u4e2d\u751f\u6210\u6784\u5efa\u6587\u4ef6\u3002 \u7f16\u8bd1\u540e\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5728 build \u76ee\u5f55\u4e0b\uff0c\u53ef\u4ee5\u76f4\u63a5\u590d\u5236\u5230\u76ee\u6807\u5e73\u53f0\u4e0a\u8fd0\u884c\uff0c\u4f8b\u5982\u53ef\u4ee5\u4f7f\u7528 SSH \u5de5\u5177\u7684 scp \u547d\u4ee4\u5c06\u6587\u4ef6\u590d\u5236\u5230\u76ee\u6807\u5e73\u53f0\u4e0a\uff0c\u4f46\u8981\u786e\u4fdd\u76ee\u6807\u5e73\u53f0\u6709 libethercat.so \u7684\u5e93\u6587\u4ef6\uff0c\u5e76\u4e14\u4fdd\u8bc1\u590d\u5236\u540e\u7684\u53ef\u6267\u884c\u6587\u4ef6\u80fd\u591f\u627e\u5230\u3002","title":"3.4 \u5b9e\u73b0"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#4","text":"\u4ea4\u53c9\u7f16\u8bd1\u9879\u76ee\u867d\u7136\u6d89\u53ca\u5230\u4e0d\u540c\u7684\u5e73\u53f0\uff0c\u4f46\u662f\u53ea\u9700\u8981\u4e00\u4e2a\u5de5\u5177\u94fe\u6587\u4ef6\u5373\u53ef\uff0c\u56e0\u4e3a\u5927\u90e8\u5206\u4ea4\u53c9\u7f16\u8bd1\u9879\u76ee\u90fd\u53ea\u6d89\u53ca Linux \u5185\u6838\uff0c\u53ea\u4e0d\u8fc7\u6d89\u53ca\u5230\u4e0d\u540c\u7684 CPU \u67b6\u6784\u3001OS\u3001\u6587\u4ef6\u7cfb\u7edf\uff0c\u800c\u8de8\u5e73\u53f0\u9879\u76ee\u5219\u9700\u8981\u8003\u8651\u4e0d\u540c\u5e73\u53f0\u7684\u5dee\u5f02\uff0c\u4f8b\u5982 Windows \u548c Linux \u4e24\u4e2a\u5e73\u53f0\u7684\u5dee\u5f02\u5c31\u975e\u5e38\u5927\u3002 \u8de8\u5e73\u53f0\u662f\u9879\u76ee\u5f00\u53d1\u7684\u4e00\u4e2a\u91cd\u8981\u65b9\u5411\uff0c\u6309\u7167 ISO \u6807\u51c6\u7f16\u5199\u7684 C++ \u7a0b\u5e8f\u8de8\u5e73\u53f0\u6027\u8f83\u597d\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u5f80\u5f80\u4f1a\u4f7f\u7528\u4e00\u4e9b\u5e73\u53f0\u76f8\u5173\u6216\u8005\u662f\u7f16\u8bd1\u5668\u76f8\u5173\u7684 API\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e86\u8de8\u5e73\u53f0\u7684\u56f0\u96be\u3002\u4f7f\u7528 CMake \u5b8c\u6210\u8de8\u5e73\u53f0\u9879\u76ee\u7684\u5f00\u53d1\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\uff0cCMake \u63d0\u4f9b\u4e86\u5f88\u591a\u5de5\u5177\u548c\u51fd\u6570\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u8005\u66f4\u597d\u7684\u5b9e\u73b0\u8de8\u5e73\u53f0\u9879\u76ee\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u8de8\u5e73\u53f0\u9879\u76ee\u7684\u5f00\u53d1\u9700\u8981\u8003\u8651\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a \u7f16\u8bd1\u5668\u7684\u7f16\u8bd1\u9009\u9879\u4e0d\u540c\uff0c\u4f8b\u5982\u7528\u4e8e\u63a7\u5236 C++ \u8bed\u8a00\u6807\u51c6\u7684\u9009\u9879\uff0c\u5728 GCC \u4e2d\u662f -std=c++<ver> \uff0c\u5728 MSVC \u4e2d\u662f /std:c++<ver> \uff1b ::: important \u4e0d\u8fc7\u5728 CMake \u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 CMAKE_CXX_STANDARD \u53d8\u91cf\u6765\u6307\u5b9a C++ \u6807\u51c6\uff0cCMake \u4f1a\u6839\u636e\u4e0d\u540c\u7684\u7f16\u8bd1\u5668\u81ea\u52a8\u9009\u62e9\u6b63\u786e\u7684\u7f16\u8bd1\u9009\u9879\uff0c\u8fd9\u91cc\u53ea\u662f\u4e3e\u4e2a\u4f8b\u5b50\u3002 ::: \u4e0d\u540c\u5e73\u53f0\u7684\u5e93\u6587\u4ef6\u540e\u7f00\u540d\u4e0d\u540c\uff0c\u4f8b\u5982 Windows \u4e0b\u7684\u9759\u6001\u5e93\u6587\u4ef6\u540e\u7f00\u540d\u662f *.lib \uff0cLinux \u4e0b\u7684\u9759\u6001\u5e93\u6587\u4ef6\u540e\u7f00\u540d\u662f *.a \uff0c\u5e76\u4e14\u5e93\u6587\u4ef6\u7684\u7ec4\u7ec7\u65b9\u5f0f\u4e5f\u4e0d\u540c\uff0cWindows \u4e0b\u5728\u94fe\u63a5\u52a8\u6001\u5e93\u65f6\u9700\u8981\u4f7f\u7528\u5bfc\u5165\u5e93 *.lib \uff0cLinux \u4e0b\u5728\u94fe\u63a5\u52a8\u6001\u5e93\u65f6\u5219\u76f4\u63a5\u4f7f\u7528\u52a8\u6001\u5e93 *.so \u3002 \u9ed8\u8ba4\u5b89\u88c5\u8def\u5f84\u4e0d\u540c\uff0cWindows \u4e0b\u7684\u9ed8\u8ba4\u5b89\u88c5\u8def\u5f84\u662f C:\\Program Files \uff0cLinux \u4e0b\u7684\u9ed8\u8ba4\u5b89\u88c5\u8def\u5f84\u662f /usr/local \uff0c\u4f46 Windows \u4e0d\u5efa\u8bae\u76f4\u63a5\u5b89\u88c5\u5230 C:\\Program Files \uff0c\u800c Linux \u5219\u6ca1\u6709\u8fc7\u591a\u7684\u9650\u5236\u3002","title":"4. \u8de8\u5e73\u53f0\u9879\u76ee"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#41","text":"\u73b0\u8ba1\u5212\u5f00\u53d1\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u57fa\u7840\u6570\u503c\u7b97\u6cd5\u548c\u6700\u4f18\u5316\u5e93 numopt \uff0c\u8be5\u5e93\u9700\u8981\u652f\u6301 Windows \u548c Linux \u4e24\u4e2a\u5e73\u53f0\uff0c numopt \u9879\u76ee\u7684\u5f00\u53d1\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u529f\u80fd\uff1a \u9700\u8981\u652f\u6301 C++17 \u6807\u51c6\uff1b \u9ed8\u8ba4\u4ee5\u9759\u6001\u5e93\u7684\u5f62\u5f0f\u6784\u5efa numopt \uff0c\u4f46\u5141\u8bb8\u7528\u6237\u901a\u8fc7 CMake \u9009\u9879\u8bbe\u7f6e\u6784\u5efa\u4e3a\u52a8\u6001\u5e93\uff1b \u5e93\u5305\u542b\u4e86 core \u3001 num \u548c opt 3 \u4e2a\u6a21\u5757\u548c numopt_version 1 \u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5176\u4e2d num \u548c opt \u4f9d\u8d56 core \u6a21\u5757\uff0c numopt_version \u4f9d\u8d56 core \u6a21\u5757\uff1b numopt \u9879\u76ee\u7684\u9ed8\u8ba4\u5b89\u88c5\u76ee\u5f55\u5982\u4e0b \u5185\u5bb9 Window \u5b89\u88c5\u8def\u5f84 Linux \u5b89\u88c5\u8def\u5f84 \u9879\u76ee\u6839\u76ee\u5f55 ${CMAKE_BINARY_DIR}/install \u8bb0\u4f5c <prefix> /usr/local \u8bb0\u4f5c <prefix> \u5934\u6587\u4ef6 <prefix>\\include <prefix>/include/numopt \u53ef\u6267\u884c\u6587\u4ef6 <prefix>\\x64\\vc16\\bin <prefix>/bin \u9759\u6001\u5e93\u6587\u4ef6 <prefix>\\x64\\vc16\\lib <prefix>/lib \u52a8\u6001\u5e93\u6587\u4ef6 <prefix>\\x64\\vc16\\bin <prefix>/lib \u5bfc\u5165\u5e93\u6587\u4ef6 <prefix>\\x64\\vc16\\lib \u2014\u2014 CMake \u914d\u7f6e\u6587\u4ef6 <prefix>\\x64\\vc16\\lib <prefix>/lib/cmake/numopt \u9700\u8981\u63d0\u4f9b uninstall \u76ee\u6807\uff0c\u7528\u4e8e\u5378\u8f7d\u5df2\u5b89\u88c5\u7684\u6587\u4ef6\uff0c\u5728\u6267\u884c shell cmake --build . --target uninstall \u540e\uff0c\u5b89\u88c5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u90fd\u4f1a\u88ab\u5220\u9664\u3002 \u6587\u4ef6\u7ed3\u6784\u5982\u4e0b\uff1a ``` :collapsed-lines . \u251c\u2500\u2500 modules \u2502 \u251c\u2500\u2500 core \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u251c\u2500\u2500 num \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2514\u2500\u2500 opt \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2514\u2500\u2500 src \u2502 \u2514\u2500\u2500 ... \u2514\u2500\u2500 samples \u2514\u2500\u2500 version.cpp ### 4.2 \u5b9e\u73b0 \u5728\u9879\u76ee\u6784\u5efa\u90e8\u5206\u548c[\u5e38\u89c4\u975e\u8de8\u5e73\u53f0\u9879\u76ee](#_1-\u5e38\u89c4\u975e\u8de8\u5e73\u53f0\u9879\u76ee)\u4e00\u81f4\uff0c\u53ea\u662f\u5728\u5b89\u88c5\u90e8\u5206\u9700\u8981\u8003\u8651\u4e0d\u540c\u5e73\u53f0\u7684\u5dee\u5f02\uff0c\u56e0\u6b64\u8de8\u5e73\u53f0\u9879\u76ee\u53ea\u662f\u6bd4\u5e38\u89c4\u9879\u76ee\u591a\u4e86\u4e00\u4e9b\u5e73\u53f0\u76f8\u5173\u7684\u914d\u7f6e\u3002 \u548c\u5e38\u89c4\u975e\u8de8\u5e73\u53f0\u9879\u76ee\u4e00\u6837\uff0c\u5728\u9879\u76ee\u4e2d\u6dfb\u52a0 - `modules/core/CMakeLists.txt` \u2014\u2014 `core` \u6a21\u5757\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `modules/num/CMakeLists.txt` \u2014\u2014 `num` \u6a21\u5757\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `modules/opt/CMakeLists.txt` \u2014\u2014 `opt` \u6a21\u5757\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `modules/CMakelists.txt` \u2014\u2014 \u9879\u76ee\u7684\u6a21\u5757\u5217\u8868 - `samples/CMakeLists.txt` \u2014\u2014 \u793a\u4f8b\u7a0b\u5e8f\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `CMakeLists.txt` \u2014\u2014 \u9879\u76ee\u6839\u76ee\u5f55\u7684 CMake \u914d\u7f6e\u6587\u4ef6 - `cmake/numoptInstall.cmake` \u2014\u2014 \u4e0e\u9879\u76ee\u5b89\u88c5\u8def\u5f84\u76f8\u5173\u7684\u914d\u7f6e\u6587\u4ef6 - `cmake/templates/numoptConfig.cmake.in` \u2014\u2014 \u9879\u76ee\u7684 CMake \u914d\u7f6e\u6587\u4ef6\u7684\u6a21\u677f\u6587\u4ef6 - `cmake/templates/cmake_uninstall.cmake.in` \u2014\u2014 \u81ea\u5b9a\u4e49\u5378\u8f7d\u76ee\u6807\u7684\u6a21\u677f\u6587\u4ef6 \u5171 7 \u4e2a\u6587\u4ef6\uff0c\u5982\u4e0b\u6587\u4ef6\u7ed3\u6784\u6240\u793a ``` :collapsed-lines . \u251c\u2500\u2500 CMakeLists.txt (New) \u251c\u2500\u2500 cmake \u2502 \u251c\u2500\u2500 numoptInstall.cmake (New) \u2502 \u2514\u2500\u2500 templates \u2502 \u251c\u2500\u2500 cmake_uninstall.cmake.in (New) \u2502 \u2514\u2500\u2500 numoptConfig.cmake.in (New) \u251c\u2500\u2500 modules \u2502 \u251c\u2500\u2500 core \u2502 \u2502 \u251c\u2500\u2500 CMakeLists.txt (New) \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u251c\u2500\u2500 num \u2502 \u2502 \u251c\u2500\u2500 CMakeLists.txt (New) \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u251c\u2500\u2500 opt \u2502 \u2502 \u251c\u2500\u2500 CMakeLists.txt (New) \u2502 \u2502 \u251c\u2500\u2500 include \u2502 \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2502 \u2514\u2500\u2500 src \u2502 \u2502 \u2514\u2500\u2500 ... \u2502 \u2514\u2500\u2500 CMakeLists.txt (New) \u2514\u2500\u2500 samples \u251c\u2500\u2500 CMakeLists.txt (New) \u2514\u2500\u2500 version.cpp \u65b9\u4fbf\u8d77\u89c1\uff0c\u5c31\u4e0d\u6dfb\u52a0\u7c7b\u4f3c\u4e8e vl_add_module \u548c vl_add_exe \u7684\u5b8f\u4e86\u3002","title":"4.1 \u9884\u671f\u76ee\u6807"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#421","text":"::: code-tabs @tab CMakeLists.txt ```cmake :collapsed-lines","title":"4.2.1 \u9879\u76ee\u914d\u7f6e"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_6","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_14","text":"","title":"\u9879\u76ee\u914d\u7f6e"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_7","text":"cmake_minimum_required(VERSION 3.16) project( numopt LANGUAGES CXX ) set(CMAKE_CXX_STANDARD 17) option(BUILD_SHARED_LIBS \"Build shared libraries?\" OFF) include(cmake/numoptInstall.cmake)","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_8","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_15","text":"","title":"\u76ee\u6807\u6784\u5efa"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_9","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#main-target","text":"add_subdirectory(modules)","title":"main target"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#executable-target","text":"add_subdirectory(samples)","title":"executable target"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#uninstall-target","text":"if(NOT TARGET uninstall) configure_file( \"${CMAKE_CURRENT_SOURCE_DIR}/cmake/templates/cmake_uninstall.cmake.in\" \"${CMAKE_CURRENT_BINARY_DIR}/cmake_uninstall.cmake\" IMMEDIATE @ONLY ) add_custom_target(uninstall COMMAND ${CMAKE_COMMAND} -P ${CMAKE_CURRENT_BINARY_DIR}/cmake_uninstall.cmake ) endif()","title":"uninstall target"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_10","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_16","text":"","title":"\u5bfc\u51fa\u3001\u5b89\u88c5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_11","text":"install( EXPORT numoptModules DESTINATION ${NUMOPT_CFG_INSTALL_PATH} FILE numoptModules.cmake ) file(RELATIVE_PATH NUMOPT_INSTALL_RELATIVE_PATH \"${CMAKE_INSTALL_PREFIX}/${NUMOPT_CFG_INSTALL_PATH}/\" ${CMAKE_INSTALL_PREFIX}) configure_file( cmake/numoptConfig.cmake.in \"${CMAKE_CURRENT_BINARY_DIR}/numoptConfig.cmake\" @ONLY ) install( FILES \"${CMAKE_CURRENT_BINARY_DIR}/numoptConfig.cmake\" DESTINATION ${NUMOPT_CFG_INSTALL_PATH} ) @tab cmake/numoptInstall.cmake ```cmake :collapsed-lines # ---------------------------------------------------------- # \u9879\u76ee\u5b89\u88c5\u8def\u5f84\u7684\u9884\u5148\u914d\u7f6e # ---------------------------------------------------------- if(NOT CMAKE_TOOLCHAIN_FILE) if(WIN32) set(CMAKE_INSTALL_PREFIX \"${CMAKE_BINARY_DIR}/install\") else() set(CMAKE_INSTALL_PREFIX \"/usr/local\") endif() else() # \u4ea4\u53c9\u7f16\u8bd1\u65f6\u7684\u5b89\u88c5\u8def\u5f84 set(CMAKE_INSTALL_PREFIX \"${CMAKE_BINARY_DIR}/install\") endif() # ---------------------------------------------------------- # MSVC \u5b89\u88c5\u8def\u5f84\u7684\u9884\u5148\u914d\u7f6e # ---------------------------------------------------------- if(MSVC) if(\"${CMAKE_GENERATOR}\" MATCHES \"(Win64|IA64)\") set(ARCH_forMSVC \"x64\") elseif(\"${CMAKE_GENERATOR_PLATFORM}\" MATCHES \"ARM64\") set(ARCH_forMSVC \"ARM64\") elseif(\"${CMAKE_GENERATOR}\" MATCHES \"ARM\") set(ARCH_forMSVC \"ARM\") elseif(\"${CMAKE_SIZEOF_VOID_P}\" STREQUAL \"8\") set(ARCH_forMSVC \"x64\") else() set(ARCH_forMSVC x86) endif() if(MSVC_VERSION EQUAL 1400) set(RUNTIME_forMSVC vc8) elseif(MSVC_VERSION EQUAL 1500) set(RUNTIME_forMSVC vc9) elseif(MSVC_VERSION EQUAL 1600) set(RUNTIME_forMSVC vc10) elseif(MSVC_VERSION EQUAL 1700) set(RUNTIME_forMSVC vc11) elseif(MSVC_VERSION EQUAL 1800) set(RUNTIME_forMSVC vc12) elseif(MSVC_VERSION EQUAL 1900) set(RUNTIME_forMSVC vc14) elseif(MSVC_VERSION MATCHES \"^191[0-9]$\") set(RUNTIME_forMSVC vc15) elseif(MSVC_VERSION MATCHES \"^192[0-9]$\") set(RUNTIME_forMSVC vc16) elseif(MSVC_VERSION MATCHES \"^19[34][0-9]$\") set(RUNTIME_forMSVC vc17) endif() endif() # ---------------------------------------------------------- # \u5b89\u88c5\u8def\u5f84\u8bbe\u7f6e # ---------------------------------------------------------- if(MSVC) if(DEFINED ARCH_forMSVC AND DEFINED RUNTIME_forMSVC) set(MSVC_INSTALL_PREFIX \"${ARCH_forMSVC}/${RUNTIME_forMSVC}\") else() set(MSVC_INSTALL_PREFIX \"\") endif() set(NUMOPT_INC_INSTALL_PATH \"include\") set(NUMOPT_LIB_INSTALL_PATH \"${MSVC_INSTALL_PREFIX}/lib\") set(NUMOPT_BIN_INSTALL_PATH \"${MSVC_INSTALL_PREFIX}/bin\") set(NUMOPT_CFG_INSTALL_PATH \"${MSVC_INSTALL_PREFIX}/lib\") elseif() set(NUMOPT_INC_INSTALL_PATH \"include/numopt\") set(NUMOPT_LIB_INSTALL_PATH \"lib\") set(NUMOPT_BIN_INSTALL_PATH \"bin\") set(NUMOPT_CFG_INSTALL_PATH \"lib/cmake/numopt\") endif() :::","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#422","text":"modules \u76ee\u5f55\u4e0b\u7684 CMakeLists.txt \u548c\u5404\u4e2a\u6a21\u5757\u7684 CMakeLists.txt \u6587\u4ef6\u5982\u4e0b\uff1a ::: code-tabs @tab modules add_subdirectory(core) add_subdirectory(num) add_subdirectory(opt) @tab core \u6a21\u5757 ```cmake :collapsed-lines aux_source_directory(src core_src) add_library(core ${core_src}) target_include_directories(core PUBLIC $ $ ) install(TARGETS core LIBRARY DESTINATION ${NUMOPT_BIN_INSTALL_PATH} ARCHIVE DESTINATION ${NUMOPT_LIB_INSTALL_PATH} RUNTIME DESTINATION ${NUMOPT_BIN_INSTALL_PATH} INCLUDES DESTINATION ${NUMOPT_INC_INSTALL_PATH} ) @tab `num` \u6a21\u5757 ```cmake :collapsed-lines aux_source_directory(src num_src) add_library(num ${num_src}) target_include_directories(num PUBLIC $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include> $<INSTALL_INTERFACE:${NUMOPT_INC_INSTALL_PATH}> ) target_link_libraries(num PUBLIC core) install(TARGETS num LIBRARY DESTINATION ${NUMOPT_BIN_INSTALL_PATH} ARCHIVE DESTINATION ${NUMOPT_LIB_INSTALL_PATH} RUNTIME DESTINATION ${NUMOPT_BIN_INSTALL_PATH} INCLUDES DESTINATION ${NUMOPT_INC_INSTALL_PATH} ) @tab opt \u6a21\u5757 ```cmake :collapsed-lines aux_source_directory(src opt_src) add_library(opt ${opt_src}) target_include_directories(opt PUBLIC $ $ ) target_link_libraries(opt PUBLIC core) install(TARGETS opt LIBRARY DESTINATION ${NUMOPT_BIN_INSTALL_PATH} ARCHIVE DESTINATION ${NUMOPT_LIB_INSTALL_PATH} RUNTIME DESTINATION ${NUMOPT_BIN_INSTALL_PATH} INCLUDES DESTINATION ${NUMOPT_INC_INSTALL_PATH} ) ::: ::: tip \u7531\u4e8e\u6ca1\u6709\u4f7f\u7528\u5b8f\uff0c`core` \u6a21\u5757\u3001`num` \u6a21\u5757\u548c `opt` \u6a21\u5757\u7684\u914d\u7f6e\u5199\u4e86\u5927\u91cf\u7684\u91cd\u590d\u4ee3\u7801\uff0c\u53ef\u8bfb\u6027\u964d\u4f4e\u3002\u56e0\u6b64\u5728\u5fc5\u8981\u65f6\u5019\u4f7f\u7528\u5b8f\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002\u8fd9\u91cc\u5c31\u4e0d\u518d\u5c55\u793a\u5b8f\u7684\u4f7f\u7528\uff0c\u8bfb\u8005\u53ef\u4ee5\u6309\u7167[\u5e38\u89c4\u975e\u8de8\u5e73\u53f0\u9879\u76ee\u914d\u7f6e](#_1-4-1-\u9879\u76ee\u914d\u7f6e)\u4e2d\u7684\u5185\u5bb9\u81ea\u884c\u6dfb\u52a0\u5b8f\u3002 ::: #### 4.2.3 \u793a\u4f8b\u7a0b\u5e8f\u914d\u7f6e ::: code-tabs @tab samples/CMakeLists.txt ```cmake :collapsed-lines add_executable(numopt_version version.cpp) target_link_libraries(numopt_version PRIVATE core) :::","title":"4.2.2 \u6a21\u5757\u914d\u7f6e"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#424-cmake","text":"cmake_uninstall.cmake.in \u6587\u4ef6\u53c2\u8003\u81ea \u6b64\u5904 \uff0c\u7528\u6237\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u6700\u597d\u52a0\u4e0a\u51fa\u5904\u3002 ::: code-tabs @tab numoptConfig.cmake.in ```cmake :collapsed-lines","title":"4.2.4 CMake \u914d\u7f6e\u6587\u4ef6\u6a21\u677f"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_12","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#numopt-cmake","text":"","title":"numopt CMake \u914d\u7f6e\u6587\u4ef6"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_17","text":"","title":""},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#cmake","text":"","title":"** \u8be5\u6587\u4ef6\u7531 CMake \u751f\u6210\uff0c\u8bf7\u52ff\u624b\u52a8\u4fee\u6539 **"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_18","text":"","title":""},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_19","text":"","title":"\u57fa\u672c\u7528\u6cd5\uff1a"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#find_packagenumopt-required","text":"","title":"find_package(numopt REQUIRED)"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#target_link_librariesyour_target-private-numopt_libs","text":"","title":"target_link_libraries(your_target PRIVATE ${numopt_LIBS})"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_13","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_14","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#numopt","text":"","title":"\u83b7\u53d6 numopt \u5b89\u88c5\u8def\u5f84"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_15","text":"get_filename_component(NUMOPT_CONFIG_PATH \"${CMAKE_CURRENT_LIST_FILE}\" PATH) get_filename_component(NUMOPT_INSTALL_PATH \"${NUMOPT_CONFIG_PATH}/@NUMOPT_INSTALL_RELATIVE_PATH@\" REALPATH )","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_16","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_20","text":"","title":"\u8bbe\u7f6e\u5934\u6587\u4ef6\u641c\u7d22\u8def\u5f84\u53d8\u91cf"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_17","text":"set(numopt_INCLUDE_DIRS \"${NUMOPT_INSTALL_PATH}/@NUMOPT_INC_INSTALL_PATH@\")","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_18","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_21","text":"","title":"\u8bbe\u7f6e\u5e93\u6587\u4ef6\u8def\u5f84\u53d8\u91cf"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_19","text":"set(numopt_LIBS @NUMOPT_LIB_COMPONENTS@) if(NOT TARGET core) include(\"${NUMOPT_CONFIG_PATH}/numoptModules.cmake\") endif()","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_20","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_22","text":"","title":"\u641c\u5bfb\u7684\u7ed3\u679c\u3001\u72b6\u6001"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_21","text":"include(FindPackageHandleStandardArgs) find_package_handle_standard_args(numopt REQUIRED_VARS numopt_INSTALL_PATH ) @tab cmake_uninstall.cmake.in ```cmake :collapsed-lines # ----------------------------------------------- # File that provides \"make uninstall\" target # We use the file 'install_manifest.txt' # # Details: # https://gitlab.kitware.com/cmake/community/-/wikis/FAQ#can-i-do-make-uninstall-with-cmake # ----------------------------------------------- if(NOT EXISTS \"@CMAKE_BINARY_DIR@/install_manifest.txt\") message(FATAL_ERROR \"Cannot find install manifest: \\\"@CMAKE_BINARY_DIR@/install_manifest.txt\\\"\" ) endif() file(READ \"@CMAKE_BINARY_DIR@/install_manifest.txt\" files) string(REGEX REPLACE \"\\n\" \";\" files \"${files}\") foreach(file ${files}) message(STATUS \"Uninstalling: $ENV{DESTDIR}${file}\") if(IS_SYMLINK \"$ENV{DESTDIR}${file}\" OR EXISTS \"$ENV{DESTDIR}${file}\") execute_process( COMMAND \"@CMAKE_COMMAND@\" \"-E\" \"remove\" \"$ENV{DESTDIR}${file}\" OUTPUT_VARIABLE rm_out RESULT_VARIABLE rm_retval ) if(NOT \"${rm_retval}\" STREQUAL 0) message(FATAL_ERROR \"Problem when removing $ENV{DESTDIR}${file}\") endif() else(IS_SYMLINK \"$ENV{DESTDIR}${file}\" OR EXISTS \"$ENV{DESTDIR}${file}\") message(STATUS \"File $ENV{DESTDIR}${file} does not exist.\") endif() endforeach() :::","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#43-visual-studio","text":"\u5bf9\u4e8e\u591a\u4e2a\u76ee\u6807\u7684\u9879\u76ee\uff0c\u4f1a\u751f\u6210\u591a\u4e2a\u5e93\u6587\u4ef6\uff0c\u4f8b\u5982\u672c numopt \u9879\u76ee\uff0c\u5728 Windows \u4e0b\u4f1a\u751f\u6210 core.lib \u3001 num.lib \u548c opt.lib 3 \u4e2a\u5e93\u6587\u4ef6\uff0c\u5728 Visual Studio \u4e2d\uff0c\u5229\u7528\u8fd9 3 \u4e2a\u5e93\u6587\u4ef6\u8fdb\u884c\u5f00\u53d1\uff0c\u9700\u8981\u518d\u9879\u76ee\u4e2d\u624b\u52a8\u6dfb\u52a0\uff0c\u8fd9\u6837\u4f1a\u589e\u52a0\u5f00\u53d1\u8005\u7684\u5de5\u4f5c\u91cf\u3002\u4e3a\u4e86\u7b80\u5316\u5f00\u53d1\u8005\u7684\u5de5\u4f5c\uff0c\u53ef\u4ee5\u5c06\u8fd9 3 \u4e2a\u5e93\u6587\u4ef6\u6253\u5305\u6210\u4e00\u4e2a numopt_world.lib \u6587\u4ef6\uff0c\u8fd9\u6837\u5f00\u53d1\u8005\u53ea\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a\u5e93\u6587\u4ef6\u5373\u53ef\u3002 \u4f8b\u5982 OpenCV \u539f\u5148\u4f1a\u751f\u6210 opencv_core.lib \u3001 opencv_imgproc.lib \u4ee5\u53ca opencv_highgui.lib \u7b49\u5bfc\u5165\u5e93\u6587\u4ef6\uff0c\u5728\u542f\u7528 BUILD_opencv_world \u9009\u9879\u540e\uff0c\u5219\u4e0d\u518d\u751f\u6210\u539f\u5148\u7684\u5e93\u6587\u4ef6\uff0c\u800c\u662f\u751f\u6210\u4e00\u4e2a opencv_world.lib \u5bfc\u5165\u5e93\u6587\u4ef6\u3002\u8fd9\u65f6\u5f00\u53d1\u8005\u5728\u4f7f\u7528 Visual Studio \u5bf9\u9879\u76ee\u7684\u5bfc\u5165\u5e93\u8fdb\u884c\u914d\u7f6e\u7684\u65f6\u5019\uff0c\u53ea\u9700\u6dfb\u52a0 opencv_world.lib \u8be5\u5bfc\u5165\u5e93\u6587\u4ef6\u7684\u8def\u5f84\u548c\u540d\u5b57\u5373\u53ef\u3002 \u4e00\u4e2a\u7b80\u5355\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u5728 core \u3001 num \u548c opt \u6a21\u5757\u7684 CMakeLists.txt \u6587\u4ef6\u4e2d\u6dfb\u52a0\u5224\u65ad\uff0c\u4e0b\u9762\u4ee5 core \u6a21\u5757\u4e3a\u4f8b\uff1a if(NOT BUILD_WORLD) # \u539f\u5148\u7684\u914d\u7f6e else() aux source_directory(src core_src) set(NUMOPT_SRC \"${NUMOPT_SRCS} ${core_src}\" CACHE INTERNAL \"\") set(NUMOPT_INC \"${NUMOPT_INC} ${CMAKE_CURRENT_SOURCE_DIR}/include\" CACHE INTERNAL \"\") # \u7531\u4e8e\u6ca1\u6709\u5916\u90e8\u4f9d\u8d56\u5e93\uff0c\u6240\u4ee5\u5c31\u4e0d\u5199 NUMOPT_LIB \u4e86 endif() \u4fee\u6539\u9879\u76ee\u7684\u6839\u76ee\u5f55\u7684 CMakeLists.txt \u6587\u4ef6 ```cmake :collapsed-lines","title":"4.3 \u9488\u5bf9 Visual Studio \u7684\u7279\u6b8a\u8bbe\u8ba1"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_23","text":"","title":"..."},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_22","text":"","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_24","text":"","title":"\u76ee\u6807\u6784\u5efa"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#-_23","text":"if(BUILD_WORLD) set(NUMOPT_SRC \"\" CACHE INTERNAL \"\") set(NUMOPT_INC \"\" CACHE INTERNAL \"\") # \u7531\u4e8e\u6ca1\u6709\u5916\u90e8\u4f9d\u8d56\u5e93\uff0c\u6240\u4ee5\u5c31\u4e0d\u5199 NUMOPT_LIB \u4e86 endif() add_subdirectory(modules) add_subdirectory(samples) if(BUILD_WORLD) add_library(numopt_world ${NUMOPT_SRC}) target_include_directories(numopt_world PUBLIC $ $ ) endif()","title":"----------------------------------------------------------------------------"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_25","text":"\u8fd8\u6709\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\u662f\u4f7f\u7528[\u5bf9\u8c61\u5e93](05.md#_3-1-1-\u5bf9\u8c61\u5e93)\uff0c\u5c06 `core`\u3001`num` \u548c `opt` \u6a21\u5757\u7684\u6e90\u6587\u4ef6\u7f16\u8bd1\u6210\u5bf9\u8c61\u6587\u4ef6\uff0c\u7136\u540e\u518d\u5c06\u8fd9\u4e9b\u5bf9\u8c61\u6587\u4ef6\u94fe\u63a5\u6210\u4e00\u4e2a\u5e93\u6587\u4ef6\u3002\u4f8b\u5982 ```cmake add_library(core_obj OBJECT ${core_src}) \u5f00\u53d1\u8005\u53ef\u4ee5\u81ea\u884c\u589e\u52a0 if \u5224\u65ad\uff0c\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u6765\u9009\u62e9\u5408\u9002\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002 \u4f7f\u7528\u5f62\u5982\u4ee5\u4e0b\u7684\u4ee3\u7801\u6765\u5b89\u88c5\uff1a ::: code-tabs @tab core \u6a21\u5757 add_library(core_obj OBJECT ${core_src}) install(TARGETS core_obj EXPORT numoptModules ) @tab num \u6a21\u5757 add_library(num_obj OBJECT ${num_src}) install(TARGETS num_obj EXPORT numoptModules ) @tab opt \u6a21\u5757 add_library(opt_obj OBJECT ${opt_src}) install(TARGETS opt_obj EXPORT numoptModules ) ::: \u4e0d\u8fc7\uff0c\u5bf9\u8c61\u5e93\u7b49\u6548\u4e8e\u5b89\u88c5\u4e00\u4e2a\u63a5\u53e3\u5e93\uff0c\u5b89\u88c5\u63a5\u53e3\u5e93\u7684\u6548\u679c\u53ef\u4ee5\u53c2\u8003 \u301010\u3011\u9879\u76ee\u7684\u5bfc\u51fa\u4e0e\u5b89\u88c5 - \u601d\u8003 \u4e2d\u7684\u7b2c 2 \u4e2a\u95ee\u9898\uff0c\u56e0\u6b64\u5728\u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u4e2d\u4e5f\u5177\u6709\u76f8\u5e94\u7684\u4fe1\u606f\uff0c\u4f8b\u5982 numoptModules.cmake \u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f1a\u5305\u542b\u5927\u81f4\u5982\u4e0b\u5185\u5bb9 # Create imported target core_obj add_library(core_obj INTERFACE IMPORTED) # Create imported target num_obj add_library(num_obj INTERFACE IMPORTED) # Create imported target opt_obj add_library(opt_obj INTERFACE IMPORTED) ::: warning \u5982\u679c\u5e0c\u671b\u5728 numoptModules.cmake \u5bfc\u51fa\u914d\u7f6e\u6587\u4ef6\u4e2d\u53ea\u5305\u542b\u4e00\u4e2a numopt_world \u76ee\u6807\u800c\u4e0d\u5305\u542b core_obj \u7b49\u7531\u5bf9\u8c61\u5e93\u5bfc\u51fa\u751f\u6210\u7684\u63a5\u53e3\u5e93\uff0c\u53ef\u4ee5\u4f7f\u7528\u7b2c\u4e00\u79cd\u65b9\u6848\u3002 :::","title":"..."},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/11/#_26","text":"\u6709\u5173 CMake \u9879\u76ee\u5b9e\u6218\u7684\u5185\u5bb9\u53ef\u4ee5\u53c2\u8003 RMVL [^2] \u9879\u76ee\u7684 CMake \u6846\u67b6\uff0c\u672c\u6587\u6d89\u53ca\u5230\u7684 \u5e38\u89c4\u76ee\u6807\u6784\u5efa\u7684\u5185\u5bb9 \u5916\u90e8\u4f9d\u8d56\u7ba1\u7406\u7684\u5185\u5bb9 \u4ea4\u53c9\u7f16\u8bd1\u7684\u5185\u5bb9 \u8de8\u5e73\u53f0\u7684\u5185\u5bb9 \u5bf9\u5e94\u7684 CMake \u914d\u7f6e\uff0c\u90fd\u80fd\u5728 RMVL \u9879\u76ee\u4e2d\u627e\u5230\u3002 [^1]: open62541 developers. open62541 , September 2014. [^2]: zhaoxi and other RMVL developers. rmvl , September 2023.","title":"\u5199\u5728\u540e\u9762"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/","text":"\u301012\u3011CTest \u5de5\u5177 \u6559\u5b66\u89c6\u9891 ::: tip \u5373\u5c06\u5230\u6765 ... - \u301012\u3011CMake\uff1aCTest \u5de5\u5177 ::: 1. \u524d\u8a00 CMake \u63d0\u4f9b\u4e86\u4e00\u4e2a\u540d\u4e3a CTest \u7684\u5de5\u5177\uff0c\u7528\u4e8e\u7ba1\u7406\u548c\u8fd0\u884c\u6d4b\u8bd5\u7528\u4f8b\u3002\u4e3b\u8981\u529f\u80fd\u6709 \u81ea\u52a8\u53d1\u73b0\u548c\u8fd0\u884c\u6d4b\u8bd5 \u5e76\u884c\u6d4b\u8bd5\u6267\u884c \u6d4b\u8bd5\u7ed3\u679c\u6536\u96c6\u548c\u62a5\u544a ::: tip \u6d4b\u8bd5\u4e00\u822c\u5206\u4e3a\u4ee5\u4e0b\u51e0\u79cd\u7c7b\u578b\uff1a \u5355\u5143\u6d4b\u8bd5 \u2014\u2014 \u5b83\u662f\u5bf9\u8f6f\u4ef6\u4e2d\u7684\u6700\u5c0f\u53ef\u6d4b\u8bd5\u5355\u5143\u8fdb\u884c\u68c0\u67e5\u548c\u9a8c\u8bc1\u7684\u8fc7\u7a0b\u3002\u5355\u5143\u6d4b\u8bd5\u901a\u5e38\u662f\u7531\u5f00\u53d1\u4eba\u5458\u7f16\u5199\u7684\uff0c\u7528\u4e8e\u9a8c\u8bc1\u4ee3\u7801\u7684\u6b63\u786e\u6027\u3002\u5355\u5143\u6d4b\u8bd5\u7684\u76ee\u7684\u662f\u786e\u4fdd\u4ee3\u7801\u7684\u6bcf\u4e2a\u90e8\u5206\u90fd\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u4ece\u800c\u63d0\u9ad8\u4ee3\u7801\u7684\u8d28\u91cf\u3002\u5355\u5143\u6d4b\u8bd5\u4e00\u822c\u9694\u79bb\u6027\u5f3a\uff0c\u4e0d\u4f9d\u8d56\u5916\u90e8\u7ec4\u4ef6\u3002 \u96c6\u6210\u6d4b\u8bd5 \u2014\u2014 \u5b83\u662f\u5bf9\u8f6f\u4ef6\u4e2d\u7684\u591a\u4e2a\u6a21\u5757\u8fdb\u884c\u8054\u5408\u6d4b\u8bd5\u7684\u8fc7\u7a0b\u3002\u96c6\u6210\u6d4b\u8bd5\u901a\u5e38\u662f\u7531\u6d4b\u8bd5\u4eba\u5458\u548c\u5f00\u53d1\u4eba\u5458\u5171\u540c\u7f16\u5199\u7684\uff0c\u7528\u4e8e\u9a8c\u8bc1\u8f6f\u4ef6\u7684\u6574\u4f53\u529f\u80fd\u3002\u96c6\u6210\u6d4b\u8bd5\u7684\u76ee\u7684\u662f\u786e\u4fdd\u8f6f\u4ef6\u7684\u5404\u4e2a\u6a21\u5757\u80fd\u591f\u534f\u540c\u5de5\u4f5c\uff0c\u4ece\u800c\u63d0\u9ad8\u8f6f\u4ef6\u7684\u8d28\u91cf\u3002\u96c6\u6210\u6d4b\u8bd5\u4e00\u822c\u9700\u8981\u6d4b\u8bd5\u73af\u5883\u3002 \u7cfb\u7edf\u6d4b\u8bd5 \u2014\u2014 \u5b83\u662f\u5bf9\u8f6f\u4ef6\u7684\u6574\u4f53\u529f\u80fd\u8fdb\u884c\u6d4b\u8bd5\u7684\u8fc7\u7a0b\u3002\u7cfb\u7edf\u6d4b\u8bd5\u901a\u5e38\u662f\u7531\u6d4b\u8bd5\u4eba\u5458\u7f16\u5199\u7684\uff0c\u7528\u4e8e\u9a8c\u8bc1\u8f6f\u4ef6\u7684\u6574\u4f53\u529f\u80fd\u3002\u7cfb\u7edf\u6d4b\u8bd5\u7684\u76ee\u7684\u662f\u786e\u4fdd\u8f6f\u4ef6\u7684\u6574\u4f53\u529f\u80fd\u80fd\u591f\u6ee1\u8db3\u7528\u6237\u7684\u9700\u6c42\u3002\u7cfb\u7edf\u6d4b\u8bd5\u4e00\u822c\u9700\u8981\u5b8c\u6574\u7684\u6d4b\u8bd5\u73af\u5883\uff0c\u4e3b\u8981\u5728\u529f\u80fd\u3001\u6027\u80fd\u3001\u8d1f\u8f7d\u3001\u5b89\u5168\u7b49\u65b9\u9762\u8fdb\u884c\u6d4b\u8bd5\u3002 ::: 2. CTest \u7684\u57fa\u672c\u4ecb\u7ecd \u5728\u5b89\u88c5 CMake \u7684\u540c\u65f6\uff0cCTest \u4e5f\u4f1a\u88ab\u5b89\u88c5\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728 CMakeLists.txt \u6587\u4ef6\u4e2d\u4f7f\u7528 CTest \u76f8\u5173\u7684\u5185\u5bb9\u3002 2.1 \u542f\u7528\u6d4b\u8bd5 \u5728\u6dfb\u52a0\u6d4b\u8bd5\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5728 CMakeLists.txt \u6587\u4ef6\u4e2d\u542f\u7528\u6d4b\u8bd5\u3002\u542f\u7528\u6d4b\u8bd5\u7684\u65b9\u6cd5\u662f\u5728 CMakeLists.txt \u6587\u4ef6\u4e2d\u6dfb\u52a0 enable_testing() \u6211\u4eec\u5148\u51c6\u5907\u4e00\u4e2a\u7b80\u5355\u7684\u8ba1\u7b97\u4e24\u6570\u4e4b\u548c\u7684\u9879\u76ee\uff0c\u76ee\u5f55\u5982\u4e0b Add \u251c\u2500\u2500 CMakeLists.txt \u251c\u2500\u2500 main.cpp \u251c\u2500\u2500 add.cpp \u2514\u2500\u2500 add.hpp ::: code-tabs @tab add.cpp #include \"add.hpp\" int add(int a, int b) { return a + b; } @tab add.hpp #ifndef ADD_HPP #define ADD_HPP int add(int a, int b); #endif // ADD_HPP @tab main.cpp ```cpp :collapsed-lines=6 include include include \"add.hpp\" int main(int argc, char *argv[]) { if (argc < 4) { printf(\"Usage: %s \\n\", argv[0]); return -1; } int a = std::atoi(argv[1]); int b = std::atoi(argv[2]); int predict = std::atoi(argv[3]); int sum = add(a, b); return sum == predict ? 0 : -1; } ::: \u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u8ba1\u7b97\u4e24\u6570\u4e4b\u548c\u7684\u9879\u76ee\uff0c\u9700\u8981\u7528\u6237\u8f93\u5165 3 \u4e2a\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u5206\u522b\u662f\u4e24\u4e2a\u52a0\u6570\u548c\u9884\u671f\u7684\u548c\u3002\u5982\u679c\u8ba1\u7b97\u7ed3\u679c\u4e0e\u9884\u671f\u7684\u548c\u76f8\u7b49\uff0c\u5219\u8fd4\u56de `0`\uff0c\u5426\u5219\u8fd4\u56de `-1`\u3002\u7136\u540e\uff0c\u6211\u4eec\u5728 `CMakeLists.txt` \u6587\u4ef6\u4e2d\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9 ```cmake cmake_minimum_required(VERSION 3.16) project(Add) add_library(add STATIC add.cpp) add_executable(demo main.cpp) target_link_libraries(demo PRIVATE add) enable_testing() \u81f3\u6b64\uff0c\u6211\u4eec\u5b8c\u6210\u4e86\u6d4b\u8bd5\u7684\u524d\u671f\u51c6\u5907\u5de5\u4f5c\u3002 2.2 \u6dfb\u52a0\u6d4b\u8bd5 \u5728 CMakeLists.txt \u6587\u4ef6\u4e2d\u6dfb\u52a0\u6d4b\u8bd5\u7684\u65b9\u6cd5\u662f\u4f7f\u7528 add_test \u547d\u4ee4\u3002 add_test \u547d\u4ee4\u7684\u8bed\u6cd5\u5982\u4e0b add_test( NAME <name> # \u6d4b\u8bd5\u7684\u540d\u79f0\uff0c\u53ef\u4ee5\u968f\u4fbf\u5199\uff0c\u4f46\u6700\u597d\u89c1\u540d\u77e5\u610f COMMAND <command> [arg1 [arg2 ...]] # \u6d4b\u8bd5\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u6216\u4e00\u4e2a\u811a\u672c ) \u5176\u4e2d\uff0c name \u662f\u6d4b\u8bd5\u7684\u540d\u79f0\uff0c command \u662f\u6d4b\u8bd5\u7684\u547d\u4ee4\u3002\u6211\u4eec\u5728 CMakeLists.txt \u6587\u4ef6\u672b\u5c3e\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9\u4ee5\u6dfb\u52a0 5 \u4e2a\u6d4b\u8bd5 add_test(NAME AddTest.positive COMMAND demo 1 2 3) add_test(NAME AddTest.negative COMMAND demo -1 -2 -3) add_test(NAME AddTest.zero COMMAND demo 0 0 0) add_test(NAME AddTest.mixed COMMAND demo 1 -2 -1) add_test(NAME AddTest.failed_example COMMAND demo 1 2 4) 2.3 \u8fd0\u884c\u6d4b\u8bd5 \u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u6784\u5efa\u9879\u76ee mkdir build cd build cmake .. cmake --build . \u7136\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8fd0\u884c\u6d4b\u8bd5 ctest \u8fd0\u884c\u7ed3\u679c\u5982\u4e0b Test project /path/to/Add/build Start 1: AddTest.positive 1/5 Test #1: AddTest.positive ................. Passed 0.00 sec Start 2: AddTest.negative 2/5 Test #2: AddTest.negative ................. Passed 0.00 sec Start 3: AddTest.zero 3/5 Test #3: AddTest.zero ..................... Passed 0.00 sec Start 4: AddTest.mixed 4/5 Test #4: AddTest.mixed .................... Passed 0.00 sec Start 5: AddTest.failed_example 5/5 Test #5: AddTest.failed_example ...........***Failed 0.00 sec 80% tests passed, 1 tests failed out of 5 Total Test time (real) = 0.01 sec 3. \u4e0e GoogleTest \u7ed3\u5408\u4f7f\u7528 GoogleTest \u662f Google \u5f00\u53d1\u7684\u4e00\u4e2a C++ \u6d4b\u8bd5\u6846\u67b6\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u65ad\u8a00\u548c\u6d4b\u8bd5\u7528\u4f8b\u7ba1\u7406\u529f\u80fd\uff0cCMake \u4e5f\u63d0\u4f9b\u4e86 GoogleTest \u76f8\u5173\u7684\u5b8f\u548c\u51fd\u6570\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5c06 GoogleTest \u4e0e CTest \u96c6\u6210\u3002 3.1 \u6587\u4ef6\u51c6\u5907 \u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5220\u9664 main.cpp \u6587\u4ef6\uff0c\u4f46\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u6d4b\u8bd5\u6587\u4ef6 test_add.cpp \uff0c\u53d8\u66f4\u540e\u7684\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b Add \u251c\u2500\u2500 CMakeLists.txt \u251c\u2500\u2500 add.cpp \u251c\u2500\u2500 add.hpp \u2514\u2500\u2500 test_add.cpp test_add.cpp \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b #include <gtest/gtest.h> #include \"add.hpp\" TEST(AddTest, Positive) { EXPECT_EQ(add(1, 2), 3); } TEST(AddTest, Negative) { EXPECT_EQ(add(-1, -2), -3); } TEST(AddTest, Zero) { EXPECT_EQ(add(0, 0), 0); } TEST(AddTest, Mixed) { EXPECT_EQ(add(1, -2), -1); } TEST(AddTest, FailedExample) { EXPECT_EQ(add(1, 2), 4); } \u7136\u540e\uff0c\u6211\u4eec\u6539\u5199 CMakeLists.txt \u6587\u4ef6\uff0c\u4f7f\u5176\u652f\u6301 GoogleTest \u6d4b\u8bd5\u6846\u67b6\u3002\u6539\u5199\u540e\u7684 CMakeLists.txt \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b cmake_minimum_required(VERSION 3.16) project(Add) add_library(add STATIC add.cpp) # \u5148\u4e0d\u8981\u7591\u60d1\u4e3a\u4ec0\u4e48 test_add.cpp \u6ca1\u6709 main \u51fd\u6570\u4e5f\u53ef\u4ee5\u7f16\u8bd1\u6210\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u540e\u9762\u4f1a\u89e3\u91ca add_executable(test_add test_add.cpp) find_package(GTest REQUIRED) # \u5bfb\u627e GTest \u5e93 include(GoogleTest) # \u4f7f\u7528 GoogleTest \u63d0\u4f9b\u7684 CMake \u51fd\u6570 # GTest::gtest_main \u63d0\u4f9b\u4e86 main \u51fd\u6570\uff0c\u56e0\u6b64 test_add.cpp \u4e0d\u9700\u8981\u989d\u5916\u63d0\u4f9b main \u51fd\u6570 target_link_libraries(test_add PRIVATE add GTest::gtest_main ) enable_testing() # \u81ea\u52a8\u6dfb\u52a0 GoogleTest \u6d4b\u8bd5\u7528\u4f8b gtest_discover_tests(test_add) 3.2 \u8fd0\u884c\u6d4b\u8bd5 \u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u6784\u5efa\u9879\u76ee mkdir build cd build cmake .. cmake --build . \u6700\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8fd0\u884c\u6d4b\u8bd5 ctest \u8fd0\u884c\u7ed3\u679c\u5982\u4e0b Test project /path/to/Add/build Start 1: AddTest.Positive 1/5 Test #1: AddTest.Positive ................. Passed 0.00 sec Start 2: AddTest.Negative 2/5 Test #2: AddTest.Negative ................. Passed 0.00 sec Start 3: AddTest.Zero 3/5 Test #3: AddTest.Zero ..................... Passed 0.00 sec Start 4: AddTest.Mixed 4/5 Test #4: AddTest.Mixed .................... Passed 0.00 sec Start 5: AddTest.FailedExample 5/5 Test #5: AddTest.FailedExample ............***Failed 0.00 sec 80% tests passed, 1 tests failed out of 5 Total Test time (real) = 0.01 sec","title":"\u301012\u3011CTest \u5de5\u5177"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#12ctest","text":"","title":"\u301012\u3011CTest \u5de5\u5177"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#_1","text":"::: tip \u5373\u5c06\u5230\u6765 ... - \u301012\u3011CMake\uff1aCTest \u5de5\u5177 :::","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#1","text":"CMake \u63d0\u4f9b\u4e86\u4e00\u4e2a\u540d\u4e3a CTest \u7684\u5de5\u5177\uff0c\u7528\u4e8e\u7ba1\u7406\u548c\u8fd0\u884c\u6d4b\u8bd5\u7528\u4f8b\u3002\u4e3b\u8981\u529f\u80fd\u6709 \u81ea\u52a8\u53d1\u73b0\u548c\u8fd0\u884c\u6d4b\u8bd5 \u5e76\u884c\u6d4b\u8bd5\u6267\u884c \u6d4b\u8bd5\u7ed3\u679c\u6536\u96c6\u548c\u62a5\u544a ::: tip \u6d4b\u8bd5\u4e00\u822c\u5206\u4e3a\u4ee5\u4e0b\u51e0\u79cd\u7c7b\u578b\uff1a \u5355\u5143\u6d4b\u8bd5 \u2014\u2014 \u5b83\u662f\u5bf9\u8f6f\u4ef6\u4e2d\u7684\u6700\u5c0f\u53ef\u6d4b\u8bd5\u5355\u5143\u8fdb\u884c\u68c0\u67e5\u548c\u9a8c\u8bc1\u7684\u8fc7\u7a0b\u3002\u5355\u5143\u6d4b\u8bd5\u901a\u5e38\u662f\u7531\u5f00\u53d1\u4eba\u5458\u7f16\u5199\u7684\uff0c\u7528\u4e8e\u9a8c\u8bc1\u4ee3\u7801\u7684\u6b63\u786e\u6027\u3002\u5355\u5143\u6d4b\u8bd5\u7684\u76ee\u7684\u662f\u786e\u4fdd\u4ee3\u7801\u7684\u6bcf\u4e2a\u90e8\u5206\u90fd\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u4ece\u800c\u63d0\u9ad8\u4ee3\u7801\u7684\u8d28\u91cf\u3002\u5355\u5143\u6d4b\u8bd5\u4e00\u822c\u9694\u79bb\u6027\u5f3a\uff0c\u4e0d\u4f9d\u8d56\u5916\u90e8\u7ec4\u4ef6\u3002 \u96c6\u6210\u6d4b\u8bd5 \u2014\u2014 \u5b83\u662f\u5bf9\u8f6f\u4ef6\u4e2d\u7684\u591a\u4e2a\u6a21\u5757\u8fdb\u884c\u8054\u5408\u6d4b\u8bd5\u7684\u8fc7\u7a0b\u3002\u96c6\u6210\u6d4b\u8bd5\u901a\u5e38\u662f\u7531\u6d4b\u8bd5\u4eba\u5458\u548c\u5f00\u53d1\u4eba\u5458\u5171\u540c\u7f16\u5199\u7684\uff0c\u7528\u4e8e\u9a8c\u8bc1\u8f6f\u4ef6\u7684\u6574\u4f53\u529f\u80fd\u3002\u96c6\u6210\u6d4b\u8bd5\u7684\u76ee\u7684\u662f\u786e\u4fdd\u8f6f\u4ef6\u7684\u5404\u4e2a\u6a21\u5757\u80fd\u591f\u534f\u540c\u5de5\u4f5c\uff0c\u4ece\u800c\u63d0\u9ad8\u8f6f\u4ef6\u7684\u8d28\u91cf\u3002\u96c6\u6210\u6d4b\u8bd5\u4e00\u822c\u9700\u8981\u6d4b\u8bd5\u73af\u5883\u3002 \u7cfb\u7edf\u6d4b\u8bd5 \u2014\u2014 \u5b83\u662f\u5bf9\u8f6f\u4ef6\u7684\u6574\u4f53\u529f\u80fd\u8fdb\u884c\u6d4b\u8bd5\u7684\u8fc7\u7a0b\u3002\u7cfb\u7edf\u6d4b\u8bd5\u901a\u5e38\u662f\u7531\u6d4b\u8bd5\u4eba\u5458\u7f16\u5199\u7684\uff0c\u7528\u4e8e\u9a8c\u8bc1\u8f6f\u4ef6\u7684\u6574\u4f53\u529f\u80fd\u3002\u7cfb\u7edf\u6d4b\u8bd5\u7684\u76ee\u7684\u662f\u786e\u4fdd\u8f6f\u4ef6\u7684\u6574\u4f53\u529f\u80fd\u80fd\u591f\u6ee1\u8db3\u7528\u6237\u7684\u9700\u6c42\u3002\u7cfb\u7edf\u6d4b\u8bd5\u4e00\u822c\u9700\u8981\u5b8c\u6574\u7684\u6d4b\u8bd5\u73af\u5883\uff0c\u4e3b\u8981\u5728\u529f\u80fd\u3001\u6027\u80fd\u3001\u8d1f\u8f7d\u3001\u5b89\u5168\u7b49\u65b9\u9762\u8fdb\u884c\u6d4b\u8bd5\u3002 :::","title":"1. \u524d\u8a00"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#2-ctest","text":"\u5728\u5b89\u88c5 CMake \u7684\u540c\u65f6\uff0cCTest \u4e5f\u4f1a\u88ab\u5b89\u88c5\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728 CMakeLists.txt \u6587\u4ef6\u4e2d\u4f7f\u7528 CTest \u76f8\u5173\u7684\u5185\u5bb9\u3002","title":"2. CTest \u7684\u57fa\u672c\u4ecb\u7ecd"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#21","text":"\u5728\u6dfb\u52a0\u6d4b\u8bd5\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5728 CMakeLists.txt \u6587\u4ef6\u4e2d\u542f\u7528\u6d4b\u8bd5\u3002\u542f\u7528\u6d4b\u8bd5\u7684\u65b9\u6cd5\u662f\u5728 CMakeLists.txt \u6587\u4ef6\u4e2d\u6dfb\u52a0 enable_testing() \u6211\u4eec\u5148\u51c6\u5907\u4e00\u4e2a\u7b80\u5355\u7684\u8ba1\u7b97\u4e24\u6570\u4e4b\u548c\u7684\u9879\u76ee\uff0c\u76ee\u5f55\u5982\u4e0b Add \u251c\u2500\u2500 CMakeLists.txt \u251c\u2500\u2500 main.cpp \u251c\u2500\u2500 add.cpp \u2514\u2500\u2500 add.hpp ::: code-tabs @tab add.cpp #include \"add.hpp\" int add(int a, int b) { return a + b; } @tab add.hpp #ifndef ADD_HPP #define ADD_HPP int add(int a, int b); #endif // ADD_HPP @tab main.cpp ```cpp :collapsed-lines=6","title":"2.1 \u542f\u7528\u6d4b\u8bd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#include","text":"","title":"include"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#include_1","text":"","title":"include"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#include-addhpp","text":"int main(int argc, char *argv[]) { if (argc < 4) { printf(\"Usage: %s \\n\", argv[0]); return -1; } int a = std::atoi(argv[1]); int b = std::atoi(argv[2]); int predict = std::atoi(argv[3]); int sum = add(a, b); return sum == predict ? 0 : -1; } ::: \u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u8ba1\u7b97\u4e24\u6570\u4e4b\u548c\u7684\u9879\u76ee\uff0c\u9700\u8981\u7528\u6237\u8f93\u5165 3 \u4e2a\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u5206\u522b\u662f\u4e24\u4e2a\u52a0\u6570\u548c\u9884\u671f\u7684\u548c\u3002\u5982\u679c\u8ba1\u7b97\u7ed3\u679c\u4e0e\u9884\u671f\u7684\u548c\u76f8\u7b49\uff0c\u5219\u8fd4\u56de `0`\uff0c\u5426\u5219\u8fd4\u56de `-1`\u3002\u7136\u540e\uff0c\u6211\u4eec\u5728 `CMakeLists.txt` \u6587\u4ef6\u4e2d\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9 ```cmake cmake_minimum_required(VERSION 3.16) project(Add) add_library(add STATIC add.cpp) add_executable(demo main.cpp) target_link_libraries(demo PRIVATE add) enable_testing() \u81f3\u6b64\uff0c\u6211\u4eec\u5b8c\u6210\u4e86\u6d4b\u8bd5\u7684\u524d\u671f\u51c6\u5907\u5de5\u4f5c\u3002","title":"include \"add.hpp\""},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#22","text":"\u5728 CMakeLists.txt \u6587\u4ef6\u4e2d\u6dfb\u52a0\u6d4b\u8bd5\u7684\u65b9\u6cd5\u662f\u4f7f\u7528 add_test \u547d\u4ee4\u3002 add_test \u547d\u4ee4\u7684\u8bed\u6cd5\u5982\u4e0b add_test( NAME <name> # \u6d4b\u8bd5\u7684\u540d\u79f0\uff0c\u53ef\u4ee5\u968f\u4fbf\u5199\uff0c\u4f46\u6700\u597d\u89c1\u540d\u77e5\u610f COMMAND <command> [arg1 [arg2 ...]] # \u6d4b\u8bd5\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u662f\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u6216\u4e00\u4e2a\u811a\u672c ) \u5176\u4e2d\uff0c name \u662f\u6d4b\u8bd5\u7684\u540d\u79f0\uff0c command \u662f\u6d4b\u8bd5\u7684\u547d\u4ee4\u3002\u6211\u4eec\u5728 CMakeLists.txt \u6587\u4ef6\u672b\u5c3e\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9\u4ee5\u6dfb\u52a0 5 \u4e2a\u6d4b\u8bd5 add_test(NAME AddTest.positive COMMAND demo 1 2 3) add_test(NAME AddTest.negative COMMAND demo -1 -2 -3) add_test(NAME AddTest.zero COMMAND demo 0 0 0) add_test(NAME AddTest.mixed COMMAND demo 1 -2 -1) add_test(NAME AddTest.failed_example COMMAND demo 1 2 4)","title":"2.2 \u6dfb\u52a0\u6d4b\u8bd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#23","text":"\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u6784\u5efa\u9879\u76ee mkdir build cd build cmake .. cmake --build . \u7136\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8fd0\u884c\u6d4b\u8bd5 ctest \u8fd0\u884c\u7ed3\u679c\u5982\u4e0b Test project /path/to/Add/build Start 1: AddTest.positive 1/5 Test #1: AddTest.positive ................. Passed 0.00 sec Start 2: AddTest.negative 2/5 Test #2: AddTest.negative ................. Passed 0.00 sec Start 3: AddTest.zero 3/5 Test #3: AddTest.zero ..................... Passed 0.00 sec Start 4: AddTest.mixed 4/5 Test #4: AddTest.mixed .................... Passed 0.00 sec Start 5: AddTest.failed_example 5/5 Test #5: AddTest.failed_example ...........***Failed 0.00 sec 80% tests passed, 1 tests failed out of 5 Total Test time (real) = 0.01 sec","title":"2.3 \u8fd0\u884c\u6d4b\u8bd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#3-googletest","text":"GoogleTest \u662f Google \u5f00\u53d1\u7684\u4e00\u4e2a C++ \u6d4b\u8bd5\u6846\u67b6\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u65ad\u8a00\u548c\u6d4b\u8bd5\u7528\u4f8b\u7ba1\u7406\u529f\u80fd\uff0cCMake \u4e5f\u63d0\u4f9b\u4e86 GoogleTest \u76f8\u5173\u7684\u5b8f\u548c\u51fd\u6570\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5c06 GoogleTest \u4e0e CTest \u96c6\u6210\u3002","title":"3. \u4e0e GoogleTest \u7ed3\u5408\u4f7f\u7528"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#31","text":"\u9996\u5148\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5220\u9664 main.cpp \u6587\u4ef6\uff0c\u4f46\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u6d4b\u8bd5\u6587\u4ef6 test_add.cpp \uff0c\u53d8\u66f4\u540e\u7684\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b Add \u251c\u2500\u2500 CMakeLists.txt \u251c\u2500\u2500 add.cpp \u251c\u2500\u2500 add.hpp \u2514\u2500\u2500 test_add.cpp test_add.cpp \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b #include <gtest/gtest.h> #include \"add.hpp\" TEST(AddTest, Positive) { EXPECT_EQ(add(1, 2), 3); } TEST(AddTest, Negative) { EXPECT_EQ(add(-1, -2), -3); } TEST(AddTest, Zero) { EXPECT_EQ(add(0, 0), 0); } TEST(AddTest, Mixed) { EXPECT_EQ(add(1, -2), -1); } TEST(AddTest, FailedExample) { EXPECT_EQ(add(1, 2), 4); } \u7136\u540e\uff0c\u6211\u4eec\u6539\u5199 CMakeLists.txt \u6587\u4ef6\uff0c\u4f7f\u5176\u652f\u6301 GoogleTest \u6d4b\u8bd5\u6846\u67b6\u3002\u6539\u5199\u540e\u7684 CMakeLists.txt \u6587\u4ef6\u5185\u5bb9\u5982\u4e0b cmake_minimum_required(VERSION 3.16) project(Add) add_library(add STATIC add.cpp) # \u5148\u4e0d\u8981\u7591\u60d1\u4e3a\u4ec0\u4e48 test_add.cpp \u6ca1\u6709 main \u51fd\u6570\u4e5f\u53ef\u4ee5\u7f16\u8bd1\u6210\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u540e\u9762\u4f1a\u89e3\u91ca add_executable(test_add test_add.cpp) find_package(GTest REQUIRED) # \u5bfb\u627e GTest \u5e93 include(GoogleTest) # \u4f7f\u7528 GoogleTest \u63d0\u4f9b\u7684 CMake \u51fd\u6570 # GTest::gtest_main \u63d0\u4f9b\u4e86 main \u51fd\u6570\uff0c\u56e0\u6b64 test_add.cpp \u4e0d\u9700\u8981\u989d\u5916\u63d0\u4f9b main \u51fd\u6570 target_link_libraries(test_add PRIVATE add GTest::gtest_main ) enable_testing() # \u81ea\u52a8\u6dfb\u52a0 GoogleTest \u6d4b\u8bd5\u7528\u4f8b gtest_discover_tests(test_add)","title":"3.1 \u6587\u4ef6\u51c6\u5907"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/12/#32","text":"\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u6784\u5efa\u9879\u76ee mkdir build cd build cmake .. cmake --build . \u6700\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8fd0\u884c\u6d4b\u8bd5 ctest \u8fd0\u884c\u7ed3\u679c\u5982\u4e0b Test project /path/to/Add/build Start 1: AddTest.Positive 1/5 Test #1: AddTest.Positive ................. Passed 0.00 sec Start 2: AddTest.Negative 2/5 Test #2: AddTest.Negative ................. Passed 0.00 sec Start 3: AddTest.Zero 3/5 Test #3: AddTest.Zero ..................... Passed 0.00 sec Start 4: AddTest.Mixed 4/5 Test #4: AddTest.Mixed .................... Passed 0.00 sec Start 5: AddTest.FailedExample 5/5 Test #5: AddTest.FailedExample ............***Failed 0.00 sec 80% tests passed, 1 tests failed out of 5 Total Test time (real) = 0.01 sec","title":"3.2 \u8fd0\u884c\u6d4b\u8bd5"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/13/","text":"\u301013\u3011CPack \u5de5\u5177 \u6559\u5b66\u89c6\u9891 ::: tip \u5373\u5c06\u5230\u6765 ... - \u301012\u3011CMake\uff1aCPack \u5de5\u5177 ::: ::: warning \u672a\u5b8c\u6210... ::: 1. \u7b80\u4ecb 1.1 CPack \u7684\u57fa\u672c\u4ecb\u7ecd 1.2 CPack \u652f\u6301\u7684\u751f\u6210\u5668 2. CPack \u7684\u57fa\u672c\u4f7f\u7528 2.1 \u901a\u7528 CPack \u914d\u7f6e 2.2 \u90e8\u5206\u751f\u6210\u5668 CPack \u914d\u7f6e Debian \u751f\u6210\u5668 CPack \u4e13\u5c5e\u914d\u7f6e NSIS \u751f\u6210\u5668 CPack \u4e13\u5c5e\u914d\u7f6e 3. \u9879\u76ee CPack \u6587\u4ef6\u7684\u5199\u6cd5 \u7528\u4e8e\u6253\u5305\u7684 CPack \u914d\u7f6e\u6587\u4ef6\u547d\u540d\u6ca1\u6709\u7279\u522b\u7684\u8bb2\u7a76\uff0c\u6bd4\u65b9\u8bf4 OpenCV \u7684 CPack \u914d\u7f6e\u6587\u4ef6\u547d\u540d\u4e3a OpenCVPackaging.cmake \uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5c06 CPack \u914d\u7f6e\u6587\u4ef6\u547d\u540d\u4e3a <PackageName>Packaging.cmake \uff0c\u5e76\u653e\u7f6e\u5728\u9879\u76ee cmake \u76ee\u5f55\u4e0b\u3002","title":"\u301013\u3011CPack \u5de5\u5177"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/13/#13cpack","text":"","title":"\u301013\u3011CPack \u5de5\u5177"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/13/#_1","text":"::: tip \u5373\u5c06\u5230\u6765 ... - \u301012\u3011CMake\uff1aCPack \u5de5\u5177 ::: ::: warning \u672a\u5b8c\u6210... :::","title":"\u6559\u5b66\u89c6\u9891"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/13/#1","text":"","title":"1. \u7b80\u4ecb"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/13/#11-cpack","text":"","title":"1.1 CPack \u7684\u57fa\u672c\u4ecb\u7ecd"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/13/#12-cpack","text":"","title":"1.2 CPack \u652f\u6301\u7684\u751f\u6210\u5668"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/13/#2-cpack","text":"","title":"2. CPack \u7684\u57fa\u672c\u4f7f\u7528"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/13/#21-cpack","text":"","title":"2.1 \u901a\u7528 CPack \u914d\u7f6e"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/13/#22-cpack","text":"","title":"2.2 \u90e8\u5206\u751f\u6210\u5668 CPack \u914d\u7f6e"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/13/#debian-cpack","text":"","title":"Debian \u751f\u6210\u5668 CPack \u4e13\u5c5e\u914d\u7f6e"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/13/#nsis-cpack","text":"","title":"NSIS \u751f\u6210\u5668 CPack \u4e13\u5c5e\u914d\u7f6e"},{"location":"%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/cmake/13/#3-cpack","text":"\u7528\u4e8e\u6253\u5305\u7684 CPack \u914d\u7f6e\u6587\u4ef6\u547d\u540d\u6ca1\u6709\u7279\u522b\u7684\u8bb2\u7a76\uff0c\u6bd4\u65b9\u8bf4 OpenCV \u7684 CPack \u914d\u7f6e\u6587\u4ef6\u547d\u540d\u4e3a OpenCVPackaging.cmake \uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5c06 CPack \u914d\u7f6e\u6587\u4ef6\u547d\u540d\u4e3a <PackageName>Packaging.cmake \uff0c\u5e76\u653e\u7f6e\u5728\u9879\u76ee cmake \u76ee\u5f55\u4e0b\u3002","title":"3. \u9879\u76ee CPack \u6587\u4ef6\u7684\u5199\u6cd5"},{"location":"%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/c%2B%2B/","text":"","title":"C++"}]}